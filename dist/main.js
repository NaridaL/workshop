!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=39)}([function(t,e){
/*!
 * Chai - flag utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
t.exports=function(t,e,r){var n=t.__flags||(t.__flags=Object.create(null));if(3!==arguments.length)return n[e];n[e]=r}},function(t,e,r){t.exports=r(2)},function(t,e,r){
/*!
 * chai
 * Copyright(c) 2011-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
var n=[];
/*!
 * Chai version
 */e.version="4.2.0",
/*!
 * Assertion Error
 */
e.AssertionError=r(10);
/*!
 * Utils for plugins (not exported)
 */
var i=r(16);e.use=function(t){return~n.indexOf(t)||(t(e,i),n.push(t)),e},
/*!
 * Utility Functions
 */
e.util=i;
/*!
 * Configuration
 */
var o=r(4);e.config=o;
/*!
 * Primary `Assertion` prototype
 */
var s=r(34);e.use(s);
/*!
 * Core Assertions
 */
var a=r(35);e.use(a);
/*!
 * Expect interface
 */
var h=r(36);e.use(h);
/*!
 * Should interface
 */
var c=r(37);e.use(c);
/*!
 * Assert interface
 */
var u=r(38);e.use(u)},function(t,e){
/*!
 * Chai - transferFlags utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
t.exports=function(t,e,r){var n=t.__flags||(t.__flags=Object.create(null));for(var i in e.__flags||(e.__flags=Object.create(null)),r=3!==arguments.length||r,n)(r||"object"!==i&&"ssfi"!==i&&"lockSsfi"!==i&&"message"!=i)&&(e.__flags[i]=n[i])}},function(t,e){t.exports={includeStack:!1,showDiff:!0,truncateThreshold:40,useProxy:!0,proxyExcludedKeys:["then","catch","inspect","toJSON"]}},function(t,e,r){var n=r(4);
/*!
 * Chai - isProxyEnabled helper
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */t.exports=function(){return n.useProxy&&"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect}},function(t,e){var r=Object.getOwnPropertyDescriptor((function(){}),"length");
/*!
 * Chai - addLengthGuard utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */t.exports=function(t,e,n){return r.configurable?(Object.defineProperty(t,"length",{get:function(){if(n)throw Error("Invalid Chai property: "+e+'.length. Due to a compatibility issue, "length" cannot directly follow "'+e+'". Use "'+e+'.lengthOf" instead.');throw Error("Invalid Chai property: "+e+'.length. See docs for proper usage of "'+e+'".')}}),t):t}},function(t,e,r){var n=r(4),i=r(0),o=r(14),s=r(5),a=["__flags","__methods","_obj","assert"];t.exports=function(t,e){return s()?new Proxy(t,{get:function t(r,s){if("string"==typeof s&&-1===n.proxyExcludedKeys.indexOf(s)&&!Reflect.has(r,s)){if(e)throw Error("Invalid Chai property: "+e+"."+s+'. See docs for proper usage of "'+e+'".');var h=null,c=4;throw o(r).forEach((function(t){if(!Object.prototype.hasOwnProperty(t)&&-1===a.indexOf(t)){var e=function(t,e,r){if(Math.abs(t.length-e.length)>=r)return r;for(var n=[],i=0;i<=t.length;i++)n[i]=Array(e.length+1).fill(0),n[i][0]=i;for(var o=0;o<e.length;o++)n[0][o]=o;for(i=1;i<=t.length;i++){var s=t.charCodeAt(i-1);for(o=1;o<=e.length;o++)Math.abs(i-o)>=r?n[i][o]=r:n[i][o]=Math.min(n[i-1][o]+1,n[i][o-1]+1,n[i-1][o-1]+(s===e.charCodeAt(o-1)?0:1))}return n[t.length][e.length]}(s,t,c);e<c&&(h=t,c=e)}})),null!==h?Error("Invalid Chai property: "+s+'. Did you mean "'+h+'"?'):Error("Invalid Chai property: "+s)}return-1!==a.indexOf(s)||i(r,"lockSsfi")||i(r,"ssfi",t),Reflect.get(r,s)}}):t}},function(t,e,r){(function(e){var r;r=function(){"use strict";var t="function"==typeof Promise,r="object"==typeof self?self:e,n="undefined"!=typeof Symbol,i="undefined"!=typeof Map,o="undefined"!=typeof Set,s="undefined"!=typeof WeakMap,a="undefined"!=typeof WeakSet,h="undefined"!=typeof DataView,c=n&&void 0!==Symbol.iterator,u=n&&void 0!==Symbol.toStringTag,l=o&&"function"==typeof Set.prototype.entries,f=i&&"function"==typeof Map.prototype.entries,d=l&&Object.getPrototypeOf((new Set).entries()),m=f&&Object.getPrototypeOf((new Map).entries()),p=c&&"function"==typeof Array.prototype[Symbol.iterator],g=p&&Object.getPrototypeOf([][Symbol.iterator]()),w=c&&"function"==typeof String.prototype[Symbol.iterator],y=w&&Object.getPrototypeOf(""[Symbol.iterator]());return function(e){var n=typeof e;if("object"!==n)return n;if(null===e)return"null";if(e===r)return"global";if(Array.isArray(e)&&(!1===u||!(Symbol.toStringTag in e)))return"Array";if("object"==typeof window&&null!==window){if("object"==typeof window.location&&e===window.location)return"Location";if("object"==typeof window.document&&e===window.document)return"Document";if("object"==typeof window.navigator){if("object"==typeof window.navigator.mimeTypes&&e===window.navigator.mimeTypes)return"MimeTypeArray";if("object"==typeof window.navigator.plugins&&e===window.navigator.plugins)return"PluginArray"}if(("function"==typeof window.HTMLElement||"object"==typeof window.HTMLElement)&&e instanceof window.HTMLElement){if("BLOCKQUOTE"===e.tagName)return"HTMLQuoteElement";if("TD"===e.tagName)return"HTMLTableDataCellElement";if("TH"===e.tagName)return"HTMLTableHeaderCellElement"}}var c=u&&e[Symbol.toStringTag];if("string"==typeof c)return c;var l=Object.getPrototypeOf(e);return l===RegExp.prototype?"RegExp":l===Date.prototype?"Date":t&&l===Promise.prototype?"Promise":o&&l===Set.prototype?"Set":i&&l===Map.prototype?"Map":a&&l===WeakSet.prototype?"WeakSet":s&&l===WeakMap.prototype?"WeakMap":h&&l===DataView.prototype?"DataView":i&&l===m?"Map Iterator":o&&l===d?"Set Iterator":p&&l===g?"Array Iterator":w&&l===y?"String Iterator":null===l?"Object":Object.prototype.toString.call(e).slice(8,-1)}},t.exports=r()}).call(this,r(19))},function(t,e,r){var n=r(13),i=r(14),o=r(22),s=r(4);t.exports=function(t,e,r,n){return a({showHidden:e,seen:[],stylize:function(t){return t}},t,void 0===r?2:r)};function a(t,r,m){if(r&&"function"==typeof r.inspect&&r.inspect!==e.inspect&&(!r.constructor||r.constructor.prototype!==r)){var p=r.inspect(m,t);return"string"!=typeof p&&(p=a(t,p,m)),p}var g,w=function(t,e){switch(typeof e){case"undefined":return t.stylize("undefined","undefined");case"string":var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string");case"number":return 0===e&&1/e==-1/0?t.stylize("-0","number"):t.stylize(""+e,"number");case"boolean":return t.stylize(""+e,"boolean");case"symbol":return t.stylize(e.toString(),"symbol")}if(null===e)return t.stylize("null","null")}(t,r);if(w)return w;if(g=r,"object"==typeof HTMLElement?g instanceof HTMLElement:g&&"object"==typeof g&&"nodeType"in g&&1===g.nodeType&&"string"==typeof g.nodeName){if("outerHTML"in r)return r.outerHTML;try{if(document.xmlVersion)return(new XMLSerializer).serializeToString(r);var y=document.createElementNS("http://www.w3.org/1999/xhtml","_");y.appendChild(r.cloneNode(!1));var b=y.innerHTML.replace("><",">"+r.innerHTML+"<");return y.innerHTML="",b}catch(t){}}var x,v,M=o(r),E=t.showHidden?i(r):M;if(0===E.length||f(r)&&(1===E.length&&"stack"===E[0]||2===E.length&&"description"===E[0]&&"stack"===E[1])){if("function"==typeof r)return v=(x=n(r))?": "+x:"",t.stylize("[Function"+v+"]","special");if(u(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(l(r))return t.stylize(Date.prototype.toUTCString.call(r),"date");if(f(r))return h(r)}var _,A,S="",O=!1,N=!1,T=["{","}"];if("object"==typeof(_=r)&&/\w+Array]$/.test(d(_))&&(N=!0,T=["[","]"]),function(t){return Array.isArray(t)||"object"==typeof t&&"[object Array]"===d(t)}(r)&&(O=!0,T=["[","]"]),"function"==typeof r&&(S=" [Function"+(v=(x=n(r))?": "+x:"")+"]"),u(r)&&(S=" "+RegExp.prototype.toString.call(r)),l(r)&&(S=" "+Date.prototype.toUTCString.call(r)),f(r))return h(r);if(0===E.length&&(!O||0==r.length))return T[0]+S+T[1];if(m<0)return u(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special");if(t.seen.push(r),O)A=function(t,e,r,n,i){for(var o=[],s=0,a=e.length;s<a;++s)Object.prototype.hasOwnProperty.call(e,String(s))?o.push(c(t,e,r,n,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(c(t,e,r,n,i,!0))})),o}(t,r,m,M,E);else{if(N)return function(t){for(var e="[ ",r=0;r<t.length;++r){if(e.length>=s.truncateThreshold-7){e+="...";break}e+=t[r]+", "}-1!==(e+=" ]").indexOf(",  ]")&&(e=e.replace(",  ]"," ]"));return e}(r);A=E.map((function(e){return c(t,r,m,M,e,O)}))}return t.seen.pop(),function(t,e,r){if(t.reduce((function(t,e){return t+e.length+1}),0)>60)return r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1];return r[0]+e+" "+t.join(", ")+" "+r[1]}(A,S,T)}function h(t){return"["+Error.prototype.toString.call(t)+"]"}function c(t,e,r,n,i,o){var s,h,c=Object.getOwnPropertyDescriptor(e,i);if(c&&(c.get?h=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(h=t.stylize("[Setter]","special"))),n.indexOf(i)<0&&(s="["+i+"]"),h||(t.seen.indexOf(e[i])<0?(h=a(t,e[i],null===r?null:r-1)).indexOf("\n")>-1&&(h=o?h.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+h.split("\n").map((function(t){return"   "+t})).join("\n")):h=t.stylize("[Circular]","special")),void 0===s){if(o&&i.match(/^\d+$/))return h;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+h}function u(t){return"object"==typeof t&&"[object RegExp]"===d(t)}function l(t){return"object"==typeof t&&"[object Date]"===d(t)}function f(t){return"object"==typeof t&&"[object Error]"===d(t)}function d(t){return Object.prototype.toString.call(t)}},function(t,e){
/*!
 * assertion-error
 * Copyright(c) 2013 Jake Luer <jake@qualiancy.com>
 * MIT Licensed
 */
/*!
 * Return a function that will copy properties from
 * one object to another excluding any originally
 * listed. Returned function will create a new `{}`.
 *
 * @param {String} excluded properties ...
 * @return {Function}
 */
function r(){var t=[].slice.call(arguments);function e(e,r){Object.keys(r).forEach((function(n){~t.indexOf(n)||(e[n]=r[n])}))}return function(){for(var t=[].slice.call(arguments),r=0,n={};r<t.length;r++)e(n,t[r]);return n}}function n(t,e,i){var o=r("name","message","stack","constructor","toJSON")(e||{});for(var s in this.message=t||"Unspecified AssertionError",this.showDiff=!1,o)this[s]=o[s];if(i=i||n,Error.captureStackTrace)Error.captureStackTrace(this,i);else try{throw new Error}catch(t){this.stack=t.stack}}
/*!
 * Inherit from Error.prototype
 */
/*!
 * Primary Exports
 */
t.exports=n,n.prototype=Object.create(Error.prototype),
/*!
 * Statically set name
 */
n.prototype.name="AssertionError",
/*!
 * Ensure correct constructor
 */
n.prototype.constructor=n,n.prototype.toJSON=function(t){var e=r("constructor","toJSON","stack")({name:this.name},this);return!1!==t&&this.stack&&(e.stack=this.stack),e}},function(t,e){
/*!
 * Chai - getActual utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
t.exports=function(t,e){return e.length>4?e[4]:t._obj}},function(t,e,r){
/*!
 * Chai - flag utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
/*!
 * Module dependencies
 */
var n=r(9),i=r(4);t.exports=function(t){var e=n(t),r=Object.prototype.toString.call(t);if(i.truncateThreshold&&e.length>=i.truncateThreshold){if("[object Function]"===r)return t.name&&""!==t.name?"[Function: "+t.name+"]":"[Function]";if("[object Array]"===r)return"[ Array("+t.length+") ]";if("[object Object]"===r){var o=Object.keys(t);return"{ Object ("+(o.length>2?o.splice(0,2).join(", ")+", ...":o.join(", "))+") }"}return e}return e}},function(t,e,r){"use strict";var n=Function.prototype.toString,i=/\s*function(?:\s|\s*\/\*[^(?:*\/)]+\*\/\s*)*([^\s\(\/]+)/;t.exports=function(t){if("function"!=typeof t)return null;var e="";if(void 0===Function.prototype.name&&void 0===t.name){var r=n.call(t).match(i);r&&(e=r[1])}else e=t.name;return e}},function(t,e){
/*!
 * Chai - getProperties utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
t.exports=function(t){var e=Object.getOwnPropertyNames(t);function r(t){-1===e.indexOf(t)&&e.push(t)}for(var n=Object.getPrototypeOf(t);null!==n;)Object.getOwnPropertyNames(n).forEach(r),n=Object.getPrototypeOf(n);return e}},function(t,e){
/*!
 * Chai - getOwnEnumerablePropertySymbols utility
 * Copyright(c) 2011-2016 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
t.exports=function(t){return"function"!=typeof Object.getOwnPropertySymbols?[]:Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))}},function(t,e,r){
/*!
 * chai
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
/*!
 * Dependencies that are used for multiple exports are required here only once
 */
var n=r(17);
/*!
 * test utility
 */e.test=r(18),
/*!
 * type utility
 */
e.type=r(8),
/*!
 * expectTypes utility
 */
e.expectTypes=r(20),
/*!
 * message utility
 */
e.getMessage=r(21),
/*!
 * actual utility
 */
e.getActual=r(11),
/*!
 * Inspect util
 */
e.inspect=r(9),
/*!
 * Object Display util
 */
e.objDisplay=r(12),
/*!
 * Flag utility
 */
e.flag=r(0),
/*!
 * Flag transferring utility
 */
e.transferFlags=r(3),
/*!
 * Deep equal utility
 */
e.eql=r(23),
/*!
 * Deep path info
 */
e.getPathInfo=n.getPathInfo,
/*!
 * Check if a property exists
 */
e.hasProperty=n.hasProperty,
/*!
 * Function name
 */
e.getName=r(13),
/*!
 * add Property
 */
e.addProperty=r(24),
/*!
 * add Method
 */
e.addMethod=r(25),
/*!
 * overwrite Property
 */
e.overwriteProperty=r(26),
/*!
 * overwrite Method
 */
e.overwriteMethod=r(27),
/*!
 * Add a chainable method
 */
e.addChainableMethod=r(28),
/*!
 * Overwrite chainable method
 */
e.overwriteChainableMethod=r(29),
/*!
 * Compare by inspect method
 */
e.compareByInspect=r(30),
/*!
 * Get own enumerable property symbols method
 */
e.getOwnEnumerablePropertySymbols=r(15),
/*!
 * Get own enumerable properties method
 */
e.getOwnEnumerableProperties=r(31),
/*!
 * Checks error against a given set of criteria
 */
e.checkError=r(32),
/*!
 * Proxify util
 */
e.proxify=r(7),
/*!
 * addLengthGuard util
 */
e.addLengthGuard=r(6),
/*!
 * isProxyEnabled helper
 */
e.isProxyEnabled=r(5),
/*!
 * isNaN method
 */
e.isNaN=r(33)},function(t,e,r){"use strict";function n(t,e){return null!=t&&e in Object(t)}function i(t){return t.replace(/([^\\])\[/g,"$1.[").match(/(\\\.|[^.]+?)+/g).map((function(t){var e=/^\[(\d+)\]$/.exec(t);return e?{i:parseFloat(e[1])}:{p:t.replace(/\\([.\[\]])/g,"$1")}}))}function o(t,e,r){var n=t,i=null;r=void 0===r?e.length:r;for(var o=0;o<r;o++){var s=e[o];n&&(n=void 0===s.p?n[s.i]:n[s.p],o===r-1&&(i=n))}return i}function s(t,e){var r=i(e),s=r[r.length-1],a={parent:r.length>1?o(t,r,r.length-1):t,name:s.p||s.i,value:o(t,r)};return a.exists=n(a.parent,a.name),a}t.exports={hasProperty:n,getPathInfo:s,getPathValue:function(t,e){return s(t,e).value},setPathValue:function(t,e,r){return function(t,e,r){for(var n=t,i=r.length,o=null,s=0;s<i;s++){var a=null,h=null;if(o=r[s],s===i-1)n[a=void 0===o.p?o.i:o.p]=e;else if(void 0!==o.p&&n[o.p])n=n[o.p];else if(void 0!==o.i&&n[o.i])n=n[o.i];else{var c=r[s+1];a=void 0===o.p?o.i:o.p,h=void 0===c.p?[]:{},n[a]=h,n=n[a]}}}(t,r,i(e)),t}}},function(t,e,r){
/*!
 * Chai - test utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
/*!
 * Module dependencies
 */
var n=r(0);t.exports=function(t,e){var r=n(t,"negate"),i=e[0];return r?!i:i}},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){
/*!
 * Chai - expectTypes utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
var n=r(10),i=r(0),o=r(8);t.exports=function(t,e){var r=i(t,"message"),s=i(t,"ssfi");r=r?r+": ":"",t=i(t,"object"),(e=e.map((function(t){return t.toLowerCase()}))).sort();var a=e.map((function(t,r){var n=~["a","e","i","o","u"].indexOf(t.charAt(0))?"an":"a";return(e.length>1&&r===e.length-1?"or ":"")+n+" "+t})).join(", "),h=o(t).toLowerCase();if(!e.some((function(t){return h===t})))throw new n(r+"object tested must be "+a+", but "+h+" given",void 0,s)}},function(t,e,r){
/*!
 * Chai - message composition utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
/*!
 * Module dependencies
 */
var n=r(0),i=r(11),o=r(12);t.exports=function(t,e){var r=n(t,"negate"),s=n(t,"object"),a=e[3],h=i(t,e),c=r?e[2]:e[1],u=n(t,"message");return"function"==typeof c&&(c=c()),c=(c=c||"").replace(/#\{this\}/g,(function(){return o(s)})).replace(/#\{act\}/g,(function(){return o(h)})).replace(/#\{exp\}/g,(function(){return o(a)})),u?u+": "+c:c}},function(t,e){
/*!
 * Chai - getEnumerableProperties utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
t.exports=function(t){var e=[];for(var r in t)e.push(r);return e}},function(t,e,r){"use strict";
/*!
 * deep-eql
 * Copyright(c) 2013 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */var n=r(8);function i(){this._key="chai/deep-eql__"+Math.random()+Date.now()}i.prototype={get:function(t){return t[this._key]},set:function(t,e){Object.isExtensible(t)&&Object.defineProperty(t,this._key,{value:e,configurable:!0})}};var o="function"==typeof WeakMap?WeakMap:i;
/*!
 * Check to see if the MemoizeMap has recorded a result of the two operands
 *
 * @param {Mixed} leftHandOperand
 * @param {Mixed} rightHandOperand
 * @param {MemoizeMap} memoizeMap
 * @returns {Boolean|null} result
*/function s(t,e,r){if(!r||g(t)||g(e))return null;var n=r.get(t);if(n){var i=n.get(e);if("boolean"==typeof i)return i}return null}
/*!
 * Set the result of the equality into the MemoizeMap
 *
 * @param {Mixed} leftHandOperand
 * @param {Mixed} rightHandOperand
 * @param {MemoizeMap} memoizeMap
 * @param {Boolean} result
*/function a(t,e,r,n){if(r&&!g(t)&&!g(e)){var i=r.get(t);i?i.set(e,n):((i=new o).set(e,n),r.set(t,i))}}
/*!
 * Primary Export
 */function h(t,e,r){if(r&&r.comparator)return u(t,e,r);var n=c(t,e);return null!==n?n:u(t,e,r)}function c(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e||!g(t)&&!g(e)&&null}
/*!
 * The main logic of the `deepEqual` function.
 *
 * @param {Mixed} leftHandOperand
 * @param {Mixed} rightHandOperand
 * @param {Object} [options] (optional) Additional options
 * @param {Array} [options.comparator] (optional) Override default algorithm, determining custom equality.
 * @param {Array} [options.memoize] (optional) Provide a custom memoization object which will cache the results of
    complex objects for a speed boost. By passing `false` you can disable memoization, but this will cause circular
    references to blow the stack.
 * @return {Boolean} equal match
*/function u(t,e,r){(r=r||{}).memoize=!1!==r.memoize&&(r.memoize||new o);var i=r&&r.comparator,u=s(t,e,r.memoize);if(null!==u)return u;var g=s(e,t,r.memoize);if(null!==g)return g;if(i){var w=i(t,e);if(!1===w||!0===w)return a(t,e,r.memoize,w),w;var y=c(t,e);if(null!==y)return y}var b=n(t);if(b!==n(e))return a(t,e,r.memoize,!1),!1;a(t,e,r.memoize,!0);var x=function(t,e,r,n){switch(r){case"String":case"Number":case"Boolean":case"Date":return h(t.valueOf(),e.valueOf());case"Promise":case"Symbol":case"function":case"WeakMap":case"WeakSet":case"Error":return t===e;case"Arguments":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"Array":return f(t,e,n);case"RegExp":
/*!
 * Compare two Regular Expressions for equality.
 *
 * @param {RegExp} leftHandOperand
 * @param {RegExp} rightHandOperand
 * @return {Boolean} result
 */
return function(t,e){return t.toString()===e.toString()}
/*!
 * Compare two Sets/Maps for equality. Faster than other equality functions.
 *
 * @param {Set} leftHandOperand
 * @param {Set} rightHandOperand
 * @param {Object} [options] (Optional)
 * @return {Boolean} result
 */(t,e);case"Generator":
/*!
 * Simple equality for generator objects such as those returned by generator functions.
 *
 * @param {Iterable} leftHandOperand
 * @param {Iterable} rightHandOperand
 * @param {Object} [options] (Optional)
 * @return {Boolean} result
 */
return function(t,e,r){return f(m(t),m(e),r)}
/*!
 * Determine if the given object has an @@iterator function.
 *
 * @param {Object} target
 * @return {Boolean} `true` if the object has an @@iterator function.
 */(t,e,n);case"DataView":return f(new Uint8Array(t.buffer),new Uint8Array(e.buffer),n);case"ArrayBuffer":return f(new Uint8Array(t),new Uint8Array(e),n);case"Set":case"Map":return l(t,e,n);default:
/*!
 * Recursively check the equality of two Objects. Once basic sameness has been established it will defer to `deepEqual`
 * for each enumerable key in the object.
 *
 * @param {Mixed} leftHandOperand
 * @param {Mixed} rightHandOperand
 * @param {Object} [options] (Optional)
 * @return {Boolean} result
 */
return function(t,e,r){var n=p(t),i=p(e);if(n.length&&n.length===i.length)return n.sort(),i.sort(),!1!==f(n,i)&&
/*!
 * Determines if two objects have matching values, given a set of keys. Defers to deepEqual for the equality check of
 * each key. If any value of the given key is not equal, the function will return false (early).
 *
 * @param {Mixed} leftHandOperand
 * @param {Mixed} rightHandOperand
 * @param {Array} keys An array of keys to compare the values of leftHandOperand and rightHandOperand against
 * @param {Object} [options] (Optional)
 * @return {Boolean} result
 */
function(t,e,r,n){var i=r.length;if(0===i)return!0;for(var o=0;o<i;o+=1)if(!1===h(t[r[o]],e[r[o]],n))return!1;return!0}(t,e,n,r);var o=d(t),s=d(e);if(o.length&&o.length===s.length)return o.sort(),s.sort(),f(o,s,r);if(0===n.length&&0===o.length&&0===i.length&&0===s.length)return!0;return!1}
/*!
 * Returns true if the argument is a primitive.
 *
 * This intentionally returns true for all objects that can be compared by reference,
 * including functions and symbols.
 *
 * @param {Mixed} value
 * @return {Boolean} result
 */(t,e,n)}}(t,e,b,r);return a(t,e,r.memoize,x),x}function l(t,e,r){if(t.size!==e.size)return!1;if(0===t.size)return!0;var n=[],i=[];return t.forEach((function(t,e){n.push([t,e])})),e.forEach((function(t,e){i.push([t,e])})),f(n.sort(),i.sort(),r)}
/*!
 * Simple equality for flat iterable objects such as Arrays, TypedArrays or Node.js buffers.
 *
 * @param {Iterable} leftHandOperand
 * @param {Iterable} rightHandOperand
 * @param {Object} [options] (Optional)
 * @return {Boolean} result
 */function f(t,e,r){var n=t.length;if(n!==e.length)return!1;if(0===n)return!0;for(var i=-1;++i<n;)if(!1===h(t[i],e[i],r))return!1;return!0}
/*!
 * Gets all iterator entries from the given Object. If the Object has no @@iterator function, returns an empty array.
 * This will consume the iterator - which could have side effects depending on the @@iterator implementation.
 *
 * @param {Object} target
 * @returns {Array} an array of entries from the @@iterator function
 */
function d(t){if(function(t){return"undefined"!=typeof Symbol&&"object"==typeof t&&void 0!==Symbol.iterator&&"function"==typeof t[Symbol.iterator]}(t))try{return m(t[Symbol.iterator]())}catch(t){return[]}return[]}
/*!
 * Gets all entries from a Generator. This will consume the generator - which could have side effects.
 *
 * @param {Generator} target
 * @returns {Array} an array of entries from the Generator.
 */function m(t){for(var e=t.next(),r=[e.value];!1===e.done;)e=t.next(),r.push(e.value);return r}
/*!
 * Gets all own and inherited enumerable keys from a target.
 *
 * @param {Object} target
 * @returns {Array} an array of own and inherited enumerable keys from the target.
 */function p(t){var e=[];for(var r in t)e.push(r);return e}function g(t){return null===t||"object"!=typeof t}t.exports=h,t.exports.MemoizeMap=o},function(t,e,r){
/*!
 * Chai - addProperty utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
var n=r(2),i=r(0),o=r(5),s=r(3);t.exports=function(t,e,r){r=void 0===r?function(){}:r,Object.defineProperty(t,e,{get:function t(){o()||i(this,"lockSsfi")||i(this,"ssfi",t);var e=r.call(this);if(void 0!==e)return e;var a=new n.Assertion;return s(this,a),a},configurable:!0})}},function(t,e,r){
/*!
 * Chai - addMethod utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
var n=r(6),i=r(2),o=r(0),s=r(7),a=r(3);t.exports=function(t,e,r){var h=function(){o(this,"lockSsfi")||o(this,"ssfi",h);var t=r.apply(this,arguments);if(void 0!==t)return t;var e=new i.Assertion;return a(this,e),e};n(h,e,!1),t[e]=s(h,e)}},function(t,e,r){
/*!
 * Chai - overwriteProperty utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
var n=r(2),i=r(0),o=r(5),s=r(3);t.exports=function(t,e,r){var a=Object.getOwnPropertyDescriptor(t,e),h=function(){};a&&"function"==typeof a.get&&(h=a.get),Object.defineProperty(t,e,{get:function t(){o()||i(this,"lockSsfi")||i(this,"ssfi",t);var e=i(this,"lockSsfi");i(this,"lockSsfi",!0);var a=r(h).call(this);if(i(this,"lockSsfi",e),void 0!==a)return a;var c=new n.Assertion;return s(this,c),c},configurable:!0})}},function(t,e,r){
/*!
 * Chai - overwriteMethod utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
var n=r(6),i=r(2),o=r(0),s=r(7),a=r(3);t.exports=function(t,e,r){var h=t[e],c=function(){throw new Error(e+" is not a function")};h&&"function"==typeof h&&(c=h);var u=function(){o(this,"lockSsfi")||o(this,"ssfi",u);var t=o(this,"lockSsfi");o(this,"lockSsfi",!0);var e=r(c).apply(this,arguments);if(o(this,"lockSsfi",t),void 0!==e)return e;var n=new i.Assertion;return a(this,n),n};n(u,e,!1),t[e]=s(u,e)}},function(t,e,r){
/*!
 * Chai - addChainingMethod utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
/*!
 * Module dependencies
 */
var n=r(6),i=r(2),o=r(0),s=r(7),a=r(3),h="function"==typeof Object.setPrototypeOf,c=function(){},u=Object.getOwnPropertyNames(c).filter((function(t){var e=Object.getOwnPropertyDescriptor(c,t);return"object"!=typeof e||!e.configurable})),l=Function.prototype.call,f=Function.prototype.apply;t.exports=function(t,e,r,c){"function"!=typeof c&&(c=function(){});var d={method:r,chainingBehavior:c};t.__methods||(t.__methods={}),t.__methods[e]=d,Object.defineProperty(t,e,{get:function(){d.chainingBehavior.call(this);var r=function(){o(this,"lockSsfi")||o(this,"ssfi",r);var t=d.method.apply(this,arguments);if(void 0!==t)return t;var e=new i.Assertion;return a(this,e),e};if(n(r,e,!0),h){var c=Object.create(this);c.call=l,c.apply=f,Object.setPrototypeOf(r,c)}else{Object.getOwnPropertyNames(t).forEach((function(e){if(-1===u.indexOf(e)){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,n)}}))}return a(this,r),s(r)},configurable:!0})}},function(t,e,r){
/*!
 * Chai - overwriteChainableMethod utility
 * Copyright(c) 2012-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
var n=r(2),i=r(3);t.exports=function(t,e,r,o){var s=t.__methods[e],a=s.chainingBehavior;s.chainingBehavior=function(){var t=o(a).call(this);if(void 0!==t)return t;var e=new n.Assertion;return i(this,e),e};var h=s.method;s.method=function(){var t=r(h).apply(this,arguments);if(void 0!==t)return t;var e=new n.Assertion;return i(this,e),e}}},function(t,e,r){
/*!
 * Chai - compareByInspect utility
 * Copyright(c) 2011-2016 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
/*!
 * Module dependencies
 */
var n=r(9);t.exports=function(t,e){return n(t)<n(e)?-1:1}},function(t,e,r){
/*!
 * Chai - getOwnEnumerableProperties utility
 * Copyright(c) 2011-2016 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
/*!
 * Module dependencies
 */
var n=r(15);t.exports=function(t){return Object.keys(t).concat(n(t))}},function(t,e,r){"use strict";var n=/\s*function(?:\s|\s*\/\*[^(?:*\/)]+\*\/\s*)*([^\(\/]+)/;function i(t){var e="";if(void 0===t.name){var r=String(t).match(n);r&&(e=r[1])}else e=t.name;return e}t.exports={compatibleInstance:function(t,e){return e instanceof Error&&t===e},compatibleConstructor:function(t,e){return e instanceof Error?t.constructor===e.constructor||t instanceof e.constructor:(e.prototype instanceof Error||e===Error)&&(t.constructor===e||t instanceof e)},compatibleMessage:function(t,e){var r="string"==typeof t?t:t.message;return e instanceof RegExp?e.test(r):"string"==typeof e&&-1!==r.indexOf(e)},getMessage:function(t){var e="";return t&&t.message?e=t.message:"string"==typeof t&&(e=t),e},getConstructorName:function(t){var e=t;return t instanceof Error?e=i(t.constructor):"function"==typeof t&&(e=i(t).trim()||i(new t)),e}}},function(t,e){t.exports=Number.isNaN||
/*!
 * Chai - isNaN utility
 * Copyright(c) 2012-2015 Sakthipriyan Vairamani <thechargingvolcano@gmail.com>
 * MIT Licensed
 */
function(t){return t!=t}},function(t,e,r){
/*!
 * chai
 * http://chaijs.com
 * Copyright(c) 2011-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
var n=r(4);t.exports=function(t,e){
/*!
   * Module dependencies.
   */
var r=t.AssertionError,i=e.flag;
/*!
   * Module export.
   */
/*!
   * Assertion Constructor
   *
   * Creates object for chaining.
   *
   * `Assertion` objects contain metadata in the form of flags. Three flags can
   * be assigned during instantiation by passing arguments to this constructor:
   *
   * - `object`: This flag contains the target of the assertion. For example, in
   *   the assertion `expect(numKittens).to.equal(7);`, the `object` flag will
   *   contain `numKittens` so that the `equal` assertion can reference it when
   *   needed.
   *
   * - `message`: This flag contains an optional custom error message to be
   *   prepended to the error message that's generated by the assertion when it
   *   fails.
   *
   * - `ssfi`: This flag stands for "start stack function indicator". It
   *   contains a function reference that serves as the starting point for
   *   removing frames from the stack trace of the error that's created by the
   *   assertion when it fails. The goal is to provide a cleaner stack trace to
   *   end users by removing Chai's internal functions. Note that it only works
   *   in environments that support `Error.captureStackTrace`, and only when
   *   `Chai.config.includeStack` hasn't been set to `false`.
   *
   * - `lockSsfi`: This flag controls whether or not the given `ssfi` flag
   *   should retain its current value, even as assertions are chained off of
   *   this object. This is usually set to `true` when creating a new assertion
   *   from within another assertion. It's also temporarily set to `true` before
   *   an overwritten assertion gets called by the overwriting assertion.
   *
   * @param {Mixed} obj target of the assertion
   * @param {String} msg (optional) custom error message
   * @param {Function} ssfi (optional) starting point for removing stack frames
   * @param {Boolean} lockSsfi (optional) whether or not the ssfi flag is locked
   * @api private
   */
function o(t,r,n,s){return i(this,"ssfi",n||o),i(this,"lockSsfi",s),i(this,"object",t),i(this,"message",r),e.proxify(this)}t.Assertion=o,Object.defineProperty(o,"includeStack",{get:function(){return console.warn("Assertion.includeStack is deprecated, use chai.config.includeStack instead."),n.includeStack},set:function(t){console.warn("Assertion.includeStack is deprecated, use chai.config.includeStack instead."),n.includeStack=t}}),Object.defineProperty(o,"showDiff",{get:function(){return console.warn("Assertion.showDiff is deprecated, use chai.config.showDiff instead."),n.showDiff},set:function(t){console.warn("Assertion.showDiff is deprecated, use chai.config.showDiff instead."),n.showDiff=t}}),o.addProperty=function(t,r){e.addProperty(this.prototype,t,r)},o.addMethod=function(t,r){e.addMethod(this.prototype,t,r)},o.addChainableMethod=function(t,r,n){e.addChainableMethod(this.prototype,t,r,n)},o.overwriteProperty=function(t,r){e.overwriteProperty(this.prototype,t,r)},o.overwriteMethod=function(t,r){e.overwriteMethod(this.prototype,t,r)},o.overwriteChainableMethod=function(t,r,n){e.overwriteChainableMethod(this.prototype,t,r,n)},o.prototype.assert=function(t,o,s,a,h,c){var u=e.test(this,arguments);if(!1!==c&&(c=!0),void 0===a&&void 0===h&&(c=!1),!0!==n.showDiff&&(c=!1),!u){o=e.getMessage(this,arguments);var l=e.getActual(this,arguments);throw new r(o,{actual:l,expected:a,showDiff:c},n.includeStack?this.assert:i(this,"ssfi"))}},
/*!
   * ### ._obj
   *
   * Quick reference to stored `actual` value for plugin developers.
   *
   * @api private
   */
Object.defineProperty(o.prototype,"_obj",{get:function(){return i(this,"object")},set:function(t){i(this,"object",t)}})}},function(t,e){
/*!
 * chai
 * http://chaijs.com
 * Copyright(c) 2011-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
t.exports=function(t,e){var r=t.Assertion,n=t.AssertionError,i=e.flag;function o(t,r){r&&i(this,"message",r),t=t.toLowerCase();var n=i(this,"object"),o=~["a","e","i","o","u"].indexOf(t.charAt(0))?"an ":"a ";this.assert(t===e.type(n).toLowerCase(),"expected #{this} to be "+o+t,"expected #{this} not to be "+o+t)}function s(t,r){return e.isNaN(t)&&e.isNaN(r)||t===r}function a(){i(this,"contains",!0)}function h(t,o){o&&i(this,"message",o);var a=i(this,"object"),h=e.type(a).toLowerCase(),c=i(this,"message"),u=i(this,"negate"),l=i(this,"ssfi"),f=i(this,"deep"),d=f?"deep ":"";c=c?c+": ":"";var m=!1;switch(h){case"string":m=-1!==a.indexOf(t);break;case"weakset":if(f)throw new n(c+"unable to use .deep.include with WeakSet",void 0,l);m=a.has(t);break;case"map":var p=f?e.eql:s;a.forEach((function(e){m=m||p(e,t)}));break;case"set":f?a.forEach((function(r){m=m||e.eql(r,t)})):m=a.has(t);break;case"array":m=f?a.some((function(r){return e.eql(r,t)})):-1!==a.indexOf(t);break;default:if(t!==Object(t))throw new n(c+"object tested must be an array, a map, an object, a set, a string, or a weakset, but "+h+" given",void 0,l);var g=Object.keys(t),w=null,y=0;if(g.forEach((function(o){var s=new r(a);if(e.transferFlags(this,s,!0),i(s,"lockSsfi",!0),u&&1!==g.length)try{s.property(o,t[o])}catch(t){if(!e.checkError.compatibleConstructor(t,n))throw t;null===w&&(w=t),y++}else s.property(o,t[o])}),this),u&&g.length>1&&y===g.length)throw w;return}this.assert(m,"expected #{this} to "+d+"include "+e.inspect(t),"expected #{this} to not "+d+"include "+e.inspect(t))}function c(){var t=i(this,"object"),r=e.type(t);this.assert("Arguments"===r,"expected #{this} to be arguments but got "+r,"expected #{this} to not be arguments")}function u(t,e){e&&i(this,"message",e);var r=i(this,"object");if(i(this,"deep")){var n=i(this,"lockSsfi");i(this,"lockSsfi",!0),this.eql(t),i(this,"lockSsfi",n)}else this.assert(t===r,"expected #{this} to equal #{exp}","expected #{this} to not equal #{exp}",t,this._obj,!0)}function l(t,r){r&&i(this,"message",r),this.assert(e.eql(t,i(this,"object")),"expected #{this} to deeply equal #{exp}","expected #{this} to not deeply equal #{exp}",t,this._obj,!0)}function f(t,o){o&&i(this,"message",o);var s,a=i(this,"object"),h=i(this,"doLength"),c=i(this,"message"),u=c?c+": ":"",l=i(this,"ssfi"),f=e.type(a).toLowerCase(),d=e.type(t).toLowerCase(),m=!0;if(h&&"map"!==f&&"set"!==f&&new r(a,c,l,!0).to.have.property("length"),h||"date"!==f||"date"===d)if("number"===d||!h&&"number"!==f)if(h||"date"===f||"number"===f)m=!1;else{s=u+"expected "+("string"===f?"'"+a+"'":a)+" to be a number or a date"}else s=u+"the argument to above must be a number";else s=u+"the argument to above must be a date";if(m)throw new n(s,void 0,l);if(h){var p,g="length";"map"===f||"set"===f?(g="size",p=a.size):p=a.length,this.assert(p>t,"expected #{this} to have a "+g+" above #{exp} but got #{act}","expected #{this} to not have a "+g+" above #{exp}",t,p)}else this.assert(a>t,"expected #{this} to be above #{exp}","expected #{this} to be at most #{exp}",t)}function d(t,o){o&&i(this,"message",o);var s,a=i(this,"object"),h=i(this,"doLength"),c=i(this,"message"),u=c?c+": ":"",l=i(this,"ssfi"),f=e.type(a).toLowerCase(),d=e.type(t).toLowerCase(),m=!0;if(h&&"map"!==f&&"set"!==f&&new r(a,c,l,!0).to.have.property("length"),h||"date"!==f||"date"===d)if("number"===d||!h&&"number"!==f)if(h||"date"===f||"number"===f)m=!1;else{s=u+"expected "+("string"===f?"'"+a+"'":a)+" to be a number or a date"}else s=u+"the argument to least must be a number";else s=u+"the argument to least must be a date";if(m)throw new n(s,void 0,l);if(h){var p,g="length";"map"===f||"set"===f?(g="size",p=a.size):p=a.length,this.assert(p>=t,"expected #{this} to have a "+g+" at least #{exp} but got #{act}","expected #{this} to have a "+g+" below #{exp}",t,p)}else this.assert(a>=t,"expected #{this} to be at least #{exp}","expected #{this} to be below #{exp}",t)}function m(t,o){o&&i(this,"message",o);var s,a=i(this,"object"),h=i(this,"doLength"),c=i(this,"message"),u=c?c+": ":"",l=i(this,"ssfi"),f=e.type(a).toLowerCase(),d=e.type(t).toLowerCase(),m=!0;if(h&&"map"!==f&&"set"!==f&&new r(a,c,l,!0).to.have.property("length"),h||"date"!==f||"date"===d)if("number"===d||!h&&"number"!==f)if(h||"date"===f||"number"===f)m=!1;else{s=u+"expected "+("string"===f?"'"+a+"'":a)+" to be a number or a date"}else s=u+"the argument to below must be a number";else s=u+"the argument to below must be a date";if(m)throw new n(s,void 0,l);if(h){var p,g="length";"map"===f||"set"===f?(g="size",p=a.size):p=a.length,this.assert(p<t,"expected #{this} to have a "+g+" below #{exp} but got #{act}","expected #{this} to not have a "+g+" below #{exp}",t,p)}else this.assert(a<t,"expected #{this} to be below #{exp}","expected #{this} to be at least #{exp}",t)}function p(t,o){o&&i(this,"message",o);var s,a=i(this,"object"),h=i(this,"doLength"),c=i(this,"message"),u=c?c+": ":"",l=i(this,"ssfi"),f=e.type(a).toLowerCase(),d=e.type(t).toLowerCase(),m=!0;if(h&&"map"!==f&&"set"!==f&&new r(a,c,l,!0).to.have.property("length"),h||"date"!==f||"date"===d)if("number"===d||!h&&"number"!==f)if(h||"date"===f||"number"===f)m=!1;else{s=u+"expected "+("string"===f?"'"+a+"'":a)+" to be a number or a date"}else s=u+"the argument to most must be a number";else s=u+"the argument to most must be a date";if(m)throw new n(s,void 0,l);if(h){var p,g="length";"map"===f||"set"===f?(g="size",p=a.size):p=a.length,this.assert(p<=t,"expected #{this} to have a "+g+" at most #{exp} but got #{act}","expected #{this} to have a "+g+" above #{exp}",t,p)}else this.assert(a<=t,"expected #{this} to be at most #{exp}","expected #{this} to be above #{exp}",t)}function g(t,r){r&&i(this,"message",r);var o=i(this,"object"),s=i(this,"ssfi"),a=i(this,"message");try{var h=o instanceof t}catch(r){if(r instanceof TypeError)throw new n((a=a?a+": ":"")+"The instanceof assertion needs a constructor but "+e.type(t)+" was given.",void 0,s);throw r}var c=e.getName(t);null===c&&(c="an unnamed constructor"),this.assert(h,"expected #{this} to be an instance of "+c,"expected #{this} to not be an instance of "+c)}function w(t,r,o){o&&i(this,"message",o);var s=i(this,"nested"),a=i(this,"own"),h=i(this,"message"),c=i(this,"object"),u=i(this,"ssfi"),l=typeof t;if(h=h?h+": ":"",s){if("string"!==l)throw new n(h+"the argument to property must be a string when using nested syntax",void 0,u)}else if("string"!==l&&"number"!==l&&"symbol"!==l)throw new n(h+"the argument to property must be a string, number, or symbol",void 0,u);if(s&&a)throw new n(h+'The "nested" and "own" flags cannot be combined.',void 0,u);if(null==c)throw new n(h+"Target cannot be null or undefined.",void 0,u);var f,d=i(this,"deep"),m=i(this,"negate"),p=s?e.getPathInfo(c,t):null,g=s?p.value:c[t],w="";d&&(w+="deep "),a&&(w+="own "),s&&(w+="nested "),w+="property ",f=a?Object.prototype.hasOwnProperty.call(c,t):s?p.exists:e.hasProperty(c,t),m&&1!==arguments.length||this.assert(f,"expected #{this} to have "+w+e.inspect(t),"expected #{this} to not have "+w+e.inspect(t)),arguments.length>1&&this.assert(f&&(d?e.eql(r,g):r===g),"expected #{this} to have "+w+e.inspect(t)+" of #{exp}, but got #{act}","expected #{this} to not have "+w+e.inspect(t)+" of #{act}",r,g),i(this,"object",g)}function y(t,e,r){i(this,"own",!0),w.apply(this,arguments)}function b(t,r,n){"string"==typeof r&&(n=r,r=null),n&&i(this,"message",n);var o=i(this,"object"),s=Object.getOwnPropertyDescriptor(Object(o),t);s&&r?this.assert(e.eql(r,s),"expected the own property descriptor for "+e.inspect(t)+" on #{this} to match "+e.inspect(r)+", got "+e.inspect(s),"expected the own property descriptor for "+e.inspect(t)+" on #{this} to not match "+e.inspect(r),r,s,!0):this.assert(s,"expected #{this} to have an own property descriptor for "+e.inspect(t),"expected #{this} to not have an own property descriptor for "+e.inspect(t)),i(this,"object",s)}function x(){i(this,"doLength",!0)}function v(t,n){n&&i(this,"message",n);var o,s=i(this,"object"),a=e.type(s).toLowerCase(),h=i(this,"message"),c=i(this,"ssfi"),u="length";switch(a){case"map":case"set":u="size",o=s.size;break;default:new r(s,h,c,!0).to.have.property("length"),o=s.length}this.assert(o==t,"expected #{this} to have a "+u+" of #{exp} but got #{act}","expected #{this} to not have a "+u+" of #{act}",t,o)}function M(t,e){e&&i(this,"message",e);var r=i(this,"object");this.assert(t.exec(r),"expected #{this} to match "+t,"expected #{this} not to match "+t)}function E(t){var r,o,s=i(this,"object"),a=e.type(s),h=e.type(t),c=i(this,"ssfi"),u=i(this,"deep"),l="",f=!0,d=i(this,"message"),m=(d=d?d+": ":"")+"when testing keys against an object or an array you must give a single Array|Object|String argument or multiple String arguments";if("Map"===a||"Set"===a)l=u?"deeply ":"",o=[],s.forEach((function(t,e){o.push(e)})),"Array"!==h&&(t=Array.prototype.slice.call(arguments));else{switch(o=e.getOwnEnumerableProperties(s),h){case"Array":if(arguments.length>1)throw new n(m,void 0,c);break;case"Object":if(arguments.length>1)throw new n(m,void 0,c);t=Object.keys(t);break;default:t=Array.prototype.slice.call(arguments)}t=t.map((function(t){return"symbol"==typeof t?t:String(t)}))}if(!t.length)throw new n(d+"keys required",void 0,c);var p=t.length,g=i(this,"any"),w=i(this,"all"),y=t;if(g||w||(w=!0),g&&(f=y.some((function(t){return o.some((function(r){return u?e.eql(t,r):t===r}))}))),w&&(f=y.every((function(t){return o.some((function(r){return u?e.eql(t,r):t===r}))})),i(this,"contains")||(f=f&&t.length==o.length)),p>1){var b=(t=t.map((function(t){return e.inspect(t)}))).pop();w&&(r=t.join(", ")+", and "+b),g&&(r=t.join(", ")+", or "+b)}else r=e.inspect(t[0]);r=(p>1?"keys ":"key ")+r,r=(i(this,"contains")?"contain ":"have ")+r,this.assert(f,"expected #{this} to "+l+r,"expected #{this} to not "+l+r,y.slice(0).sort(e.compareByInspect),o.sort(e.compareByInspect),!0)}function _(t,n,o){o&&i(this,"message",o);var s,a=i(this,"object"),h=i(this,"ssfi"),c=i(this,"message"),u=i(this,"negate")||!1;new r(a,c,h,!0).is.a("function"),(t instanceof RegExp||"string"==typeof t)&&(n=t,t=null);try{a()}catch(t){s=t}var l=void 0===t&&void 0===n,f=Boolean(t&&n),d=!1,m=!1;if(l||!l&&!u){var p="an error";t instanceof Error?p="#{exp}":t&&(p=e.checkError.getConstructorName(t)),this.assert(s,"expected #{this} to throw "+p,"expected #{this} to not throw an error but #{act} was thrown",t&&t.toString(),s instanceof Error?s.toString():"string"==typeof s?s:s&&e.checkError.getConstructorName(s))}if(t&&s){if(t instanceof Error)e.checkError.compatibleInstance(s,t)===u&&(f&&u?d=!0:this.assert(u,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}"+(s&&!u?" but #{act} was thrown":""),t.toString(),s.toString()));e.checkError.compatibleConstructor(s,t)===u&&(f&&u?d=!0:this.assert(u,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}"+(s?" but #{act} was thrown":""),t instanceof Error?t.toString():t&&e.checkError.getConstructorName(t),s instanceof Error?s.toString():s&&e.checkError.getConstructorName(s)))}if(s&&null!=n){var g="including";n instanceof RegExp&&(g="matching"),e.checkError.compatibleMessage(s,n)===u&&(f&&u?m=!0:this.assert(u,"expected #{this} to throw error "+g+" #{exp} but got #{act}","expected #{this} to throw error not "+g+" #{exp}",n,e.checkError.getMessage(s)))}d&&m&&this.assert(u,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}"+(s?" but #{act} was thrown":""),t instanceof Error?t.toString():t&&e.checkError.getConstructorName(t),s instanceof Error?s.toString():s&&e.checkError.getConstructorName(s)),i(this,"object",s)}function A(t,r){r&&i(this,"message",r);var n=i(this,"object"),o=i(this,"itself"),s="function"!=typeof n||o?n[t]:n.prototype[t];this.assert("function"==typeof s,"expected #{this} to respond to "+e.inspect(t),"expected #{this} to not respond to "+e.inspect(t))}function S(t,r){r&&i(this,"message",r);var n=t(i(this,"object"));this.assert(n,"expected #{this} to satisfy "+e.objDisplay(t),"expected #{this} to not satisfy"+e.objDisplay(t),!i(this,"negate"),n)}function O(t,e,o){o&&i(this,"message",o);var s=i(this,"object"),a=i(this,"message"),h=i(this,"ssfi");if(new r(s,a,h,!0).is.a("number"),"number"!=typeof t||"number"!=typeof e)throw new n((a=a?a+": ":"")+"the arguments to closeTo or approximately must be numbers",void 0,h);this.assert(Math.abs(s-t)<=e,"expected #{this} to be close to "+t+" +/- "+e,"expected #{this} not to be close to "+t+" +/- "+e)}function N(t,e,n){n&&i(this,"message",n);var o,s=i(this,"object"),a=i(this,"message"),h=i(this,"ssfi");new r(s,a,h,!0).is.a("function"),e?(new r(t,a,h,!0).to.have.property(e),o=t[e]):(new r(t,a,h,!0).is.a("function"),o=t()),s();var c=null==e?t():t[e],u=null==e?o:"."+e;i(this,"deltaMsgObj",u),i(this,"initialDeltaValue",o),i(this,"finalDeltaValue",c),i(this,"deltaBehavior","change"),i(this,"realDelta",c!==o),this.assert(o!==c,"expected "+u+" to change","expected "+u+" to not change")}function T(t,e,n){n&&i(this,"message",n);var o,s=i(this,"object"),a=i(this,"message"),h=i(this,"ssfi");new r(s,a,h,!0).is.a("function"),e?(new r(t,a,h,!0).to.have.property(e),o=t[e]):(new r(t,a,h,!0).is.a("function"),o=t()),new r(o,a,h,!0).is.a("number"),s();var c=null==e?t():t[e],u=null==e?o:"."+e;i(this,"deltaMsgObj",u),i(this,"initialDeltaValue",o),i(this,"finalDeltaValue",c),i(this,"deltaBehavior","increase"),i(this,"realDelta",c-o),this.assert(c-o>0,"expected "+u+" to increase","expected "+u+" to not increase")}function P(t,e,n){n&&i(this,"message",n);var o,s=i(this,"object"),a=i(this,"message"),h=i(this,"ssfi");new r(s,a,h,!0).is.a("function"),e?(new r(t,a,h,!0).to.have.property(e),o=t[e]):(new r(t,a,h,!0).is.a("function"),o=t()),new r(o,a,h,!0).is.a("number"),s();var c=null==e?t():t[e],u=null==e?o:"."+e;i(this,"deltaMsgObj",u),i(this,"initialDeltaValue",o),i(this,"finalDeltaValue",c),i(this,"deltaBehavior","decrease"),i(this,"realDelta",o-c),this.assert(c-o<0,"expected "+u+" to decrease","expected "+u+" to not decrease")}["to","be","been","is","and","has","have","with","that","which","at","of","same","but","does","still"].forEach((function(t){r.addProperty(t)})),r.addProperty("not",(function(){i(this,"negate",!0)})),r.addProperty("deep",(function(){i(this,"deep",!0)})),r.addProperty("nested",(function(){i(this,"nested",!0)})),r.addProperty("own",(function(){i(this,"own",!0)})),r.addProperty("ordered",(function(){i(this,"ordered",!0)})),r.addProperty("any",(function(){i(this,"any",!0),i(this,"all",!1)})),r.addProperty("all",(function(){i(this,"all",!0),i(this,"any",!1)})),r.addChainableMethod("an",o),r.addChainableMethod("a",o),r.addChainableMethod("include",h,a),r.addChainableMethod("contain",h,a),r.addChainableMethod("contains",h,a),r.addChainableMethod("includes",h,a),r.addProperty("ok",(function(){this.assert(i(this,"object"),"expected #{this} to be truthy","expected #{this} to be falsy")})),r.addProperty("true",(function(){this.assert(!0===i(this,"object"),"expected #{this} to be true","expected #{this} to be false",!i(this,"negate"))})),r.addProperty("false",(function(){this.assert(!1===i(this,"object"),"expected #{this} to be false","expected #{this} to be true",!!i(this,"negate"))})),r.addProperty("null",(function(){this.assert(null===i(this,"object"),"expected #{this} to be null","expected #{this} not to be null")})),r.addProperty("undefined",(function(){this.assert(void 0===i(this,"object"),"expected #{this} to be undefined","expected #{this} not to be undefined")})),r.addProperty("NaN",(function(){this.assert(e.isNaN(i(this,"object")),"expected #{this} to be NaN","expected #{this} not to be NaN")})),r.addProperty("exist",(function(){var t=i(this,"object");this.assert(null!=t,"expected #{this} to exist","expected #{this} to not exist")})),r.addProperty("empty",(function(){var t,r=i(this,"object"),o=i(this,"ssfi"),s=i(this,"message");switch(s=s?s+": ":"",e.type(r).toLowerCase()){case"array":case"string":t=r.length;break;case"map":case"set":t=r.size;break;case"weakmap":case"weakset":throw new n(s+".empty was passed a weak collection",void 0,o);case"function":var a=s+".empty was passed a function "+e.getName(r);throw new n(a.trim(),void 0,o);default:if(r!==Object(r))throw new n(s+".empty was passed non-string primitive "+e.inspect(r),void 0,o);t=Object.keys(r).length}this.assert(0===t,"expected #{this} to be empty","expected #{this} not to be empty")})),r.addProperty("arguments",c),r.addProperty("Arguments",c),r.addMethod("equal",u),r.addMethod("equals",u),r.addMethod("eq",u),r.addMethod("eql",l),r.addMethod("eqls",l),r.addMethod("above",f),r.addMethod("gt",f),r.addMethod("greaterThan",f),r.addMethod("least",d),r.addMethod("gte",d),r.addMethod("below",m),r.addMethod("lt",m),r.addMethod("lessThan",m),r.addMethod("most",p),r.addMethod("lte",p),r.addMethod("within",(function(t,o,s){s&&i(this,"message",s);var a,h=i(this,"object"),c=i(this,"doLength"),u=i(this,"message"),l=u?u+": ":"",f=i(this,"ssfi"),d=e.type(h).toLowerCase(),m=e.type(t).toLowerCase(),p=e.type(o).toLowerCase(),g=!0,w="date"===m&&"date"===p?t.toUTCString()+".."+o.toUTCString():t+".."+o;if(c&&"map"!==d&&"set"!==d&&new r(h,u,f,!0).to.have.property("length"),c||"date"!==d||"date"===m&&"date"===p)if("number"===m&&"number"===p||!c&&"number"!==d)if(c||"date"===d||"number"===d)g=!1;else{a=l+"expected "+("string"===d?"'"+h+"'":h)+" to be a number or a date"}else a=l+"the arguments to within must be numbers";else a=l+"the arguments to within must be dates";if(g)throw new n(a,void 0,f);if(c){var y,b="length";"map"===d||"set"===d?(b="size",y=h.size):y=h.length,this.assert(y>=t&&y<=o,"expected #{this} to have a "+b+" within "+w,"expected #{this} to not have a "+b+" within "+w)}else this.assert(h>=t&&h<=o,"expected #{this} to be within "+w,"expected #{this} to not be within "+w)})),r.addMethod("instanceof",g),r.addMethod("instanceOf",g),r.addMethod("property",w),r.addMethod("ownProperty",y),r.addMethod("haveOwnProperty",y),r.addMethod("ownPropertyDescriptor",b),r.addMethod("haveOwnPropertyDescriptor",b),r.addChainableMethod("length",v,x),r.addChainableMethod("lengthOf",v,x),r.addMethod("match",M),r.addMethod("matches",M),r.addMethod("string",(function(t,n){n&&i(this,"message",n);var o=i(this,"object"),s=i(this,"message"),a=i(this,"ssfi");new r(o,s,a,!0).is.a("string"),this.assert(~o.indexOf(t),"expected #{this} to contain "+e.inspect(t),"expected #{this} to not contain "+e.inspect(t))})),r.addMethod("keys",E),r.addMethod("key",E),r.addMethod("throw",_),r.addMethod("throws",_),r.addMethod("Throw",_),r.addMethod("respondTo",A),r.addMethod("respondsTo",A),r.addProperty("itself",(function(){i(this,"itself",!0)})),r.addMethod("satisfy",S),r.addMethod("satisfies",S),r.addMethod("closeTo",O),r.addMethod("approximately",O),r.addMethod("members",(function(t,n){n&&i(this,"message",n);var o=i(this,"object"),s=i(this,"message"),a=i(this,"ssfi");new r(o,s,a,!0).to.be.an("array"),new r(t,s,a,!0).to.be.an("array");var h,c,u,l=i(this,"contains"),f=i(this,"ordered");l?(c="expected #{this} to be "+(h=f?"an ordered superset":"a superset")+" of #{exp}",u="expected #{this} to not be "+h+" of #{exp}"):(c="expected #{this} to have the same "+(h=f?"ordered members":"members")+" as #{exp}",u="expected #{this} to not have the same "+h+" as #{exp}");var d=i(this,"deep")?e.eql:void 0;this.assert(function(t,e,r,n,i){if(!n){if(t.length!==e.length)return!1;e=e.slice()}return t.every((function(t,o){if(i)return r?r(t,e[o]):t===e[o];if(!r){var s=e.indexOf(t);return-1!==s&&(n||e.splice(s,1),!0)}return e.some((function(i,o){return!!r(t,i)&&(n||e.splice(o,1),!0)}))}))}(t,o,d,l,f),c,u,t,o,!0)})),r.addMethod("oneOf",(function(t,e){e&&i(this,"message",e);var n=i(this,"object"),o=i(this,"message"),s=i(this,"ssfi");new r(t,o,s,!0).to.be.an("array"),this.assert(t.indexOf(n)>-1,"expected #{this} to be one of #{exp}","expected #{this} to not be one of #{exp}",t,n)})),r.addMethod("change",N),r.addMethod("changes",N),r.addMethod("increase",T),r.addMethod("increases",T),r.addMethod("decrease",P),r.addMethod("decreases",P),r.addMethod("by",(function(t,e){e&&i(this,"message",e);var r,n=i(this,"deltaMsgObj"),o=i(this,"initialDeltaValue"),s=i(this,"finalDeltaValue"),a=i(this,"deltaBehavior"),h=i(this,"realDelta");r="change"===a?Math.abs(s-o)===Math.abs(t):h===Math.abs(t),this.assert(r,"expected "+n+" to "+a+" by "+t,"expected "+n+" to not "+a+" by "+t)})),r.addProperty("extensible",(function(){var t=i(this,"object"),e=t===Object(t)&&Object.isExtensible(t);this.assert(e,"expected #{this} to be extensible","expected #{this} to not be extensible")})),r.addProperty("sealed",(function(){var t=i(this,"object"),e=t!==Object(t)||Object.isSealed(t);this.assert(e,"expected #{this} to be sealed","expected #{this} to not be sealed")})),r.addProperty("frozen",(function(){var t=i(this,"object"),e=t!==Object(t)||Object.isFrozen(t);this.assert(e,"expected #{this} to be frozen","expected #{this} to not be frozen")})),r.addProperty("finite",(function(t){var e=i(this,"object");this.assert("number"==typeof e&&isFinite(e),"expected #{this} to be a finite number","expected #{this} to not be a finite number")}))}},function(t,e){
/*!
 * chai
 * Copyright(c) 2011-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
t.exports=function(t,e){t.expect=function(e,r){return new t.Assertion(e,r)},t.expect.fail=function(e,r,n,i){throw arguments.length<2&&(n=e,e=void 0),n=n||"expect.fail()",new t.AssertionError(n,{actual:e,expected:r,operator:i},t.expect.fail)}}},function(t,e){
/*!
 * chai
 * Copyright(c) 2011-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
t.exports=function(t,e){var r=t.Assertion;function n(){Object.defineProperty(Object.prototype,"should",{set:function(t){Object.defineProperty(this,"should",{value:t,enumerable:!0,configurable:!0,writable:!0})},get:function t(){return this instanceof String||this instanceof Number||this instanceof Boolean||"function"==typeof Symbol&&this instanceof Symbol?new r(this.valueOf(),null,t):new r(this,null,t)},configurable:!0});var e={fail:function(r,n,i,o){throw arguments.length<2&&(i=r,r=void 0),i=i||"should.fail()",new t.AssertionError(i,{actual:r,expected:n,operator:o},e.fail)},equal:function(t,e,n){new r(t,n).to.equal(e)},Throw:function(t,e,n,i){new r(t,i).to.Throw(e,n)},exist:function(t,e){new r(t,e).to.exist},not:{}};return e.not.equal=function(t,e,n){new r(t,n).to.not.equal(e)},e.not.Throw=function(t,e,n,i){new r(t,i).to.not.Throw(e,n)},e.not.exist=function(t,e){new r(t,e).to.not.exist},e.throw=e.Throw,e.not.throw=e.not.Throw,e}t.should=n,t.Should=n}},function(t,e){
/*!
 * chai
 * Copyright(c) 2011-2014 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */
t.exports=function(t,e){
/*!
   * Chai dependencies.
   */
var r=t.Assertion,n=e.flag,i=t.assert=function(e,n){new r(null,null,t.assert,!0).assert(e,n,"[ negation message unavailable ]")};
/*!
   * Module export.
   */i.fail=function(e,r,n,o){throw arguments.length<2&&(n=e,e=void 0),n=n||"assert.fail()",new t.AssertionError(n,{actual:e,expected:r,operator:o},i.fail)},i.isOk=function(t,e){new r(t,e,i.isOk,!0).is.ok},i.isNotOk=function(t,e){new r(t,e,i.isNotOk,!0).is.not.ok},i.equal=function(t,e,o){var s=new r(t,o,i.equal,!0);s.assert(e==n(s,"object"),"expected #{this} to equal #{exp}","expected #{this} to not equal #{act}",e,t,!0)},i.notEqual=function(t,e,o){var s=new r(t,o,i.notEqual,!0);s.assert(e!=n(s,"object"),"expected #{this} to not equal #{exp}","expected #{this} to equal #{act}",e,t,!0)},i.strictEqual=function(t,e,n){new r(t,n,i.strictEqual,!0).to.equal(e)},i.notStrictEqual=function(t,e,n){new r(t,n,i.notStrictEqual,!0).to.not.equal(e)},i.deepEqual=i.deepStrictEqual=function(t,e,n){new r(t,n,i.deepEqual,!0).to.eql(e)},i.notDeepEqual=function(t,e,n){new r(t,n,i.notDeepEqual,!0).to.not.eql(e)},i.isAbove=function(t,e,n){new r(t,n,i.isAbove,!0).to.be.above(e)},i.isAtLeast=function(t,e,n){new r(t,n,i.isAtLeast,!0).to.be.least(e)},i.isBelow=function(t,e,n){new r(t,n,i.isBelow,!0).to.be.below(e)},i.isAtMost=function(t,e,n){new r(t,n,i.isAtMost,!0).to.be.most(e)},i.isTrue=function(t,e){new r(t,e,i.isTrue,!0).is.true},i.isNotTrue=function(t,e){new r(t,e,i.isNotTrue,!0).to.not.equal(!0)},i.isFalse=function(t,e){new r(t,e,i.isFalse,!0).is.false},i.isNotFalse=function(t,e){new r(t,e,i.isNotFalse,!0).to.not.equal(!1)},i.isNull=function(t,e){new r(t,e,i.isNull,!0).to.equal(null)},i.isNotNull=function(t,e){new r(t,e,i.isNotNull,!0).to.not.equal(null)},i.isNaN=function(t,e){new r(t,e,i.isNaN,!0).to.be.NaN},i.isNotNaN=function(t,e){new r(t,e,i.isNotNaN,!0).not.to.be.NaN},i.exists=function(t,e){new r(t,e,i.exists,!0).to.exist},i.notExists=function(t,e){new r(t,e,i.notExists,!0).to.not.exist},i.isUndefined=function(t,e){new r(t,e,i.isUndefined,!0).to.equal(void 0)},i.isDefined=function(t,e){new r(t,e,i.isDefined,!0).to.not.equal(void 0)},i.isFunction=function(t,e){new r(t,e,i.isFunction,!0).to.be.a("function")},i.isNotFunction=function(t,e){new r(t,e,i.isNotFunction,!0).to.not.be.a("function")},i.isObject=function(t,e){new r(t,e,i.isObject,!0).to.be.a("object")},i.isNotObject=function(t,e){new r(t,e,i.isNotObject,!0).to.not.be.a("object")},i.isArray=function(t,e){new r(t,e,i.isArray,!0).to.be.an("array")},i.isNotArray=function(t,e){new r(t,e,i.isNotArray,!0).to.not.be.an("array")},i.isString=function(t,e){new r(t,e,i.isString,!0).to.be.a("string")},i.isNotString=function(t,e){new r(t,e,i.isNotString,!0).to.not.be.a("string")},i.isNumber=function(t,e){new r(t,e,i.isNumber,!0).to.be.a("number")},i.isNotNumber=function(t,e){new r(t,e,i.isNotNumber,!0).to.not.be.a("number")},i.isFinite=function(t,e){new r(t,e,i.isFinite,!0).to.be.finite},i.isBoolean=function(t,e){new r(t,e,i.isBoolean,!0).to.be.a("boolean")},i.isNotBoolean=function(t,e){new r(t,e,i.isNotBoolean,!0).to.not.be.a("boolean")},i.typeOf=function(t,e,n){new r(t,n,i.typeOf,!0).to.be.a(e)},i.notTypeOf=function(t,e,n){new r(t,n,i.notTypeOf,!0).to.not.be.a(e)},i.instanceOf=function(t,e,n){new r(t,n,i.instanceOf,!0).to.be.instanceOf(e)},i.notInstanceOf=function(t,e,n){new r(t,n,i.notInstanceOf,!0).to.not.be.instanceOf(e)},i.include=function(t,e,n){new r(t,n,i.include,!0).include(e)},i.notInclude=function(t,e,n){new r(t,n,i.notInclude,!0).not.include(e)},i.deepInclude=function(t,e,n){new r(t,n,i.deepInclude,!0).deep.include(e)},i.notDeepInclude=function(t,e,n){new r(t,n,i.notDeepInclude,!0).not.deep.include(e)},i.nestedInclude=function(t,e,n){new r(t,n,i.nestedInclude,!0).nested.include(e)},i.notNestedInclude=function(t,e,n){new r(t,n,i.notNestedInclude,!0).not.nested.include(e)},i.deepNestedInclude=function(t,e,n){new r(t,n,i.deepNestedInclude,!0).deep.nested.include(e)},i.notDeepNestedInclude=function(t,e,n){new r(t,n,i.notDeepNestedInclude,!0).not.deep.nested.include(e)},i.ownInclude=function(t,e,n){new r(t,n,i.ownInclude,!0).own.include(e)},i.notOwnInclude=function(t,e,n){new r(t,n,i.notOwnInclude,!0).not.own.include(e)},i.deepOwnInclude=function(t,e,n){new r(t,n,i.deepOwnInclude,!0).deep.own.include(e)},i.notDeepOwnInclude=function(t,e,n){new r(t,n,i.notDeepOwnInclude,!0).not.deep.own.include(e)},i.match=function(t,e,n){new r(t,n,i.match,!0).to.match(e)},i.notMatch=function(t,e,n){new r(t,n,i.notMatch,!0).to.not.match(e)},i.property=function(t,e,n){new r(t,n,i.property,!0).to.have.property(e)},i.notProperty=function(t,e,n){new r(t,n,i.notProperty,!0).to.not.have.property(e)},i.propertyVal=function(t,e,n,o){new r(t,o,i.propertyVal,!0).to.have.property(e,n)},i.notPropertyVal=function(t,e,n,o){new r(t,o,i.notPropertyVal,!0).to.not.have.property(e,n)},i.deepPropertyVal=function(t,e,n,o){new r(t,o,i.deepPropertyVal,!0).to.have.deep.property(e,n)},i.notDeepPropertyVal=function(t,e,n,o){new r(t,o,i.notDeepPropertyVal,!0).to.not.have.deep.property(e,n)},i.ownProperty=function(t,e,n){new r(t,n,i.ownProperty,!0).to.have.own.property(e)},i.notOwnProperty=function(t,e,n){new r(t,n,i.notOwnProperty,!0).to.not.have.own.property(e)},i.ownPropertyVal=function(t,e,n,o){new r(t,o,i.ownPropertyVal,!0).to.have.own.property(e,n)},i.notOwnPropertyVal=function(t,e,n,o){new r(t,o,i.notOwnPropertyVal,!0).to.not.have.own.property(e,n)},i.deepOwnPropertyVal=function(t,e,n,o){new r(t,o,i.deepOwnPropertyVal,!0).to.have.deep.own.property(e,n)},i.notDeepOwnPropertyVal=function(t,e,n,o){new r(t,o,i.notDeepOwnPropertyVal,!0).to.not.have.deep.own.property(e,n)},i.nestedProperty=function(t,e,n){new r(t,n,i.nestedProperty,!0).to.have.nested.property(e)},i.notNestedProperty=function(t,e,n){new r(t,n,i.notNestedProperty,!0).to.not.have.nested.property(e)},i.nestedPropertyVal=function(t,e,n,o){new r(t,o,i.nestedPropertyVal,!0).to.have.nested.property(e,n)},i.notNestedPropertyVal=function(t,e,n,o){new r(t,o,i.notNestedPropertyVal,!0).to.not.have.nested.property(e,n)},i.deepNestedPropertyVal=function(t,e,n,o){new r(t,o,i.deepNestedPropertyVal,!0).to.have.deep.nested.property(e,n)},i.notDeepNestedPropertyVal=function(t,e,n,o){new r(t,o,i.notDeepNestedPropertyVal,!0).to.not.have.deep.nested.property(e,n)},i.lengthOf=function(t,e,n){new r(t,n,i.lengthOf,!0).to.have.lengthOf(e)},i.hasAnyKeys=function(t,e,n){new r(t,n,i.hasAnyKeys,!0).to.have.any.keys(e)},i.hasAllKeys=function(t,e,n){new r(t,n,i.hasAllKeys,!0).to.have.all.keys(e)},i.containsAllKeys=function(t,e,n){new r(t,n,i.containsAllKeys,!0).to.contain.all.keys(e)},i.doesNotHaveAnyKeys=function(t,e,n){new r(t,n,i.doesNotHaveAnyKeys,!0).to.not.have.any.keys(e)},i.doesNotHaveAllKeys=function(t,e,n){new r(t,n,i.doesNotHaveAllKeys,!0).to.not.have.all.keys(e)},i.hasAnyDeepKeys=function(t,e,n){new r(t,n,i.hasAnyDeepKeys,!0).to.have.any.deep.keys(e)},i.hasAllDeepKeys=function(t,e,n){new r(t,n,i.hasAllDeepKeys,!0).to.have.all.deep.keys(e)},i.containsAllDeepKeys=function(t,e,n){new r(t,n,i.containsAllDeepKeys,!0).to.contain.all.deep.keys(e)},i.doesNotHaveAnyDeepKeys=function(t,e,n){new r(t,n,i.doesNotHaveAnyDeepKeys,!0).to.not.have.any.deep.keys(e)},i.doesNotHaveAllDeepKeys=function(t,e,n){new r(t,n,i.doesNotHaveAllDeepKeys,!0).to.not.have.all.deep.keys(e)},i.throws=function(t,e,o,s){("string"==typeof e||e instanceof RegExp)&&(o=e,e=null);var a=new r(t,s,i.throws,!0).to.throw(e,o);return n(a,"object")},i.doesNotThrow=function(t,e,n,o){("string"==typeof e||e instanceof RegExp)&&(n=e,e=null),new r(t,o,i.doesNotThrow,!0).to.not.throw(e,n)},i.operator=function(o,s,a,h){var c;switch(s){case"==":c=o==a;break;case"===":c=o===a;break;case">":c=o>a;break;case">=":c=o>=a;break;case"<":c=o<a;break;case"<=":c=o<=a;break;case"!=":c=o!=a;break;case"!==":c=o!==a;break;default:throw h=h?h+": ":h,new t.AssertionError(h+'Invalid operator "'+s+'"',void 0,i.operator)}var u=new r(c,h,i.operator,!0);u.assert(!0===n(u,"object"),"expected "+e.inspect(o)+" to be "+s+" "+e.inspect(a),"expected "+e.inspect(o)+" to not be "+s+" "+e.inspect(a))},i.closeTo=function(t,e,n,o){new r(t,o,i.closeTo,!0).to.be.closeTo(e,n)},i.approximately=function(t,e,n,o){new r(t,o,i.approximately,!0).to.be.approximately(e,n)},i.sameMembers=function(t,e,n){new r(t,n,i.sameMembers,!0).to.have.same.members(e)},i.notSameMembers=function(t,e,n){new r(t,n,i.notSameMembers,!0).to.not.have.same.members(e)},i.sameDeepMembers=function(t,e,n){new r(t,n,i.sameDeepMembers,!0).to.have.same.deep.members(e)},i.notSameDeepMembers=function(t,e,n){new r(t,n,i.notSameDeepMembers,!0).to.not.have.same.deep.members(e)},i.sameOrderedMembers=function(t,e,n){new r(t,n,i.sameOrderedMembers,!0).to.have.same.ordered.members(e)},i.notSameOrderedMembers=function(t,e,n){new r(t,n,i.notSameOrderedMembers,!0).to.not.have.same.ordered.members(e)},i.sameDeepOrderedMembers=function(t,e,n){new r(t,n,i.sameDeepOrderedMembers,!0).to.have.same.deep.ordered.members(e)},i.notSameDeepOrderedMembers=function(t,e,n){new r(t,n,i.notSameDeepOrderedMembers,!0).to.not.have.same.deep.ordered.members(e)},i.includeMembers=function(t,e,n){new r(t,n,i.includeMembers,!0).to.include.members(e)},i.notIncludeMembers=function(t,e,n){new r(t,n,i.notIncludeMembers,!0).to.not.include.members(e)},i.includeDeepMembers=function(t,e,n){new r(t,n,i.includeDeepMembers,!0).to.include.deep.members(e)},i.notIncludeDeepMembers=function(t,e,n){new r(t,n,i.notIncludeDeepMembers,!0).to.not.include.deep.members(e)},i.includeOrderedMembers=function(t,e,n){new r(t,n,i.includeOrderedMembers,!0).to.include.ordered.members(e)},i.notIncludeOrderedMembers=function(t,e,n){new r(t,n,i.notIncludeOrderedMembers,!0).to.not.include.ordered.members(e)},i.includeDeepOrderedMembers=function(t,e,n){new r(t,n,i.includeDeepOrderedMembers,!0).to.include.deep.ordered.members(e)},i.notIncludeDeepOrderedMembers=function(t,e,n){new r(t,n,i.notIncludeDeepOrderedMembers,!0).to.not.include.deep.ordered.members(e)},i.oneOf=function(t,e,n){new r(t,n,i.oneOf,!0).to.be.oneOf(e)},i.changes=function(t,e,n,o){3===arguments.length&&"function"==typeof e&&(o=n,n=null),new r(t,o,i.changes,!0).to.change(e,n)},i.changesBy=function(t,e,n,o,s){if(4===arguments.length&&"function"==typeof e){var a=o;o=n,s=a}else 3===arguments.length&&(o=n,n=null);new r(t,s,i.changesBy,!0).to.change(e,n).by(o)},i.doesNotChange=function(t,e,n,o){return 3===arguments.length&&"function"==typeof e&&(o=n,n=null),new r(t,o,i.doesNotChange,!0).to.not.change(e,n)},i.changesButNotBy=function(t,e,n,o,s){if(4===arguments.length&&"function"==typeof e){var a=o;o=n,s=a}else 3===arguments.length&&(o=n,n=null);new r(t,s,i.changesButNotBy,!0).to.change(e,n).but.not.by(o)},i.increases=function(t,e,n,o){return 3===arguments.length&&"function"==typeof e&&(o=n,n=null),new r(t,o,i.increases,!0).to.increase(e,n)},i.increasesBy=function(t,e,n,o,s){if(4===arguments.length&&"function"==typeof e){var a=o;o=n,s=a}else 3===arguments.length&&(o=n,n=null);new r(t,s,i.increasesBy,!0).to.increase(e,n).by(o)},i.doesNotIncrease=function(t,e,n,o){return 3===arguments.length&&"function"==typeof e&&(o=n,n=null),new r(t,o,i.doesNotIncrease,!0).to.not.increase(e,n)},i.increasesButNotBy=function(t,e,n,o,s){if(4===arguments.length&&"function"==typeof e){var a=o;o=n,s=a}else 3===arguments.length&&(o=n,n=null);new r(t,s,i.increasesButNotBy,!0).to.increase(e,n).but.not.by(o)},i.decreases=function(t,e,n,o){return 3===arguments.length&&"function"==typeof e&&(o=n,n=null),new r(t,o,i.decreases,!0).to.decrease(e,n)},i.decreasesBy=function(t,e,n,o,s){if(4===arguments.length&&"function"==typeof e){var a=o;o=n,s=a}else 3===arguments.length&&(o=n,n=null);new r(t,s,i.decreasesBy,!0).to.decrease(e,n).by(o)},i.doesNotDecrease=function(t,e,n,o){return 3===arguments.length&&"function"==typeof e&&(o=n,n=null),new r(t,o,i.doesNotDecrease,!0).to.not.decrease(e,n)},i.doesNotDecreaseBy=function(t,e,n,o,s){if(4===arguments.length&&"function"==typeof e){var a=o;o=n,s=a}else 3===arguments.length&&(o=n,n=null);return new r(t,s,i.doesNotDecreaseBy,!0).to.not.decrease(e,n).by(o)},i.decreasesButNotBy=function(t,e,n,o,s){if(4===arguments.length&&"function"==typeof e){var a=o;o=n,s=a}else 3===arguments.length&&(o=n,n=null);new r(t,s,i.decreasesButNotBy,!0).to.decrease(e,n).but.not.by(o)}
/*!
   * ### .ifError(object)
   *
   * Asserts if value is not a false value, and throws if it is a true value.
   * This is added to allow for chai to be a drop-in replacement for Node's
   * assert class.
   *
   *     var err = new Error('I am a custom error');
   *     assert.ifError(err); // Rethrows err!
   *
   * @name ifError
   * @param {Object} object
   * @namespace Assert
   * @api public
   */,i.ifError=function(t){if(t)throw t},i.isExtensible=function(t,e){new r(t,e,i.isExtensible,!0).to.be.extensible},i.isNotExtensible=function(t,e){new r(t,e,i.isNotExtensible,!0).to.not.be.extensible},i.isSealed=function(t,e){new r(t,e,i.isSealed,!0).to.be.sealed},i.isNotSealed=function(t,e){new r(t,e,i.isNotSealed,!0).to.not.be.sealed},i.isFrozen=function(t,e){new r(t,e,i.isFrozen,!0).to.be.frozen},i.isNotFrozen=function(t,e){new r(t,e,i.isNotFrozen,!0).to.not.be.frozen},i.isEmpty=function(t,e){new r(t,e,i.isEmpty,!0).to.be.empty},i.isNotEmpty=function(t,e){new r(t,e,i.isNotEmpty,!0).to.not.be.empty},
/*!
   * Aliases.
   */
function t(e,r){return i[r]=i[e],t}("isOk","ok")("isNotOk","notOk")("throws","throw")("throws","Throw")("isExtensible","extensible")("isNotExtensible","notExtensible")("isSealed","sealed")("isNotSealed","notSealed")("isFrozen","frozen")("isNotFrozen","notFrozen")("isEmpty","empty")("isNotEmpty","notEmpty")}},function(t,e,r){"use strict";r.r(e);class n{constructor(){this[Symbol.toStringTag]="Map",this._map=new Map,this._size=0}toString(){return"{"+Array.from(this.entries2()).map(({key:t,value:e})=>t+":"+e).join(", ")+"}"}forEach(t,e){for(const r of this._map.values())for(const{key:n,value:i}of r)t.call(e,i,n,this)}*keys(){for(const t of this._map.values())for(const{key:e}of t)yield e}*values(){for(const t of this._map.values())for(const{value:e}of t)yield e}[Symbol.iterator](){return this.entries()}set(t,e){return this.set2(t,e),this}set2(t,e){const r=t.hashCode(),n=this._map.get(r);if(n){const r=n.findIndex(e=>e.key.equals(t));if(-1!=r)return n[r].value=e,!1;n.push({key:t,value:e})}else this._map.set(r,[{key:t,value:e}]);return this._size++,!0}has(t){const e=t.hashCode(),r=this._map.get(e);return void 0!==r&&r.some(e=>e.key.equals(t))}get(t){const e=t.hashCode(),r=this._map.get(e),n=r&&r.find(e=>e.key.equals(t));return n&&n.value}getLike(t){for(const e of t.hashCodes()){const r=this._map.get(e),n=r&&r.find(e=>e.key.like(t));if(n)return n}}setLike(t,e){return!this.getLike(t)&&this.set(t,e)}delete(t){const e=t.hashCode(),r=this._map.get(e);if(r){const n=r.findIndex(e=>e.key.equals(t));if(-1!=n)return 1==r.length?this._map.delete(e):r.splice(n,1),this._size--,!0}return!1}deleteLike(t){for(const e of t.hashCodes()){const r=this._map.get(e);if(r){const n=r.findIndex(e=>e.key.like(t));if(-1!=n){const t=r[n];return 1==r.length?this._map.delete(e):r.splice(n,1),this._size--,t}}}}*entries2(){for(const t of this._map.values())yield*t}*entries(){for(const t of this._map.values())for(const{key:e,value:r}of t)yield[e,r]}clear(){this._map.clear(),this._size=0}get size(){return this._size}}const i=Math.PI;console.log("NLA_PRECISION",1/(1<<26)),console.log("NLA_DEBUG",!1);function o(t,...e){0}function s(t,e,r){return t*(1-r)+e*r}const a=Number.prototype.toString;Number.prototype.toString=function(t){return i==this?"PI":a.call(this,t)};const h=(t,e=1/(1<<26))=>Math.abs(t)<=e,c=(t,e,r=1/(1<<26))=>Math.abs(t-e)<=r,u=(t,e,r=1/(1<<26))=>t-e<-r,l=c;function f(t,e,r){if(void 0===r||0==+r)return t(e);if(e=+e,r=+r,isNaN(e)||"number"!=typeof r||r%1!=0)return NaN;let n=e.toString().split("e");return n=(e=t(+(n[0]+"e"+(n[1]?+n[1]-r:-r)))).toString().split("e"),+(n[0]+"e"+(n[1]?+n[1]+r:r))}f.bind(void 0,Math.round),f.bind(void 0,Math.floor),f.bind(void 0,Math.ceil),Math.sqrt(5);function d(t,e,r){return Math.max(e,Math.min(r,t))}function m(t,e,...r){Object.getOwnPropertyNames(e).forEach(n=>{r.includes(n)||(t.hasOwnProperty(n)&&console.warn("target ",t," already has property ",n,t[n]),Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n)))})}let p=t=>t;const g=.017453292519943295;function w(t){switch(typeof t){case"undefined":return"undefined";case"function":return t.toString();case"number":return""+t;case"string":return JSON.stringify(t);case"object":return null==t?"null":t.sce;default:throw new Error}}function y(t,e,r,n){if(h(t))return h(e)?[-n/r]:function(t,e){const r=t*t/4-e;if(r<-1/(1<<26))return[];if(r<=1/(1<<26))return[-t/2];{const e=Math.sqrt(r);return[-t/2-e,-t/2+e]}}(r/e,n/e);const i=t;t=e/i;const o=(3*(e=r/i)-t*t)/3/3,s=o*o*o,a=(2*t*t*t-9*t*e+27*(r=n/i))/27,c=a/2,u=c*c+s;if(u<-1/(1<<26)/8){const e=Math.sqrt(-s),r=-a/(2*e),n=r<-1?-1:r>1?1:r,i=Math.acos(n),o=2*Math.cbrt(e);return[o*Math.cos(i/3)-t/3,o*Math.cos((i+2*Math.PI)/3)-t/3,o*Math.cos((i+4*Math.PI)/3)-t/3]}if(u<=1/(1<<26)/8){if(0==c)return[-t/3];const e=c<0?Math.cbrt(-c):-Math.cbrt(c);return[2*e-t/3,-e-t/3]}{const e=Math.sqrt(u);return[Math.cbrt(-c+e)-Math.cbrt(c+e)-t/3]}}function b(t,...e){return t+"("+e.map(w).join(",")+")"}function x(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function v(t,e,r,n,i){for(n+=i,i+=e;i-- >e;)r[--n]=t[i];return r}function M(t,e,r,n,i,o,s){let a=e+s*r,h=i+s*o;for(;a>e;)n[h-=o]=t[a-=r]}function E(t,e){const r=new Array(t);let n=t;for(;n--;)r[n]=e(n,t);return r}function _(t){let e=t.length,r=-1/0;for(;e--;){const n=t[e];r<n&&(r=n)}return r}Object.map=function(t,e,r){const n={};for(const i in t)n[i]=e.call(r,t[i],i,t);return n},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.equals=function(t){return this==t},Object.defineProperty(Object.prototype,"sce",{get:function(){return this.toSource()}}),Object.defineProperty(Object.prototype,"str",{get:function(){return this.toString()}});class A{constructor(t,e,r){this.x=t,this.y=e,this.z=r}static random(){return new A(Math.random(),Math.random(),Math.random())}static parallel(t,e){return t.dot(e)-t.length()*e.length()}static randomUnit(){const t=2*Math.random()*Math.PI,e=2*Math.random()-1,r=Math.sqrt(1-Math.pow(e,2));return new A(r*Math.cos(t),r*Math.sin(t),e)}static fromAngles(t,e){throw new Error}static fromFunction(t){return new A(t(0),t(1),t(2))}static min(t,e){return new A(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))}static max(t,e){return new A(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))}static lerp(t,e,r){return new A(t.x*(1-r)+e.x*r,t.y*(1-r)+e.y*r,t.z*(1-r)+e.z*r)}static fromArray(t){return new A(t[0],t[1],t[2])}static angleBetween(t,e){return t.angleTo(e)}static zip(t,...e){return new A(t.apply(void 0,e.map(t=>t.x)),t.apply(void 0,e.map(t=>t.y)),t.apply(void 0,e.map(t=>t.z)))}static normalOnPoints(t,e,r){return P(t,e,r),t.to(e).cross(t.to(r))}static add(...t){P(...t);let e=0,r=0,n=0,i=t.length;for(;i--;)e+=t[i].x,r+=t[i].y,n+=t[i].z;return new A(e,r,n)}static sub(...t){P(...t);let e=t[0].x,r=t[0].y,n=t[0].z,i=t.length;for(;i--;)e-=t[i].x,r-=t[i].y,n-=t[i].z;return new A(e,r,n)}static pack(t,e,r=0,n=0,i=t.length-r){const o=e||new Float32Array(3*i);o.length,o.length;let s=i,a=r,h=n;for(;s--;){const e=t[a++];o[h++]=e.x,o[h++]=e.y,o[h++]=e.z}return o}static unpack(t,e,r=0,n=0,i=(t.length-r)/3){(e=e||new Array(i)).length;let o=i,s=r,a=n;for(;o--;)e[a++]=new A(t[s++],t[s++],t[s++]);return e}static packXY(t,e,r=0,n=0,i=t.length-r){const o=e||new Float32Array(2*i);o.length;let s=i,a=r,h=n;for(;s--;){const e=t[a++];o[h++]=e.x,o[h++]=e.y}return o}static unpackXY(t,e,r=0,n=0,i=Math.min(t.length/2,e&&e.length||1/0)-n){(e=e||new Array(i)).length,t.length;let o=i,s=r,a=n;for(;o--;)e[a++]=new A(t[s++],t[s++],0);return e}static perturbed(t,e){return t.perturbed(e)}static polar(t,e,r=0){return new A(t*Math.cos(e),t*Math.sin(e),r)}static sphere(t,e,r=1){return new A(r*Math.cos(e)*Math.cos(t),r*Math.cos(e)*Math.sin(t),r*Math.sin(e))}static inverseLerp(t,e,r){const n=t.to(e);return t.to(r).dot(n)/n.squared()}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}get u(){return this.x}get v(){return this.y}perturbed(t=1/(1<<26)*.8){return this.map(e=>e+(Math.random()-.5)*t)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}e(t){return 0==t?this.x:1==t?this.y:this.z}negated(){return new A(-this.x,-this.y,-this.z)}abs(){return new A(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))}plus(t){return P(t),new A(this.x+t.x,this.y+t.y,this.z+t.z)}schur(t){return new A(this.x*t.x,this.y*t.y,this.z*t.z)}divv(t){return new A(this.x/t.x,this.y/t.y,this.z/t.z)}minus(t){return P(t),new A(this.x-t.x,this.y-t.y,this.z-t.z)}to(t){return P(t),t.minus(this)}times(t){return new A(this.x*t,this.y*t,this.z*t)}div(t){return new A(this.x/t,this.y/t,this.z/t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lerp(t,e){return P(t),A.lerp(this,t,e)}squared(){return this.dot(this)}distanceTo(t){return P(t),Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z)}distanceToSquared(t){return P(t),this.minus(t).squared()}toSource(){return A.NAMEMAP.get(this)||this.toString()}nonParallelVector(){const t=this.abs();return t.x<=t.y&&t.x<=t.z?A.X:t.y<=t.x&&t.y<=t.z?A.Y:A.Z}slerp(t,e){P(t);const r=Math.sin,n=this.angleTo(t);return this.times(r((1-e)*n)/r(n)).plus(t.times(r(e*n)/r(n)))}min(t){return new A(Math.min(this.x,t.x),Math.min(this.y,t.y),Math.min(this.z,t.z))}max(t){return new A(Math.max(this.x,t.x),Math.max(this.y,t.y),Math.max(this.z,t.z))}equals(t){return this==t||this.x==t.x&&this.y==t.y&&this.z==t.z}cross(t){return new A(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}minElement(){return Math.min(this.x,this.y,this.z)}maxElement(){return Math.max(this.x,this.y,this.z)}toArray(t=3){return[this.x,this.y,this.z].slice(0,t)}getPerpendicular(){if(h(this.x)&&h(this.y)){if(h(this.z))throw new Error("zero vector");return A.Y}return new A(-this.y,this.x,0)}dim(){return 3}els(){return[this.x,this.y,this.z]}angleXY(){return Math.atan2(this.y,this.x)}lengthXY(){return Math.hypot(this.x,this.y)}squaredXY(){return this.x*this.x+this.y*this.y}xy(){return new A(this.x,this.y,0)}map(t){return new A(t(this.x,"x"),t(this.y,"y"),t(this.z,"z"))}toString(t){return t=t||p,A.NAMEMAP.get(this)||"V("+[this.x,this.y,this.z].map(t).join(", ")+")"}angleTo(t){return arguments.length,P(t),this.likeO(),t.likeO(),Math.acos(Math.min(1,this.dot(t)/this.length()/t.length()))}angleRelativeNormal(t,e){return arguments.length,P(t,e),o(),Math.atan2(this.cross(t).dot(e),this.dot(t))}isParallelTo(t){P(t),this.likeO(),t.likeO();const e=this.dot(t);return c(this.squared()*t.squared(),e*e)}isPerpendicularTo(t){return P(t),this.likeO(),t.likeO(),h(this.dot(t))}isReverseDirTo(t){P(t),this.likeO(),t.likeO();const e=this.dot(t);return c(Math.sqrt(this.squared()*t.squared()),e)}length(){return Math.hypot(this.x,this.y,this.z)}likeO(){return this.like(A.O)}like(t){return t===this||t instanceof A&&(c(this.x,t.x)&&c(this.y,t.y)&&c(this.z,t.z))}likeOrReversed(t){return c(Math.abs(this.dot(t)),Math.sqrt(this.squared()*t.squared()))}unit(){return this.likeO(),this.div(this.length())}normalized(){throw new Error("documentation stub. use .unit()")}toLength(t){return this.times(t/this.length())}projectedOn(t){return P(t),t.times(this.dot(t)/t.dot(t))}rejectedFrom(t){return P(t),this.minus(t.times(this.dot(t)/t.dot(t)))}rejectedFrom1(t){return P(t),t.hasLength(1),this.minus(t.times(this.dot(t)))}rejectedLength(t){return P(t),Math.sqrt(this.dot(this)-Math.pow(this.dot(t),2)/t.dot(t))}rejected1Length(t){return P(t),t.hasLength(1),Math.sqrt(this.dot(this)-Math.pow(this.dot(t),2))}hasLength(t){return c(t,this.length())}absSum(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}minAbsElement(){return Math.min(Math.abs(this.x),Math.abs(this.y),Math.min(this.z))}maxAbsElement(){return Math.max(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))}maxAbsDim(){const t=Math.abs(this.x),e=Math.abs(this.y),r=Math.abs(this.z);return t>=e?t>=r?0:2:e>=r?1:2}minAbsDim(){const t=Math.abs(this.x),e=Math.abs(this.y),r=Math.abs(this.z);return t<e?t<r?0:2:e<r?1:2}withElement(t,e){return["x","y","z"].includes(t),"x"==t?new A(e,this.y,this.z):"y"==t?new A(this.x,e,this.z):new A(this.x,this.y,e)}hashCode(){function t(t){return~~(t*(1<<28))}return~~(31*(31*t(this.x)+t(this.y))+t(this.z))}hashCodes(){const t=~~(31*(31*~~(this.x*(1<<28)-.5)+~~(this.y*(1<<28)-.5))+~~(this.z*(1<<28)-.5));return[~~t,~~(t+961),~~(t+31),~~(t+31+961),~~(t+1),~~(t+1+961),~~(t+1+31),~~(t+1+31+961)]}compareTo(t){return this.x!=t.x?this.x-t.x:this.y!=t.y?this.y-t.y:this.z-t.z}compareTo2(t,e=1/(1<<26)){return l(this.x,t.x,e)?l(this.y,t.y,e)?l(this.z,t.z,e)?0:this.z-t.z:this.y-t.y:this.x-t.x}toAngles(){return{theta:Math.atan2(this.y,this.x),phi:Math.asin(this.z/this.length())}}}function S(t,e,r){if(3==arguments.length)return new A(parseFloat(t),parseFloat(e),parseFloat(r));if(2==arguments.length)return new A(parseFloat(t),parseFloat(e),0);if(1==arguments.length&&"object"==typeof t){if(t instanceof A)return t;if(t instanceof Array||t instanceof Float32Array||t instanceof Float64Array){if(2==t.length)return new A(parseFloat(t[0]),parseFloat(t[1]),0);if(3==t.length)return new A(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))}else if("x"in t&&"y"in t)return new A(parseFloat(t.x),parseFloat(t.y),"z"in t?parseFloat(t.z):0)}throw new Error("invalid arguments"+arguments)}A.O=new A(0,0,0),A.X=new A(1,0,0),A.Y=new A(0,1,0),A.Z=new A(0,0,1),A.XY=new A(1,1,0),A.XYZ=new A(1,1,1),A.INF=new A(1/0,1/0,1/0),A.UNITS=[A.X,A.Y,A.Z],A.NAMEMAP=(new n).set(A.O,"V3.O").set(A.X,"V3.X").set(A.Y,"V3.Y").set(A.Z,"V3.Z").set(A.XYZ,"V3.XYZ").set(A.INF,"V3.INF");class O{constructor(t){this.v=t,Float64Array}static fromFunction(t,e){const r=new Float64Array(t);let n=t;for(;n--;)r[n]=e(n);return new O(r)}static random(t){return O.fromFunction(t,t=>Math.random())}static from(...t){return t[0]instanceof Float64Array||t.every(t=>"number"==typeof t),new O(t[0]instanceof Float64Array?t[0]:Float64Array.from(t))}static Zero(t){let e=0;const r=new Float64Array(t);for(;e--;)r[e]=0;return new O(r)}static Unit(t,e){let r=0;const n=new Float64Array(t);for(;r--;)n[r]=+(r==e);return new O(n)}static pack(t,e,r=0,n=0,i=t.length-r){const o=t[0].dim(),s=e||new Float32Array(o*i);s.length,s.length;let a=i,h=r,c=n;for(;a--;){const e=t[h++];for(let t=0;t<o;t++)s[c++]=e.v[t]}return s}static lerp(t,e,r){t.dim(),e.dim();const n=new Float64Array(t.v.length);let i=t.v.length;for(;i--;)n[i]=t.v[i]*(1-r)+e.v[i]*r;return new O(n)}static add(...t){const e=t[0].v.length,r=new Float64Array(e);let n=t.length;for(;n--;){let i=e;for(;i--;)r[i]+=t[n].v[i]}return new O(r)}static fromV3AndWeight(t,e){return new O(new Float64Array([t.x*e,t.y*e,t.z*e,e]))}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}get w(){return this.v[3]}[Symbol.iterator](){return this.v[Symbol.iterator]()}dim(){return this.v.length}e(t){if(0>t||t>=this.v.length)throw new Error("array index out of bounds");return this.v[t]}plus(t){const e=this.v,r=t.v,n=new Float64Array(e.length);let i=e.length;for(;i--;)n[i]=e[i]+r[i];return new O(n)}minus(t){const e=this.v,r=t.v,n=new Float64Array(e.length);let i=e.length;for(;i--;)n[i]=e[i]-r[i];return new O(n)}times(t){const e=this.v,r=new Float64Array(e.length);let n=e.length;for(;n--;)r[n]=e[n]*t;return new O(r)}div(t){const e=this.v,r=new Float64Array(e.length);let n=e.length;for(;n--;)r[n]=e[n]/t;return new O(r)}dot(t){this.dim,t.dim;let e=0;const r=this.v,n=t.v;let i=r.length;for(;i--;)e+=r[i]*n[i];return e}cross(t){const e=new Float64Array(3);return e[0]=this.v[1]*t.v[2]-this.v[2]*t.v[1],e[1]=this.v[2]*t.v[0]-this.v[0]*t.v[2],e[2]=this.v[0]*t.v[1]-this.v[1]*t.v[0],new O(e)}schur(t){const e=this.v,r=t.v,n=new Float64Array(e.length);let i=e.length;for(;i--;)n[i]=e[i]*r[i];return new O(n)}equals(t){if(t===this)return!0;if(t.constructor!==O)return!1;if(this.v.length!=t.v.length)return!1;let e=this.v.length;for(;e--;)if(this.v[e]!==t.v[e])return!1;return!0}like(t){if(t===this)return!0;if(t.constructor!==O)return!1;if(this.v.length!=t.v.length)return!1;let e=this.v.length;for(;e--;)if(!c(this.v[e],t.v[e]))return!1;return!0}map(t){return new O(this.v.map(t))}toString(t){return t=t||(t=>+t.toFixed(6)),"Vector("+this.v.map(t).join(", ")+")"}toSource(){return b("VV",...this.v)}angleTo(t){return this.isZero(),t.isZero(),Math.acos(d(this.dot(t)/this.length()/t.length(),-1,1))}isParallelTo(t){return this.isZero(),t.isZero(),c(Math.sqrt(this.lengthSquared()*t.lengthSquared()),Math.abs(this.dot(t)))}isPerpendicularTo(t){return this.isZero(),t.isZero(),h(this.dot(t))}isZero(){return h(this.length())}length(){return Math.hypot.apply(void 0,this.v)}lengthSquared(){let t=0;const e=this.v;let r=e.length;for(;r--;)t+=e[r]*e[r];return t}unit(){const t=this.length();if(h(t))throw new Error("cannot normalize zero vector");return this.div(this.length())}normalized(){throw new Error("documentation stub. use .unit()")}asRowMatrix(){return new T(this.v.length,1,this.v)}asColMatrix(){return new T(1,this.v.length,this.v)}projectedOn(t){return t.times(this.dot(t)/t.dot(t))}rejectedOn(t){return this.minus(t.times(this.dot(t)/t.dot(t)))}to(t){return t.minus(this)}hasLength(t){return c(t,this.length())}V3(){return new A(this.v[0],this.v[1],this.v[2])}p3(){this.v.length;const t=this.v[3];return new A(this.v[0]/t,this.v[1]/t,this.v[2]/t)}transposed(){return new T(this.v.length,1,this.v)}}function N(...t){return new O(new Float64Array(t))}class T{constructor(t,e,r){this.width=t,this.height=e,this.m=r,o(),o(),r.length,r.length}static random(t,e){return T.fromFunction(t,e,()=>Math.random())}static fromFunction(t,e,r){const n=new Float64Array(e*t);let i=e*t;for(;i--;)n[i]=r(Math.floor(i/t),i%t,i);return new T(t,e,n)}static identityN(t){const e=new Float64Array(t*t);let r=t*(t+1);for(;r;)r-=t+1,e[r]=1;return new T(t,t,e)}static permutation(t,e,r){o(),o();const n=new Float64Array(t*t);let i=t*(t+1);for(;i;)i-=t+1,n[i]=1;return n[e*t+e]=0,n[r*t+r]=0,n[e*t+r]=1,n[r*t+e]=1,new T(t,t,n)}static fromRowArrays(...t){if(0==t.length)throw new Error("cannot have 0 vector");const e=t.length,r=t[0].length,n=new Float64Array(e*r);v(t[0],0,n,0,r);for(let i=1;i<e;i++){if(t[i].length!=r)throw new Error("all row arrays must be the same length");v(t[i],0,n,i*r,r)}return this.new(r,e,n)}static fromColVectors(t){return T.fromColArrays(...t.map(t=>t.v))}static forWidthHeight(t,e){return new T(t,e,new Float64Array(t*e))}static fromColArrays(...t){if(0==t.length)throw new Error("cannot have 0 vector");const e=t.length,r=t[0].length,n=new Float64Array(r*e);M(t[0],0,1,n,0,e,r);for(let i=1;i<e;i++){if(t[i].length!=r)throw new Error("all col arrays must be the same length");M(t[i],0,1,n,i,e,r)}return this.new(e,r,n)}static product(...t){const[e,r]=Array.isArray(t[0])?[t[0],t[1]]:[t,void 0];if(0==e.length)throw new Error("Can't guess matrix size.");return 1==e.length?T.copy(e[0],r):T.copy(e.reduce((t,e)=>t.times(e)),r)}static jacobi(t,e,r=t(e),n=1e-6){const i=T.forWidthHeight(e.length,r.length);for(let o=0;o<e.length;o++){e[o]+=n;const s=t(e);for(let t=0;t<r.length;t++){const e=(s[t]-r[t])/n;i.setEl(t,o,e)}e[o]-=n}return i}static copy(t,e=t.new()){t.width,e.width,t.height,e.height;const r=t.m,n=e.m;let i=r.length;for(;i--;)n[i]=r[i];return e}static new(t,e,r){return new T(t,e,r)}copy(){return T.copy(this)}e(t,e){return 0<=t&&this.height,0<=e&&this.width,this.m[t*this.width+e]}setEl(t,e,r){0<=t&&this.height,0<=e&&this.width,this.m[t*this.width+e]=r}plus(t){this.width,t.width,this.height,t.height;const e=this.new();let r=this.m.length;for(;r--;)e.m[r]=this.m[r]+t.m[r];return e}minus(t){this.width,t.width,this.height,t.height;const e=this.new();let r=this.m.length;for(;r--;)e.m[r]=this.m[r]-t.m[r];return e}mulScalar(t){const e=this.new();let r=this.m.length;for(;r--;)e.m[r]=this.m[r]*t;return e}divScalar(t){const e=this.new();let r=this.m.length;for(;r--;)e.m[r]=this.m[r]/t;return e}new(){return new T(this.width,this.height,new Float64Array(this.width*this.height))}toString(t,e,r){(t=t||(t=>t.toFixed(6)))(0),t(0),!e||(e.length,this.width),!r||(r.length,this.height);const n=Array.from(this.m).map(t),i=E(this.height,t=>n.slice(t*this.width,(t+1)*this.width));e&&i.unshift(Array.from(e)),r&&i.forEach((t,n)=>t.unshift(r[n-(e?1:0)]||""));const o=E(this.width,t=>_(i.map(e=>e[t].length)));return i.map((t,n)=>t.map((t,i)=>(0==n&&e||0==i&&r?String.prototype.padEnd:String.prototype.padStart).call(t,o[i])).join("  ")).map(t=>t+"\n").join("")}row(t){0<=t&&this.height;const e=new Float64Array(this.width);return v(this.m,t*this.width,e,0,this.width),new O(e)}col(t){0<=t&&this.width;const e=new Float64Array(this.height);return M(this.m,t,this.width,e,0,1,this.height),new O(e)}dim(){return{width:this.width,height:this.height}}dimString(){return this.width+"x"+this.height}equals(t){if(t.constructor!=this.constructor)return!1;if(this.width!=t.width||this.height!=t.height)return!1;let e=this.m.length;for(;e--;)if(this.m[e]!=t.m[e])return!1;return!0}equalsMatrix(t,e=1/(1<<26)){if(this.width!=t.width||this.height!=t.height)return!1;let r=this.m.length;for(;r--;)if(Math.abs(this.m[r]-t.m[r])>=e)return!1;return!0}hashCode(){let t=0,e=this.m.length;for(;e--;)t=31*t+~~(this.m[e]*(1<<28));return t}isZero(){let t=this.m.length;for(;t--;)if(!h(this.m[t]))return!1;return!0}isOrthogonal(){return this.isSquare()&&this.transposed().times(this).equalsMatrix(T.identityN(this.width))}luDecomposition(){o(0,this.dim().toSource());const t=this.width,e=this.asRowArrays(Float64Array),r=E(t,e=>new Float64Array(t)),n=T.identityN(t).asRowArrays(Float64Array);let i=0;for(let o=0;o<t;o++){let s=0,a=-1,h=0;for(let r=i;r<t;r++){const t=e[r][o];h+=+(0!=t),Math.abs(t)>s&&(s=Math.abs(t),a=r)}if(0!=s){if(x(e,i,a),x(r,i,a),x(n,i,a),r[o][o]=1,1<h)for(let n=i+1;n<t;n++){const s=e[n][o]/e[i][o];r[n][o]=s;for(let r=o;r<t;r++)e[n][r]-=s*e[i][r]}i++}}return{L:T.fromRowArrays(...r),U:T.fromRowArrays(...e),P:T.fromRowArrays(...n)}}gauss(){const t=this.width,e=this.height,r=this.asRowArrays(Float64Array),n=E(e,e=>new Float64Array(t)),i=T.identityN(e).asRowArrays(Float64Array);let o=0;for(let s=0;s<t;s++){let a=0,h=-1,c=0;for(let t=o;t<e;t++){const e=r[t][s];c+=+(0!=e),Math.abs(e)>a&&(a=Math.abs(e),h=t)}if(0!=a){if(x(r,o,h),x(n,o,h),x(i,o,h),n[o][s]=1,1<c)for(let i=o+1;i<e;i++){const e=r[i][s]/r[o][s];n[i][s]=e;for(let n=s;n<t;n++)r[i][n]-=e*r[o][n]}o++}}return{L:T.fromRowArrays(...n),U:T.fromRowArrays(...r),P:T.fromRowArrays(...i)}}qrDecompositionGivensRotation(){const t=this.copy();function e(t,e,r,n,i){const o=T.identityN(t);return o.setEl(e,e,n),o.setEl(r,r,n),o.setEl(e,r,i),o.setEl(r,e,-i),o}let r=T.identityN(this.height);for(let n=0;n<this.width;n++)for(let i=n+1;i<this.height;i++){const o=t.e(n,n),s=t.e(i,n);if(0==s)continue;const a=Math.hypot(o,s),h=o/a,c=s/a;for(let e=n;e<this.width;e++){const r=t.e(n,e)*h+t.e(i,e)*c,o=t.e(i,e)*h-t.e(n,e)*c;t.setEl(n,e,r),t.setEl(i,e,o)}r=e(this.height,n,i,h,c).times(r)}return{Q:r.transposed(),R:t}}isPermutation(){if(!this.isSquare())return!1;if(this.m.some(t=>!h(t)&&!c(1,t)))return!1;return!this.asRowArrays(Array).some(t=>1!=t.filter(t=>c(1,t)).length)&&!this.asColArrays(Array).some(t=>1!=t.filter(t=>c(1,t)).length)}isDiagonal(t){let e=this.m.length;for(;e--;)if(0!=e%(this.width+1)&&!h(this.m[e]))return!1;return!0}isIdentity(t){return this.isLowerUnitriangular(t)&&this.isUpperTriangular(t)}isUpperTriangular(t=1/(1<<26)){if(!this.isSquare())return!1;for(let e=1;e<this.height;e++)for(let r=0;r<e;r++)if(!h(this.m[e*this.width+r],t))return!1;return!0}isSymmetric(t=1/(1<<26)){if(!this.isSquare())return!1;for(let e=0;e<this.height-1;e++)for(let r=e+1;r<this.width;r++){const n=this.m[e*this.width+r],i=this.m[r*this.width+e];if(!c(n,i,t))return!1}return!0}solveLinearSystem(t){const{L:e,U:r,P:n}=this.luDecomposition(),i=e.solveForwards(n.timesVector(t));return r.solveBackwards(i)}isLowerUnitriangular(t=1/(1<<26)){if(!this.isSquare())return!1;for(let e=0;e<this.height-1;e++)for(let r=e;r<this.width;r++){const n=this.m[e*this.width+r];if(e==r?!c(1,n,t):!h(n,t))return!1}return!0}isLowerTriangular(t=1/(1<<26)){if(!this.isSquare())return!1;for(let e=0;e<this.height-1;e++)for(let r=e+1;r<this.width;r++)if(!h(this.m[e*this.width+r],t))return!1;return!0}solveBackwards(t){P(t),this.height,t.dim(),this.isUpperTriangular(),this.str;const e=new Float64Array(this.width);let r=this.height;for(;r--;){let n=t.v[r];for(let t=r+1;t<this.width;t++)n-=e[t]*this.e(r,t);e[r]=n/this.e(r,r)}return new O(e)}solveBackwardsMatrix(t){const e=new Array(t.width);let r=t.width;for(;r--;)e[r]=this.solveBackwards(t.col(r));return T.fromColVectors(e)}solveForwardsMatrix(t){const e=new Array(t.width);let r=t.width;for(;r--;)e[r]=this.solveForwards(t.col(r));return T.fromColVectors(e)}solveForwards(t){P(t),this.height,t.dim(),o(0,this.toString());const e=new Float64Array(this.width);for(let r=0;r<this.height;r++){let n=t.v[r];for(let t=0;t<r;t++)n-=e[t]*this.e(r,t);e[r]=n/this.e(r,r)}return new O(e)}rank(){const t=this.gauss().U;let e=this.height;for(;e--&&t.row(e).isZero(););return e+1}rowsIndependent(){return this.height==this.rank()}colsIndependent(){return this.width==this.rank()}asRowArrays(t=Float64Array){return E(this.height,e=>this.rowArray(e,t))}asColArrays(t=Float64Array){return E(this.width,e=>this.colArray(e,t))}rowArray(t,e=Float64Array){const r=new e(this.width);return v(this.m,t*this.width,r,0,this.width)}colArray(t,e=Float64Array){const r=new e(this.width);return M(this.m,t,this.height,r,0,1,this.height),r}subMatrix(t,e,r,n){t+e<=this.width&&this.height;const i=new Float64Array(e*n);return function(t,e,r,n,i,o,s,a){for(let h=0;h<a;h++)v(t,e+r*h,n,i+o*h,s)}(this.m,t,this.width,i,0,e,n,e),new T(e,n,i)}map(t){return new T(this.width,this.height,this.m.map(t))}dimEquals(t){return this.width==t.width&&this.height==t.height}inversed(){if(this.isSquare()){if(2==this.width)return this.inversed2();if(3==this.width)return this.inversed3();if(4==this.width)return this.inversed4()}const{L:t,U:e,P:r}=this.luDecomposition(),n=t.solveForwardsMatrix(r);return e.solveBackwardsMatrix(n)}inversed2(){o();const t=T.forWidthHeight(2,2),e=this.m,r=t.m,n=e[0]*e[3]-e[1]*r[2];return r[0]=e[3]/n,r[1]=-e[2]/n,r[2]=-e[1]/n,r[3]=e[0]/n,t}inversed3(t=T.forWidthHeight(3,3)){o(),o();const e=this.m,r=t.m;r[0]=e[4]*e[8]-e[5]*e[7],r[1]=-e[1]*e[8]+e[2]*e[7],r[2]=e[1]*e[5]-e[2]*e[4],r[3]=-e[3]*e[8]+e[5]*e[6],r[4]=e[0]*e[8]-e[2]*e[6],r[5]=-e[0]*e[5]+e[2]*e[3],r[6]=e[3]*e[7]-e[4]*e[6],r[7]=-e[0]*e[7]+e[1]*e[6],r[8]=e[0]*e[4]-e[1]*e[3];const n=e[0]*r[0]+e[1]*r[3]+e[2]*r[6];let i=9;for(;i--;)r[i]/=n;return t}inversed4(t=T.forWidthHeight(4,4)){o(),o();const e=this.m,r=t.m;r[0]=e[5]*e[10]*e[15]-e[5]*e[14]*e[11]-e[6]*e[9]*e[15]+e[6]*e[13]*e[11]+e[7]*e[9]*e[14]-e[7]*e[13]*e[10],r[1]=-e[1]*e[10]*e[15]+e[1]*e[14]*e[11]+e[2]*e[9]*e[15]-e[2]*e[13]*e[11]-e[3]*e[9]*e[14]+e[3]*e[13]*e[10],r[2]=e[1]*e[6]*e[15]-e[1]*e[14]*e[7]-e[2]*e[5]*e[15]+e[2]*e[13]*e[7]+e[3]*e[5]*e[14]-e[3]*e[13]*e[6],r[3]=-e[1]*e[6]*e[11]+e[1]*e[10]*e[7]+e[2]*e[5]*e[11]-e[2]*e[9]*e[7]-e[3]*e[5]*e[10]+e[3]*e[9]*e[6],r[4]=-e[4]*e[10]*e[15]+e[4]*e[14]*e[11]+e[6]*e[8]*e[15]-e[6]*e[12]*e[11]-e[7]*e[8]*e[14]+e[7]*e[12]*e[10],r[5]=e[0]*e[10]*e[15]-e[0]*e[14]*e[11]-e[2]*e[8]*e[15]+e[2]*e[12]*e[11]+e[3]*e[8]*e[14]-e[3]*e[12]*e[10],r[6]=-e[0]*e[6]*e[15]+e[0]*e[14]*e[7]+e[2]*e[4]*e[15]-e[2]*e[12]*e[7]-e[3]*e[4]*e[14]+e[3]*e[12]*e[6],r[7]=e[0]*e[6]*e[11]-e[0]*e[10]*e[7]-e[2]*e[4]*e[11]+e[2]*e[8]*e[7]+e[3]*e[4]*e[10]-e[3]*e[8]*e[6],r[8]=e[4]*e[9]*e[15]-e[4]*e[13]*e[11]-e[5]*e[8]*e[15]+e[5]*e[12]*e[11]+e[7]*e[8]*e[13]-e[7]*e[12]*e[9],r[9]=-e[0]*e[9]*e[15]+e[0]*e[13]*e[11]+e[1]*e[8]*e[15]-e[1]*e[12]*e[11]-e[3]*e[8]*e[13]+e[3]*e[12]*e[9],r[10]=e[0]*e[5]*e[15]-e[0]*e[13]*e[7]-e[1]*e[4]*e[15]+e[1]*e[12]*e[7]+e[3]*e[4]*e[13]-e[3]*e[12]*e[5],r[11]=-e[0]*e[5]*e[11]+e[0]*e[9]*e[7]+e[1]*e[4]*e[11]-e[1]*e[8]*e[7]-e[3]*e[4]*e[9]+e[3]*e[8]*e[5],r[12]=-e[4]*e[9]*e[14]+e[4]*e[13]*e[10]+e[5]*e[8]*e[14]-e[5]*e[12]*e[10]-e[6]*e[8]*e[13]+e[6]*e[12]*e[9],r[13]=e[0]*e[9]*e[14]-e[0]*e[13]*e[10]-e[1]*e[8]*e[14]+e[1]*e[12]*e[10]+e[2]*e[8]*e[13]-e[2]*e[12]*e[9],r[14]=-e[0]*e[5]*e[14]+e[0]*e[13]*e[6]+e[1]*e[4]*e[14]-e[1]*e[12]*e[6]-e[2]*e[4]*e[13]+e[2]*e[12]*e[5],r[15]=e[0]*e[5]*e[10]-e[0]*e[9]*e[6]-e[1]*e[4]*e[10]+e[1]*e[8]*e[6]+e[2]*e[4]*e[9]-e[2]*e[8]*e[5];const n=e[0]*r[0]+e[1]*r[4]+e[2]*r[8]+e[3]*r[12];let i=16;for(;i--;)r[i]/=n;return t}canMultiply(t){return this.width==t.height}times(t){this.canMultiply(t);const e=t.width,r=this.height,n=this.width,i=new Float64Array(e*r);let o=r;for(;o--;){let r=e;for(;r--;){let s=0,a=n;for(;a--;)s+=this.m[o*n+a]*t.m[a*e+r];i[o*e+r]=s}}return new T(e,r,i)}timesVector(t){P(t),this.width,t.dim();const e=this.height,r=this.width,n=new Float64Array(e);let i=e;for(;i--;){let e=0,o=r;for(;o--;)e+=this.m[i*r+o]*t.v[o];n[i]=e}return new O(n)}transposed(){const t=this.height,e=this.width,r=new Float64Array(t*e);let n=e;for(;n--;){let i=t;for(;i--;)r[n*t+i]=this.m[i*e+n]}return new T(t,e,r)}transpose(){const t=this.height,e=this.width,r=this.m;let n=t;for(;n--;){let i=Math.min(n,e);for(;i--;){const o=r[n*e+i];r[n*e+i]=r[i*t+n],r[i*t+n]=o}}this.width=t,this.height=e}isSquare(){return this.height==this.width}diagonal(){if(!this.isSquare())throw new Error("!!");const t=new Float64Array(this.width);let e=this.width*(this.width+1),r=this.width;for(;r--;)e-=this.width+1,t[r]=this.m[e];return new O(t)}maxEl(){return Math.max.apply(void 0,this.m)}minEl(){return Math.min.apply(void 0,this.m)}maxAbsColSum(){let t=0,e=this.width;for(;e--;){let r=0,n=this.height;for(;n--;)r+=Math.abs(this.m[n*this.width+e]);t=Math.max(t,r)}return t}maxAbsRowSum(){let t=0,e=this.height;for(;e--;){let r=0,n=this.width;for(;n--;)r+=Math.abs(this.m[e*this.width+n]);t=Math.max(t,r)}return t}getTriangularDeterminant(){this.isUpperTriangular()||this.isLowerTriangular();let t=1,e=this.width*(this.width+1);for(;e;)e-=this.width+1,t*=this.m[e];return t}getDeterminant(){return this.luDecomposition().U.getTriangularDeterminant()}hasFullRank(){return Math.min(this.width,this.height)==this.rank()}permutationAsIndexMap(){o();const t=new Array(this.height);let e=this.height;for(;e--;){const r=e*this.width;let n=r;for(;this.m[n]<.5;)n++;t[e]=n-r}return t}getDependentRowIndexes(t=this.gauss()){const{L:e,U:r,P:n}=t,i=new Array(this.height);let o=this.height;for(;o--;){if(!(r.row(o).length()<1/(1<<26)))break;i[o]=!0}let s=this.height;for(;s--;)if(i[s]){let t=Math.min(s,this.width);for(;t--;)0!==e.e(s,t)&&(i[t]=!0)}console.log("m\n",this.toString(t=>""+t)),console.log("L\n",e.toString(t=>""+t)),console.log("U\n",r.toString(t=>""+t)),console.log("P\n",n.toString(t=>""+t));const a=n.permutationAsIndexMap();return i.map((t,e)=>t&&a[e]).filter(t=>null!=t)}lerp(t,e,r=this.new()){this.width==t.width&&(this.height,t.height);const n=1-e;let i=this.m.length;for(;i--;)r.m[i]=n*this.m[i]+e*t.m[i];return r}}function P(...t){return!0}const I={normal1:A.X,w:0},R={normal1:A.Y,w:0},k={normal1:A.Z,w:0};class F{mirror(t){return this.transform(q.mirror(t))}mirroredX(){return this.mirror(I)}mirrorY(){return this.mirror(R)}mirrorZ(){return this.mirror(k)}project(t){return this.transform(q.project(t))}projectXY(){return this.transform(q.project(k))}projectYZ(){return this.transform(q.project(I))}projectZX(){return this.transform(q.project(R))}translate(...t){return this.transform(q.translate.apply(void 0,t),b.call(void 0,".translate",...t))}scale(...t){return this.transform(q.scale.apply(void 0,t),b.call(void 0,".scale",...t))}rotateX(t){return this.transform(q.rotateX(t),`.rotateX(${t})`)}rotateY(t){return this.transform(q.rotateY(t),`.rotateY(${t})`)}rotateZ(t){return this.transform(q.rotateZ(t),`.rotateZ(${t})`)}rotate(t,e,r){return this.transform(q.rotateLine(t,e,r),b(".rotate",t,e,r))}rotateAB(t,e){return this.transform(q.rotateAB(t,e),b(".rotateAB",t,e))}eulerZXZ(t,e,r){throw new Error}shearX(t,e){return this.transform(new q([1,t,e,0,0,1,0,0,0,0,1,0,0,0,0,1]))}foo(){return this.transform(q.FOO)}bar(){return this.transform(q.BAR)}visit(t,...e){let r=Object.getPrototypeOf(this);for(;!t.hasOwnProperty(r.constructor.name)&&r!==F.prototype;)r=Object.getPrototypeOf(r);if(t.hasOwnProperty(r.constructor.name))return t[r.constructor.name].apply(this,e);throw new Error("No implementation for "+this.constructor.name)}}const z=new RegExp("^(abstract|boolean|break|byte|case|catch|char|class|const|continue|debugger|default|delete|do|double|else|enum|export|extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|interface|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|this|throw|throws|transient|true|try|typeof|undefined|var|void|volatile|while|with)$");const j=[];function L(t,e=0){return void 0===t?"undefined":null===t?"null":t.toSource()}function B(t,e){t.prototype.toSource||Object.defineProperty(t.prototype,"toSource",{value:e,writable:!0,configurable:!0,enumerable:!1})}B(Boolean,Boolean.prototype.toString),B(Function,Function.prototype.toString),B(Number,Number.prototype.toString),B(RegExp,RegExp.prototype.toString),B(Date,(function(){return"new Date("+this.getTime()+")"})),B(String,(function(){return JSON.stringify(this)})),B(Array,(function(){if(j.includes(this))return"CIRCULAR_REFERENCE";j.push(this);let t="[";for(let e=0;e<this.length;e++)t+="\n\t"+L(this[e]).replace(/\r\n|\n|\r/g,"$&\t"),e!==this.length-1&&(t+=",");return t+=0===this.length?"]":"\n]",j.pop(),t})),B(Object,(function(){if(j.includes(this))return"CIRCULAR_REFERENCE";j.push(this);let t="{";const e=Object.keys(this).sort();for(let n=0;n<e.length;n++){const i=e[n];t+="\n\t"+((/^[a-z_$][0-9a-z_$]*$/gi.test(r=i)&&!z.test(r)?i:JSON.stringify(i))+": ")+L(this[i]).replace(/\r\n|\n|\r/g,"$&\t"),n!==e.length-1&&(t+=",")}var r;return t+=0===e.length?"}":"\n}",j.pop(),t}));class D extends F{constructor(t=A.INF,e=A.INF.negated()){super(),this.min=t,this.max=e}static forXYZ(t,e,r){return new D(A.O,new A(t,e,r))}static forAABBs(t){const e=new D;for(const r of t)e.addAABB(r);return e}addPoint(t){return this.min=this.min.min(t),this.max=this.max.max(t),this}addPoints(t){return t.forEach(t=>this.addPoint(t)),this}addAABB(t){return this.addPoint(t.min),this.addPoint(t.max),this}withoutAABB(t){let e,r;const n=this.volume(),i=this.size();let o=-1/0;for(let s=0;s<3;s++){const a=["x","y","z"][s],h=t.min[a]-this.min[a]>this.max[a]-t.max[a],c=h?this.min[a]:Math.max(this.min[a],t.max[a]),u=h?Math.min(this.max[a],t.min[a]):this.max[a],l=(u-c)*n/i[a];l>o&&(o=l,e=this.min.withElement(a,c),r=this.max.withElement(a,u))}return new D(e,r)}getIntersectionAABB(t){return new D(this.min.max(t.min),this.max.min(t.max))}touchesAABB(t){return!(this.min.x>t.max.x||this.max.x<t.min.x||this.min.y>t.max.y||this.max.y<t.min.y||this.min.z>t.max.z||this.max.z<t.min.z)}touchesAABBfuzzy(t,e=1/(1<<26)){return!(u(t.max.x,this.min.x,e)||u(this.max.x,t.min.x,e)||u(t.max.y,this.min.y,e)||u(this.max.y,t.min.y,e)||u(t.max.z,this.min.z,e)||u(this.max.z,t.min.z,e))}intersectsAABB(t){return!(this.min.x>=t.max.x||this.max.x<=t.min.x||this.min.y>=t.max.y||this.max.y<=t.min.y||this.min.z>=t.max.z||this.max.z<=t.min.z)}intersectsAABB2d(t){return!(this.min.x>=t.max.x||this.max.x<=t.min.x||this.min.y>=t.max.y||this.max.y<=t.min.y)}containsPoint(t){return this.min.x<=t.x&&this.min.y<=t.y&&this.min.z<=t.z&&this.max.x>=t.x&&this.max.y>=t.y&&this.max.z>=t.z}containsSphere(t,e){return this.distanceToPoint(t)>e}intersectsSphere(t,e){return this.distanceToPoint(t)<=e}distanceToPoint(t){const e=t.x,r=t.y,n=t.z,i=this.min,o=this.max;return this.containsPoint(t)?Math.max(i.x-e,e-o.x,i.y-r,r-o.y,i.z-n,n-o.z):t.distanceTo(new A(d(e,i.x,o.x),d(r,i.y,o.y),d(n,i.z,o.z)))}containsAABB(t){return this.containsPoint(t.min)&&this.containsPoint(t.max)}likeAABB(t){return this.min.like(t.min)&&this.max.like(t.max)}intersectsLine(t){t.anchor,t.dir1;const e=t.dir1.map(t=>t||Number.MIN_VALUE),r=this.min.minus(t.anchor).divv(e),n=this.max.minus(t.anchor).divv(e),i=r.min(n).maxElement(),o=r.max(n).minElement();return i<=o&&!(o<t.tMin||t.tMax<i)}hasVolume(){return this.min.x<=this.max.x&&this.min.y<=this.max.y&&this.min.z<=this.max.z}volume(){if(!this.hasVolume())return-1;const t=this.max.minus(this.min);return t.x*t.y*t.z}size(){return this.max.minus(this.min)}getCenter(){return this.min.plus(this.max).div(2)}transform(t){t.isAxisAligned();const e=new D;return e.addPoint(t.transformPoint(this.min)),e.addPoint(t.transformPoint(this.max)),e}ofTransformed(t){const e=new D;return e.addPoints(t.transformedPoints(this.corners())),e}corners(){const t=this.min,e=this.max;return[t,new A(t.x,t.y,e.z),new A(t.x,e.y,t.z),new A(t.x,e.y,e.z),new A(e.x,t.y,t.z),new A(e.x,t.y,e.z),new A(e.x,e.y,t.z),e]}toString(){return b("new AABB",this.min,this.max)}toSource(){return this.toString()}getM4(){return q.translate(this.min).times(q.scale(this.size()))}}const{PI:C,abs:V}=Math;class q extends T{constructor(...t){let e;if(0==arguments.length)e=new Float64Array(16);else{const t=Array.prototype.concat.apply([],arguments);t.length,t.length,e=new Float64Array(t)}super(4,4,e)}static inverse(t,e=new q){return t.inversed4(e)}static permutation4(t,e,r=new q){o(),o();const n=r.m;return q.identity(r),n[4*t+t]=0,n[4*e+e]=0,n[4*t+e]=1,n[4*e+t]=1,r}static transpose(t,e=new q){const r=t.m,n=e.m;return n[0]=r[0],n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=r[1],n[5]=r[5],n[6]=r[9],n[7]=r[13],n[8]=r[2],n[9]=r[6],n[10]=r[10],n[11]=r[14],n[12]=r[3],n[13]=r[7],n[14]=r[11],n[15]=r[15],e}static multiply(t,e,r=new q){const n=t.m,i=e.m,o=r.m;return o[0]=n[0]*i[0]+n[1]*i[4]+(n[2]*i[8]+n[3]*i[12]),o[1]=n[0]*i[1]+n[1]*i[5]+(n[2]*i[9]+n[3]*i[13]),o[2]=n[0]*i[2]+n[1]*i[6]+(n[2]*i[10]+n[3]*i[14]),o[3]=n[0]*i[3]+n[1]*i[7]+(n[2]*i[11]+n[3]*i[15]),o[4]=n[4]*i[0]+n[5]*i[4]+(n[6]*i[8]+n[7]*i[12]),o[5]=n[4]*i[1]+n[5]*i[5]+(n[6]*i[9]+n[7]*i[13]),o[6]=n[4]*i[2]+n[5]*i[6]+(n[6]*i[10]+n[7]*i[14]),o[7]=n[4]*i[3]+n[5]*i[7]+(n[6]*i[11]+n[7]*i[15]),o[8]=n[8]*i[0]+n[9]*i[4]+(n[10]*i[8]+n[11]*i[12]),o[9]=n[8]*i[1]+n[9]*i[5]+(n[10]*i[9]+n[11]*i[13]),o[10]=n[8]*i[2]+n[9]*i[6]+(n[10]*i[10]+n[11]*i[14]),o[11]=n[8]*i[3]+n[9]*i[7]+(n[10]*i[11]+n[11]*i[15]),o[12]=n[12]*i[0]+n[13]*i[4]+(n[14]*i[8]+n[15]*i[12]),o[13]=n[12]*i[1]+n[13]*i[5]+(n[14]*i[9]+n[15]*i[13]),o[14]=n[12]*i[2]+n[13]*i[6]+(n[14]*i[10]+n[15]*i[14]),o[15]=n[12]*i[3]+n[13]*i[7]+(n[14]*i[11]+n[15]*i[15]),r}static product(...t){const[e,r]=Array.isArray(t[0])?[t[0],t[1]]:[t,new q];if(0==e.length)return q.identity(r);if(1==e.length)return q.copy(e[0],r);if(2==e.length)return q.multiply(e[0],e[1],r);let n=q.temp0,i=q.temp1;q.multiply(e[0],e[1],n);for(let t=2;t<e.length-1;t++)q.multiply(n,e[t],i),[n,i]=[i,n];return q.multiply(n,e.last,r)}static forSys(t,e,r=t.cross(e),n=A.O){return new q(t.x,e.x,r.x,n.x,t.y,e.y,r.y,n.y,t.z,e.z,r.z,n.z,0,0,0,1)}static forRows(t,e,r,n=A.O){return new q(t.x,t.y,t.z,0,e.x,e.y,e.z,0,r.x,r.y,r.z,0,n.x,n.y,n.z,1)}static identity(t=new q){const e=t.m;return e[0]=e[5]=e[10]=e[15]=1,e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,t}static fromFunction4(t,e=new q){const r=e.m;let n=16;for(;n--;)r[n]=t(Math.floor(n/4),n%4,n);return e}static perspective(t,e,r,n,i=new q){return q.perspectiveRad(t*g,e,r,n,i)}static perspectiveRad(t,e,r,n,i=new q){const o=Math.tan(t/2)*r,s=o*e;return q.frustum(-s,s,-o,o,r,n,i)}static perspectivePlane(t,e=new q){const r=e.m;return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t.normal1.x,r[13]=t.normal1.y,r[14]=t.normal1.z,r[15]=-t.w,e}static frustum(t,e,r,n,i,o,s=new q){const a=s.m;return a[0]=2*i/(e-t),a[1]=0,a[2]=(e+t)/(e-t),a[3]=0,a[4]=0,a[5]=2*i/(n-r),a[6]=(n+r)/(n-r),a[7]=0,a[8]=0,a[9]=0,a[10]=-(o+i)/(o-i),a[11]=-2*o*i/(o-i),a[12]=0,a[13]=0,a[14]=-1,a[15]=0,s}static projectPlanePoint(t,e,r=new q){e.normal1;const n=r.m,i=e.normal1,o=e.w,s=i.dot(t);return n[0]=t.x*i.x+o-s,n[1]=t.x*i.y,n[2]=t.x*i.z,n[3]=-o*t.x,n[4]=t.y*i.x,n[5]=t.y*i.y+o-s,n[6]=t.y*i.z,n[7]=-o*t.y,n[8]=t.z*i.x,n[9]=t.z*i.y,n[10]=t.z*i.z+o-s,n[11]=-o*t.z,n[12]=i.x,n[13]=i.y,n[14]=i.z,n[15]=-s,r}static ortho(t,e,r,n,i,o,s=new q){const a=s.m;return a[0]=2/(e-t),a[1]=0,a[2]=0,a[3]=-(e+t)/(e-t),a[4]=0,a[5]=2/(n-r),a[6]=0,a[7]=-(n+r)/(n-r),a[8]=0,a[9]=0,a[10]=-2/(o-i),a[11]=-(o+i)/(o-i),a[12]=0,a[13]=0,a[14]=0,a[15]=1,s}static scale(...t){let e,r,n,i;t[0]instanceof A?(t.length,({x:e,y:r,z:n}=t[0]),i=t[1]):"number"!=typeof t[1]?(e=r=n=t[0],i=t[1]):(t.length,e=t[0],r=t[1],n=null!=t[2]?t[2]:1,i=t[3]),null==i&&(i=new q);const o=i.m;return o[0]=e,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,i}static translate(...t){let e,r,n,i;t[0]instanceof A?(t.length,({x:e,y:r,z:n}=t[0]),i=t[1]):(t.length,e=t[0],r=null!=t[1]?t[1]:0,n=null!=t[2]?t[2]:0,i=t[3]),null==i&&(i=new q);const o=i.m;return o[0]=1,o[1]=0,o[2]=0,o[3]=e,o[4]=0,o[5]=1,o[6]=0,o[7]=r,o[8]=0,o[9]=0,o[10]=1,o[11]=n,o[12]=0,o[13]=0,o[14]=0,o[15]=1,i}static rotate(t,e,r){null==r&&(r=new q);let{x:n,y:i,z:o}=e;new A(n,i,o).likeO();const s=r.m,a=Math.sqrt(n*n+i*i+o*o);n/=a,i/=a,o/=a;const h=Math.cos(t),c=Math.sin(t),u=1-h;return s[0]=n*n*u+h,s[1]=n*i*u-o*c,s[2]=n*o*u+i*c,s[3]=0,s[4]=i*n*u+o*c,s[5]=i*i*u+h,s[6]=i*o*u-n*c,s[7]=0,s[8]=o*n*u-i*c,s[9]=o*i*u+n*c,s[10]=o*o*u+h,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,r}static lookAt(t,e,r,n=new q){const i=n.m,o=t.minus(e).unit(),s=r.cross(o).unit(),a=o.cross(s).unit();return i[0]=s.x,i[1]=s.y,i[2]=s.z,i[3]=-s.dot(t),i[4]=a.x,i[5]=a.y,i[6]=a.z,i[7]=-a.dot(t),i[8]=o.x,i[9]=o.y,i[10]=o.z,i[11]=-o.dot(t),i[12]=0,i[13]=0,i[14]=0,i[15]=1,n}static rotateX(t){const e=Math.sin(t),r=Math.cos(t);return new q([1,0,0,0,0,r,-e,0,0,e,r,0,0,0,0,1])}static rotateY(t){const e=Math.sin(t),r=Math.cos(t);return new q([r,0,e,0,0,1,0,0,-e,0,r,0,0,0,0,1])}static rotateZ(t){const e=Math.sin(t),r=Math.cos(t);return new q([r,-e,0,0,e,r,0,0,0,0,1,0,0,0,0,1])}static rotateAB(t,e,r=new q){const n=t.cross(e),i=n.length();if(h(i))return q.identity(r);const o=Math.atan2(i,t.dot(e));return q.rotateLine(A.O,n,o,r)}static rotateLine(t,e,r,n=new q){e=e.unit();const i=t.x,o=t.y,s=t.z,a=e.x,h=e.y,c=e.z,u=n.m,l=Math.cos(r),f=Math.sin(r);return u[0]=a*a+(h*h+c*c)*l,u[1]=a*h*(1-l)-c*f,u[2]=a*c*(1-l)+h*f,u[3]=(i*(h*h+c*c)-a*(o*h+s*c))*(1-l)+(o*c-s*h)*f,u[4]=a*h*(1-l)+c*f,u[5]=h*h+(a*a+c*c)*l,u[6]=h*c*(1-l)-a*f,u[7]=(o*(a*a+c*c)-h*(i*a+s*c))*(1-l)+(s*a-i*c)*f,u[8]=a*c*(1-l)-h*f,u[9]=h*c*(1-l)+a*f,u[10]=c*c+(a*a+h*h)*l,u[11]=(s*(a*a+h*h)-c*(i*a+o*h))*(1-l)+(i*h-o*a)*f,u[12]=0,u[13]=0,u[14]=0,u[15]=1,n}static mirror(t,e=new q){t.normal1;const[r,n,i]=t.normal1,o=t.w,s=e.m;return s[0]=1-2*r*r,s[1]=-2*n*r,s[2]=-2*i*r,s[3]=2*r*o,s[4]=-2*r*n,s[5]=1-2*n*n,s[6]=-2*i*n,s[7]=2*n*o,s[8]=-2*r*i,s[9]=-2*n*i,s[10]=1-2*i*i,s[11]=2*i*o,s[12]=0,s[13]=0,s[14]=0,s[15]=1,e}static project(t,e=t.normal1,r=new q){t.normal1;const n=t.w,i=r.m,o=t.normal1.dot(e),{x:s,y:a,z:h}=t.normal1,{x:c,y:u,z:l}=e.div(o);return i[0]=1-s*c,i[1]=-a*c,i[2]=-h*c,i[3]=c*n,i[4]=-s*u,i[5]=1-a*u,i[6]=-h*u,i[7]=u*n,i[8]=-s*l,i[9]=-a*l,i[10]=1-h*l,i[11]=l*n,i[12]=0,i[13]=0,i[14]=0,i[15]=1,r}static lineProjection(t,e=new q){t.anchor,t.dir1;const r=t.anchor.x,n=t.anchor.y,i=t.anchor.z,o=t.dir1.x,s=t.dir1.y,a=t.dir1.z,h=e.m;return h[0]=o*o,h[1]=o*s,h[2]=o*a,h[3]=r,h[4]=s*o,h[5]=s*s,h[6]=s*a,h[7]=n,h[8]=a*o,h[9]=a*s,h[10]=a*a,h[11]=i,h[12]=0,h[13]=0,h[14]=0,h[15]=1,e}static pointInversion(t,e=new q){const r=e.m;return r[0]=-1,r[1]=0,r[2]=0,r[3]=2*t.x,r[4]=0,r[5]=-1,r[6]=0,r[7]=2*t.y,r[8]=0,r[9]=0,r[10]=-1,r[11]=2*t.z,r[12]=0,r[13]=0,r[14]=0,r[15]=1,e}static new(t,e,r){return new q(...r)}get X(){return this.transformVector(A.X)}get Y(){return this.transformVector(A.Y)}get Z(){return this.transformVector(A.Z)}get O(){return this.getTranslation()}isMirror(t=1/(1<<26)){const e=this.m,r=Math.sqrt((1-e[0])/2),n=Math.sqrt((1-e[5])/2),i=Math.sqrt((1-e[10])/2);return c(e[1],-2*n*r,t)&&c(e[2],-2*i*r,t)&&c(e[4],-2*r*n,t)&&c(e[6],-2*i*n,t)&&c(e[8],-2*r*i,t)&&c(e[9],-2*n*i,t)&&c(e[12],0,t)&&c(e[13],0,t)&&c(e[14],0,t)&&c(e[15],1,t)&&c(e[3]*n,e[7]*r,t)&&c(e[7]*i,e[11]*n,t)&&c(e[11]*r,e[3]*i,t)}inversed(t){return q.inverse(this,t)}trace(){return this.m[0]+this.m[5]+this.m[10]+this.m[15]}as3x3(t){const e=(t=q.copy(this,t)).m;return e[3]=e[7]=e[11]=e[12]=e[13]=e[14]=0,e[15]=1,t}transform(t){return t.times(this)}realEigenValues3(){const t=this.m;0==t[12]&&0==t[13]&&t[14];const[e,r,n,,i,o,s,,a,h,c]=t,u=e+o+c,l=-e*o-e*c+r*i+n*a-o*c+s*h,f=e*(o*c-s*h)-r*(i*c-s*a)+n*(i*h-o*a);return console.log(-1,u,l,f),y(-1,u,l,f)}realEigenVectors3(){const t=this.realEigenValues3(),e=this.times(q.IDENTITY3);console.log(this.toString()),console.log(e.toString());let r=t.map(t=>q.IDENTITY3.scale(-t).plus(e));if(console.log(r.map(t=>t.determinant3())),console.log(r.map(t=>""+t.toString(t=>""+t)).join("\n\n")),console.log(r.map(t=>""+t.gauss().U.toString(t=>""+t)).join("\n\n")),console.log("mats.map(m=>m.rank())",r.map(t=>t.rank())),1==t.length)return console.log(r[0].toString()),o(),E(3,t=>new A(this.m[t],this.m[4+t],this.m[8+t]));if(2==t.length){1==r[0].rank()&&(r=[r[1],r[0]]),o(),o();const t=r[0].gauss().U,e=t.row(0).cross(t.row(1)).V3().unit(),n=r[1].gauss().U.row(0).V3(),i=n.getPerpendicular().unit(),s=e.cross(i).rejectedFrom(n);return[e,i,s]}if(3==t.length)return r.forEach((t,e)=>(t.rank(),t.rank(),!0)),r.map(t=>{const e=t.gauss().U;return e.row(0).cross(e.row(1)).V3().unit()});throw new Error("there cannot be more than 3 eigen values")}svd3(){function t(t,e,r,n){const i=q.identity();return i.setEl(t,t,r),i.setEl(e,e,r),i.setEl(t,e,n),i.setEl(e,t,-n),i}const e=this.as3x3();let r=e.transposed().times(e),n=q.identity();console.log(r.str);for(let i=0;i<16;i++){console.log("blahg\n",n.times(r).times(n.transposed()).str),n.times(r).times(n.transposed()).likeM4(e.transposed().times(e)),n.times(r).times(n.transposed()).str,e.transposed().times(e).str;let i=0,o=1,s=10;for(;s--;){const t=Math.abs(r.m[s]);s%4!=Math.floor(s/4)&&t>i&&(i=t,o=s)}const a=Math.floor(o/4),h=o%4,c=r.m[5*a],u=r.m[5*h],l=r.m[o],f=c===u?C/4:Math.atan(2*l/(c-u))/2;console.log(o,a,h,"phi",f);const d=t(a,h,Math.cos(f),-Math.sin(f));d.transposed().times(d).likeIdentity(),console.log(d.str),n=n.times(d),r=q.product(d.transposed(),r,d),console.log(r.str)}const i=r.map((t,e)=>e%5==0?Math.sqrt(t):0);return{U:q.product(e,n,i.map((t,e)=>e%5==0?1/t:0)),SIGMA:i,VSTAR:n.transposed()}}map(t){return q.fromFunction4((e,r,n)=>t(this.m[n],n,this.m))}likeM4(t){return this.m.every((e,r)=>c(e,t.m[r]))}transposed(t){return q.transpose(this,t)}times(t){return q.multiply(this,t)}vanishingPoint(t){const e=this.m,r=t.x,n=t.y,i=t.z,o=r*e[12]+n*e[13]+i*e[14];if(h(o))return;const s=r*e[0]+n*e[1]+i*e[2],a=r*e[4]+n*e[5]+i*e[6],c=r*e[8]+n*e[9]+i*e[10];return new A(s/o,a/o,c/o)}transformPoint(t){const e=this.m,r=t.x,n=t.y,i=t.z,o=r*e[0]+n*e[1]+i*e[2]+e[3],s=r*e[4]+n*e[5]+i*e[6]+e[7],a=r*e[8]+n*e[9]+i*e[10]+e[11],h=r*e[12]+n*e[13]+i*e[14]+e[15];return new A(o/h,s/h,a/h)}transformVector(t,e=!0){const r=this.m,n=t.x*r[12]+t.y*r[13]+t.z*r[14];return e&&h(n),new A(r[0]*t.x+r[1]*t.y+r[2]*t.z,r[4]*t.x+r[5]*t.y+r[6]*t.z,r[8]*t.x+r[9]*t.y+r[10]*t.z)}transformVector2(t,e){const r=this.timesVector(N(e.x,e.y,e.z,1)),n=this.timesVector(N(t.x,t.y,t.z,0));return n.times(r.w).minus(r.times(n.w)).div(Math.pow(r.w,2)).V3()}transformedPoints(t){return t.map(t=>this.transformPoint(t))}transformedVectors(t){return t.map(t=>this.transformVector(t))}new(){return new q}isRegular(){return!h(this.determinant())}isAxisAligned(){const t=this.m;return 1>=+!h(t[0])+ +!h(t[1])+ +!h(t[2])&&1>=+!h(t[4])+ +!h(t[5])+ +!h(t[6])&&1>=+!h(t[8])+ +!h(t[9])+ +!h(t[10])}isOrthogonal(){return q.transpose(this,q.temp0),q.multiply(this,q.temp0,q.temp1),q.IDENTITY.likeM4(q.temp1)}isSymmetric(){return q.transpose(this,q.temp0),this.likeM4(q.temp0)}isSkewSymmetric(t){return h(this.m[0],t)&&h(this.m[5],t)&&h(this.m[10],t)&&h(this.m[15],t)&&c(this.m[1],this.m[4],t)&&c(this.m[2],this.m[8],t)&&c(this.m[3],this.m[12],t)&&c(this.m[6],this.m[9],t)&&c(this.m[7],this.m[13],t)&&c(this.m[11],this.m[14],t)}isNormal(){return q.transpose(this,q.temp0),q.multiply(this,q.temp0,q.temp1),q.multiply(q.temp0,this,q.temp2),q.temp1.likeM4(q.temp2)}determinant(){const t=this.m,e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],s=t[5],a=t[6],h=t[7],c=t[8],u=t[9],l=t[10],f=t[11],d=t[12],m=t[13],p=t[14],g=t[15],w=l*g-f*p,y=u*g-f*m,b=u*p-l*m,x=c*g-f*d,v=c*p-l*d,M=c*m-u*d;return e*(s*w-a*y+h*b)-r*(o*w-a*x+h*v)+n*(o*y-s*x+h*M)-i*(o*b-s*v+a*M)}determinant3(){const[t,e,r,,n,i,o,,s,a,h]=this.m;return t*(i*h-o*a)-e*(n*h-o*s)+r*(n*a-i*s)}isMirroring(){return this.determinant()<0}getTranslation(){const t=this.m,e=t[15];return new A(t[3]/e,t[7]/e,t[11]/e)}normalized(){const t=V(this.determinant());return 1==t?this:this.divScalar(Math.pow(t,.25))}normalized2(){const t=this.m[15];return 1==t?this:this.divScalar(Math.pow(t,.25))}like3x3(){const t=this.m;return c(1,t[15])&&h(t[12])&&h(t[13])&&h(t[14])&&h(t[3])&&h(t[7])&&h(t[11])}isNoProj(){const t=this.m;return 0==t[12]&&0==t[13]&&0==t[14]&&1==t[15]}likeIdentity(){return this.m.every((t,e)=>(e/4|0)==e%4?c(1,t):h(t))}isIdentity(){return this.m.every((t,e)=>(e/4|0)==e%4?1==t:0==t)}toString(t=(t=>t.toFixed(6).replace(/([0.])(?=0*$)/g," "))){t(0),t(0);const e=Array.prototype.slice.call(this.m).map(t),r=[0,1,2,3].map(t=>_(function(t,e,r,n,i=1){e<0&&(e=t.length+e),r<=0&&(r=t.length+r);const o=Math.ceil((r-e)/n),s=new Array(o);let a=0;for(let o=e;o<r;o+=n)for(let e=o;e<Math.min(o+i,r);e++)s[a++]=t[e];return s}(e,t,0,4).map(t=>t.length)));return[0,1,2,3].map(t=>e.slice(4*t,4*t+4).map((t,e)=>" ".repeat(r[e]-t.length)+t).join(" ")).join("\n")}isTranslation(){return[1,0,0,2,0,1,0,2,0,0,1,2,0,0,0,1].every((t,e)=>2==t||t==this.m[e])}isScaling(){return[2,0,0,0,0,2,0,0,0,0,2,0,0,0,0,1].every((t,e)=>2==t||t==this.m[e])}isZRotation(){return[2,2,0,0,2,2,0,0,0,0,1,0,0,0,0,1].every((t,e)=>2==t||t==this.m[e])&&c(1,Math.pow(this.m[0],2)+Math.pow(this.m[1],2))&&this.m[0]==this.m[5]&&this.m[1]==-this.m[4]}toSource(){const t=q.NAMEMAP.get(this);if(t)return t;if(this.isTranslation())return b("M4.translate",this.O);if(this.isScaling())return b("M4.scale",this.m[0],this.m[5],this.m[10]);if(this.isNoProj())return this.O.equals(A.O)?b("M4.forSys",this.X,this.Y,this.Z):b("M4.forSys",this.X,this.Y,this.Z,this.O);if(this.isMirror(0)){const t=this.m,e=Math.sqrt((1-t[0])/2),r=Math.sqrt((1-t[5])/2),n=Math.sqrt((1-t[10])/2),i=t[3]/2/e;return b("M4.mirror",{normal1:new A(e,r,n),w:i})}{const t=this.m;return"new M4(\n\t"+t[0]+",\t"+t[1]+",\t"+t[2]+",\t"+t[3]+",\n\t"+t[4]+",\t"+t[5]+",\t"+t[6]+",\t"+t[7]+",\n\t"+t[8]+",\t"+t[9]+",\t"+t[10]+",\t"+t[11]+",\n\t"+t[12]+",\t"+t[13]+",\t"+t[14]+",\t"+t[15]+")"}}xyAreaFactor(){return this.transformVector(A.X).cross(this.transformVector(A.Y)).length()}}q.FOO=new q(0,1,1,2,.3,.4,.8,13,2.1,3.4,5.5,8.9,0,0,0,1),q.BAR=q.FOO.inversed(),q.IDENTITY=q.identity(),q.O=new q(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),q.YZX=q.forSys(A.Y,A.Z,A.X),q.ZXY=q.forSys(A.Z,A.X,A.Y),q.IDENTITY3=new q(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0),q.temp0=new q,q.temp1=new q,q.temp2=new q,q.NAMEMAP=(new n).set(q.IDENTITY3,"M4.IDENTITY3").set(q.FOO,"M4.FOO").set(q.O,"M4.O").set(q.BAR,"M4.BAR").set(q.IDENTITY,"M4.IDENTITY").set(q.ZXY,"M4.ZXY").set(q.YZX,"M4.YZX"),q.prototype.height=4,q.prototype.width=4,m(q.prototype,F.prototype,"constructor");function U(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{h(n.next(t))}catch(t){o(t)}}function a(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}h((n=n.apply(t,e||[])).next())}))}
/**
 * @license
 *
 * js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
const{abs:G,atan2:Y,cos:X,floor:W,log:H,min:Z,max:$,round:K,sign:J,sin:Q,sqrt:tt,cbrt:et,PI:rt,hypot:nt}=Math;function it(t,e,r){return t+(e-t)*r}function ot(t,e=0,r=1){return t<e?e:t>r?r:t}function st(t,e,r,n=1e-8){let i,o=e;for(;r--&&G(i=t(o))>n;){const e=(t(o+n)-i)/n;console.log("fx / dfdx",i/e,"fx",i,"x",o),o-=i/e}return o}const at=rt/180,ht=180/rt;function ct(...t){return t[0]instanceof ut?t[0]:t.length>1&&"string"==typeof t[t.length-1]?Ot(t.slice(0,t.length-1),t[t.length-1]):Array.isArray(t[0])?Ot(t[0]):Ot(t)}class ut{constructor(t,e,r,n=1){this.r=t,this.g=e,this.b=r,this.a=n}mix(t,e,r="rgb"){return pt(this,t,e,r)}rgb(t=!0,e=!0){const r=r=>(t&&(r=K(r)),e&&(r=ot(r,0,255)),r),{r:n,g:i,b:o}=this;return[r(n),r(i),r(o)]}rgba(t=!0,e=!0){const r=r=>(t&&(r=K(r)),e&&(r=ot(r,0,255)),r),{r:n,g:i,b:o,a:s}=this;return[r(n),r(i),r(o),s]}hex(t="rgb"){const{r:e,g:r,b:n,a:i}=this;return function(t,e,r,n,i="rgb"){t=ot(K(t),0,255),e=ot(K(e),0,255),r=ot(K(r),0,255);const o=(t<<16|e<<8|r).toString(16).padStart(6,"0"),s=K(255*ot(n)).toString(16).padStart(2,"0");return"#"+("argb"==i?s+o:"rgba"==i?o+s:o)}(e,r,n,i,t)}hsl(){const{r:t,g:e,b:r}=this;return function(t,e,r){const[n,i,o]=Xt(t/255,e/255,r/255),s=(o+i)/2;let a;a=o==i?0:s<.5?(o-i)/(o+i):(o-i)/(2-o-i);return[n,a,s]}(t,e,r)}hsv(){const{r:t,g:e,b:r}=this;return function(t,e,r){const[n,i,o]=Xt(t,e,r),s=o-i;return[n,0==o?0:s/o,o/255]}(t,e,r)}hcg(){const{r:t,g:e,b:r}=this;return function(t,e,r){const[n,i,o]=Xt(t,e,r),s=(o-i)/255;return[n,s,s<1?i/255/(1-s):0]}(t,e,r)}css(t="rgb"){if("rgb"==t){const{r:t,g:e,b:r,a:n}=this;return function(t,e,r,n=1){return n>=1?"rgb("+[t,e,r].map(K).join(",")+")":"rgba("+[t,e,r].map(K).join(",")+","+n+")"}(t,e,r,n)}if("hsl"==t)return function([t,e,r],n){const i=n<1?"hsla":"hsl";return i+"("+Ct(t)+","+Ct(100*e)+"%,"+Ct(100*r)+"%"+("hsla"==i?","+Ct(n):"")+")"}(this.hsl(),this.alpha());throw new Error}name(t=!1){const e=this.num(),r=Object.keys(mt).find(t=>mt[t]==e);if(!r&&t){const[t,e,r]=this.lab();return(n=Object.keys(mt))[se(n,n=>{const[i,o,s]=yt(mt[n]).lab();return-nt(t-i,e-o,r-s)})]}var n;return r}cmyk(){const{r:t,g:e,b:r}=this;return function(t,e,r){const n=1-$(t/=255,e/=255,r/=255);return 1==n?[0,0,0,1]:[(1-t-n)/(1-n),(1-e-n)/(1-n),(1-r-n)/(1-n),n]}(t,e,r)}gl(){const{r:t,g:e,b:r,a:n}=this;return[t/255,e/255,r/255,n]}luminance(t){const{r:e,g:r,b:n,a:i}=this,[,o]=ie(e,r,n);if(void 0===t)return o;const s=(t,e,r)=>(r-t)/(e-t);return t>o?pt(this,ft,s(o,1,t),"xyz").alpha(i):pt(lt,this,s(0,o,t),"xyz").alpha(i)}temperature(){const{r:t,g:e,b:r}=this;return n=t,i=e,o=r,console.log(o-n),i+o<158.61?(console.log("0 < t < 20"),K(100*st(t=>i-(-155.25485562709179-.44596950469579133*(t-2)+104.49216199393888*H(t-2)),15,4))):o-n<0?(console.log("20 < t < 66"),K(100*st(t=>o-(.8274096064007395*(t-10)-254.76935184120902+115.67994401066147*H(t-10)),43,4))):(console.log("0 < t < 400, start= "+(-1.4*(n+i)+755)),K(100*st(t=>n-(351.97690566805693+.114206453784165*(t-55)-40.25366309332127*H(t-55)),-1.4*(n+i)+755,8)));var n,i,o}set(t,e){const[r,n]=t.split("."),i=this[r](),o=r.indexOf(n);if(-1==o)throw new Error("invalid channel");return i[o]="number"==typeof e?e:e(i[o]),ct(i,r).alpha(this.a)}clipped(){const{r:t,g:e,b:r}=this;return!(0<=t&&t<=255&&0<=e&&e<=255&&0<=r&&r<=255)}textColor(){return this.luminance()>.5?lt:ft}alpha(t){if(void 0===t)return this.a;const{r:e,g:r,b:n}=this;return bt(e,r,n,t)}darker(t=1){const[e,r,n]=this.lab();return wt(e-$t*t,r,n,this.alpha())}brighter(t=1){return this.darker(-t)}saturate(t=1){const[e,r,n]=this.lch();return function(...t){return Ot(t,"lch")}(e,$(0,r+t*$t),n,this.alpha())}desaturate(t=1){return this.saturate(-t)}premultiplied(){const{r:t,g:e,b:r,a:n}=this;return bt(t*n,e*n,r*n,n)}hsi(){const{r:t,g:e,b:r}=this;return function(t,e,r){const n=t/255,i=e/255,o=r/255,s=(n+i+o)/3;if(n==i&&i==o)return[0,0,s];{const t=.5*(2*n-i-o),e=tt(3)/2*(i-o),r=Y(e,t),a=Z(n,i,o);return[(r<0?2*rt+r:r)*ht,1-a/s,s]}}(t,e,r)}lab(){const{r:t,g:e,b:r}=this;return ne(t,e,r)}num(t="rgb"){const{r:e,g:r,b:n,a:i}=this;return function(t,e,r,n=1,i="rgb"){const o=K(t)<<16|K(e)<<8|K(r);return"rgb"===i?o:"rgba"===i?o<<8|K(255*n)<<24:K(255*n)<<24|o}(e,r,n,i,t)}lch(){const{r:t,g:e,b:r}=this;return function(t,e,r){const[n,i,o]=ne(t,e,r);return function(t,e,r){const n=nt(e,r),i=(Y(r,e)*ht+360)%360;return[t,n,i]}(n,i,o)}(t,e,r)}xyz(){const{r:t,g:e,b:r}=this;return ie(t,e,r)}equals(t){const{r:e,g:r,b:n,a:i}=this,{r:o,g:s,b:a,a:h}=t;return e==o&&r==s&&n==a&&i==h}hashCode(){return this.num("rgba")}toSource(){const{r:t,g:e,b:r,a:n}=this;return"chroma.rgb("+t+", "+e+", "+r+(1===n?")":", "+n+")")}}ut.prototype.toString=ut.prototype.css,ut.prototype.kelvin=ut.prototype.temperature;const lt=new ut(0,0,0,1),ft=new ut(255,255,255,1),dt={OrRd:[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072],PuBu:[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496],BuPu:[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347],Oranges:[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060],BuGn:[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435],YlOrBr:[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150],YlGn:[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705],Reds:[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221],RdPu:[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234],Greens:[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435],YlGnBu:[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800],Purples:[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893],GnBu:[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801],Greys:[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0],YlOrRd:[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646],PuRd:[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239],Blues:[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683],PuBuGn:[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510],Viridis:[4456788,4728695,4147850,3237774,2524047,2071946,7130714,11984427,16705573],Spectral:[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770],RdYlGn:[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679],RdBu:[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065],PiYG:[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529],PRGn:[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435],RdYlBu:[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237],BrBG:[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408],RdGy:[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618],PuOr:[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195],Set2:[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947],Accent:[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886],Set1:[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329],Set3:[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463],Dark2:[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886],Paired:[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696],Pastel2:[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772],Pastel1:[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]},mt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function pt(t,e,r=.5,n="rgb"){const i=ct(t),o=ct(e),s=At[n]&&At[n](i,o,r,n);if(!s)throw new Error("color mode "+n+" is not supported");return s.alpha(it(i.alpha(),o.alpha(),r))}function gt(...t){return Ot(t,"hsl")}function wt(...t){return Ot(t,"lab")}function yt(t){const[e,r,n]=Pt(t);return new ut(e,r,n)}function bt(...t){return Ot(t,"rgb")}Gt(Yt((t,e)=>t)),Gt(Yt((t,e)=>t*e/255)),Gt(Yt((function(t,e){return 255*(1-(1-t/255)*(1-e/255))}))),Gt(Yt((function(t,e){return e<128?2*t*e/255:255*(1-2*(1-t/255)*(1-e/255))}))),Gt(Yt(Z)),Gt(Yt($)),Gt(Yt((function(t,e){if(255==t)return 255;return 255*Z(1,e/255/(1-t/255))}))),Gt(Yt((function(t,e){return 255*(1-(1-e/255)/(t/255))})));function xt(...t){const e=t=>e._at(t);return Object.getOwnPropertyNames(vt.prototype).forEach(t=>e[t]=vt.prototype[t]),Array.isArray(t[0])&&(t=t[0]),1==t.length&&"string"==typeof t[0]&&(t=dt[t[0]]),e._init("function"==typeof t[0]?t[0]:t.map(t=>ct(t))),e}class vt{classes(t){if(void 0===t)return this._classes;if(Array.isArray(t))this._classes=t,this.domain(t[0],t[t.length-1]);else{if(t%1!=0||t<1)throw new Error("invalid classes param");this._classes=_t(this.domain(),"e",t)}return this}domain(...t){if(void 0===t[0])return"function"!=typeof this._colors?this._pos.map(t=>it(this._min,this._max,t)):[this._min,this._max];if(this._min=t[0],this._max=t[t.length-1],2==t.length)"function"!=typeof this._colors&&(this._pos=this._colors.map((t,e)=>e/(this._colors.length-1)));else{if("function"==typeof this._colors||t.length!=this._colors.length)throw new Error("invalid domain "+t);this._pos=t.map(t=>{return e=this._min,r=this._max,(t-e)/(r-e);var e,r})}return this}mode(t){return void 0===t?this._mode:(this._mode=t,this._resetCache(),this)}out(t){return this._out=t,this}correctLightness(t=!0){if(this._correctLightness!=t){this._resetCache();const e=this._colors;if(t&&"function"!=typeof e){let t=0;for(let r=1;r<e.length;r++){const n=e[r].lab()[0]-e[r-1].lab()[0];if(0==t)t=n;else if(t*n<0)throw new Error("scale color lightnesses must be monotonic")}}}return this._correctLightness=t,this}padding(t,e=t){return t?(this._paddingLeft=t,this._paddingRight=e,this):[this._paddingLeft,this._paddingRight]}colors(t,e="hex"){let r;if(void 0===t)r=this._colors.slice();else if(1==t)r=[this._color((this._min+this._max)/2)];else if(t>1)r=Array.from({length:t},(e,r)=>this._color(it(this._min,this._max,r/(t-1))));else{let t;t=this._classes&&this._classes.length>2?Array.from({length:this._classes.length-1},(t,e)=>.5*(this._classes[e]+this._classes[e+1])):this.domain(),r=t.map(t=>this._color(t))}return"color"!=e?r.map(t=>t[e]()):r}cache(t){return void 0===t?!!this._cache:(this._cache=t?this._cache||new Map:void 0,this)}gamma(t){return void 0===t?this._gamma:(this._gamma=t,this)}_at(t){const e=this._color(t);return this._out?e[this._out]():e}_init(t){this._colors=t,"function"!=typeof t&&(this._pos=t.map((e,r)=>r/(t.length-1))),this._mode="rgb",this.domain(0,1),this._paddingLeft=0,this._paddingRight=0,this._correctLightness=!1,this._cache=new Map,this._gamma=1}_getClass(t){return this._classes.findIndex(e=>t<=e)-1}_color(t,e=!1){let r;if(e)r=t;else{const e=this._min,n=this._max;if(this._classes&&this._classes.length>2){r=this._getClass(t)/(this._classes.length-2)}else r=n!==e?(t-e)/(n-e):1;this._correctLightness&&(r=this._tCorrectedLightness(r))}r=r**this._gamma,r=(this._paddingLeft+r)/(1+this._paddingLeft+this._paddingRight),r=ot(r,0,1);const n=r,i=this._cache&&this._cache.get(n);if(i)return i;{let t;if(Array.isArray(this._colors))for(let e=0;e<this._pos.length;e++){const n=this._pos[e];if(r<=n){t=this._colors[e];break}if(r>=n&&e==this._pos.length-1){t=this._colors[e];break}if(r>n&&r<this._pos[e+1]){r=(r-n)/(this._pos[e+1]-n),t=pt(this._colors[e],this._colors[e+1],r,this._mode);break}}else t=this._colors(r);return this._cache&&this._cache.set(n,t),t}}_tCorrectedLightness(t){const e=it(this._color(0,!0).lab()[0],this._color(1,!0).lab()[0],t);return function(t,e,r,n){let i=t(e);for(;n--;){const n=(e+r)/2,o=t(n);J(i)==J(o)?(e=n,i=o):r=n}return(e+r)/2}(t=>this._color(t,!0).lab()[0]-e,0,1,8)}_resetCache(){this._cache&&this._cache.clear()}}var Mt;function Et(t){const e={min:1/0,max:-1/0,sum:0,values:[],count:0};return t.forEach(t=>function(t){null==t||isNaN(t)||(e.values.push(t),e.sum+=t,t<e.min&&(e.min=t),t>e.max&&(e.max=t),e.count+=1)}(t)),e.domain=[e.min,e.max],e.limits=function(t,e){return _t(this,t,e)},e}function _t(t,e="e",r=7){const n=Array.isArray(t)?Et(t):t,{min:i,max:o,values:s}=n;if(s.sort((t,e)=>t-e),1==r)return[i,o];if(e.startsWith("c"))return[i,o];if(e.startsWith("e"))return Array.from({length:r+1},(t,e)=>it(i,o,e/r));if(e.startsWith("l")){if(i<=0)throw new Error("Logarithmic scales are only possible for values > 0");const t=Math.LOG10E*H(i),e=Math.LOG10E*H(o);return Array.from({length:r+1},(n,i)=>10**it(t,e,i/r))}if(e.startsWith("q"))return Array.from({length:r+1},(t,e)=>{const n=(s.length-1)*e/r,i=W(n);return i==n?s[i]:it(s[i],s[i+1],n-i)});if(e.startsWith("k")){const t=s.length,e=new Array(t),n=new Array(r);let a=!0,h=0,c=Array.from({length:r+1},(t,e)=>it(i,o,e/r));do{n.fill(0);for(let t=0;t<s.length;t++){const r=s[t],i=se(c,t=>-G(t-r));n[i]++,e[t]=i}const t=new Array(r).fill(0);for(let r=0;r<e.length;r++){t[e[r]]+=s[r]}for(let e=0;e<t.length;e++)t[e]/=n[e];a=t.some((t,e)=>t!=c[e]),c=t}while(h++<200&&a);const u=Array.from({length:r},()=>[]);for(let t=0;t<e.length;t++){u[e[t]].push(s[t])}const l=[];for(const t of u)l.push(t[0],t[t.length-1]);l.sort((t,e)=>t-e);const f=[];f.push(l[0]);for(let t=1;t<l.length;t+=2){const e=l[t];isNaN(e)||-1!=f.indexOf(e)||f.push(e)}return f}throw new Error("unknown mode")}!function(t){t.cool=function(){return xt([gt(180,1,.9),gt(250,.7,.4)])},t.hot=function(){return xt(["#000","#f00","#ff0","#fff"]).mode("rgb")}}(Mt||(Mt={}));const At={},St={};function Ot(t,e){if(Array.isArray(t[0])&&(t=t[0]),!e)if(1==t.length&&t[0]in mt)e="name";else if(1==t.length&&"string"==typeof t[0])e="css";else if(3==t.length)e="rgb";else if(4==t.length&&"number"==typeof t[3]&&t[3]>=0&&t[3]<=1)e="rgb";else{if(!(1==t.length&&"number"==typeof t[0]&&t[0]>=0&&t[0]<=16777215))throw new Error("could not guess mode. args "+JSON.stringify(t));e="num"}const r=St[e](...t);return new ut(r[0],r[1],r[2],void 0!==r[3]?r[3]:1)}function Nt(t){let e;if(e=t.match(/^#?([A-F\d]{2})([A-F\d]{2})([A-F\d]{2})([A-F\d]{2})?$/i))return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),e[4]?parseInt(e[4],16)/255:1];if(e=t.match(/^#?([A-F\d])([A-F\d])([A-F\d])([A-F\d])?$/i))return[17*parseInt(e[1],16),17*parseInt(e[2],16),17*parseInt(e[3],16),e[4]?17*parseInt(e[4],16)/255:1];throw new Error("invalid hex color: "+t)}function Tt(t){return(t%360+360)%360}function Pt(t){if(!("number"==typeof t&&t>=0&&t<=16777215))throw new Error("unknown num color: "+t);return[t>>16,t>>8&255,255&t,1]}At.xyz=At.rgb=At.lab=function(t,e,r,n){const i=t[n](),o=e[n]();return Ot([it(i[0],o[0],r),it(i[1],o[1],r),it(i[2],o[2],r),it(t.alpha(),e.alpha(),r)],n)},At.num=function(t,e,r){return yt(it(t.num(),e.num(),r))},At.lrgb=function(t,e,r){const[n,i,o,s]=t.rgba(!1,!1),[a,h,c,u]=e.rgba(!1,!1);return new ut(tt(n**2*(1-r)+a**2*r),tt(i**2*(1-r)+h**2*r),tt(o**2*(1-r)+c**2*r),it(s,u,r))},St.lrgb=St.rgb,St.hex=Nt,St.hsl=Ht,St.hsv=function(t,e,r,n=1){t=Tt(t);const i=r*e;return Wt(t,i,i*(1-G(t/60%2-1)),r-i,n)},St.num=Pt;const It="\\s*",Rt="([+-]?(?:\\d*\\.?)?\\d+(?:[eE][+-]?\\d+)?)",kt=new RegExp(["^rgba?\\(",Rt,",",Rt,",",Rt,"(?:,",Rt+"(%)?",")?\\)$"].join(It),"i"),Ft=new RegExp(["^rgba?\\(",Rt,Rt,Rt,"(?:/",Rt+"(%)?",")?\\)$"].join(It),"i"),zt=new RegExp(["^rgba?\\(",Rt+"%",",",Rt+"%",",",Rt+"%","(?:,",Rt+"(%)?",")?\\)$"].join(It),"i"),jt=new RegExp(["^rgba?\\(",Rt+"%",Rt+"%",Rt+"%","(?:/",Rt+"(%)?",")?\\)$"].join(It),"i"),Lt=new RegExp(["^hsla?\\(",Rt+"(deg|rad|turn)?",",",Rt+"%",",",Rt+"%","(?:,",Rt+"(%)?",")?\\)$"].join(It),"i"),Bt=new RegExp(["^hsla?\\(",Rt+"(deg|rad|turn)?\\s+"+Rt+"%",Rt+"%","(?:/",Rt+"(%)?",")?\\)$"].join(It),"i");function Dt(t){if(mt&&mt.hasOwnProperty(t))return Pt(mt[t.toLowerCase()]);let e;if(e=t.match(kt)||t.match(Ft))return[ot(+e[1],0,255),ot(+e[2],0,255),ot(+e[3],0,255),e[4]?ot(e[5]?+e[4]/100:+e[4]):1];if(e=t.match(zt)||t.match(jt))return[255*ot(+e[1]/100),255*ot(+e[2]/100),255*ot(+e[3]/100),e[4]?ot(e[5]?+e[4]/100:+e[4]):1];if(e=t.match(Lt)||t.match(Bt)){const t={deg:1,rad:ht,turn:360},r=e[2]?e[2].toLowerCase():"deg";return Ht((+e[1]*t[r]%360+360)%360,ot(+e[3]/100),ot(+e[4]/100),e[5]?ot(e[6]?+e[5]/100:+e[5]):1)}return Nt(t)}function Ct(t){return K(100*t)/100}function Vt(t){const e=t/255;return e<=.04045?e/12.92:((e+.055)/1.055)**2.4}function qt(t){return t<=.0031308?12.92*t*255:255*(1.055*t**(1/2.4)-.055)}function Ut(t){const e=t/100;let r,n,i;return e<66?(r=255,n=-155.25485562709179-.44596950469579133*(e-2)+104.49216199393888*H(e-2),i=e<20?0:.8274096064007395*(e-10)-254.76935184120902+115.67994401066147*H(e-10)):(r=351.97690566805693+.114206453784165*(e-55)-40.25366309332127*H(e-55),n=325.4494125711974+.07943456536662342*(e-50)-28.0852963507957*H(e-50),i=255),[r,n,i]}function Gt(t){return function(e,r){const[n,i,o]=t(ct(r).rgb(),ct(e).rgb());return bt(n,i,o)}}function Yt(t){return function(e,r){return e.map((e,n)=>t(e,r[n]))}}function Xt(t,e,r){const n=Z(t,e,r),i=$(t,e,r),o=i-n;let s;return s=0==o?0:t==i?(e-r)/o+(e<r?6:0):e==i?2+(r-t)/o:4+(t-e)/o,[60*s,n,i]}function Wt(t,e,r,n,i){const o=255*n,s=255*e+o,a=255*r+o;return t<60?[s,a,o,i]:t<120?[a,s,o,i]:t<180?[o,s,a,i]:t<240?[o,a,s,i]:t<300?[a,o,s,i]:[s,o,a,i]}function Ht(t,e,r,n=1){t=Tt(t);const i=(1-G(2*r-1))*e;return Wt(t,i,i*(1-G(t/60%2-1)),r-i/2,n)}function Zt(t,e,r,n=1){const[i,o,s]=function(t,e,r){function n(t){return t>te?t**3:ee*(t-4/29)}return[Kt*n((t+16)/116+e/500),Jt*n((t+16)/116),Qt*n((t+16)/116-r/200)]}(t,e,r);return oe(i,o,s,n)}St.css=Dt,St.name=function(t){return Pt(mt[t])},St.lch=function(t,e,r,n=1){const[,i,o]=function(t,e,r){return[t,X(r*at)*e,Q(r*at)*e]}(t,e,r);return Zt(t,i,o,n)},St.cmyk=function(t,e,r,n,i=1){return 1==n?[0,0,0,i]:[255*(1-t)*(1-n),255*(1-e)*(1-n),255*(1-r)*(1-n),i]},St.gl=function(t,e,r,n=1){return[255*t,255*e,255*r,n]},St.rgb=(...t)=>t,St.temperature=St.kelvin=St.K=Ut,St.hcg=function(t,e,r,n=1){const i=r*(1-e);return Wt(t=Tt(t),e,e*(1-G(t/60%2-1)),i,n)};const $t=18,Kt=.95047,Jt=1,Qt=1.08883,te=.206896552,ee=.12841855,re=.008856452;function ne(t,e,r){const[n,i,o]=ie(t,e,r);return function(t,e,r){function n(t){return t>re?et(t):t/ee+4/29}return[116*n(e/Jt)-16,500*(n(t/Kt)-n(e/Jt)),200*(n(e/Jt)-n(r/Qt))]}(n,i,o)}function ie(t,e,r){const n=Vt(t),i=Vt(e),o=Vt(r);return[.4124564*n+.3575761*i+.1804375*o,.2126729*n+.7151522*i+.072175*o,.0193339*n+.119192*i+.9503041*o]}function oe(t,e,r,n=1){const i=-.969266*t+1.8760108*e+.041556*r,o=.0556434*t-.2040259*e+1.0572252*r;return[qt(3.2404542*t-1.5371385*e-.4985314*r),qt(i),qt(o),n]}function se(t,e){let r=-1/0,n=-1;for(let i=0;i<t.length;i++){const o=e(t[i]);o>r&&(r=o,n=i)}return n}St.xyz=oe,St.lab=Zt,St.hsi=function(t,e,r,n=1){let i,o,s,a=t*at;return a<2*rt/3?(s=(1-e)/3,i=(1+e*X(a)/X(rt/3-a))/3,o=1-(s+i)):a<4*rt/3?(a-=2*rt/3,i=(1-e)/3,o=(1+e*X(a)/X(rt/3-a))/3,s=1-(i+o)):(a-=4*rt/3,o=(1-e)/3,s=(1+e*X(a)/X(rt/3-a))/3,i=1-(o+s)),[3*r*i*255,3*r*o*255,3*r*s*255,n]},At.hsv=At.hsl=At.hsi=At.lch=At.hcg=function(t,e,r,n){const[i,o,s]=t[n](),[a,h,c]=e[n]();function u(t,e,r){return t+r*(Tt(e-t+180)-180)}return ct(("h"==n.charAt(0)?u:it)(i,a,r),it(o,h,r),("h"==n.charAt(2)?u:it)(s,c,r),n)};const ae=WebGLRenderingContext;class he{constructor(t,e){this.target=t,this.type=e,this.buffer=void 0,this.data=[],this.count=0,this.spacing=1,this.hasBeenCompiled=!1,t==ae.ARRAY_BUFFER||ae.ELEMENT_ARRAY_BUFFER,e==Float32Array||e==Uint16Array||Uint32Array,Uint16Array==e?this.bindSize=ae.UNSIGNED_SHORT:Uint32Array==e&&(this.bindSize=ae.UNSIGNED_INT)}compile(t=ae.STATIC_DRAW,e=Ie()){let r;if(ae.STATIC_DRAW==t||ae.DYNAMIC_DRAW,this.buffer=this.buffer||e.createBuffer(),0==this.data.length&&console.warn("empty buffer "+this.name),0==this.data.length||this.data[0]instanceof A)!(this.data[0]instanceof A)||(this.type,Float32Array),A.pack(this.data,r=new this.type(3*this.data.length)),this.spacing=3,this.count=this.data.length,this.maxValue=0;else{if(Array.isArray(this.data[0])){const t=this.data.length*this.data[0].length;r=new this.type(t);let e=this.data.length,n=t;for(;e--;){const t=this.data[e];let i=t.length;for(;i--;)r[--n]=t[i]}}else r=new this.type(this.data);const t=this.data.length?r.length/this.data.length:0;this.name,[1,2,3,4].includes(t),this.spacing=t,this.count=this.data.length}e.bindBuffer(this.target,this.buffer),e.bufferData(this.target,r,t),this.hasBeenCompiled=!0}}const{cos:ce,sin:ue,PI:le,min:fe,max:de}=Math,me=WebGLRenderingContext,pe=new q,ge=new q;class we extends F{constructor(){super(),this.hasBeenCompiled=!1,this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","ts_Vertex")}calcVolume(){let t=0,e=A.O,r=0;const n=this.TRIANGLES,i=this.vertices;for(let o=0;o<n.length;o+=3){const s=n[o+0],a=n[o+1],h=n[o+2],c=i[s],u=i[a],l=i[h],f=u.minus(c),d=l.minus(c),m=f.cross(d);t+=A.add(c,u,l).div(3).z*m.z,r+=m.length();const p=A.add(c.times(2*c.z+u.z+l.z),u.times(c.z+2*u.z+l.z),l.times(c.z+u.z+2*l.z)).times(m.z);e=e.plus(p)}const o=t/2;return{volume:o,centroid:h(o)?A.O:e.div(24*o).schur(new A(1,1,.5)),area:r/2}}addVertexBuffer(t,e){return this.vertexBuffers[e],this.hasBeenCompiled=!1,(this.vertexBuffers[e]=new he(me.ARRAY_BUFFER,Float32Array)).name=t,this[t]=[],this}addIndexBuffer(t,e=me.UNSIGNED_SHORT){this.hasBeenCompiled=!1;const r=me.UNSIGNED_SHORT==e?Uint16Array:Uint32Array;return(this.indexBuffers[t]=new he(me.ELEMENT_ARRAY_BUFFER,r)).name=t,this[t]=[],this}concat(...t){const e=new we,r=[this].concat(t);return Object.getOwnPropertyNames(this.vertexBuffers).forEach(n=>{t.every(t=>!!t.vertexBuffers[n]);const i=this.vertexBuffers[n].name;"ts_Vertex"!==n&&e.addVertexBuffer(i,n),e[i]=[].concat(...r.map(t=>t[i]))}),Object.getOwnPropertyNames(this.indexBuffers).forEach(n=>{t.every(t=>!!t.indexBuffers[n]),e.addIndexBuffer(n,this.indexBuffers[n].bindSize);const i=new Array(r.reduce((t,e)=>t+e[n].length,0));let o=0,s=0;for(const t of r){for(const e of t[n])i[o++]=s+e;s+=t.vertices.length}e[n]=i}),e.compile(),e}compile(t=Ie()){let e=1/0;Object.getOwnPropertyNames(this.vertexBuffers).forEach(r=>{const n=this.vertexBuffers[r];n.data=this[n.name],n.compile(void 0,t),this[n.name].length<e&&(e=this[n.name].length)});for(const e in this.indexBuffers){const r=this.indexBuffers[e];r.data=this[r.name],r.compile(void 0,t)}return this.hasBeenCompiled=!0,this}static fromBinarySTL(t){return U(this,void 0,void 0,(function*(){return new Promise((e,r)=>{const n=(new we).addVertexBuffer("normals","ts_Normal"),i=new FileReader;i.onerror=r,i.onload=function(t){const r=new DataView(this.result),i=r.getUint32(80,!0);n.normals.length=3*i,n.vertices.length=3*i;let o=3*i,s=84;function a(){const t=r.getFloat32(s,!0);s+=4;const e=r.getFloat32(s,!0);s+=4;const n=r.getFloat32(s,!0);return s+=4,new A(t,e,n)}for(;o;){o-=3;const t=a();n.normals[o+0]=t,n.normals[o+1]=t,n.normals[o+2]=t,n.vertices[o+0]=a(),n.vertices[o+1]=a(),n.vertices[o+2]=a(),s+=2}e(n)},i.readAsArrayBuffer(t)})}))}toBinarySTL(){if(!this.TRIANGLES)throw new Error("TRIANGLES must be defined.");const t=this.TRIANGLES,e=t.length/3,r=new ArrayBuffer(84+50*e),n=new DataView(r);n.setUint32(80,e,!0);let i=84,o=t.length;for(;o;){o-=3;const e=this.vertices[t[o]],r=this.vertices[t[o+1]],s=this.vertices[t[o+2]];[A.normalOnPoints(e,r,s),e,r,s].forEach(t=>{n.setFloat32(i,t.x,!0),i+=4,n.setFloat32(i,t.y,!0),i+=4,n.setFloat32(i,t.z,!0),i+=4}),i+=2}return r.byteLength,r.byteLength,new Blob([r],{type:"application/octet-stream"})}transform(t){const e=new we;if(e.vertices=t.transformedPoints(this.vertices),this.normals){e.addVertexBuffer("normals","ts_Normal");const r=t.as3x3(pe).inversed(ge).transposed(pe);e.normals=this.normals.map(t=>r.transformVector(t).unit())}for(const t in this.indexBuffers)e.addIndexBuffer(t),e[t]=this[t];for(const t in this.vertexBuffers)if("ts_Vertex"!==t&&"ts_Normal"!==t){const r=this.vertexBuffers[t].name;e.addVertexBuffer(r,t),e[r]=this[r]}return e}computeNormalsFromFlatTriangles(){this.normals||this.addVertexBuffer("normals","ts_Normal");const t=this.TRIANGLES,e=this.vertices,r=this.normals;r.length=e.length;for(let n=0;n<t.length;n+=3){const i=t[n],o=t[n+1],s=t[n+2],a=e[i],h=e[o],c=e[s],u=h.minus(a).cross(c.minus(a)).unit();r[i]=r[i].plus(u),r[o]=r[o].plus(u),r[s]=r[s].plus(u)}for(let t=0;t<e.length;t++)r[t]=r[t].unit();return this.hasBeenCompiled=!1,this}computeWireframeFromFlatTriangles(t="LINES"){if(!this.TRIANGLES)throw new Error("TRIANGLES must be defined.");const e=new Set;function r(t,e){return fe(t,e)<<16|de(t,e)}const n=this.TRIANGLES;for(let t=0;t<n.length;t+=3)e.add(r(n[t+0],n[t+1])),e.add(r(n[t+1],n[t+2])),e.add(r(n[t+2],n[t+0]));const i=t;return this[i]||this.addIndexBuffer(t),e.forEach(t=>this[i].push(t>>16,65535&t)),this.hasBeenCompiled=!1,this}computeWireframeFromFlatTrianglesClosedMesh(t="LINES"){if(!this.TRIANGLES)throw new Error("TRIANGLES must be defined.");this.LINES||this.addIndexBuffer("LINES");const e=this.TRIANGLES;this[t]||this.addIndexBuffer(t);const r=this[t];for(let t=0;t<e.length;t+=3)e[t+0]<e[t+1]&&r.push(e[t+0],e[t+1]),e[t+1]<e[t+2]&&r.push(e[t+1],e[t+2]),e[t+2]<e[t+0]&&r.push(e[t+2],e[t+0]);return this.hasBeenCompiled=!1,this}computeNormalLines(t=1,e="LINES"){if(!this.normals)throw new Error("normals must be defined.");const r=this.vertices,n=this.vertices.length;this[e]||this.addIndexBuffer(e);for(let i=0;i<this.normals.length;i++)r[n+i]=r[i].plus(this.normals[i].toLength(t)),this[e].push(n+i,i);return this.hasBeenCompiled=!1,this}getAABB(){return(new D).addPoints(this.vertices)}getBoundingSphere(){const t={center:this.getAABB().getCenter(),radius:0};for(let e=0;e<this.vertices.length;e++)t.radius=Math.max(t.radius,this.vertices[e].minus(t.center).length());return t}static plane(t={}){const e=t.detailX||t.detail||1,r=t.detailY||t.detail||1,n=t.startX||0,i=t.startY||0,o=t.width||1,s=t.height||1,a=(new we).addIndexBuffer("LINES").addIndexBuffer("TRIANGLES").addVertexBuffer("normals","ts_Normal").addVertexBuffer("coords","ts_TexCoord");for(let t=0;t<=r;t++){const h=t/r;for(let c=0;c<=e;c++){const u=c/e;if(a.vertices.push(new A(n+u*o,i+h*s,0)),a.coords.push([u,h]),a.normals.push(A.Z),c<e&&t<r){const r=c+t*(e+1);a.TRIANGLES.push(r,r+e+1,r+1,r+e+1,r+e+2,r+1)}}}for(let t=0;t<e;t++)a.LINES.push(t,t+1),a.LINES.push((e+1)*r+t,(e+1)*r+t+1);for(let t=0;t<r;t++)a.LINES.push(e*t,e*(t+1)+1),a.LINES.push(e*(t+1),e*(t+2)+1);return a.compile(),a}static box(t=1,e=1,r=1){const n=(new we).addIndexBuffer("LINES").addIndexBuffer("TRIANGLES").addVertexBuffer("normals","ts_Normal");n.vertices.length=n.normals.length=2*((t+1)*(e+1)+(e+1)*(r+1)+(r+1)*(t+1)),n.TRIANGLES.length=4*(t*e+e*r+r*t);let i=0,o=0;function s(t,e,r,s=0,a=1,h=0,c=1){const u=r.transformVector(A.Z);for(let l=0;l<=e;l++){const f=l/e;for(let d=0;d<=t;d++){const m=d/t;if(n.vertices[i]=r.transformPoint(new A(s+m*a,h+f*c,0)),n.normals[i]=u,i++,d<t&&l<e){const e=d+l*(t+1);n.TRIANGLES[o++]=e,n.TRIANGLES[o++]=e+t+1,n.TRIANGLES[o++]=e+1,n.TRIANGLES[o++]=e+t+1,n.TRIANGLES[o++]=e+t+2,n.TRIANGLES[o++]=e+1}}}}return s(e,t,q.forSys(A.Y,A.X,A.Z.negated())),s(t,e,q.translate(A.Z)),s(r,e,q.forSys(A.Z,A.Y,A.X.negated())),s(e,r,q.forSys(A.Y,A.Z,A.X,A.X)),s(t,r,q.forSys(A.X,A.Z,A.Y.negated())),s(r,t,q.forSys(A.Z,A.X,A.Y,A.Y)),n}static cube(){const t=(new we).addVertexBuffer("normals","ts_Normal").addIndexBuffer("TRIANGLES").addIndexBuffer("LINES"),e=[0,1,2,3,4,5,6,7,0,4,1,5,2,6,3,7,2,6,0,4,3,7,1,5];t.vertices=e.map(t=>we.UNIT_CUBE_CORNERS[t]),t.normals=[A.X.negated(),A.X,A.Y.negated(),A.Y,A.Z.negated(),A.Z].flatMap(t=>[t,t,t,t]);for(let r=0;r<24;r+=4)Fe(t.TRIANGLES,0!=r%8,e[r],e[r+1],e[r+2],e[r+3]);return t.LINES=[0,1,0,2,1,3,2,3,0,4,1,5,2,6,3,7,4,5,4,6,5,7,6,7].map(t=>e.indexOf(t)),t.compile(),t}static isocahedron(){return we.sphere(0)}static sphere2(t,e){const r=E(t,e=>{const r=e/(t-1)*le-le/2;return new A(0,ce(r),ue(r))});return we.rotation(r,{anchor:A.O,dir1:A.Z},2*le,e,!0,r)}static sphere(t=3){const e=(1+Math.sqrt(5))/2,r=new A(1,e,0).unit(),n=r.x,i=r.y,o=[new A(-n,i,0),new A(n,i,0),new A(-n,-i,0),new A(n,-i,0),new A(0,-n,i),new A(0,n,i),new A(0,-n,-i),new A(0,n,-i),new A(i,0,-n),new A(i,0,n),new A(-i,0,-n),new A(-i,0,n)],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];function a(t,e,r,n,i,o,s,h,c,u){if(0==n)o.push(s,h,c),s<h&&u.push(s,h),h<c&&u.push(h,c),c<s&&u.push(c,s);else{const l=t.plus(e).toLength(1),f=e.plus(r).toLength(1),d=r.plus(t).toLength(1),m=i.length,p=m+1,g=m+2;i.push(l,f,d),a(l,f,d,n-1,i,o,m,p,g,u),a(t,l,d,n-1,i,o,s,m,g,u),a(e,f,l,n-1,i,o,h,p,m,u),a(r,d,f,n-1,i,o,c,g,p,u)}}const h=(new we).addVertexBuffer("normals","ts_Normal").addIndexBuffer("TRIANGLES").addIndexBuffer("LINES");h.vertices.push(...o),t=null==t?4:t;for(let e=0;e<20;e++){const[r,n,i]=s.slice(3*e,3*e+3);a(o[r],o[n],o[i],t,h.vertices,h.TRIANGLES,r,n,i,h.LINES)}return h.normals=h.vertices,h.compile(),h}static aabb(t){const e=q.product(q.translate(t.min),q.scale(t.size().max(new A(1/(1<<26),1/(1<<26),1/(1<<26))))),r=we.cube().transform(e);return r.computeNormalLines(20),r.compile(),r}static offsetVertices(t,e,r,n){P.apply(void 0,t);const i=(new we).addIndexBuffer("TRIANGLES").addVertexBuffer("coords","ts_TexCoord");n&&i.addVertexBuffer("normals","ts_Normal"),i.vertices=t.concat(t.map(t=>t.plus(e)));const o=t.length;i.coords=E(2*o,t=>[t%o/o,t/o|0]);const s=i.TRIANGLES;for(let e=0;e<t.length-1;e++)Fe(s,!1,e,e+1,t.length+e,t.length+e+1);return r&&Fe(s,!1,t.length-1,0,2*t.length-1,t.length),n&&(i.normals=n.concat(n)),i.compile(),i}static rotation(t,e,r,n,i=!0,o){const s=(new we).addIndexBuffer("TRIANGLES");o&&s.addVertexBuffer("normals","ts_Normal");const a=t.length,h=a*n,c=new q,u=s.TRIANGLES;for(let l=0;l<n;l++){const f=r/n*l;if(q.rotateLine(e.anchor,e.dir1,f,c),s.vertices.push(...c.transformedPoints(t)),o&&s.normals.push(...c.transformedVectors(o)),i||l!==n-1)for(let t=0;t<a-1;t++)Fe(u,!1,l*a+t+1,l*a+t,((l+1)*a+t+1)%h,((l+1)*a+t)%h)}return s.compile(),s}static parametric(t,e,r,n,i,o,a,h){const c=(new we).addIndexBuffer("TRIANGLES").addVertexBuffer("normals","ts_Normal");for(let u=0;u<=a;u++){const l=s(r,n,u/a);for(let r=0;r<=h;r++){const n=s(i,o,r/h);if(c.vertices.push(t(l,n)),e&&c.normals.push(e(l,n)),r<h&&u<a){const t=r+u*(h+1);Fe(c.TRIANGLES,!1,t,t+h+1,t+1,t+h+2)}}}return c}static load(t){const e=new we;if(!Array.isArray(t.vertices[0]))throw new Error;return e.vertices=t.vertices.map(t=>S(t)),t.triangles&&(e.addIndexBuffer("TRIANGLES"),e.TRIANGLES=t.triangles),t.normals&&(e.addVertexBuffer("normals","ts_Normal"),e.normals=t.normals),e.compile(),e}toJSON(){return{vertices:this.vertices.map(t=>t.toArray()),TRIANGLES:this.TRIANGLES}}}we.UNIT_CUBE_CORNERS=[A.O,new A(0,0,1),new A(0,1,0),new A(0,1,1),new A(1,0,0),new A(1,0,1),new A(1,1,0),A.XYZ];const ye=WebGLRenderingContext,be={[ye.POINTS]:"POINTS",[ye.LINES]:"LINES",[ye.LINE_STRIP]:"LINE_STRIP",[ye.LINE_LOOP]:"LINE_LOOP",[ye.TRIANGLES]:"TRIANGLES",[ye.TRIANGLE_STRIP]:"TRIANGLE_STRIP",[ye.TRIANGLE_FAN]:"TRIANGLE_FAN"},xe={[ye.POINTS]:t=>!0,[ye.LINES]:t=>0==t%2,[ye.LINE_STRIP]:t=>t>2,[ye.LINE_LOOP]:t=>t>2,[ye.TRIANGLES]:t=>0==t%3,[ye.TRIANGLE_STRIP]:t=>t>3,[ye.TRIANGLE_FAN]:t=>t>3};class ve{constructor(t,e,r=Ie()){this.projectionMatrixVersion=-1,this.modelViewMatrixVersion=-1;const n="\n\t\tuniform mat3 ts_NormalMatrix;\n\t\tuniform mat4 ts_ModelViewMatrix;\n\t\tuniform mat4 ts_ProjectionMatrix;\n\t\tuniform mat4 ts_ModelViewProjectionMatrix;\n\t\tuniform mat4 ts_ModelViewMatrixInverse;\n\t\tuniform mat4 ts_ProjectionMatrixInverse;\n\t\tuniform mat4 ts_ModelViewProjectionMatrixInverse;\n\t".match(/\bts_\w+/g);function i(t,e){const n=r.createShader(t);if(r.shaderSource(n,e),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw new Error("compile error: "+r.getShaderInfoLog(n));return n}if(this.gl=r,this.program=r.createProgram(),r.attachShader(this.program,i(r.VERTEX_SHADER,t)),r.attachShader(this.program,i(r.FRAGMENT_SHADER,e)),r.linkProgram(this.program),!r.getProgramParameter(this.program,r.LINK_STATUS))throw new Error("link error: "+r.getProgramInfoLog(this.program));this.attributeLocations={},this.uniformLocations={},this.constantAttributes={},this.activeMatrices={},n&&n.forEach(t=>{r.getUniformLocation(this.program,t)&&(this.activeMatrices[t]=!0)}),this.uniformInfos={};for(let t=r.getProgramParameter(this.program,r.ACTIVE_UNIFORMS);t-- >0;){const e=r.getActiveUniform(this.program,t);this.uniformInfos[e.name]=e}}static create(t,e,r){return new ve(t,e,r)}uniforms(t){const e=this.gl;e.useProgram(this.program);for(const r in t){const n=this.uniformLocations[r]||e.getUniformLocation(this.program,r);if(!n)continue;this.uniformLocations[r]=n;let i=t[r];const o=this.uniformInfos[r];if(i instanceof A&&(i=i.toArray()),e.FLOAT_VEC4==o.type&&1!=o.size)i instanceof Float32Array||i instanceof Float64Array?e.uniform4fv(n,i instanceof Float32Array?i:Float32Array.from(i)):e.uniform4fv(n,i.flatMap(t=>t));else if(e.FLOAT==o.type&&1!=o.size)e.uniform1fv(n,i);else if(e.FLOAT_VEC3==o.type&&1!=o.size)e.uniform3fv(n,A.pack(i));else if(i.length)switch(i.length){case 1:e.uniform1fv(n,i);break;case 2:e.uniform2fv(n,i);break;case 3:e.uniform3fv(n,i);break;case 4:e.uniform4fv(n,i);break;case 9:e.uniformMatrix3fv(n,!1,new Float32Array([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]]));break;case 16:e.uniformMatrix4fv(n,!1,new Float32Array([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]]));break;default:throw new Error("don't know how to load uniform \""+r+'" of length '+i.length)}else if("number"==typeof i)e.SAMPLER_2D==o.type||e.SAMPLER_CUBE==o.type||e.INT==o.type?e.uniform1i(n,i):e.uniform1f(n,i);else if("boolean"==typeof i)e.uniform1i(n,+i);else{if(!(i instanceof q))throw new Error('attempted to set uniform "'+r+'" to invalid value '+i);{const t=i.m;if(e.FLOAT_MAT4==o.type)e.uniformMatrix4fv(n,!1,[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]);else if(e.FLOAT_MAT3==o.type)e.uniformMatrix3fv(n,!1,[t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]]);else{if(e.FLOAT_MAT2!=o.type)throw new Error("Can't assign M4 to "+o.type);e.uniformMatrix2fv(n,!1,new Float32Array([t[0],t[4],t[1],t[5]]))}}}}return this}attributes(t){const e=this.gl;e.useProgram(this.program);for(const r in t){const n=this.attributeLocations[r]||e.getAttribLocation(this.program,r);if(-1==n){r.startsWith("ts_")||console.warn(`Vertex buffer ${r} was not bound because the attribute is not active.`);continue}this.attributeLocations[r]=n,e.disableVertexAttribArray(n);let i=t[r];i instanceof A&&(i=i.toArray()),"number"==typeof i?e.vertexAttrib1f(n,i):e.vertexAttrib4fv(n,i),this.constantAttributes[r]=!0}return this}draw(t,e=ye.TRIANGLES,r,n){t.hasBeenCompiled;const i=be[e];return this.drawBuffers(t.vertexBuffers,t.indexBuffers[i],e,r,n)}drawBuffers(t,e,r=ye.TRIANGLES,n=0,i){const s=this.gl;o(),Object.keys(t).forEach(e=>(t[e],!0));const a=this.activeMatrices,h=(a.ts_ModelViewMatrixInverse||a.ts_NormalMatrix)&&s.modelViewMatrix.inversed(),c=a.ts_ProjectionMatrixInverse&&s.projectionMatrix.inversed(),u=(a.ts_ModelViewProjectionMatrix||a.ts_ModelViewProjectionMatrixInverse)&&s.projectionMatrix.times(s.modelViewMatrix),l={};a.ts_ModelViewMatrix&&this.modelViewMatrixVersion!=s.modelViewMatrixVersion&&(l.ts_ModelViewMatrix=s.modelViewMatrix),a.ts_ModelViewMatrixInverse&&(l.ts_ModelViewMatrixInverse=h),a.ts_ProjectionMatrix&&this.projectionMatrixVersion!=s.projectionMatrixVersion&&(l.ts_ProjectionMatrix=s.projectionMatrix),c&&(l.ts_ProjectionMatrixInverse=c),u&&(l.ts_ModelViewProjectionMatrix=u),u&&a.ts_ModelViewProjectionMatrixInverse&&(l.ts_ModelViewProjectionMatrixInverse=u.inversed()),a.ts_NormalMatrix&&this.modelViewMatrixVersion!=s.modelViewMatrixVersion&&(l.ts_NormalMatrix=h.transposed()),this.uniforms(l),this.projectionMatrixVersion=s.projectionMatrixVersion,this.modelViewMatrixVersion=s.modelViewMatrixVersion;let f=1/0;for(const e in t){const r=t[e];r.hasBeenCompiled;const n=this.attributeLocations[e]||s.getAttribLocation(this.program,e);-1!=n&&r.buffer?(this.attributeLocations[e]=n,s.bindBuffer(ye.ARRAY_BUFFER,r.buffer),s.enableVertexAttribArray(n),s.vertexAttribPointer(n,r.spacing,ye.FLOAT,!1,0,0),f=Math.min(f,r.count)):e.startsWith("ts_")||console.warn(`Vertex buffer ${e} was not bound because the attribute is not active.`)}for(const e in this.attributeLocations)e in t||s.disableVertexAttribArray(this.attributeLocations[e]);if(f){if(void 0===i&&(i=e?e.count:f),xe[r](i),xe[r].toString(),e){if(e.hasBeenCompiled,e.maxValue,e.spacing,e.spacing,n+i>e.count)throw new Error("Buffer not long enough for passed parameters start/length/buffer length "+n+" "+i+" "+e.count);s.bindBuffer(ye.ELEMENT_ARRAY_BUFFER,e.buffer),s.drawElements(r,i,e.bindSize,e.type.BYTES_PER_ELEMENT*n)}else{if(n+i>f)throw new Error("invalid");s.drawArrays(r,n,i)}s.drawCallCount++}return this}}class Me{constructor(t,e,r={},n=Ie()){this.gl=n,this.width=t,this.height=e,this.format=r.format||n.RGBA,this.internalFormat=r.internalFormat||n.RGBA,this.type=r.type||n.UNSIGNED_BYTE;const i=r.filter||r.magFilter||n.LINEAR,o=r.filter||r.minFilter||n.LINEAR;if(this.type===n.FLOAT){if(2!=n.version&&!n.getExtension("OES_texture_float"))throw new Error("OES_texture_float is required but not supported");if((o!==n.NEAREST||i!==n.NEAREST)&&!n.getExtension("OES_texture_float_linear"))throw new Error("OES_texture_float_linear is required but not supported")}else if(this.type===n.HALF_FLOAT_OES){if(!n.getExtension("OES_texture_half_float"))throw new Error("OES_texture_half_float is required but not supported");if((o!==n.NEAREST||i!==n.NEAREST)&&!n.getExtension("OES_texture_half_float_linear"))throw new Error("OES_texture_half_float_linear is required but not supported")}this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,r.wrap||r.wrapS||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,r.wrap||r.wrapT||n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,this.internalFormat,t,e,0,this.format,this.type,r.data)}setData(t){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.internalFormat,this.width,this.height,0,this.format,this.type,t)}downloadData(t){if(!this.framebuffer)throw new Error("No framebuffer. You need to draw to this texture before it makes sense to read from it.");const e=this.gl,r=e.getParameter(e.FRAMEBUFFER_BINDING);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.readPixels(0,0,this.width,this.height,this.format,this.type,t,0),r!==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,r)}bind(t){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(t){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}drawTo(t){const e=this.gl,r=e.getParameter(e.FRAMEBUFFER_BINDING);if(this.framebuffer)r!==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer);else{const t=e.getParameter(e.RENDERBUFFER_BINDING),r=e.createRenderbuffer();if(e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height),e.bindRenderbuffer(e.RENDERBUFFER,t),this.framebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,r),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)throw new Error("Rendering to this texture is not supported (incomplete this.framebuffer)")}const n=e.getParameter(e.VIEWPORT);e.viewport(0,0,this.width,this.height),t(e),r!==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,r),e.viewport(n[0],n[1],n[2],n[3])}swapWith(t){let e;this.gl,t.gl,e=t.texture,t.texture=this.texture,this.texture=e,e=t.width,t.width=this.width,this.width=e,e=t.height,t.height=this.height,this.height=e,e=t.framebuffer,t.framebuffer=this.framebuffer,this.framebuffer=e}static fromImage(t,e={},r=Ie()){const n=new Me(t.width,t.height,e,r);try{r.texImage2D(r.TEXTURE_2D,0,n.format,n.format,n.type,t)}catch(t){throw"file:"==location.protocol?new Error('imgElement not loaded for security reasons (serve this page over "http://" instead)'):new Error("imgElement not loaded for security reasons (imgElement must originate from the same domain as this page or use Cross-Origin Resource Sharing)")}return e.minFilter&&e.minFilter!=r.NEAREST&&e.minFilter!=r.LINEAR&&r.generateMipmap(r.TEXTURE_2D),n}static fromURLSwitch(t,e,r=Ie()){Me.checkerBoardCanvas=Me.checkerBoardCanvas||function(){const t=document.createElement("canvas").getContext("2d");if(!t)throw new Error("Could not create 2d canvas.");t.canvas.width=t.canvas.height=128;for(let e=0;e<t.canvas.height;e+=16)for(let r=0;r<t.canvas.width;r+=16)t.fillStyle=16&(r^e)?"#FFF":"#DDD",t.fillRect(r,e,16,16);return t.canvas}();const n=Me.fromImage(Me.checkerBoardCanvas,e),i=new Image;return i.onload=()=>Me.fromImage(i,e,r).swapWith(n),i.onerror=()=>{throw new Error("Could not load image "+i.src+". 404?")},i.src=t,n}static fromURL(t,e,r=Ie()){return new Promise((n,i)=>{const o=new Image;o.onload=()=>n(Me.fromImage(o,e,r)),o.onerror=t=>i("Could not load image "+o.src+". 404?"+t),o.src=t})}}WebGLRenderingContext;function Ee(t){window.console&&window.console.error?window.console.error(t):function(t){window.console&&window.console.log&&window.console.log(t)}(t)}const _e={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}};let Ae=null,Se=null;function Oe(){if(null===Ae){Ae={},Se={};const t=window.WebGL2RenderingContext||window.WebGLRenderingContext;if(!t)throw new Error("Neither WebGL2RenderingContext nor WebGLRenderingContext exists on window.");for(const e in t){const r=t[e];"number"==typeof r&&(Ae[r]=e,Se[e]=r)}}}function Ne(t){Oe();var e=Ae[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function Te(t,e,r,n){const i=_e[t];if(void 0!==i){const t=i[e];if(void 0!==t){const e=t[r];if(e){if("object"==typeof e){const t=e.enumBitwiseOr,r=[];let i=0;for(let e=0;e<t.length;++e){const o=Se[t[e]];0!=(n&o)&&(i|=o,r.push(Ne(o)))}return i===n?r.join(" | "):Ne(n)}return Ne(n)}}}return null===n?"null":void 0===n?"undefined":n.toString()}function Pe(t,e,r){t.__defineGetter__(r,(function(){return e[r]})),t.__defineSetter__(r,(function(t){e[r]=t}))}function Ie(){return Re.gl}class Re{constructor(t,e={mesh:(new we).addVertexBuffer("coords","ts_TexCoord").addVertexBuffer("colors","ts_Color"),mode:-1,coord:[0,0],color:[1,1,1,1],pointSize:1,shader:ve.create("\n\t\t\tattribute vec4 ts_Color;\n\t\t\tattribute vec4 ts_Vertex;\n\t\t\tuniform mat4 ts_ModelViewProjectionMatrix;\n\t\t\tattribute vec2 ts_TexCoord;\n            uniform float pointSize;\n            varying vec4 color;\n            varying vec2 coord;\n            void main() {\n                color = ts_Color;\n                coord = ts_TexCoord;\n                gl_Position = ts_ModelViewProjectionMatrix * ts_Vertex;\n                gl_PointSize = pointSize;\n            }\n\t\t","\n\t\t\tprecision highp float;\n            uniform sampler2D texture;\n            uniform float pointSize;\n            // uniform bool useTexture;\n            varying vec4 color;\n            varying vec2 coord;\n            void main() {\n                gl_FragColor = color;\n                // if (useTexture) gl_FragColor *= texture2D(texture, coord.xy);\n            }\n        ",t)}){this.immediate=e,this.modelViewMatrix=q.identity(),this.projectionMatrix=q.identity(),this.tempMatrix=new q,this.resultMatrix=new q,this.modelViewStack=[],this.projectionStack=[],this.drawCallCount=0,this.projectionMatrixVersion=0,this.modelViewMatrixVersion=0,this.cachedSDFMeshes={},this.matrixMode(Re.MODELVIEW)}matrixMode(t){switch(t){case this.MODELVIEW:this.currentMatrixName="modelViewMatrix",this.stack=this.modelViewStack;break;case this.PROJECTION:this.currentMatrixName="projectionMatrix",this.stack=this.projectionStack;break;default:throw new Error("invalid matrix mode "+t)}}loadIdentity(){q.identity(this[this.currentMatrixName]),"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}loadMatrix(t){q.copy(t,this[this.currentMatrixName]),"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}multMatrix(t){q.multiply(this[this.currentMatrixName],t,this.resultMatrix);const e=this.resultMatrix;this.resultMatrix=this[this.currentMatrixName],this[this.currentMatrixName]=e,"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}mirror(t){this.multMatrix(q.mirror(t))}perspective(t,e,r,n){this.multMatrix(q.perspectiveRad(t*g,e,r,n,this.tempMatrix))}frustum(t,e,r,n,i,o){this.multMatrix(q.frustum(t,e,r,n,i,o,this.tempMatrix))}ortho(t,e,r,n,i,o){this.multMatrix(q.ortho(t,e,r,n,i,o,this.tempMatrix))}scale(...t){this.multMatrix(q.scale(...t,this.tempMatrix))}mirroredX(){this.multMatrix(q.mirror(R))}translate(t,e,r){void 0!==e?this.multMatrix(q.translate(t,e,r,this.tempMatrix)):this.multMatrix(q.translate(t,this.tempMatrix))}rotate(t,e,r,n){this.multMatrix(q.rotate(t*g,{x:e,y:r,z:n},this.tempMatrix))}lookAt(t,e,r){this.multMatrix(q.lookAt(t,e,r,this.tempMatrix))}pushMatrix(){this.stack.push(q.copy(this[this.currentMatrixName]))}popMatrix(){const t=this.stack.pop();this[this.currentMatrixName]=t,"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}wcToWindowMatrix(){const t=this.getParameter(this.VIEWPORT),[e,r,n,i]=t,o=new q([n/2,0,0,e+n/2,i/2,0,0,r+i/2,0,0,1,0,0,0,0,1]);return q.product(o,this.projectionMatrix,this.modelViewMatrix)}pointSize(t){this.immediate.shader.uniforms({pointSize:t})}begin(t){if(-1!=this.immediate.mode)throw new Error("mismatched viewerGL.begin() and viewerGL.end() calls");this.immediate.mode=t,this.immediate.mesh.colors=[],this.immediate.mesh.coords=[],this.immediate.mesh.vertices=[]}color(...t){var e;this.immediate.color=1==t.length&&Array.isArray(t[0])?t[0]:1==t.length&&"number"==typeof t[0]?[((e=t[0])>>16)/255,(e>>8&255)/255,(255&e)/255,1]:1==t.length&&"string"==typeof t[0]?ct(t[0]).gl():[t[0],t[1],t[2],t[3]||1]}texCoord(...t){this.immediate.coord=S.apply(void 0,t).toArray(2)}vertex(...t){this.immediate.mesh.colors.push(this.immediate.color),this.immediate.mesh.coords.push(this.immediate.coord),this.immediate.mesh.vertices.push(S.apply(void 0,t))}end(){if(-1==this.immediate.mode)throw new Error("mismatched viewerGL.begin() and viewerGL.end() calls");this.immediate.mesh.compile(),this.immediate.shader.uniforms({useTexture:!!Re.gl.getParameter(this.TEXTURE_BINDING_2D)}).drawBuffers(this.immediate.mesh.vertexBuffers,void 0,this.immediate.mode),this.immediate.mode=-1}makeCurrent(){Re.gl=this}animate(t){const e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){setTimeout(()=>t(performance.now()),1e3/60)};let r=performance.now(),n=!0;const i=o=>{n&&(t.call(this,o,o-r),r=o,e(i))};return e(i),()=>{n=!1}}fullscreen(t={}){const e=t.paddingTop||0,r=t.paddingLeft||0,n=t.paddingRight||0,i=t.paddingBottom||0;if(!document.body)throw new Error("document.body doesn't exist yet (call viewerGL.fullscreen() from window.onload() or from inside the <body> tag)");document.body.appendChild(this.canvas),document.body.style.overflow="hidden",this.canvas.style.position="absolute",this.canvas.style.left=r+"px",this.canvas.style.top=e+"px",this.canvas.style.width=window.innerWidth-r-n+"px",this.canvas.style.bottom=window.innerHeight-e-i+"px";const o=this;function s(){o.canvas.width=(window.innerWidth-r-n)*window.devicePixelRatio,o.canvas.height=(window.innerHeight-e-i)*window.devicePixelRatio,o.viewport(0,0,o.canvas.width,o.canvas.height),t.camera&&(o.matrixMode(Re.PROJECTION),o.loadIdentity(),o.perspective(t.fov||45,o.canvas.width/o.canvas.height,t.near||.1,t.far||1e3),o.matrixMode(Re.MODELVIEW))}return window.addEventListener("resize",s),s(),this}getMouseLine(t,e){if(t instanceof MouseEvent)return this.getMouseLine(t.offsetX,t.offsetY);const r=S(2*t/this.canvas.offsetWidth-1,2*-e/this.canvas.offsetHeight+1,0),n=S(2*t/this.canvas.offsetWidth-1,2*-e/this.canvas.offsetHeight+1,1),i=this.projectionMatrix.inversed(),o=i.transformPoint(r);return{anchor:o,dir:i.transformPoint(n).minus(o)}}viewportFill(){this.viewport(0,0,this.canvas.width,this.canvas.height)}setupTextRendering(t,e){return U(this,void 0,void 0,(function*(){this.textRenderShader=ve.create("attribute vec2 ts_TexCoord;attribute vec4 ts_Vertex;uniform mat4 ts_ModelViewProjectionMatrix;varying vec2 coord;void main(){coord=ts_TexCoord.xy;gl_Position=ts_ModelViewProjectionMatrix*ts_Vertex;}","precision mediump float;uniform sampler2D u_texture;uniform vec4 u_color;uniform float u_buffer;uniform float u_gamma;uniform float u_debug;varying vec2 coord;void main(){float dist=texture2D(u_texture,coord).r;if(u_debug>0.0){gl_FragColor=vec4(dist,dist,dist,1);}else{float alpha=smoothstep(u_buffer-u_gamma,u_buffer+u_gamma,dist);gl_FragColor=vec4(u_color.rgb,alpha*u_color.a);if(gl_FragColor.a==0.0){discard;}}}"),[this.textAtlas,this.textMetrics]=yield Promise.all([Me.fromURL(t,{format:this.LUMINANCE,internalFormat:this.LUMINANCE,type:this.UNSIGNED_BYTE}),fetch(e).then(t=>t.json())])}))}getSDFMeshForString(t){return this.textMetrics,this.cachedSDFMeshes[t]||(this.cachedSDFMeshes[t]=function(t,e,r,n=1){const i=(new we).addIndexBuffer("TRIANGLES").addVertexBuffer("coords","ts_TexCoord");let o=0,s=0;function a(r){const n=t.chars[r];if(!n)return;const[a,h,c,u,l,f,d]=n,{size:m,buffer:p}=t,g=i.vertices.length;if(a>0&&h>0){const t=(o+c-p)/m,r=(o+c+a+p)/m,n=(u-h-p)/m,l=(u+p)/m;i.vertices.push(new A(t,n,s/m),new A(r,n,s/m),new A(t,l,s/m),new A(r,l,s/m));const w=f/e.width,y=(f+a+2*p)/e.width,b=(d+h+2*p)/e.height,x=d/e.height;i.coords.push([w,b],[y,b],[w,x],[y,x]),Fe(i.TRIANGLES,!1,g,g+1,g+2,g+3)}o+=l}for(let e=0;e<r.length;e++){const i=r[e];"\n"==i?(o=0,s+=n*t.size):a(i)}return Object.assign(i.compile(),{width:o/t.size,lineCount:s+1})}
/**
 * @license
 *
 * js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */(this.textMetrics,this.textAtlas,t))}renderText(t,e,r=1,n="left",i="bottom",o=.05,s=1.2){const a=this.getSDFMeshForString(t);this.pushMatrix(),this.scale(r);const h={top:-this.textMetrics.ascender/this.textMetrics.size,middle:(-this.textMetrics.ascender-this.textMetrics.descender)/2/this.textMetrics.size,alphabetic:0,bottom:-this.textMetrics.descender/this.textMetrics.size};this.translate({left:0,center:-.5,right:-1}[n]*a.width,h[i],0),this.multMatrix(q.forSys(A.X,A.Y,new A(0,-s,0))),this.textAtlas.bind(0),this.textRenderShader.uniforms({texture:0,u_color:e,u_debug:0,u_gamma:o,u_buffer:.75}).draw(a),this.popMatrix()}static create(t={}){const e=t.canvas||document.createElement("canvas");t.canvas||(e.width=800,e.height=600),"alpha"in t||(t.alpha=!1);let r=void 0;try{r=e.getContext("webgl2",t),r&&(r.version=2),r||(r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r&&(r.version=1)),console.log("getting context")}catch(t){console.log(t,"Failed to get context")}if(!r)throw new Error("WebGL not supported");return t.throwOnError&&(r=function t(e,r,n,i=e){Oe(),r=r||function(t,e,r){var n="",i=r.length;for(let t=0;t<i;++t)n+=(0==t?"":", ")+Te(e,i,t,r[t]);Ee("WebGL error "+Ne(t)+" in "+e+"("+n+")")};const o={};function s(t,e){return function(...s){n&&n(e,s);const a=t[e].apply(t,s),h=i.getError();return 0!=h&&(o[h]=!0,r(h,e,s)),a}}const a={};for(let o in e){if("function"==typeof e[o])if("getExtension"!=o)a[o]=s(e,o);else{let h=s(e,o);a[o]=function(){const o=h.apply(e,arguments);return o?t(o,r,n,i):null}}else Pe(a,e,o)}return a.getError=function(){for(const t in o)if(o.hasOwnProperty(t)&&o[t])return o[t]=!1,parseInt(t);return e.NO_ERROR},a}(r,(t,e)=>{throw new Error(Ne(t)+" was caused by "+e)})),Re.gl=r,m(r,Re.prototype),m(r,new Re(r)),r}fixCanvasRes(t=1/0){this.canvas.width=this.canvas.clientWidth*Math.min(window.devicePixelRatio,t),this.canvas.height=this.canvas.clientHeight*Math.min(window.devicePixelRatio,t),this.viewport(0,0,this.canvas.width,this.canvas.height)}}var ke;function Fe(t,e,r,n,i,o){e?t.push(r,i,n,n,i,o):t.push(r,n,i,n,o,i)}Re.MODELVIEW=0,Re.PROJECTION=1,Re.HALF_FLOAT_OES=36193,function(t){t.create=Re.create}(ke||(ke={})),Re.prototype.MODELVIEW=Re.MODELVIEW,Re.prototype.PROJECTION=Re.PROJECTION,Re.prototype.HALF_FLOAT_OES=Re.HALF_FLOAT_OES;const{abs:ze,atan2:je,cos:Le,floor:Be,log:De,min:Ce,max:Ve,round:qe,sign:Ue,sin:Ge,sqrt:Ye,cbrt:Xe,PI:We,hypot:He}=Math;function Ze(t,e,r){return t+(e-t)*r}function $e(t,e=0,r=1){return t<e?e:t>r?r:t}function Ke(t,e,r,n=1e-8){let i,o=e;for(;r--&&ze(i=t(o))>n;){const e=(t(o+n)-i)/n;console.log("fx / dfdx",i/e,"fx",i,"x",o),o-=i/e}return o}const Je=We/180,Qe=180/We;function tr(...t){return t[0]instanceof er?t[0]:t.length>1&&"string"==typeof t[t.length-1]?yr(t.slice(0,t.length-1),t[t.length-1]):Array.isArray(t[0])?yr(t[0]):yr(t)}class er{constructor(t,e,r,n=1){this.r=t,this.g=e,this.b=r,this.a=n}mix(t,e,r="rgb"){return sr(this,t,e,r)}rgb(t=!0,e=!0){const r=r=>(t&&(r=qe(r)),e&&(r=$e(r,0,255)),r),{r:n,g:i,b:o}=this;return[r(n),r(i),r(o)]}rgba(t=!0,e=!0){const r=r=>(t&&(r=qe(r)),e&&(r=$e(r,0,255)),r),{r:n,g:i,b:o,a:s}=this;return[r(n),r(i),r(o),s]}hex(t="rgb"){const{r:e,g:r,b:n,a:i}=this;return function(t,e,r,n,i="rgb"){t=$e(qe(t),0,255),e=$e(qe(e),0,255),r=$e(qe(r),0,255);const o=(t<<16|e<<8|r).toString(16).padStart(6,"0"),s=qe(255*$e(n)).toString(16).padStart(2,"0");return"#"+("argb"==i?s+o:"rgba"==i?o+s:o)}(e,r,n,i,t)}hsl(){const{r:t,g:e,b:r}=this;return function(t,e,r){const[n,i,o]=jr(t/255,e/255,r/255),s=(o+i)/2;let a;a=o==i?0:s<.5?(o-i)/(o+i):(o-i)/(2-o-i);return[n,a,s]}(t,e,r)}hsv(){const{r:t,g:e,b:r}=this;return function(t,e,r){const[n,i,o]=jr(t,e,r),s=o-i;return[n,0==o?0:s/o,o/255]}(t,e,r)}hcg(){const{r:t,g:e,b:r}=this;return function(t,e,r){const[n,i,o]=jr(t,e,r),s=(o-i)/255;return[n,s,s<1?i/255/(1-s):0]}(t,e,r)}css(t="rgb"){if("rgb"==t){const{r:t,g:e,b:r,a:n}=this;return function(t,e,r,n=1){return n>=1?"rgb("+[t,e,r].map(qe).join(",")+")":"rgba("+[t,e,r].map(qe).join(",")+","+n+")"}(t,e,r,n)}if("hsl"==t)return function([t,e,r],n){const i=n<1?"hsla":"hsl";return i+"("+Pr(t)+","+Pr(100*e)+"%,"+Pr(100*r)+"%"+("hsla"==i?","+Pr(n):"")+")"}(this.hsl(),this.alpha());throw new Error}name(t=!1){const e=this.num(),r=Object.keys(or).find(t=>or[t]==e);if(!r&&t){const[t,e,r]=this.lab();return(n=Object.keys(or))[$r(n,n=>{const[i,o,s]=cr(or[n]).lab();return-He(t-i,e-o,r-s)})]}var n;return r}cmyk(){const{r:t,g:e,b:r}=this;return function(t,e,r){const n=1-Ve(t/=255,e/=255,r/=255);return 1==n?[0,0,0,1]:[(1-t-n)/(1-n),(1-e-n)/(1-n),(1-r-n)/(1-n),n]}(t,e,r)}gl(){const{r:t,g:e,b:r,a:n}=this;return[t/255,e/255,r/255,n]}luminance(t){const{r:e,g:r,b:n,a:i}=this,[,o]=Hr(e,r,n);if(void 0===t)return o;const s=(t,e,r)=>(r-t)/(e-t);return t>o?sr(this,nr,s(o,1,t),"xyz").alpha(i):sr(rr,this,s(0,o,t),"xyz").alpha(i)}temperature(){const{r:t,g:e,b:r}=this;return n=t,i=e,o=r,console.log(o-n),i+o<158.61?(console.log("0 < t < 20"),qe(100*Ke(t=>i-(-155.25485562709179-.44596950469579133*(t-2)+104.49216199393888*De(t-2)),15,4))):o-n<0?(console.log("20 < t < 66"),qe(100*Ke(t=>o-(.8274096064007395*(t-10)-254.76935184120902+115.67994401066147*De(t-10)),43,4))):(console.log("0 < t < 400, start= "+(-1.4*(n+i)+755)),qe(100*Ke(t=>n-(351.97690566805693+.114206453784165*(t-55)-40.25366309332127*De(t-55)),-1.4*(n+i)+755,8)));var n,i,o}set(t,e){const[r,n]=t.split("."),i=this[r](),o=r.indexOf(n);if(-1==o)throw new Error("invalid channel");return i[o]="number"==typeof e?e:e(i[o]),tr(i,r).alpha(this.a)}clipped(){const{r:t,g:e,b:r}=this;return!(0<=t&&t<=255&&0<=e&&e<=255&&0<=r&&r<=255)}textColor(){return this.luminance()>.5?rr:nr}alpha(t){if(void 0===t)return this.a;const{r:e,g:r,b:n}=this;return ur(e,r,n,t)}darker(t=1){const[e,r,n]=this.lab();return hr(e-Cr*t,r,n,this.alpha())}brighter(t=1){return this.darker(-t)}saturate(t=1){const[e,r,n]=this.lch();return function(...t){return yr(t,"lch")}(e,Ve(0,r+t*Cr),n,this.alpha())}desaturate(t=1){return this.saturate(-t)}premultiplied(){const{r:t,g:e,b:r,a:n}=this;return ur(t*n,e*n,r*n,n)}hsi(){const{r:t,g:e,b:r}=this;return function(t,e,r){const n=t/255,i=e/255,o=r/255,s=(n+i+o)/3;if(n==i&&i==o)return[0,0,s];{const t=.5*(2*n-i-o),e=Ye(3)/2*(i-o),r=je(e,t),a=Ce(n,i,o);return[(r<0?2*We+r:r)*Qe,1-a/s,s]}}(t,e,r)}lab(){const{r:t,g:e,b:r}=this;return Wr(t,e,r)}num(t="rgb"){const{r:e,g:r,b:n,a:i}=this;return function(t,e,r,n=1,i="rgb"){const o=qe(t)<<16|qe(e)<<8|qe(r);return"rgb"===i?o:"rgba"===i?o<<8|qe(255*n)<<24:qe(255*n)<<24|o}(e,r,n,i,t)}lch(){const{r:t,g:e,b:r}=this;return function(t,e,r){const[n,i,o]=Wr(t,e,r);return function(t,e,r){const n=He(e,r),i=(je(r,e)*Qe+360)%360;return[t,n,i]}(n,i,o)}(t,e,r)}xyz(){const{r:t,g:e,b:r}=this;return Hr(t,e,r)}equals(t){const{r:e,g:r,b:n,a:i}=this,{r:o,g:s,b:a,a:h}=t;return e==o&&r==s&&n==a&&i==h}hashCode(){return this.num("rgba")}toSource(){const{r:t,g:e,b:r,a:n}=this;return"chroma.rgb("+t+", "+e+", "+r+(1===n?")":", "+n+")")}}er.prototype.toString=er.prototype.css,er.prototype.kelvin=er.prototype.temperature;const rr=new er(0,0,0,1),nr=new er(255,255,255,1),ir={OrRd:[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072],PuBu:[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496],BuPu:[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347],Oranges:[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060],BuGn:[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435],YlOrBr:[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150],YlGn:[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705],Reds:[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221],RdPu:[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234],Greens:[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435],YlGnBu:[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800],Purples:[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893],GnBu:[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801],Greys:[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0],YlOrRd:[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646],PuRd:[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239],Blues:[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683],PuBuGn:[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510],Viridis:[4456788,4728695,4147850,3237774,2524047,2071946,7130714,11984427,16705573],Spectral:[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770],RdYlGn:[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679],RdBu:[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065],PiYG:[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529],PRGn:[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435],RdYlBu:[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237],BrBG:[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408],RdGy:[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618],PuOr:[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195],Set2:[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947],Accent:[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886],Set1:[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329],Set3:[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463],Dark2:[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886],Paired:[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696],Pastel2:[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772],Pastel1:[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]},or={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function sr(t,e,r=.5,n="rgb"){const i=tr(t),o=tr(e),s=gr[n]&&gr[n](i,o,r,n);if(!s)throw new Error("color mode "+n+" is not supported");return s.alpha(Ze(i.alpha(),o.alpha(),r))}function ar(...t){return yr(t,"hsl")}function hr(...t){return yr(t,"lab")}function cr(t){const[e,r,n]=vr(t);return new er(e,r,n)}function ur(...t){return yr(t,"rgb")}Fr(zr((t,e)=>t)),Fr(zr((t,e)=>t*e/255)),Fr(zr((function(t,e){return 255*(1-(1-t/255)*(1-e/255))}))),Fr(zr((function(t,e){return e<128?2*t*e/255:255*(1-2*(1-t/255)*(1-e/255))}))),Fr(zr(Ce)),Fr(zr(Ve)),Fr(zr((function(t,e){if(255==t)return 255;return 255*Ce(1,e/255/(1-t/255))}))),Fr(zr((function(t,e){return 255*(1-(1-e/255)/(t/255))})));function lr(...t){const e=t=>e._at(t);return Object.getOwnPropertyNames(fr.prototype).forEach(t=>e[t]=fr.prototype[t]),Array.isArray(t[0])&&(t=t[0]),1==t.length&&"string"==typeof t[0]&&(t=ir[t[0]]),e._init("function"==typeof t[0]?t[0]:t.map(t=>tr(t))),e}class fr{classes(t){if(void 0===t)return this._classes;if(Array.isArray(t))this._classes=t,this.domain(t[0],t[t.length-1]);else{if(t%1!=0||t<1)throw new Error("invalid classes param");this._classes=pr(this.domain(),"e",t)}return this}domain(...t){if(void 0===t[0])return"function"!=typeof this._colors?this._pos.map(t=>Ze(this._min,this._max,t)):[this._min,this._max];if(this._min=t[0],this._max=t[t.length-1],2==t.length)"function"!=typeof this._colors&&(this._pos=this._colors.map((t,e)=>e/(this._colors.length-1)));else{if("function"==typeof this._colors||t.length!=this._colors.length)throw new Error("invalid domain "+t);this._pos=t.map(t=>{return e=this._min,r=this._max,(t-e)/(r-e);var e,r})}return this}mode(t){return void 0===t?this._mode:(this._mode=t,this._resetCache(),this)}out(t){return this._out=t,this}correctLightness(t=!0){if(this._correctLightness!=t){this._resetCache();const e=this._colors;if(t&&"function"!=typeof e){let t=0;for(let r=1;r<e.length;r++){const n=e[r].lab()[0]-e[r-1].lab()[0];if(0==t)t=n;else if(t*n<0)throw new Error("scale color lightnesses must be monotonic")}}}return this._correctLightness=t,this}padding(t,e=t){return t?(this._paddingLeft=t,this._paddingRight=e,this):[this._paddingLeft,this._paddingRight]}colors(t,e="hex"){let r;if(void 0===t)r=this._colors.slice();else if(1==t)r=[this._color((this._min+this._max)/2)];else if(t>1)r=Array.from({length:t},(e,r)=>this._color(Ze(this._min,this._max,r/(t-1))));else{let t;t=this._classes&&this._classes.length>2?Array.from({length:this._classes.length-1},(t,e)=>.5*(this._classes[e]+this._classes[e+1])):this.domain(),r=t.map(t=>this._color(t))}return"color"!=e?r.map(t=>t[e]()):r}cache(t){return void 0===t?!!this._cache:(this._cache=t?this._cache||new Map:void 0,this)}gamma(t){return void 0===t?this._gamma:(this._gamma=t,this)}_at(t){const e=this._color(t);return this._out?e[this._out]():e}_init(t){this._colors=t,"function"!=typeof t&&(this._pos=t.map((e,r)=>r/(t.length-1))),this._mode="rgb",this.domain(0,1),this._paddingLeft=0,this._paddingRight=0,this._correctLightness=!1,this._cache=new Map,this._gamma=1}_getClass(t){return this._classes.findIndex(e=>t<=e)-1}_color(t,e=!1){let r;if(e)r=t;else{const e=this._min,n=this._max;if(this._classes&&this._classes.length>2){r=this._getClass(t)/(this._classes.length-2)}else r=n!==e?(t-e)/(n-e):1;this._correctLightness&&(r=this._tCorrectedLightness(r))}r=r**this._gamma,r=(this._paddingLeft+r)/(1+this._paddingLeft+this._paddingRight),r=$e(r,0,1);const n=r,i=this._cache&&this._cache.get(n);if(i)return i;{let t;if(Array.isArray(this._colors))for(let e=0;e<this._pos.length;e++){const n=this._pos[e];if(r<=n){t=this._colors[e];break}if(r>=n&&e==this._pos.length-1){t=this._colors[e];break}if(r>n&&r<this._pos[e+1]){r=(r-n)/(this._pos[e+1]-n),t=sr(this._colors[e],this._colors[e+1],r,this._mode);break}}else t=this._colors(r);return this._cache&&this._cache.set(n,t),t}}_tCorrectedLightness(t){const e=Ze(this._color(0,!0).lab()[0],this._color(1,!0).lab()[0],t);return function(t,e,r,n){let i=t(e);for(;n--;){const n=(e+r)/2,o=t(n);Ue(i)==Ue(o)?(e=n,i=o):r=n}return(e+r)/2}(t=>this._color(t,!0).lab()[0]-e,0,1,8)}_resetCache(){this._cache&&this._cache.clear()}}var dr;function mr(t){const e={min:1/0,max:-1/0,sum:0,values:[],count:0};return t.forEach(t=>function(t){null==t||isNaN(t)||(e.values.push(t),e.sum+=t,t<e.min&&(e.min=t),t>e.max&&(e.max=t),e.count+=1)}(t)),e.domain=[e.min,e.max],e.limits=function(t,e){return pr(this,t,e)},e}function pr(t,e="e",r=7){const n=Array.isArray(t)?mr(t):t,{min:i,max:o,values:s}=n;if(s.sort((t,e)=>t-e),1==r)return[i,o];if(e.startsWith("c"))return[i,o];if(e.startsWith("e"))return Array.from({length:r+1},(t,e)=>Ze(i,o,e/r));if(e.startsWith("l")){if(i<=0)throw new Error("Logarithmic scales are only possible for values > 0");const t=Math.LOG10E*De(i),e=Math.LOG10E*De(o);return Array.from({length:r+1},(n,i)=>10**Ze(t,e,i/r))}if(e.startsWith("q"))return Array.from({length:r+1},(t,e)=>{const n=(s.length-1)*e/r,i=Be(n);return i==n?s[i]:Ze(s[i],s[i+1],n-i)});if(e.startsWith("k")){const t=s.length,e=new Array(t),n=new Array(r);let a=!0,h=0,c=Array.from({length:r+1},(t,e)=>Ze(i,o,e/r));do{n.fill(0);for(let t=0;t<s.length;t++){const r=s[t],i=$r(c,t=>-ze(t-r));n[i]++,e[t]=i}const t=new Array(r).fill(0);for(let r=0;r<e.length;r++){t[e[r]]+=s[r]}for(let e=0;e<t.length;e++)t[e]/=n[e];a=t.some((t,e)=>t!=c[e]),c=t}while(h++<200&&a);const u=Array.from({length:r},()=>[]);for(let t=0;t<e.length;t++){u[e[t]].push(s[t])}const l=[];for(const t of u)l.push(t[0],t[t.length-1]);l.sort((t,e)=>t-e);const f=[];f.push(l[0]);for(let t=1;t<l.length;t+=2){const e=l[t];isNaN(e)||-1!=f.indexOf(e)||f.push(e)}return f}throw new Error("unknown mode")}!function(t){t.cool=function(){return lr([ar(180,1,.9),ar(250,.7,.4)])},t.hot=function(){return lr(["#000","#f00","#ff0","#fff"]).mode("rgb")}}(dr||(dr={}));const gr={},wr={};function yr(t,e){if(Array.isArray(t[0])&&(t=t[0]),!e)if(1==t.length&&t[0]in or)e="name";else if(1==t.length&&"string"==typeof t[0])e="css";else if(3==t.length)e="rgb";else if(4==t.length&&"number"==typeof t[3]&&t[3]>=0&&t[3]<=1)e="rgb";else{if(!(1==t.length&&"number"==typeof t[0]&&t[0]>=0&&t[0]<=16777215))throw new Error("could not guess mode. args "+JSON.stringify(t));e="num"}const r=wr[e](...t);return new er(r[0],r[1],r[2],void 0!==r[3]?r[3]:1)}function br(t){let e;if(e=t.match(/^#?([A-F\d]{2})([A-F\d]{2})([A-F\d]{2})([A-F\d]{2})?$/i))return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),e[4]?parseInt(e[4],16)/255:1];if(e=t.match(/^#?([A-F\d])([A-F\d])([A-F\d])([A-F\d])?$/i))return[17*parseInt(e[1],16),17*parseInt(e[2],16),17*parseInt(e[3],16),e[4]?17*parseInt(e[4],16)/255:1];throw new Error("invalid hex color: "+t)}function xr(t){return(t%360+360)%360}function vr(t){if(!("number"==typeof t&&t>=0&&t<=16777215))throw new Error("unknown num color: "+t);return[t>>16,t>>8&255,255&t,1]}gr.xyz=gr.rgb=gr.lab=function(t,e,r,n){const i=t[n](),o=e[n]();return yr([Ze(i[0],o[0],r),Ze(i[1],o[1],r),Ze(i[2],o[2],r),Ze(t.alpha(),e.alpha(),r)],n)},gr.num=function(t,e,r){return cr(Ze(t.num(),e.num(),r))},gr.lrgb=function(t,e,r){const[n,i,o,s]=t.rgba(!1,!1),[a,h,c,u]=e.rgba(!1,!1);return new er(Ye(n**2*(1-r)+a**2*r),Ye(i**2*(1-r)+h**2*r),Ye(o**2*(1-r)+c**2*r),Ze(s,u,r))},wr.lrgb=wr.rgb,wr.hex=br,wr.hsl=Br,wr.hsv=function(t,e,r,n=1){t=xr(t);const i=r*e;return Lr(t,i,i*(1-ze(t/60%2-1)),r-i,n)},wr.num=vr;const Mr="([+-]?(?:\\d*\\.?)?\\d+(?:[eE][+-]?\\d+)?)",Er=new RegExp(["^rgba?\\(",Mr,",",Mr,",",Mr,"(?:,",Mr+"(%)?",")?\\)$"].join("\\s*"),"i"),_r=new RegExp(["^rgba?\\(",Mr,Mr,Mr,"(?:/",Mr+"(%)?",")?\\)$"].join("\\s*"),"i"),Ar=new RegExp(["^rgba?\\(",Mr+"%",",",Mr+"%",",",Mr+"%","(?:,",Mr+"(%)?",")?\\)$"].join("\\s*"),"i"),Sr=new RegExp(["^rgba?\\(",Mr+"%",Mr+"%",Mr+"%","(?:/",Mr+"(%)?",")?\\)$"].join("\\s*"),"i"),Or=new RegExp(["^hsla?\\(",Mr+"(deg|rad|turn)?",",",Mr+"%",",",Mr+"%","(?:,",Mr+"(%)?",")?\\)$"].join("\\s*"),"i"),Nr=new RegExp(["^hsla?\\(",Mr+"(deg|rad|turn)?\\s+"+Mr+"%",Mr+"%","(?:/",Mr+"(%)?",")?\\)$"].join("\\s*"),"i");function Tr(t){if(or&&or.hasOwnProperty(t))return vr(or[t.toLowerCase()]);let e;if(e=t.match(Er)||t.match(_r))return[$e(+e[1],0,255),$e(+e[2],0,255),$e(+e[3],0,255),e[4]?$e(e[5]?+e[4]/100:+e[4]):1];if(e=t.match(Ar)||t.match(Sr))return[255*$e(+e[1]/100),255*$e(+e[2]/100),255*$e(+e[3]/100),e[4]?$e(e[5]?+e[4]/100:+e[4]):1];if(e=t.match(Or)||t.match(Nr)){const t={deg:1,rad:Qe,turn:360},r=e[2]?e[2].toLowerCase():"deg";return Br((+e[1]*t[r]%360+360)%360,$e(+e[3]/100),$e(+e[4]/100),e[5]?$e(e[6]?+e[5]/100:+e[5]):1)}return br(t)}function Pr(t){return qe(100*t)/100}function Ir(t){const e=t/255;return e<=.04045?e/12.92:((e+.055)/1.055)**2.4}function Rr(t){return t<=.0031308?12.92*t*255:255*(1.055*t**(1/2.4)-.055)}function kr(t){const e=t/100;let r,n,i;return e<66?(r=255,n=-155.25485562709179-.44596950469579133*(e-2)+104.49216199393888*De(e-2),i=e<20?0:.8274096064007395*(e-10)-254.76935184120902+115.67994401066147*De(e-10)):(r=351.97690566805693+.114206453784165*(e-55)-40.25366309332127*De(e-55),n=325.4494125711974+.07943456536662342*(e-50)-28.0852963507957*De(e-50),i=255),[r,n,i]}function Fr(t){return function(e,r){const[n,i,o]=t(tr(r).rgb(),tr(e).rgb());return ur(n,i,o)}}function zr(t){return function(e,r){return e.map((e,n)=>t(e,r[n]))}}function jr(t,e,r){const n=Ce(t,e,r),i=Ve(t,e,r),o=i-n;let s;return s=0==o?0:t==i?(e-r)/o+(e<r?6:0):e==i?2+(r-t)/o:4+(t-e)/o,[60*s,n,i]}function Lr(t,e,r,n,i){const o=255*n,s=255*e+o,a=255*r+o;return t<60?[s,a,o,i]:t<120?[a,s,o,i]:t<180?[o,s,a,i]:t<240?[o,a,s,i]:t<300?[a,o,s,i]:[s,o,a,i]}function Br(t,e,r,n=1){t=xr(t);const i=(1-ze(2*r-1))*e;return Lr(t,i,i*(1-ze(t/60%2-1)),r-i/2,n)}function Dr(t,e,r,n=1){const[i,o,s]=function(t,e,r){function n(t){return t>Gr?t**3:Yr*(t-4/29)}return[Vr*n((t+16)/116+e/500),qr*n((t+16)/116),Ur*n((t+16)/116-r/200)]}(t,e,r);return Zr(i,o,s,n)}wr.css=Tr,wr.name=function(t){return vr(or[t])},wr.lch=function(t,e,r,n=1){const[,i,o]=function(t,e,r){return[t,Le(r*Je)*e,Ge(r*Je)*e]}(t,e,r);return Dr(t,i,o,n)},wr.cmyk=function(t,e,r,n,i=1){return 1==n?[0,0,0,i]:[255*(1-t)*(1-n),255*(1-e)*(1-n),255*(1-r)*(1-n),i]},wr.gl=function(t,e,r,n=1){return[255*t,255*e,255*r,n]},wr.rgb=(...t)=>t,wr.temperature=wr.kelvin=wr.K=kr,wr.hcg=function(t,e,r,n=1){const i=r*(1-e);return Lr(t=xr(t),e,e*(1-ze(t/60%2-1)),i,n)};const Cr=18,Vr=.95047,qr=1,Ur=1.08883,Gr=.206896552,Yr=.12841855,Xr=.008856452;function Wr(t,e,r){const[n,i,o]=Hr(t,e,r);return function(t,e,r){function n(t){return t>Xr?Xe(t):t/Yr+4/29}return[116*n(e/qr)-16,500*(n(t/Vr)-n(e/qr)),200*(n(e/qr)-n(r/Ur))]}(n,i,o)}function Hr(t,e,r){const n=Ir(t),i=Ir(e),o=Ir(r);return[.4124564*n+.3575761*i+.1804375*o,.2126729*n+.7151522*i+.072175*o,.0193339*n+.119192*i+.9503041*o]}function Zr(t,e,r,n=1){const i=-.969266*t+1.8760108*e+.041556*r,o=.0556434*t-.2040259*e+1.0572252*r;return[Rr(3.2404542*t-1.5371385*e-.4985314*r),Rr(i),Rr(o),n]}function $r(t,e){let r=-1/0,n=-1;for(let i=0;i<t.length;i++){const o=e(t[i]);o>r&&(r=o,n=i)}return n}wr.xyz=Zr,wr.lab=Dr,wr.hsi=function(t,e,r,n=1){let i,o,s,a=t*Je;return a<2*We/3?(s=(1-e)/3,i=(1+e*Le(a)/Le(We/3-a))/3,o=1-(s+i)):a<4*We/3?(a-=2*We/3,i=(1-e)/3,o=(1+e*Le(a)/Le(We/3-a))/3,s=1-(i+o)):(a-=4*We/3,o=(1-e)/3,s=(1+e*Le(a)/Le(We/3-a))/3,i=1-(o+s)),[3*r*i*255,3*r*o*255,3*r*s*255,n]},gr.hsv=gr.hsl=gr.hsi=gr.lch=gr.hcg=function(t,e,r,n){const[i,o,s]=t[n](),[a,h,c]=e[n]();function u(t,e,r){return t+r*(xr(e-t+180)-180)}return tr(("h"==n.charAt(0)?u:Ze)(i,a,r),Ze(o,h,r),("h"==n.charAt(2)?u:Ze)(s,c,r),n)};var Kr=setTimeout;function Jr(t,e){var r=e.useCachedSetTimeout?Kr:setTimeout;return new Promise((function(e){r(e,t)}))}var Qr=function(t){function e(t){return i.then((function(){return t}))}var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=r.useCachedSetTimeout,i=Jr(t,{useCachedSetTimeout:n});return e.then=function(){return i.then.apply(i,arguments)},e.catch=Promise.resolve().catch,e},tn=r(1),en="#version 300 es\r\nin vec4 ts_Vertex;\r\nin vec2 ts_TexCoord;\r\nout vec2 coord;\r\nvoid main() {\r\n    coord = ts_TexCoord.xy;\r\n    gl_Position = ts_Vertex;\r\n}";const rn=ke.create();document.body.append(rn.canvas);const nn=Math.sqrt(3)/2,on=(t,e)=>S(t+.5*(1&e),e*nn,0);Object(tn.assert)(on(0,0).equals(S(0,0))),Object(tn.assert)(on(1,0).equals(S(1,0))),Object(tn.assert)(on(0,1).equals(S(.5,nn)));const sn=(t,e,r,n)=>(([t,e,r],[n,i,o])=>(Math.abs(n-t)+Math.abs(i-e)+Math.abs(o-r))/2)(an(t,e),an(r,n)),an=(t,e)=>{const r=t-(e>>1);return[r,e,-r-e]};tn.assert.deepEqual(an(0,0),[0,0,-0]),tn.assert.deepEqual(an(1,0),[1,0,-1]),tn.assert.deepEqual(an(0,1),[0,1,-1]),tn.assert.deepEqual(an(0,2),[-1,2,-1]);class hn{constructor(t,e){this.w=t,this.h=e,this.data=new Uint8Array(t*e)}clone(){const t=new hn(this.w,this.h);return t.plusHS(this),t}dualize(){for(let t=0;t<this.h*this.w;t++)255!==this.data[t]&&(this.data[t]=5-this.data[t]);console.log("dualized")}plus(t){for(let e=0;e<this.h*this.w;e++)255!==this.data[e]&&(this.data[e]+=t);console.log("plus "+t)}times(t){for(let e=0;e<this.h*this.w;e++)255!==this.data[e]&&(this.data[e]*=t);console.log("times "+t)}setHS(t){for(let e=0;e<this.h*this.w;e++)this.data[e]=t.data[e]}plusHS(t){for(let e=0;e<this.h*this.w;e++)255!==this.data[e]&&(this.data[e]+=t.data[e])}fill(t){for(let e=0;e<this.h*this.w;e++)255!==this.data[e]&&(this.data[e]=t)}fillf(t){for(let e=0;e<this.h*this.w;e++){const r=e%this.w,n=e/this.w|0;255!==this.data[e]&&(this.data[e]=t(r,n,e))}}getOddr(t,e){return this.data[e*this.w+t]}setOddr(t,e,r){return this.data[e*this.w+t]=r}addOddr(t,e,r){return this.data[e*this.w+t]+=r}isSink(t,e){return 255===this.getOddr(t,e)}drawHex(t,e,r){const n=this.w/2|0,i=this.h/2|0;for(let o=0;o<this.h*this.w;o++){const s=o%this.w,a=o/this.w|0;t<=sn(n,i,s,a)&&sn(n,i,s,a)<=e&&(this.data[o]=r)}}drawTriangle(t,e,r){const n=this.w/2|0,i=this.h/2|0;for(let o=0;o<this.h*this.w;o++){const s=o%this.w,a=o/this.w|0,h=Math.max(...an(s-n,a-i));t<=h&&h<=e&&(this.data[o]=r)}}drawCircle(t,e,r){const n=this.w/2|0,i=this.h/2|0,o=on(n,i);for(let n=0;n<this.h*this.w;n++){const i=n%this.w,s=n/this.w|0,a=on(i,s).distanceTo(o);t<=a&&a<=e&&(this.data[n]=r)}}async asyncStabilize(){let t;gn();do{t=0;for(let e=0;e<this.h*this.w;e++){const r=e%this.w,n=e/this.w|0;!this.isSink(r,n)&&this.getOddr(r,n)>=6&&(await wn(r,n,async(t,e)=>!this.isSink(t,e)&&this.addOddr(t,e,1)),this.addOddr(r,n,-6),t++)}gn(),await Qr(10)}while(0!=t);console.log("stabilized"),await Qr(2e3)}async calcHash(){return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",this.data))).map(t=>t.toString(16).padStart(2,"0")).join("")}countUnstable(){let t=0;for(let e=0;e<this.w*this.h;e++)t+=+(255!==this.data[e]&&this.data[e]>=6);return t}}const cn=lr("yellow","blue").mode("lab").colors(10,"gl"),un=tr("F4F4ED").gl();rn.fullscreen(),console.log(rn.canvas.width,rn.canvas.height);const ln=ve.create(en,'#version 300 es\r\nprecision mediump float;\r\nprecision mediump usampler2D;\r\n\r\n// this shader defines a virtual texture, which renders\r\n// a hex "(height-)map" saved as ODDR\r\n\r\n// texture coordinate to render\r\nin vec2 coord;\r\n\r\nuniform vec4 colorBg;\r\nuniform vec4[10] colorFg;\r\n\r\nconst int MAX_MARCHING_STEPS = 255;\r\nconst float MIN_DIST = 0.0;\r\nconst float MAX_DIST = 100.0;\r\n\r\nout vec4 fragColor;\r\n\r\n// the "map" being rendered. also implicitely defines the\r\n// size of the texture.\r\n// width: x is in [-0.5, heights.width], (0, 0) is the center of the first hex\r\n// height: sqrt(3) / 2 * heights.height\r\nuniform usampler2D heights;\r\n\r\nvec3 raToHex(vec2 xy) {\r\n\tfloat hex_t = xy.y / 0.866;\r\n\tfloat hex_s = xy.x - hex_t / 2.0;\r\n\treturn vec3(hex_s, hex_t, -(hex_s + hex_t));\r\n}\r\n\r\nvec2 hexToRa(vec3 hex) {\r\n\tfloat y = hex.t * 0.866;\r\n\tfloat x = hex.s + hex.t / 2.0;\r\n\treturn vec2(x, y);\r\n}\r\nivec2 cube_to_oddr(ivec3 cube) {\r\n    int col = cube.x + (cube.y - (cube.y&1)) / 2;\r\n    int row = cube.y;\r\n    return ivec2(col, row);\r\n}\r\nivec3 oddr_to_cube(ivec2 hex) {\r\n    int x = hex.x - (hex.y - (hex.y&1)) / 2;\r\n    int y = hex.y;\r\n    int z = -x-y;\r\n    return ivec3(x, y, z);\r\n}\r\n\r\nvec3 hexRound(vec3 hex) {\r\n\tvec3 r = floor(hex + 0.5);\r\n\tvec3 diff = abs(r - hex);\r\n\r\n\tif (diff.x > diff.y && diff.x > diff.z) {\r\n\t\tr.x = -(r.y + r.z);\r\n\t} else if (diff.y > diff.z) {\r\n\t\tr.y = -(r.x + r.z);\r\n\t} else {\r\n\t\tr.z = -(r.x + r.y);\r\n\t}\r\n\r\n\treturn r;\r\n}\r\nfloat max3 (vec3 v) {\r\n  return max (max (v.x, v.y), v.z);\r\n}\r\nfloat min3 (vec3 v) {\r\n  return max (max (v.x, v.y), v.z);\r\n}\r\nfloat hex_sdf(vec3 h) {\r\n\treturn max3(abs(h.yzx + h.zxy/2.0 ) );\r\n\t// return abs(h.x+(h.y/2.0) );\r\n\t// return max3(abs(vec3(h)));\r\n}\r\n\r\nbool between(float min, float max, float x) {\r\n\treturn min <= x && x <= max;\r\n}\r\n\r\nvoid main() {\r\n\t//mainImage(gl_FragColor, coord.xy);\r\n\tfloat factor = 140.0;\r\n\tvec2 pos2 = coord;\r\n\tvec3 hex_pos = raToHex(pos2);\r\n\t// vec2 hex_center = floor(hex_pos + 0.5);\r\n\tvec3 hex_center = hexRound(hex_pos);\r\n\tvec2 center = hexToRa(hex_center);\r\n\tvec2 squarePos = floor(pos2+ 0.5);\r\n\tvec3 hex_d = hex_pos - hex_center;\r\n\t// vec2 d =hex_pos - hex_center;\r\n\t// vec3 zz = vec3(d.xy, (d.y - d.x)/1.41);\r\n\tvec2 local_ra_offset = pos2 - center;\r\n\t// if (abs(zz.x +zz.y+ zz.z) < 0.1) {\r\n\t// if (max(d.x, max(d.y, 0.0)) < 0.45) {\r\n\t// if (length(pos2 - squarePos) < 0.5) {\r\n\tfloat d = hex_sdf(hex_d);\r\n\tif (between(0.0, 0.45, d)\r\n\t\t// || length(pos2 - center) < 0.2\r\n\t) {\r\n\t// if (length (pos2 - center) <0.53){\r\n\t// if (length (hex_pos - hex_center) <0.45){\r\n\t\tivec2 center2 = cube_to_oddr( ivec3(hex_center) );\r\n\t\tuint value = texelFetch(heights,  center2, 0).r;\r\n\t\tfragColor = value == 255u ? colorBg : colorFg[value];\r\n\t} else {\r\n\t\tfragColor = colorBg;\r\n\t}\r\n}'),fn=ve.create(en,"#version 300 es\r\nprecision mediump float;\r\nprecision mediump usampler2D;\r\nin vec2 coord;\r\n\r\nuniform vec2 iResolution;\r\nuniform vec4 colorBg;\r\nuniform vec4[10] colorFg;\r\nuniform float aspectRatio;\r\n\r\nout uvec4 fragColor;\r\n\r\nconst uint SINK = 255u;\r\n\r\nuniform usampler2D heights;\r\n\r\nfloat EPSILON = 0.0001;\r\n\r\nvec3 raToHex(vec2 xy) {\r\n\tfloat hex_t = xy.y / 0.866;\r\n\tfloat hex_s = xy.x - hex_t / 2.0;\r\n\treturn vec3(hex_s, hex_t, -(hex_s + hex_t));\r\n}\r\n\r\nvec2 hexToRa(vec3 hex) {\r\n\tfloat y = hex.t * 0.866;\r\n\tfloat x = hex.s + hex.t / 2.0;\r\n\treturn vec2(x, y);\r\n}\r\nivec2 cube_to_oddr(ivec3 cube) {\r\n    int col = cube.x + (cube.y - (cube.y&1)) / 2;\r\n    int row = cube.y;\r\n    return ivec2(col, row);\r\n}\r\nivec3 oddr_to_cube(ivec2 hex) {\r\n    int x = hex.x - (hex.y - (hex.y&1)) / 2;\r\n    int y = hex.y;\r\n    int z = -x-y;\r\n    return ivec3(x, y, z);\r\n}\r\n\r\nvec3 hexRound(vec3 hex) {\r\n\tvec3 r = floor(hex + 0.5);\r\n\tvec3 diff = abs(r - hex);\r\n\r\n\tif (diff.x > diff.y && diff.x > diff.z) {\r\n\t\tr.x = -(r.y + r.z);\r\n\t} else if (diff.y > diff.z) {\r\n\t\tr.y = -(r.x + r.z);\r\n\t} else {\r\n\t\tr.z = -(r.x + r.y);\r\n\t}\r\n\r\n\treturn r;\r\n}\r\nfloat max3 (vec3 v) {\r\n  return max (max (v.x, v.y), v.z);\r\n}\r\nfloat min3 (vec3 v) {\r\n  return max (max (v.x, v.y), v.z);\r\n}\r\nfloat hex_sdf(vec3 h) {\r\n\treturn max3(abs(h.yzx + h.zxy/2.0 ) );\r\n\t// return abs(h.x+(h.y/2.0) );\r\n\t// return max3(abs(vec3(h)));\r\n}\r\n\r\nbool between(float min, float max, float x) {\r\n\treturn min <= x && x <= max;\r\n}\r\n\r\nuint at(ivec2 p) {\r\n\tivec2 tex_size = textureSize(heights, 0);\r\n\r\n\tif (p.x < 0 || p.y < 0 || tex_size.x <= p.x || tex_size.y <= p.y) {\r\n\t\t// point is outside source texture\r\n\t\treturn 0u;\r\n\t} else {\r\n\t\tuint value = texelFetch(heights, p, 0).r;\r\n\t\tif (SINK == value) {\r\n\t\t\treturn 0u;\r\n\t\t} else {\r\n\t\t\treturn value / 6u;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nuint calc(ivec2 oddr_pos) {\r\n\tuint value = texelFetch(heights, oddr_pos, 0).r;\r\n\r\n\tif (SINK == value) {\r\n\t\treturn SINK;\r\n\t}\r\n\r\n\t// the current pos topples as many times as it can\r\n\tvalue = value % 6u;\r\n\t// all the neighbors topple as often as they can\r\n\tvalue += at(oddr_pos + ivec2(+1, 0));\r\n\tvalue += at(oddr_pos + ivec2(-1, 0));\r\n\r\n\tvalue += at(oddr_pos + ivec2(0, +1));\r\n\tvalue += at(oddr_pos + ivec2(0, -1));\r\n\r\n\tvalue += at(oddr_pos + ivec2(0 != (oddr_pos.y & 1) ? 1 : -1, +1));\r\n\tvalue += at(oddr_pos + ivec2(0 != (oddr_pos.y & 1) ? 1 : -1, -1));\r\n\r\n\treturn value;\r\n}\r\n\r\nvoid main() {\r\n\tfragColor = uvec4(calc(ivec2(coord)), 0u, 0u, 0u);\r\n\t// fragColor = uvec4(2u, 0u, 0u, 0u);\r\n}"),dn=new hn(256,256),mn=new Me(dn.w,dn.h,{filter:rn.NEAREST,internalFormat:rn.R8UI,format:rn.RED_INTEGER}),pn=new Me(dn.w,dn.h,{filter:rn.NEAREST,internalFormat:rn.R8UI,format:rn.RED_INTEGER});console.log("IMPLEMENTATION_COLOR_READ_FORMAT",rn.getParameter(rn.IMPLEMENTATION_COLOR_READ_FORMAT).toString(16)),console.log("IMPLEMENTATION_COLOR_READ_TYPE",rn.getParameter(rn.IMPLEMENTATION_COLOR_READ_TYPE).toString(16));const gn=()=>mn.setData(dn.data);dn.fill(255),dn.drawHex(20,100,0),dn.fill(10),gn();const wn=async(t,e,r)=>{await r(t+1,e),await r(t-1,e),await r(t,e+1),await r(t,e-1),await r(t+1-2*(1&e),e+1),await r(t+1-2*(1&e),e-1)},yn=(t,e,r,n)=>{const i=we.plane({startX:-1,width:2,startY:-1,height:2});return i.coords[0]=[t,e],i.coords[1]=[r,e],i.coords[2]=[t,n],i.coords[3]=[r,n],i.compile(),i},bn=yn(-.5,-.5,dn.w,dn.w/(rn.canvas.width/rn.canvas.height)),xn=yn(0,0,dn.w,dn.h),vn=async()=>{for(;dn.countUnstable()>0;){for(let t=0;t<1e3;t++){for(let t=0;t<1;t++)pn.drawTo(t=>{mn.bind(0),fn.uniforms({heights:0}).draw(xn)}),mn.swapWith(pn);await Qr(10)}mn.downloadData(dn.data),console.log("stabilize",dn.countUnstable(),await dn.calcHash())}};(async()=>{dn.fill(10),gn(),await Qr(2e3),await vn(),dn.dualize(),gn(),await Qr(3e3),dn.plus(5),gn(),await Qr(3e3),await vn();const t=dn.clone();console.log("zero hash",await t.calcHash())})(),rn.animate(()=>{mn.bind(0),ln.uniforms({iResolution:[800,600],colorBg:un,"colorFg[0]":cn,aspectRatio:rn.canvas.width/rn.canvas.height,heights:0}).draw(bn)})}]);