(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{143:function(t,r,e){"use strict";e.d(r,"a",(function(){return tt})),e.d(r,"b",(function(){return S})),e.d(r,"c",(function(){return nt})),e.d(r,"d",(function(){return o})),e.d(r,"e",(function(){return h})),e.d(r,"f",(function(){return $})),e.d(r,"g",(function(){return i})),e.d(r,"h",(function(){return s})),e.d(r,"i",(function(){return H})),e.d(r,"j",(function(){return X})),e.d(r,"k",(function(){return V})),e.d(r,"l",(function(){return z})),e.d(r,"m",(function(){return T})),e.d(r,"n",(function(){return q})),e.d(r,"o",(function(){return O})),e.d(r,"p",(function(){return c})),e.d(r,"q",(function(){return a})),e.d(r,"r",(function(){return U})),e.d(r,"s",(function(){return m})),e.d(r,"t",(function(){return B})),e.d(r,"u",(function(){return v})),e.d(r,"v",(function(){return N})),e.d(r,"w",(function(){return y})),e.d(r,"x",(function(){return f})),e.d(r,"y",(function(){return Z})),e.d(r,"z",(function(){return M})),e.d(r,"A",(function(){return R})),e.d(r,"B",(function(){return j}));class n{constructor(){this[Symbol.toStringTag]="Map",this._map=new Map,this._size=0}toString(){return"{"+Array.from(this.entries2()).map(({key:t,value:r})=>t+":"+r).join(", ")+"}"}forEach(t,r){for(const e of this._map.values())for(const{key:n,value:i}of e)t.call(r,i,n,this)}*keys(){for(const t of this._map.values())for(const{key:r}of t)yield r}*values(){for(const t of this._map.values())for(const{value:r}of t)yield r}[Symbol.iterator](){return this.entries()}set(t,r){return this.set2(t,r),this}set2(t,r){const e=t.hashCode(),n=this._map.get(e);if(n){const e=n.findIndex(r=>r.key.equals(t));if(-1!=e)return n[e].value=r,!1;n.push({key:t,value:r})}else this._map.set(e,[{key:t,value:r}]);return this._size++,!0}has(t){const r=t.hashCode(),e=this._map.get(r);return void 0!==e&&e.some(r=>r.key.equals(t))}get(t){const r=t.hashCode(),e=this._map.get(r),n=e&&e.find(r=>r.key.equals(t));return n&&n.value}getLike(t){for(const r of t.hashCodes()){const e=this._map.get(r),n=e&&e.find(r=>r.key.like(t));if(n)return n}}setLike(t,r){return!this.getLike(t)&&this.set(t,r)}delete(t){const r=t.hashCode(),e=this._map.get(r);if(e){const n=e.findIndex(r=>r.key.equals(t));if(-1!=n)return 1==e.length?this._map.delete(r):e.splice(n,1),this._size--,!0}return!1}deleteLike(t){for(const r of t.hashCodes()){const e=this._map.get(r);if(e){const n=e.findIndex(r=>r.key.like(t));if(-1!=n){const t=e[n];return 1==e.length?this._map.delete(r):e.splice(n,1),this._size--,t}}}}*entries2(){for(const t of this._map.values())yield*t}*entries(){for(const t of this._map.values())for(const{key:r,value:e}of t)yield[r,e]}clear(){this._map.clear(),this._size=0}get size(){return this._size}}const i=Math.PI,s=2*i,o=!1,h=1/(1<<26);console.log("NLA_PRECISION",1/(1<<26)),console.log("NLA_DEBUG",o);function a(t,...r){var e,n;if(o)for(let i=0;i<r.length;i++)if(!(r[i]instanceof t))throw Error("assertInst objs["+i+"] is not a "+t.prototype.name+". "+(null===(n=null===(e=r[i])||void 0===e?void 0:e.constructor)||void 0===n?void 0:n.name)+r[i]);return!0}function u(...t){if(o)for(let r=0;r<t.length;r++)if("number"!=typeof t[r])throw Error(`assertNumbers arguments[${r}] is not a number. ${typeof t[r]} == typeof ${t[r]}`);return!0}function l(...t){if(o)for(let r=0;r<t.length;r++)if("number"!=typeof t[r]||t[r]%1!=0)throw Error(`assertNumbers arguments[${r}] is not an int. ${typeof t[r]} == typeof ${t[r]}`);return!0}function c(t,...r){if(o&&!t)throw Error("assert failed: "+r.map(t=>"function"==typeof t?t():t||"").join("\n"));return!0}function m(t,...r){if(o&&!t())throw Error("assertf failed: "+t.toString()+r.map(t=>"function"==typeof t?t():t||"").join("\n"))}function f(t,r,e){return t*(1-e)+r*e}const d=Number.prototype.toString;Number.prototype.toString=function(t){return i==this?"PI":d.call(this,t)};const y=(t,r=1/(1<<26))=>Math.abs(t)<=r,g=(t,r,e=1/(1<<26))=>Math.abs(t-r)<=e,w=(t,r,e=1/(1<<26))=>t-r<-e,p=g;function x(t,r,e){if(void 0===e||0==+e)return t(r);if(e=+e,isNaN(r=+r)||"number"!=typeof e||e%1!=0)return NaN;let n=r.toString().split("e");return n=(r=t(+(n[0]+"e"+(n[1]?+n[1]-e:-e)))).toString().split("e"),+(n[0]+"e"+(n[1]?+n[1]+e:e))}const M=x.bind(void 0,Math.round);x.bind(void 0,Math.floor),x.bind(void 0,Math.ceil);function v(t,r,e){return u(t,r,e),Math.max(r,Math.min(e,t))}function z(t,r,...e){Object.getOwnPropertyNames(r).forEach(n=>{e.includes(n)||(t.hasOwnProperty(n)&&console.warn("target ",t," already has property ",n,t[n]),Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n)))})}let A=t=>t;function b(t){return~~(t*(1<<28))}const S=.017453292519943295;function F(t){switch(typeof t){case"undefined":return"undefined";case"function":return t.toString();case"number":return""+t;case"string":return JSON.stringify(t);case"object":return null==t?"null":t.sce;default:throw Error()}}function k(t,r,e,n){if(y(t))return y(r)?[-n/e]:function(t,r){const e=t*t/4-r;if(e<-1/(1<<26))return[];if(e<=1/(1<<26))return[-t/2];{const r=Math.sqrt(e);return[-t/2-r,-t/2+r]}}(e/r,n/r);const i=t;t=r/i;const s=(3*(r=e/i)-t*t)/3/3,o=s*s*s,h=(2*t*t*t-9*t*r+27*(e=n/i))/27,a=h/2,u=a*a+o;if(u<-1/(1<<26)/8){const r=Math.sqrt(-o),e=-h/(2*r),n=Math.acos(e<-1?-1:e>1?1:e),i=2*Math.cbrt(r);return[i*Math.cos(n/3)-t/3,i*Math.cos((n+2*Math.PI)/3)-t/3,i*Math.cos((n+4*Math.PI)/3)-t/3]}if(u<=1/(1<<26)/8){if(0==a)return[-t/3];const r=a<0?Math.cbrt(-a):-Math.cbrt(a);return[2*r-t/3,-r-t/3]}{const r=Math.sqrt(u);return[Math.cbrt(-a+r)-Math.cbrt(a+r)-t/3]}}function E(t,...r){return t+"("+r.map(F).join(",")+")"}function O(t,r,e){const n=t[r];t[r]=t[e],t[e]=n}function P(t,r,e,n,i){for(l(r,n,i),n+=i,i+=r;i-- >r;)e[--n]=t[i];return e}function I(t,r,e,n,i,s,o){let h=r+o*e,a=i+o*s;for(;h>r;)n[a-=s]=t[h-=e]}function q(t,r,e=1){u(t,e);const n=Math.ceil((r-t)/e),i=Array(n);for(let r=t,s=0;s<n;r+=e,s++)i[s]=r;return i}function T(t,r){u(t),c("function"==typeof r);const e=Array(t);let n=t;for(;n--;)e[n]=r(n,t);return e}function j(t,r){let e=t.length,n=void 0,i=-1/0;for(;e--;){const s=t[e],o=r(s,e,t);o>i&&(i=o,n=s)}return n}function N(t,r){return t[r%t.length]}function Y(t){let r=t.length,e=-1/0;for(;r--;){const n=t[r];e<n&&(e=n)}return e}function R(t){const r=new Set(t);return Array.from(r)}function B(t,r){const e=t[r];return r==t.length-1?t.pop():t[r]=t.pop(),e}function Z(t,r){if(r.sort((t,r)=>t-r),0===r.length)return t;if(1===r.length)return t.splice(r[0],1),t;let e=r[0],n=r[0],i=0;for(let s=r[0];s<t.length;s++)if(s!==n)t[e++]=t[s];else{if(i++,!(i<r.length))return t.splice(e,s+1-e),t;n=r[i]}throw Error("illegal state")}Object.map=function(t,r,e){const n={};for(const i in t)n[i]=r.call(e,t[i],i,t);return n},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.equals=function(t){return this==t},Object.defineProperty(Object.prototype,"sce",{get:function(){return this.toSource()}}),Object.defineProperty(Object.prototype,"str",{get:function(){return this.toString()}});class V{constructor(t,r,e){this.x=t,this.y=r,this.z=e,u(t,r,e)}static random(){return new V(Math.random(),Math.random(),Math.random())}static parallel(t,r){return t.dot(r)-t.length()*r.length()}static randomUnit(){const t=2*Math.random()*Math.PI,r=2*Math.random()-1,e=Math.sqrt(1-Math.pow(r,2));return new V(e*Math.cos(t),e*Math.sin(t),r)}static fromAngles(t,r){throw Error()}static fromFunction(t){return new V(t(0),t(1),t(2))}static min(t,r){return new V(Math.min(t.x,r.x),Math.min(t.y,r.y),Math.min(t.z,r.z))}static max(t,r){return new V(Math.max(t.x,r.x),Math.max(t.y,r.y),Math.max(t.z,r.z))}static lerp(t,r,e){return new V(t.x*(1-e)+r.x*e,t.y*(1-e)+r.y*e,t.z*(1-e)+r.z*e)}static fromArray(t){return new V(t[0],t[1],t[2])}static angleBetween(t,r){return t.angleTo(r)}static zip(t,...r){return c(t instanceof Function),new V(t.apply(void 0,r.map(t=>t.x)),t.apply(void 0,r.map(t=>t.y)),t.apply(void 0,r.map(t=>t.z)))}static normalOnPoints(t,r,e){return U(t,r,e),t.to(r).cross(t.to(e))}static add(...t){U(...t);let r=0,e=0,n=0,i=t.length;for(;i--;)r+=t[i].x,e+=t[i].y,n+=t[i].z;return new V(r,e,n)}static sub(...t){U(...t);let r=t[0].x,e=t[0].y,n=t[0].z,i=t.length;for(;i--;)r-=t[i].x,e-=t[i].y,n-=t[i].z;return new V(r,e,n)}static pack(t,r,e=0,n=0,i=t.length-e){const s=r||new Float32Array(3*i);c(s.length-n>=3*i,"dest.length - destStart >= v3count * 3",s.length,n,3*i);let o=i,h=e,a=n;for(;o--;){const r=t[h++];s[a++]=r.x,s[a++]=r.y,s[a++]=r.z}return s}static unpack(t,r,e=0,n=0,i=(t.length-e)/3){c((r=r||Array(i)).length-n>=i,"dest.length - destStart >= v3count");let s=i,o=e,h=n;for(;s--;)r[h++]=new V(t[o++],t[o++],t[o++]);return r}static packXY(t,r,e=0,n=0,i=t.length-e){const s=r||new Float32Array(2*i);c(s.length-n>=i,"dest.length - destStart >= v3count");let o=i,h=e,a=n;for(;o--;){const r=t[h++];s[a++]=r.x,s[a++]=r.y}return s}static unpackXY(t,r,e=0,n=0,i=Math.min(t.length/2,r&&r.length||1/0)-n){c((r=r||Array(i)).length-n>=i,"dest.length - destStart >= v3count"),c(t.length-e>=2*i,"dest.length - destStart >= v3count");let s=i,o=e,h=n;for(;s--;)r[h++]=new V(t[o++],t[o++],0);return r}static perturbed(t,r){return t.perturbed(r)}static polar(t,r,e=0){return new V(t*Math.cos(r),t*Math.sin(r),e)}static sphere(t,r,e=1){return new V(e*Math.cos(r)*Math.cos(t),e*Math.cos(r)*Math.sin(t),e*Math.sin(r))}static inverseLerp(t,r,e){const n=t.to(r);return t.to(e).dot(n)/n.squared()}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}get u(){return this.x}get v(){return this.y}perturbed(t=1/(1<<26)*.8){return this.map(r=>r+(Math.random()-.5)*t)}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}e(t){return c(t>=0&&t<3),0==t?this.x:1==t?this.y:this.z}negated(){return new V(-this.x,-this.y,-this.z)}abs(){return new V(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))}plus(t){return U(t),new V(this.x+t.x,this.y+t.y,this.z+t.z)}schur(t){return new V(this.x*t.x,this.y*t.y,this.z*t.z)}divv(t){return new V(this.x/t.x,this.y/t.y,this.z/t.z)}minus(t){return U(t),new V(this.x-t.x,this.y-t.y,this.z-t.z)}to(t){return U(t),t.minus(this)}times(t){return u(t),new V(this.x*t,this.y*t,this.z*t)}div(t){return u(t),new V(this.x/t,this.y/t,this.z/t)}dot(t){return a(V,t),this.x*t.x+this.y*t.y+this.z*t.z}lerp(t,r){return U(t),u(r),V.lerp(this,t,r)}squared(){return this.dot(this)}distanceTo(t){return U(t),Math.hypot(this.x-t.x,this.y-t.y,this.z-t.z)}distanceToSquared(t){return U(t),this.minus(t).squared()}toSource(){return V.NAMEMAP.get(this)||this.toString()}nonParallelVector(){const t=this.abs();return t.x<=t.y&&t.x<=t.z?V.X:t.y<=t.x&&t.y<=t.z?V.Y:V.Z}slerp(t,r){U(t),u(r);const e=Math.sin,n=this.angleTo(t);return this.times(e((1-r)*n)/e(n)).plus(t.times(e(r*n)/e(n)))}min(t){return new V(Math.min(this.x,t.x),Math.min(this.y,t.y),Math.min(this.z,t.z))}max(t){return new V(Math.max(this.x,t.x),Math.max(this.y,t.y),Math.max(this.z,t.z))}equals(t){return this==t||this.x==t.x&&this.y==t.y&&this.z==t.z}cross(t){return new V(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}minElement(){return Math.min(this.x,this.y,this.z)}maxElement(){return Math.max(this.x,this.y,this.z)}toArray(t=3){return[this.x,this.y,this.z].slice(0,t)}getPerpendicular(){if(y(this.x)&&y(this.y)){if(y(this.z))throw Error("zero vector");return V.Y}return new V(-this.y,this.x,0)}dim(){return 3}els(){return[this.x,this.y,this.z]}angleXY(){return Math.atan2(this.y,this.x)}lengthXY(){return Math.hypot(this.x,this.y)}squaredXY(){return this.x*this.x+this.y*this.y}xy(){return new V(this.x,this.y,0)}map(t){return new V(t(this.x,"x"),t(this.y,"y"),t(this.z,"z"))}toString(t){return t=t||A,V.NAMEMAP.get(this)||"V("+[this.x,this.y,this.z].map(t).join(", ")+")"}angleTo(t){return c(1==arguments.length),U(t),c(!this.likeO()),c(!t.likeO()),Math.acos(Math.min(1,this.dot(t)/this.length()/t.length()))}angleRelativeNormal(t,r){return c(2==arguments.length),U(t,r),m(()=>r.hasLength(1)),Math.atan2(this.cross(t).dot(r),this.dot(t))}isParallelTo(t){U(t),c(!this.likeO()),c(!t.likeO());const r=this.dot(t);return g(this.squared()*t.squared(),r*r)}isPerpendicularTo(t){return U(t),c(!this.likeO(),"!this.likeO()"),c(!t.likeO(),"!vector.likeO()"),y(this.dot(t))}isReverseDirTo(t){U(t),c(!this.likeO()),c(!t.likeO());const r=this.dot(t);return g(Math.sqrt(this.squared()*t.squared()),r)}length(){return Math.hypot(this.x,this.y,this.z)}likeO(){return this.like(V.O)}like(t){return t===this||t instanceof V&&g(this.x,t.x)&&g(this.y,t.y)&&g(this.z,t.z)}likeOrReversed(t){return g(Math.abs(this.dot(t)),Math.sqrt(this.squared()*t.squared()))}unit(){return c(!this.likeO(),"cannot normalize zero vector"),this.div(this.length())}normalized(){throw Error("documentation stub. use .unit()")}toLength(t){return u(t),this.times(t/this.length())}projectedOn(t){return U(t),t.times(this.dot(t)/t.dot(t))}rejectedFrom(t){return U(t),this.minus(t.times(this.dot(t)/t.dot(t)))}rejectedFrom1(t){return U(t),c(t.hasLength(1)),this.minus(t.times(this.dot(t)))}rejectedLength(t){return U(t),Math.sqrt(this.dot(this)-Math.pow(this.dot(t),2)/t.dot(t))}rejected1Length(t){return U(t),c(t.hasLength(1)),Math.sqrt(this.dot(this)-Math.pow(this.dot(t),2))}hasLength(t){return u(t),g(t,this.length())}absSum(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}minAbsElement(){return Math.min(Math.abs(this.x),Math.abs(this.y),Math.min(this.z))}maxAbsElement(){return Math.max(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))}maxAbsDim(){const t=Math.abs(this.x),r=Math.abs(this.y),e=Math.abs(this.z);return t>=r?t>=e?0:2:r>=e?1:2}minAbsDim(){const t=Math.abs(this.x),r=Math.abs(this.y),e=Math.abs(this.z);return t<r?t<e?0:2:r<e?1:2}withElement(t,r){return c(["x","y","z"].includes(t),""+t),u(r),"x"==t?new V(r,this.y,this.z):"y"==t?new V(this.x,r,this.z):new V(this.x,this.y,r)}hashCode(){function t(t){return~~(t*(1<<28))}return~~(31*(31*t(this.x)+t(this.y))+t(this.z))}hashCodes(){const t=~~(31*(31*~~(this.x*(1<<28)-.5)+~~(this.y*(1<<28)-.5))+~~(this.z*(1<<28)-.5));return[~~t,~~(t+961),~~(t+31),~~(t+31+961),~~(t+1),~~(t+1+961),~~(t+1+31),~~(t+1+31+961)]}compareTo(t){return this.x!=t.x?this.x-t.x:this.y!=t.y?this.y-t.y:this.z-t.z}compareTo2(t,r=1/(1<<26)){return p(this.x,t.x,r)?p(this.y,t.y,r)?p(this.z,t.z,r)?0:this.z-t.z:this.y-t.y:this.x-t.x}toAngles(){return{theta:Math.atan2(this.y,this.x),phi:Math.asin(this.z/this.length())}}}function X(t,r,e){if(3==arguments.length)return new V(parseFloat(t),parseFloat(r),parseFloat(e));if(2==arguments.length)return new V(parseFloat(t),parseFloat(r),0);if(1==arguments.length&&"object"==typeof t){if(t instanceof V)return t;if(t instanceof Array||t instanceof Float32Array||t instanceof Float64Array){if(2==t.length)return new V(parseFloat(t[0]),parseFloat(t[1]),0);if(3==t.length)return new V(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))}else if("x"in t&&"y"in t)return new V(parseFloat(t.x),parseFloat(t.y),"z"in t?parseFloat(t.z):0)}throw Error("invalid arguments"+arguments)}V.O=new V(0,0,0),V.X=new V(1,0,0),V.Y=new V(0,1,0),V.Z=new V(0,0,1),V.XY=new V(1,1,0),V.XYZ=new V(1,1,1),V.INF=new V(1/0,1/0,1/0),V.UNITS=[V.X,V.Y,V.Z],V.NAMEMAP=(new n).set(V.O,"V3.O").set(V.X,"V3.X").set(V.Y,"V3.Y").set(V.Z,"V3.Z").set(V.XYZ,"V3.XYZ").set(V.INF,"V3.INF");class L{constructor(t){this.v=t,a(Float64Array,t)}static fromFunction(t,r){u(t);const e=new Float64Array(t);let n=t;for(;n--;)e[n]=r(n);return new L(e)}static random(t){return L.fromFunction(t,t=>Math.random())}static from(...t){return c(t[0]instanceof Float64Array||t.every(t=>"number"==typeof t),'args[0] instanceof Float64Array || args.every(a => "number" == typeof a)'),new L(t[0]instanceof Float64Array?t[0]:Float64Array.from(t))}static Zero(t){u(t);let r=0;const e=new Float64Array(t);for(;r--;)e[r]=0;return new L(e)}static Unit(t,r){u(t,r);let e=0;const n=new Float64Array(t);for(;e--;)n[e]=+(e==r);return new L(n)}static pack(t,r,e=0,n=0,i=t.length-e){const s=t[0].dim(),o=r||new Float32Array(s*i);c(o.length-n>=i*s,"dest.length - destStart >= v3count * 3",o.length,n,3*i);let h=i,a=e,u=n;for(;h--;){const r=t[a++];for(let t=0;t<s;t++)o[u++]=r.v[t]}return o}static lerp(t,r,e){c(t.dim()==r.dim());const n=new Float64Array(t.v.length);let i=t.v.length;for(;i--;)n[i]=t.v[i]*(1-e)+r.v[i]*e;return new L(n)}static add(...t){const r=t[0].v.length,e=new Float64Array(r);let n=t.length;for(;n--;){let i=r;for(;i--;)e[i]+=t[n].v[i]}return new L(e)}static fromV3AndWeight(t,r){return new L(new Float64Array([t.x*r,t.y*r,t.z*r,r]))}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}get w(){return this.v[3]}[Symbol.iterator](){return this.v[Symbol.iterator]()}dim(){return this.v.length}e(t){if(0>t||t>=this.v.length)throw Error("array index out of bounds");return this.v[t]}plus(t){const r=this.v,e=t.v,n=new Float64Array(r.length);let i=r.length;for(;i--;)n[i]=r[i]+e[i];return new L(n)}minus(t){const r=this.v,e=t.v,n=new Float64Array(r.length);let i=r.length;for(;i--;)n[i]=r[i]-e[i];return new L(n)}times(t){const r=this.v,e=new Float64Array(r.length);let n=r.length;for(;n--;)e[n]=r[n]*t;return new L(e)}div(t){const r=this.v,e=new Float64Array(r.length);let n=r.length;for(;n--;)e[n]=r[n]/t;return new L(e)}dot(t){c(this.dim==t.dim,"passed vector must have the same dim");let r=0;const e=this.v,n=t.v;let i=e.length;for(;i--;)r+=e[i]*n[i];return r}cross(t){a(L,t);const r=new Float64Array(3);return r[0]=this.v[1]*t.v[2]-this.v[2]*t.v[1],r[1]=this.v[2]*t.v[0]-this.v[0]*t.v[2],r[2]=this.v[0]*t.v[1]-this.v[1]*t.v[0],new L(r)}schur(t){a(L,t);const r=this.v,e=t.v,n=new Float64Array(r.length);let i=r.length;for(;i--;)n[i]=r[i]*e[i];return new L(n)}equals(t){if(t===this)return!0;if(t.constructor!==L)return!1;if(this.v.length!=t.v.length)return!1;let r=this.v.length;for(;r--;)if(this.v[r]!==t.v[r])return!1;return!0}like(t){if(t===this)return!0;if(t.constructor!==L)return!1;if(this.v.length!=t.v.length)return!1;let r=this.v.length;for(;r--;)if(!g(this.v[r],t.v[r]))return!1;return!0}map(t){return new L(this.v.map(t))}toString(t){return t=t||(t=>+t.toFixed(6)),"Vector("+this.v.map(t).join(", ")+")"}toSource(){return E("VV",...this.v)}angleTo(t){return a(L,t),c(!this.isZero(),"!this.likeO()"),c(!t.isZero(),"!vector.likeO()"),Math.acos(v(this.dot(t)/this.length()/t.length(),-1,1))}isParallelTo(t){return a(L,t),c(!this.isZero(),"!this.likeO()"),c(!t.isZero(),"!vector.likeO()"),g(Math.sqrt(this.lengthSquared()*t.lengthSquared()),Math.abs(this.dot(t)))}isPerpendicularTo(t){return a(L,t),c(!this.isZero(),"!this.likeO()"),c(!t.isZero(),"!vector.likeO()"),y(this.dot(t))}isZero(){return y(this.length())}length(){return Math.hypot.apply(void 0,this.v)}lengthSquared(){let t=0;const r=this.v;let e=r.length;for(;e--;)t+=r[e]*r[e];return t}unit(){const t=this.length();if(y(t))throw Error("cannot normalize zero vector");return this.div(this.length())}normalized(){throw Error("documentation stub. use .unit()")}asRowMatrix(){return new _(this.v.length,1,this.v)}asColMatrix(){return new _(1,this.v.length,this.v)}projectedOn(t){return a(L,t),t.times(this.dot(t)/t.dot(t))}rejectedOn(t){return a(L,t),this.minus(t.times(this.dot(t)/t.dot(t)))}to(t){return t.minus(this)}hasLength(t){return u(t),g(t,this.length())}V3(){return new V(this.v[0],this.v[1],this.v[2])}p3(){c(4==this.v.length);const t=this.v[3];return new V(this.v[0]/t,this.v[1]/t,this.v[2]/t)}transposed(){return new _(this.v.length,1,this.v)}}function C(...t){return new L(new Float64Array(t))}class _{constructor(t,r,e){this.width=t,this.height=r,this.m=e,l(t,r),m(()=>0<t),m(()=>0<r),c(t*r==e.length,"width * height == m.length",t,r,e.length)}static random(t,r){return _.fromFunction(t,r,()=>Math.random())}static fromFunction(t,r,e){const n=new Float64Array(r*t);let i=r*t;for(;i--;)n[i]=e(Math.floor(i/t),i%t,i);return new _(t,r,n)}static identityN(t){l(t);const r=new Float64Array(t*t);let e=t*(t+1);for(;e;)e-=t+1,r[e]=1;return new _(t,t,r)}static permutation(t,r,e){l(t,r,e),m(()=>0<=r&&r<t),m(()=>0<=e&&e<t);const n=new Float64Array(t*t);let i=t*(t+1);for(;i;)i-=t+1,n[i]=1;return n[r*t+r]=0,n[e*t+e]=0,n[r*t+e]=1,n[e*t+r]=1,new _(t,t,n)}static fromRowArrays(...t){if(0==t.length)throw Error("cannot have 0 vector");const r=t.length,e=t[0].length,n=new Float64Array(r*e);P(t[0],0,n,0,e);for(let i=1;i<r;i++){if(t[i].length!=e)throw Error("all row arrays must be the same length");P(t[i],0,n,i*e,e)}return this.new(e,r,n)}static fromColVectors(t){return _.fromColArrays(...t.map(t=>t.v))}static forWidthHeight(t,r){return new _(t,r,new Float64Array(t*r))}static fromColArrays(...t){if(0==t.length)throw Error("cannot have 0 vector");const r=t.length,e=t[0].length,n=new Float64Array(e*r);I(t[0],0,1,n,0,r,e);for(let i=1;i<r;i++){if(t[i].length!=e)throw Error("all col arrays must be the same length");I(t[i],0,1,n,i,r,e)}return this.new(r,e,n)}static product(...t){const[r,e]=Array.isArray(t[0])?[t[0],t[1]]:[t,void 0];if(0==r.length)throw Error("Can't guess matrix size.");return 1==r.length?_.copy(r[0],e):_.copy(r.reduce((t,r)=>t.times(r)),e)}static jacobi(t,r,e=t(r),n=1e-6){const i=_.forWidthHeight(r.length,e.length);for(let s=0;s<r.length;s++){r[s]+=n;const o=t(r);for(let t=0;t<e.length;t++){const r=(o[t]-e[t])/n;i.setEl(t,s,r)}r[s]-=n}return i}static copy(t,r=t.new()){a(_,t,r),c(t.width==r.width),c(t.height==r.height),c(r!=t,"result != src");const e=t.m,n=r.m;let i=e.length;for(;i--;)n[i]=e[i];return r}static new(t,r,e){return new _(t,r,e)}copy(){return _.copy(this)}e(t,r){return l(t,r),c(0<=t&&t<this.height,"rowIndex out of bounds "+t),c(0<=r&&r<this.width,"colIndex out of bounds "+r),this.m[t*this.width+r]}setEl(t,r,e){l(t,r),c(0<=t&&t<this.height,"rowIndex out of bounds "+t),c(0<=r&&r<this.width,"colIndex out of bounds "+r),u(e),this.m[t*this.width+r]=e}plus(t){c(this.width==t.width),c(this.height==t.height);const r=this.new();let e=this.m.length;for(;e--;)r.m[e]=this.m[e]+t.m[e];return r}minus(t){c(this.width==t.width),c(this.height==t.height);const r=this.new();let e=this.m.length;for(;e--;)r.m[e]=this.m[e]-t.m[e];return r}mulScalar(t){u(t);const r=this.new();let e=this.m.length;for(;e--;)r.m[e]=this.m[e]*t;return r}divScalar(t){u(t);const r=this.new();let e=this.m.length;for(;e--;)r.m[e]=this.m[e]/t;return r}new(){return new _(this.width,this.height,new Float64Array(this.width*this.height))}toString(t,r,e){c("string"==typeof(t=t||(t=>t.toFixed(6)))(0),typeof t(0)),c(!r||r.length==this.width),c(!e||e.length==this.height);const n=Array.from(this.m).map(t),i=T(this.height,t=>n.slice(t*this.width,(t+1)*this.width));r&&i.unshift(Array.from(r)),e&&i.forEach((t,n)=>t.unshift(e[n-(r?1:0)]||""));const s=T(this.width,t=>Y(i.map(r=>r[t].length)));return i.map((t,n)=>t.map((t,i)=>(0==n&&r||0==i&&e?String.prototype.padEnd:String.prototype.padStart).call(t,s[i])).join("  ")).map(t=>t+"\n").join("")}row(t){l(t),c(0<=t&&t<this.height,"rowIndex out of bounds "+t);const r=new Float64Array(this.width);return P(this.m,t*this.width,r,0,this.width),new L(r)}col(t){l(t),c(0<=t&&t<this.width,"colIndex out of bounds "+t);const r=new Float64Array(this.height);return I(this.m,t,this.width,r,0,1,this.height),new L(r)}dim(){return{width:this.width,height:this.height}}dimString(){return this.width+"x"+this.height}equals(t){if(t.constructor!=this.constructor)return!1;if(this.width!=t.width||this.height!=t.height)return!1;let r=this.m.length;for(;r--;)if(this.m[r]!=t.m[r])return!1;return!0}equalsMatrix(t,r=1/(1<<26)){if(a(_,t),this.width!=t.width||this.height!=t.height)return!1;let e=this.m.length;for(;e--;)if(Math.abs(this.m[e]-t.m[e])>=r)return!1;return!0}hashCode(){let t=0,r=this.m.length;for(;r--;)t=31*t+b(this.m[r]);return t}isZero(){let t=this.m.length;for(;t--;)if(!y(this.m[t]))return!1;return!0}isOrthogonal(){return this.isSquare()&&this.transposed().times(this).equalsMatrix(_.identityN(this.width))}luDecomposition(){m(()=>this.isSquare(),this.dim().toSource());const t=this.width,r=this.asRowArrays(Float64Array),e=T(t,r=>new Float64Array(t)),n=_.identityN(t).asRowArrays(Float64Array);let i=0;for(let s=0;s<t;s++){let o=0,h=-1,a=0;for(let e=i;e<t;e++){const t=r[e][s];a+=+(0!=t),Math.abs(t)>o&&(o=Math.abs(t),h=e)}if(0!=o){if(c(-1!==h),O(r,i,h),O(e,i,h),O(n,i,h),e[s][s]=1,1<a)for(let n=i+1;n<t;n++){const o=r[n][s]/r[i][s];e[n][s]=o;for(let e=s;e<t;e++)r[n][e]-=o*r[i][e]}i++}}return{L:_.fromRowArrays(...e),U:_.fromRowArrays(...r),P:_.fromRowArrays(...n)}}gauss(){const t=this.width,r=this.height,e=this.asRowArrays(Float64Array),n=T(r,r=>new Float64Array(t)),i=_.identityN(r).asRowArrays(Float64Array);let s=0;for(let o=0;o<t;o++){let h=0,a=-1,u=0;for(let t=s;t<r;t++){const r=e[t][o];u+=+(0!=r),Math.abs(r)>h&&(h=Math.abs(r),a=t)}if(0!=h){if(c(-1!==a),O(e,s,a),O(n,s,a),O(i,s,a),n[s][o]=1,1<u)for(let i=s+1;i<r;i++){const r=e[i][o]/e[s][o];n[i][o]=r;for(let n=o;n<t;n++)e[i][n]-=r*e[s][n]}s++}}return{L:_.fromRowArrays(...n),U:_.fromRowArrays(...e),P:_.fromRowArrays(...i)}}qrDecompositionGivensRotation(){const t=this.copy();function r(t,r,e,n,i){const s=_.identityN(t);return s.setEl(r,r,n),s.setEl(e,e,n),s.setEl(r,e,i),s.setEl(e,r,-i),s}let e=_.identityN(this.height);for(let n=0;n<this.width;n++)for(let i=n+1;i<this.height;i++){const s=t.e(n,n),o=t.e(i,n);if(0==o)continue;const h=Math.hypot(s,o),a=s/h,u=o/h;for(let r=n;r<this.width;r++){const e=t.e(n,r)*a+t.e(i,r)*u,s=t.e(i,r)*a-t.e(n,r)*u;t.setEl(n,r,e),t.setEl(i,r,s)}e=r(this.height,n,i,a,u).times(e)}return{Q:e.transposed(),R:t}}isPermutation(){return!(!this.isSquare()||this.m.some(t=>!y(t)&&!g(1,t))||this.asRowArrays(Array).some(t=>1!=t.filter(t=>g(1,t)).length)||this.asColArrays(Array).some(t=>1!=t.filter(t=>g(1,t)).length))}isDiagonal(t){let r=this.m.length;for(;r--;)if(0!=r%(this.width+1)&&!y(this.m[r]))return!1;return!0}isIdentity(t){return this.isLowerUnitriangular(t)&&this.isUpperTriangular(t)}isUpperTriangular(t=1/(1<<26)){if(!this.isSquare())return!1;for(let r=1;r<this.height;r++)for(let e=0;e<r;e++)if(!y(this.m[r*this.width+e],t))return!1;return!0}isSymmetric(t=1/(1<<26)){if(!this.isSquare())return!1;for(let r=0;r<this.height-1;r++)for(let e=r+1;e<this.width;e++){const n=this.m[r*this.width+e],i=this.m[e*this.width+r];if(!g(n,i,t))return!1}return!0}solveLinearSystem(t){a(L,t);const{L:r,U:e,P:n}=this.luDecomposition(),i=r.solveForwards(n.timesVector(t));return e.solveBackwards(i)}isLowerUnitriangular(t=1/(1<<26)){if(!this.isSquare())return!1;for(let r=0;r<this.height-1;r++)for(let e=r;e<this.width;e++){const n=this.m[r*this.width+e];if(r==e?!g(1,n,t):!y(n,t))return!1}return!0}isLowerTriangular(t=1/(1<<26)){if(!this.isSquare())return!1;for(let r=0;r<this.height-1;r++)for(let e=r+1;e<this.width;e++)if(!y(this.m[r*this.width+e],t))return!1;return!0}solveBackwards(t){U(t),c(this.height==t.dim(),"this.height == x.dim()"),c(this.isUpperTriangular(),"this.isUpperTriangular()\n"+this.str);const r=new Float64Array(this.width);let e=this.height;for(;e--;){let n=t.v[e];for(let t=e+1;t<this.width;t++)n-=r[t]*this.e(e,t);r[e]=n/this.e(e,e)}return new L(r)}solveBackwardsMatrix(t){const r=Array(t.width);let e=t.width;for(;e--;)r[e]=this.solveBackwards(t.col(e));return _.fromColVectors(r)}solveForwardsMatrix(t){const r=Array(t.width);let e=t.width;for(;e--;)r[e]=this.solveForwards(t.col(e));return _.fromColVectors(r)}solveForwards(t){U(t),c(this.height==t.dim(),"this.height == x.dim()"),m(()=>this.isLowerTriangular(),this.toString());const r=new Float64Array(this.width);for(let e=0;e<this.height;e++){let n=t.v[e];for(let t=0;t<e;t++)n-=r[t]*this.e(e,t);r[e]=n/this.e(e,e)}return new L(r)}rank(){const t=this.gauss().U;let r=this.height;for(;r--&&t.row(r).isZero(););return r+1}rowsIndependent(){return this.height==this.rank()}colsIndependent(){return this.width==this.rank()}asRowArrays(t=Float64Array){return T(this.height,r=>this.rowArray(r,t))}asColArrays(t=Float64Array){return T(this.width,r=>this.colArray(r,t))}rowArray(t,r=Float64Array){const e=new r(this.width);return P(this.m,t*this.width,e,0,this.width)}colArray(t,r=Float64Array){const e=new r(this.width);return I(this.m,t,this.height,e,0,1,this.height),e}subMatrix(t,r,e,n){c(0<t&&0<r&&0<e&&0<n),c(t+r<=this.width&&e+n<=this.height);const i=new Float64Array(r*n);return function(t,r,e,n,i,s,o,h){for(let a=0;a<h;a++)P(t,r+e*a,n,i+s*a,o)}(this.m,t,this.width,i,0,r,n,r),new _(r,n,i)}map(t){return new _(this.width,this.height,this.m.map(t))}dimEquals(t){return a(_,t),this.width==t.width&&this.height==t.height}inversed(){if(this.isSquare()){if(2==this.width)return this.inversed2();if(3==this.width)return this.inversed3();if(4==this.width)return this.inversed4()}const{L:t,U:r,P:e}=this.luDecomposition(),n=t.solveForwardsMatrix(e);return r.solveBackwardsMatrix(n)}inversed2(){m(()=>2==this.width&&2==this.height);const t=_.forWidthHeight(2,2),r=this.m,e=t.m,n=r[0]*r[3]-r[1]*e[2];return e[0]=r[3]/n,e[1]=-r[2]/n,e[2]=-r[1]/n,e[3]=r[0]/n,t}inversed3(t=_.forWidthHeight(3,3)){a(_,t),m(()=>3==this.width&&3==this.height),m(()=>3==t.width&&3==t.height),c(()=>this!=t);const r=this.m,e=t.m;e[0]=r[4]*r[8]-r[5]*r[7],e[1]=-r[1]*r[8]+r[2]*r[7],e[2]=r[1]*r[5]-r[2]*r[4],e[3]=-r[3]*r[8]+r[5]*r[6],e[4]=r[0]*r[8]-r[2]*r[6],e[5]=-r[0]*r[5]+r[2]*r[3],e[6]=r[3]*r[7]-r[4]*r[6],e[7]=-r[0]*r[7]+r[1]*r[6],e[8]=r[0]*r[4]-r[1]*r[3];const n=r[0]*e[0]+r[1]*e[3]+r[2]*e[6];let i=9;for(;i--;)e[i]/=n;return t}inversed4(t=_.forWidthHeight(4,4)){a(_,t),m(()=>4==this.width&&4==this.height),m(()=>4==t.width&&4==t.height),c(()=>this!=t);const r=this.m,e=t.m;e[0]=r[5]*r[10]*r[15]-r[5]*r[14]*r[11]-r[6]*r[9]*r[15]+r[6]*r[13]*r[11]+r[7]*r[9]*r[14]-r[7]*r[13]*r[10],e[1]=-r[1]*r[10]*r[15]+r[1]*r[14]*r[11]+r[2]*r[9]*r[15]-r[2]*r[13]*r[11]-r[3]*r[9]*r[14]+r[3]*r[13]*r[10],e[2]=r[1]*r[6]*r[15]-r[1]*r[14]*r[7]-r[2]*r[5]*r[15]+r[2]*r[13]*r[7]+r[3]*r[5]*r[14]-r[3]*r[13]*r[6],e[3]=-r[1]*r[6]*r[11]+r[1]*r[10]*r[7]+r[2]*r[5]*r[11]-r[2]*r[9]*r[7]-r[3]*r[5]*r[10]+r[3]*r[9]*r[6],e[4]=-r[4]*r[10]*r[15]+r[4]*r[14]*r[11]+r[6]*r[8]*r[15]-r[6]*r[12]*r[11]-r[7]*r[8]*r[14]+r[7]*r[12]*r[10],e[5]=r[0]*r[10]*r[15]-r[0]*r[14]*r[11]-r[2]*r[8]*r[15]+r[2]*r[12]*r[11]+r[3]*r[8]*r[14]-r[3]*r[12]*r[10],e[6]=-r[0]*r[6]*r[15]+r[0]*r[14]*r[7]+r[2]*r[4]*r[15]-r[2]*r[12]*r[7]-r[3]*r[4]*r[14]+r[3]*r[12]*r[6],e[7]=r[0]*r[6]*r[11]-r[0]*r[10]*r[7]-r[2]*r[4]*r[11]+r[2]*r[8]*r[7]+r[3]*r[4]*r[10]-r[3]*r[8]*r[6],e[8]=r[4]*r[9]*r[15]-r[4]*r[13]*r[11]-r[5]*r[8]*r[15]+r[5]*r[12]*r[11]+r[7]*r[8]*r[13]-r[7]*r[12]*r[9],e[9]=-r[0]*r[9]*r[15]+r[0]*r[13]*r[11]+r[1]*r[8]*r[15]-r[1]*r[12]*r[11]-r[3]*r[8]*r[13]+r[3]*r[12]*r[9],e[10]=r[0]*r[5]*r[15]-r[0]*r[13]*r[7]-r[1]*r[4]*r[15]+r[1]*r[12]*r[7]+r[3]*r[4]*r[13]-r[3]*r[12]*r[5],e[11]=-r[0]*r[5]*r[11]+r[0]*r[9]*r[7]+r[1]*r[4]*r[11]-r[1]*r[8]*r[7]-r[3]*r[4]*r[9]+r[3]*r[8]*r[5],e[12]=-r[4]*r[9]*r[14]+r[4]*r[13]*r[10]+r[5]*r[8]*r[14]-r[5]*r[12]*r[10]-r[6]*r[8]*r[13]+r[6]*r[12]*r[9],e[13]=r[0]*r[9]*r[14]-r[0]*r[13]*r[10]-r[1]*r[8]*r[14]+r[1]*r[12]*r[10]+r[2]*r[8]*r[13]-r[2]*r[12]*r[9],e[14]=-r[0]*r[5]*r[14]+r[0]*r[13]*r[6]+r[1]*r[4]*r[14]-r[1]*r[12]*r[6]-r[2]*r[4]*r[13]+r[2]*r[12]*r[5],e[15]=r[0]*r[5]*r[10]-r[0]*r[9]*r[6]-r[1]*r[4]*r[10]+r[1]*r[8]*r[6]+r[2]*r[4]*r[9]-r[2]*r[8]*r[5];const n=r[0]*e[0]+r[1]*e[4]+r[2]*e[8]+r[3]*e[12];let i=16;for(;i--;)e[i]/=n;return t}canMultiply(t){return a(_,t),this.width==t.height}times(t){a(_,t),c(this.canMultiply(t),"Cannot multiply this {this.dimString()} by matrix {matrix.dimString()}");const r=t.width,e=this.height,n=this.width,i=new Float64Array(r*e);let s=e;for(;s--;){let e=r;for(;e--;){let o=0,h=n;for(;h--;)o+=this.m[s*n+h]*t.m[h*r+e];i[s*r+e]=o}}return new _(r,e,i)}timesVector(t){U(t),c(this.width==t.dim());const r=this.height,e=this.width,n=new Float64Array(r);let i=r;for(;i--;){let r=0,s=e;for(;s--;)r+=this.m[i*e+s]*t.v[s];n[i]=r}return new L(n)}transposed(){const t=this.height,r=this.width,e=new Float64Array(t*r);let n=r;for(;n--;){let i=t;for(;i--;)e[n*t+i]=this.m[i*r+n]}return new _(t,r,e)}transpose(){const t=this.height,r=this.width,e=this.m;let n=t;for(;n--;){let i=Math.min(n,r);for(;i--;){const s=e[n*r+i];e[n*r+i]=e[i*t+n],e[i*t+n]=s}}this.width=t,this.height=r}isSquare(){return this.height==this.width}diagonal(){if(!this.isSquare())throw Error("!!");const t=new Float64Array(this.width);let r=this.width*(this.width+1),e=this.width;for(;e--;)r-=this.width+1,t[e]=this.m[r];return new L(t)}maxEl(){return Math.max.apply(void 0,this.m)}minEl(){return Math.min.apply(void 0,this.m)}maxAbsColSum(){let t=0,r=this.width;for(;r--;){let e=0,n=this.height;for(;n--;)e+=Math.abs(this.m[n*this.width+r]);t=Math.max(t,e)}return t}maxAbsRowSum(){let t=0,r=this.height;for(;r--;){let e=0,n=this.width;for(;n--;)e+=Math.abs(this.m[r*this.width+n]);t=Math.max(t,e)}return t}getTriangularDeterminant(){c(this.isUpperTriangular()||this.isLowerTriangular(),"not a triangular matrix");let t=1,r=this.width*(this.width+1);for(;r;)r-=this.width+1,t*=this.m[r];return t}getDeterminant(){return this.luDecomposition().U.getTriangularDeterminant()}hasFullRank(){return Math.min(this.width,this.height)==this.rank()}permutationAsIndexMap(){m(()=>this.isPermutation());const t=Array(this.height);let r=this.height;for(;r--;){const e=r*this.width;let n=e;for(;this.m[n]<.5;)n++;t[r]=n-e}return t}getDependentRowIndexes(t=this.gauss()){const{L:r,U:e,P:n}=t,i=Array(this.height);let s=this.height;for(;s--&&e.row(s).length()<1/(1<<26);)i[s]=!0;let o=this.height;for(;o--;)if(i[o]){let t=Math.min(o,this.width);for(;t--;)0!==r.e(o,t)&&(i[t]=!0)}console.log("m\n",this.toString(t=>""+t)),console.log("L\n",r.toString(t=>""+t)),console.log("U\n",e.toString(t=>""+t)),console.log("P\n",n.toString(t=>""+t));const h=n.permutationAsIndexMap();return i.map((t,r)=>t&&h[r]).filter(t=>null!=t)}lerp(t,r,e=this.new()){a(_,t,e),u(r),c(this.width==t.width&&this.height==t.height);const n=1-r;let i=this.m.length;for(;i--;)e.m[i]=n*this.m[i]+r*t.m[i];return e}}function U(...t){if(o)for(let t=0;t<arguments.length;t++)if(!(arguments[t]instanceof V||arguments[t]instanceof L))throw Error("assertVectors arguments["+t+"] is not a vector. "+typeof arguments[t]+" == typeof "+arguments[t]);return!0}const D={normal1:V.X,w:0},$={normal1:V.Y,w:0},W={normal1:V.Z,w:0};class H{mirror(t){return this.transform(nt.mirror(t))}mirroredX(){return this.mirror(D)}mirrorY(){return this.mirror($)}mirrorZ(){return this.mirror(W)}project(t){return this.transform(nt.project(t))}projectXY(){return this.transform(nt.project(W))}projectYZ(){return this.transform(nt.project(D))}projectZX(){return this.transform(nt.project($))}translate(...t){return this.transform(nt.translate.apply(void 0,t),E(".translate",...t))}scale(...t){return this.transform(nt.scale.apply(void 0,t),E(".scale",...t))}rotateX(t){return this.transform(nt.rotateX(t),`.rotateX(${t})`)}rotateY(t){return this.transform(nt.rotateY(t),`.rotateY(${t})`)}rotateZ(t){return this.transform(nt.rotateZ(t),`.rotateZ(${t})`)}rotate(t,r,e){return this.transform(nt.rotateLine(t,r,e),E(".rotate",t,r,e))}rotateAB(t,r){return this.transform(nt.rotateAB(t,r),E(".rotateAB",t,r))}eulerZXZ(t,r,e){throw Error()}shearX(t,r){return this.transform(new nt([1,t,r,0,0,1,0,0,0,0,1,0,0,0,0,1]))}foo(){return this.transform(nt.FOO)}bar(){return this.transform(nt.BAR)}visit(t,...r){let e=Object.getPrototypeOf(this);for(;!t.hasOwnProperty(e.constructor.name)&&e!==H.prototype;)e=Object.getPrototypeOf(e);if(t.hasOwnProperty(e.constructor.name))return t[e.constructor.name].apply(this,r);throw Error("No implementation for "+this.constructor.name)}}const J=/^(abstract|boolean|break|byte|case|catch|char|class|const|continue|debugger|default|delete|do|double|else|enum|export|extends|false|final|finally|float|for|function|goto|if|implements|import|in|instanceof|int|interface|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|this|throw|throws|transient|true|try|typeof|undefined|var|void|volatile|while|with)$/,G=[];function Q(t,r=0){return void 0===t?"undefined":null===t?"null":t.toSource()}function K(t,r){t.prototype.toSource||Object.defineProperty(t.prototype,"toSource",{value:r,writable:!0,configurable:!0,enumerable:!1})}K(Boolean,Boolean.prototype.toString),K(Function,Function.prototype.toString),K(Number,Number.prototype.toString),K(RegExp,RegExp.prototype.toString),K(Date,(function(){return"new Date("+this.getTime()+")"})),K(String,(function(){return JSON.stringify(this)})),K(Array,(function(){if(G.includes(this))return"CIRCULAR_REFERENCE";G.push(this);let t="[";for(let r=0;r<this.length;r++)t+="\n\t"+Q(this[r]).replace(/\r\n|\n|\r/g,"$&\t"),r!==this.length-1&&(t+=",");return t+=0===this.length?"]":"\n]",G.pop(),t})),K(Object,(function(){if(G.includes(this))return"CIRCULAR_REFERENCE";G.push(this);let t="{";const r=Object.keys(this).sort();for(let n=0;n<r.length;n++){const i=r[n];t+="\n\t"+(/^[a-z_$][0-9a-z_$]*$/gi.test(e=i)&&!J.test(e)?i:JSON.stringify(i))+": "+Q(this[i]).replace(/\r\n|\n|\r/g,"$&\t"),n!==r.length-1&&(t+=",")}var e;return t+=0===r.length?"}":"\n}",G.pop(),t}));class tt extends H{constructor(t=V.INF,r=V.INF.negated()){super(),this.min=t,this.max=r,U(t,r)}static forXYZ(t,r,e){return new tt(V.O,new V(t,r,e))}static forAABBs(t){const r=new tt;for(const e of t)r.addAABB(e);return r}addPoint(t){return U(t),this.min=this.min.min(t),this.max=this.max.max(t),this}addPoints(t){return t.forEach(t=>this.addPoint(t)),this}addAABB(t){return a(tt,t),this.addPoint(t.min),this.addPoint(t.max),this}withoutAABB(t){let r,e;a(tt,t);const n=this.volume(),i=this.size();let s=-1/0;for(let o=0;o<3;o++){const h=["x","y","z"][o],a=t.min[h]-this.min[h]>this.max[h]-t.max[h],u=a?this.min[h]:Math.max(this.min[h],t.max[h]),l=a?Math.min(this.max[h],t.min[h]):this.max[h],c=(l-u)*n/i[h];c>s&&(s=c,r=this.min.withElement(h,u),e=this.max.withElement(h,l))}return new tt(r,e)}getIntersectionAABB(t){return a(tt,t),new tt(this.min.max(t.min),this.max.min(t.max))}touchesAABB(t){return a(tt,t),!(this.min.x>t.max.x||this.max.x<t.min.x||this.min.y>t.max.y||this.max.y<t.min.y||this.min.z>t.max.z||this.max.z<t.min.z)}touchesAABBfuzzy(t,r=1/(1<<26)){return a(tt,t),!(w(t.max.x,this.min.x,r)||w(this.max.x,t.min.x,r)||w(t.max.y,this.min.y,r)||w(this.max.y,t.min.y,r)||w(t.max.z,this.min.z,r)||w(this.max.z,t.min.z,r))}intersectsAABB(t){return a(tt,t),!(this.min.x>=t.max.x||this.max.x<=t.min.x||this.min.y>=t.max.y||this.max.y<=t.min.y||this.min.z>=t.max.z||this.max.z<=t.min.z)}intersectsAABB2d(t){return a(tt,t),!(this.min.x>=t.max.x||this.max.x<=t.min.x||this.min.y>=t.max.y||this.max.y<=t.min.y)}containsPoint(t){return U(t),this.min.x<=t.x&&this.min.y<=t.y&&this.min.z<=t.z&&this.max.x>=t.x&&this.max.y>=t.y&&this.max.z>=t.z}containsSphere(t,r){return U(t),u(r),this.distanceToPoint(t)>r}intersectsSphere(t,r){return U(t),u(r),this.distanceToPoint(t)<=r}distanceToPoint(t){U(t);const r=t.x,e=t.y,n=t.z,i=this.min,s=this.max;return this.containsPoint(t)?Math.max(i.x-r,r-s.x,i.y-e,e-s.y,i.z-n,n-s.z):t.distanceTo(new V(v(r,i.x,s.x),v(e,i.y,s.y),v(n,i.z,s.z)))}containsAABB(t){return a(tt,t),this.containsPoint(t.min)&&this.containsPoint(t.max)}likeAABB(t){return a(tt,t),this.min.like(t.min)&&this.max.like(t.max)}intersectsLine(t){U(t.anchor,t.dir1);const r=t.dir1.map(t=>t||5e-324),e=this.min.minus(t.anchor).divv(r),n=this.max.minus(t.anchor).divv(r),i=e.min(n).maxElement(),s=e.max(n).minElement();return i<=s&&!(s<t.tMin||t.tMax<i)}hasVolume(){return this.min.x<=this.max.x&&this.min.y<=this.max.y&&this.min.z<=this.max.z}volume(){if(!this.hasVolume())return-1;const t=this.max.minus(this.min);return t.x*t.y*t.z}size(){return this.max.minus(this.min)}getCenter(){return this.min.plus(this.max).div(2)}transform(t){a(nt,t),c(t.isAxisAligned());const r=new tt;return r.addPoint(t.transformPoint(this.min)),r.addPoint(t.transformPoint(this.max)),r}ofTransformed(t){a(nt,t);const r=new tt;return r.addPoints(t.transformedPoints(this.corners())),r}corners(){const t=this.min,r=this.max;return[t,new V(t.x,t.y,r.z),new V(t.x,r.y,t.z),new V(t.x,r.y,r.z),new V(r.x,t.y,t.z),new V(r.x,t.y,r.z),new V(r.x,r.y,t.z),r]}toString(){return E("new AABB",this.min,this.max)}toSource(){return this.toString()}getM4(){return nt.translate(this.min).times(nt.scale(this.size()))}}const{PI:rt,abs:et}=Math;class nt extends _{constructor(...t){let r;if(0==arguments.length)r=new Float64Array(16);else{const t=Array.prototype.concat.apply([],arguments);c(16==t.length,"flattened.length == 16 "+t.length),r=new Float64Array(t)}super(4,4,r)}static inverse(t,r=new nt){return t.inversed4(r)}static permutation4(t,r,e=new nt){l(t,r),m(()=>0<=t&&t<4),m(()=>0<=r&&r<4);const n=e.m;return nt.identity(e),n[4*t+t]=0,n[4*r+r]=0,n[4*t+r]=1,n[4*r+t]=1,e}static transpose(t,r=new nt){a(nt,t),a(nt,r),c(t!=r,"matrix != result");const e=t.m,n=r.m;return n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15],r}static multiply(t,r,e=new nt){a(nt,t,r),a(nt,e),c(t!=e,"left != result"),c(r!=e,"right != result");const n=t.m,i=r.m,s=e.m;return s[0]=n[0]*i[0]+n[1]*i[4]+(n[2]*i[8]+n[3]*i[12]),s[1]=n[0]*i[1]+n[1]*i[5]+(n[2]*i[9]+n[3]*i[13]),s[2]=n[0]*i[2]+n[1]*i[6]+(n[2]*i[10]+n[3]*i[14]),s[3]=n[0]*i[3]+n[1]*i[7]+(n[2]*i[11]+n[3]*i[15]),s[4]=n[4]*i[0]+n[5]*i[4]+(n[6]*i[8]+n[7]*i[12]),s[5]=n[4]*i[1]+n[5]*i[5]+(n[6]*i[9]+n[7]*i[13]),s[6]=n[4]*i[2]+n[5]*i[6]+(n[6]*i[10]+n[7]*i[14]),s[7]=n[4]*i[3]+n[5]*i[7]+(n[6]*i[11]+n[7]*i[15]),s[8]=n[8]*i[0]+n[9]*i[4]+(n[10]*i[8]+n[11]*i[12]),s[9]=n[8]*i[1]+n[9]*i[5]+(n[10]*i[9]+n[11]*i[13]),s[10]=n[8]*i[2]+n[9]*i[6]+(n[10]*i[10]+n[11]*i[14]),s[11]=n[8]*i[3]+n[9]*i[7]+(n[10]*i[11]+n[11]*i[15]),s[12]=n[12]*i[0]+n[13]*i[4]+(n[14]*i[8]+n[15]*i[12]),s[13]=n[12]*i[1]+n[13]*i[5]+(n[14]*i[9]+n[15]*i[13]),s[14]=n[12]*i[2]+n[13]*i[6]+(n[14]*i[10]+n[15]*i[14]),s[15]=n[12]*i[3]+n[13]*i[7]+(n[14]*i[11]+n[15]*i[15]),e}static product(...t){const[r,e]=Array.isArray(t[0])?[t[0],t[1]]:[t,new nt];if(0==r.length)return nt.identity(e);if(1==r.length)return nt.copy(r[0],e);if(2==r.length)return nt.multiply(r[0],r[1],e);let n=nt.temp0,i=nt.temp1;nt.multiply(r[0],r[1],n);for(let t=2;t<r.length-1;t++)nt.multiply(n,r[t],i),[n,i]=[i,n];return nt.multiply(n,r.last,e)}static forSys(t,r,e=t.cross(r),n=V.O){return U(t,r,e,n),new nt(t.x,r.x,e.x,n.x,t.y,r.y,e.y,n.y,t.z,r.z,e.z,n.z,0,0,0,1)}static forRows(t,r,e,n=V.O){return U(t,r,e,n),new nt(t.x,t.y,t.z,0,r.x,r.y,r.z,0,e.x,e.y,e.z,0,n.x,n.y,n.z,1)}static identity(t=new nt){a(nt,t);const r=t.m;return r[0]=r[5]=r[10]=r[15]=1,r[1]=r[2]=r[3]=r[4]=r[6]=r[7]=r[8]=r[9]=r[11]=r[12]=r[13]=r[14]=0,t}static fromFunction4(t,r=new nt){c("function"==typeof t),a(nt,r);const e=r.m;let n=16;for(;n--;)e[n]=t(Math.floor(n/4),n%4,n);return r}static perspective(t,r,e,n,i=new nt){return nt.perspectiveRad(t*S,r,e,n,i)}static perspectiveRad(t,r,e,n,i=new nt){a(nt,i),u(t,r,e,n);const s=Math.tan(t/2)*e,o=s*r;return nt.frustum(-o,o,-s,s,e,n,i)}static perspectivePlane(t,r=new nt){a(nt,r);const e=r.m;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t.normal1.x,e[13]=t.normal1.y,e[14]=t.normal1.z,e[15]=-t.w,r}static frustum(t,r,e,n,i,s,o=new nt){u(t,r,e,n,i,s),c(0<i,"0 < near"),c(i<s,"near < far"),a(nt,o);const h=o.m;return h[0]=2*i/(r-t),h[1]=0,h[2]=(r+t)/(r-t),h[3]=0,h[4]=0,h[5]=2*i/(n-e),h[6]=(n+e)/(n-e),h[7]=0,h[8]=0,h[9]=0,h[10]=-(s+i)/(s-i),h[11]=-2*s*i/(s-i),h[12]=0,h[13]=0,h[14]=-1,h[15]=0,o}static projectPlanePoint(t,r,e=new nt){U(t,r.normal1),a(nt,e);const n=e.m,i=r.normal1,s=r.w,o=i.dot(t);return n[0]=t.x*i.x+s-o,n[1]=t.x*i.y,n[2]=t.x*i.z,n[3]=-s*t.x,n[4]=t.y*i.x,n[5]=t.y*i.y+s-o,n[6]=t.y*i.z,n[7]=-s*t.y,n[8]=t.z*i.x,n[9]=t.z*i.y,n[10]=t.z*i.z+s-o,n[11]=-s*t.z,n[12]=i.x,n[13]=i.y,n[14]=i.z,n[15]=-o,e}static ortho(t,r,e,n,i,s,o=new nt){u(t,r,e,n,i,s),a(nt,o);const h=o.m;return h[0]=2/(r-t),h[1]=0,h[2]=0,h[3]=-(r+t)/(r-t),h[4]=0,h[5]=2/(n-e),h[6]=0,h[7]=-(n+e)/(n-e),h[8]=0,h[9]=0,h[10]=-2/(s-i),h[11]=-(s+i)/(s-i),h[12]=0,h[13]=0,h[14]=0,h[15]=1,o}static scale(...t){let r,e,n,i;t[0]instanceof V?(c(t.length<=2),({x:r,y:e,z:n}=t[0]),i=t[1]):"number"!=typeof t[1]?(r=e=n=t[0],i=t[1]):(c(t.length<=4),r=t[0],e=t[1],n=null!=t[2]?t[2]:1,i=t[3]),null==i&&(i=new nt),a(nt,i),u(r,e,n);const s=i.m;return s[0]=r,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,i}static translate(...t){let r,e,n,i;t[0]instanceof V?(c(t.length<=2),({x:r,y:e,z:n}=t[0]),i=t[1]):(c(t.length<=4),r=t[0],e=null!=t[1]?t[1]:0,n=null!=t[2]?t[2]:0,i=t[3]),null==i&&(i=new nt),a(nt,i),u(r,e,n);const s=i.m;return s[0]=1,s[1]=0,s[2]=0,s[3]=r,s[4]=0,s[5]=1,s[6]=0,s[7]=e,s[8]=0,s[9]=0,s[10]=1,s[11]=n,s[12]=0,s[13]=0,s[14]=0,s[15]=1,i}static rotate(t,r,e){null==e&&(e=new nt),a(nt,e);let{x:n,y:i,z:s}=r;c(!new V(n,i,s).likeO(),"!V(x, y, z).likeO()");const o=e.m,h=Math.sqrt(n*n+i*i+s*s);n/=h,i/=h,s/=h;const u=Math.cos(t),l=Math.sin(t),m=1-u;return o[0]=n*n*m+u,o[1]=n*i*m-s*l,o[2]=n*s*m+i*l,o[3]=0,o[4]=i*n*m+s*l,o[5]=i*i*m+u,o[6]=i*s*m-n*l,o[7]=0,o[8]=s*n*m-i*l,o[9]=s*i*m+n*l,o[10]=s*s*m+u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,e}static lookAt(t,r,e,n=new nt){U(t,r,e),a(nt,n);const i=n.m,s=t.minus(r).unit(),o=e.cross(s).unit(),h=s.cross(o).unit();return i[0]=o.x,i[1]=o.y,i[2]=o.z,i[3]=-o.dot(t),i[4]=h.x,i[5]=h.y,i[6]=h.z,i[7]=-h.dot(t),i[8]=s.x,i[9]=s.y,i[10]=s.z,i[11]=-s.dot(t),i[12]=0,i[13]=0,i[14]=0,i[15]=1,n}static rotateX(t){u(t);const r=Math.sin(t),e=Math.cos(t);return new nt([1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1])}static rotateY(t){const r=Math.sin(t),e=Math.cos(t);return new nt([e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1])}static rotateZ(t){const r=Math.sin(t),e=Math.cos(t);return new nt([e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1])}static rotateAB(t,r,e=new nt){U(t,r),a(nt,e);const n=t.cross(r),i=n.length();if(y(i))return nt.identity(e);const s=Math.atan2(i,t.dot(r));return nt.rotateLine(V.O,n,s,e)}static rotateLine(t,r,e,n=new nt){U(t,r),u(e),a(nt,n),r=r.unit();const i=t.x,s=t.y,o=t.z,h=r.x,l=r.y,c=r.z,m=n.m,f=Math.cos(e),d=Math.sin(e);return m[0]=h*h+(l*l+c*c)*f,m[1]=h*l*(1-f)-c*d,m[2]=h*c*(1-f)+l*d,m[3]=(i*(l*l+c*c)-h*(s*l+o*c))*(1-f)+(s*c-o*l)*d,m[4]=h*l*(1-f)+c*d,m[5]=l*l+(h*h+c*c)*f,m[6]=l*c*(1-f)-h*d,m[7]=(s*(h*h+c*c)-l*(i*h+o*c))*(1-f)+(o*h-i*c)*d,m[8]=h*c*(1-f)-l*d,m[9]=l*c*(1-f)+h*d,m[10]=c*c+(h*h+l*l)*f,m[11]=(o*(h*h+l*l)-c*(i*h+s*l))*(1-f)+(i*l-s*h)*d,m[12]=0,m[13]=0,m[14]=0,m[15]=1,n}static mirror(t,r=new nt){U(t.normal1),a(nt,r);const[e,n,i]=t.normal1,s=t.w,o=r.m;return o[0]=1-2*e*e,o[1]=-2*n*e,o[2]=-2*i*e,o[3]=2*e*s,o[4]=-2*e*n,o[5]=1-2*n*n,o[6]=-2*i*n,o[7]=2*n*s,o[8]=-2*e*i,o[9]=-2*n*i,o[10]=1-2*i*i,o[11]=2*i*s,o[12]=0,o[13]=0,o[14]=0,o[15]=1,r}static project(t,r=t.normal1,e=new nt){U(r,t.normal1),a(nt,e);const n=t.w,i=e.m,s=t.normal1.dot(r),{x:o,y:h,z:u}=t.normal1,{x:l,y:c,z:m}=r.div(s);return i[0]=1-o*l,i[1]=-h*l,i[2]=-u*l,i[3]=l*n,i[4]=-o*c,i[5]=1-h*c,i[6]=-u*c,i[7]=c*n,i[8]=-o*m,i[9]=-h*m,i[10]=1-u*m,i[11]=m*n,i[12]=0,i[13]=0,i[14]=0,i[15]=1,e}static lineProjection(t,r=new nt){U(t.anchor,t.dir1),a(nt,r);const e=t.anchor.x,n=t.anchor.y,i=t.anchor.z,s=t.dir1.x,o=t.dir1.y,h=t.dir1.z,u=r.m;return u[0]=s*s,u[1]=s*o,u[2]=s*h,u[3]=e,u[4]=o*s,u[5]=o*o,u[6]=o*h,u[7]=n,u[8]=h*s,u[9]=h*o,u[10]=h*h,u[11]=i,u[12]=0,u[13]=0,u[14]=0,u[15]=1,r}static pointInversion(t,r=new nt){U(t),a(nt,r);const e=r.m;return e[0]=-1,e[1]=0,e[2]=0,e[3]=2*t.x,e[4]=0,e[5]=-1,e[6]=0,e[7]=2*t.y,e[8]=0,e[9]=0,e[10]=-1,e[11]=2*t.z,e[12]=0,e[13]=0,e[14]=0,e[15]=1,r}static new(t,r,e){return c(4==t&&4==r),new nt(...e)}get X(){return this.transformVector(V.X)}get Y(){return this.transformVector(V.Y)}get Z(){return this.transformVector(V.Z)}get O(){return this.getTranslation()}isMirror(t=1/(1<<26)){const r=this.m,e=Math.sqrt((1-r[0])/2),n=Math.sqrt((1-r[5])/2),i=Math.sqrt((1-r[10])/2);return g(r[1],-2*n*e,t)&&g(r[2],-2*i*e,t)&&g(r[4],-2*e*n,t)&&g(r[6],-2*i*n,t)&&g(r[8],-2*e*i,t)&&g(r[9],-2*n*i,t)&&g(r[12],0,t)&&g(r[13],0,t)&&g(r[14],0,t)&&g(r[15],1,t)&&g(r[3]*n,r[7]*e,t)&&g(r[7]*i,r[11]*n,t)&&g(r[11]*e,r[3]*i,t)}inversed(t){return nt.inverse(this,t)}trace(){return this.m[0]+this.m[5]+this.m[10]+this.m[15]}as3x3(t){const r=(t=nt.copy(this,t)).m;return r[3]=r[7]=r[11]=r[12]=r[13]=r[14]=0,r[15]=1,t}transform(t){return t.times(this)}realEigenValues3(){const t=this.m;c(0==t[12]&&0==t[13]&&0==t[14]);const[r,e,n,,i,s,o,,h,a,u]=t,l=r+s+u,m=-r*s-r*u+e*i+n*h-s*u+o*a,f=r*(s*u-o*a)-e*(i*u-o*h)+n*(i*a-s*h);return console.log(-1,l,m,f),k(-1,l,m,f)}realEigenVectors3(){const t=this.realEigenValues3(),r=this.times(nt.IDENTITY3);console.log(this.toString()),console.log(r.toString());let e=t.map(t=>nt.IDENTITY3.scale(-t).plus(r));if(console.log(e.map(t=>t.determinant3())),console.log(e.map(t=>""+t.toString(t=>""+t)).join("\n\n")),console.log(e.map(t=>""+t.gauss().U.toString(t=>""+t)).join("\n\n")),console.log("mats.map(m=>m.rank())",e.map(t=>t.rank())),1==t.length)return console.log(e[0].toString()),m(()=>0==e[0].rank()),T(3,t=>new V(this.m[t],this.m[4+t],this.m[8+t]));if(2==t.length){1==e[0].rank()&&(e=[e[1],e[0]]),m(()=>2==e[0].rank()),m(()=>1==e[1].rank());const t=e[0].gauss().U,r=t.row(0).cross(t.row(1)).V3().unit(),n=e[1].gauss().U.row(0).V3(),i=n.getPerpendicular().unit(),s=r.cross(i).rejectedFrom(n);return[r,i,s]}if(3==t.length)return e.forEach((t,r)=>c(2==t.rank(),r+": "+t.rank())),e.map(t=>{const r=t.gauss().U;return r.row(0).cross(r.row(1)).V3().unit()});throw Error("there cannot be more than 3 eigen values")}svd3(){function t(t,r,e,n){const i=nt.identity();return i.setEl(t,t,e),i.setEl(r,r,e),i.setEl(t,r,n),i.setEl(r,t,-n),i}const r=this.as3x3();let e=r.transposed().times(r),n=nt.identity();console.log(e.str);for(let i=0;i<16;i++){console.log("blahg\n",n.times(e).times(n.transposed()).str),c(n.times(e).times(n.transposed()).likeM4(r.transposed().times(r)),n.times(e).times(n.transposed()).str,r.transposed().times(r).str);let i=0,s=1,o=10;for(;o--;){const t=Math.abs(e.m[o]);o%4!=Math.floor(o/4)&&t>i&&(i=t,s=o)}const h=Math.floor(s/4),a=s%4,u=e.m[5*h],l=e.m[5*a],m=e.m[s],f=u===l?rt/4:Math.atan(2*m/(u-l))/2;console.log(s,h,a,"phi",f);const d=t(h,a,Math.cos(f),-Math.sin(f));c(d.transposed().times(d).likeIdentity()),console.log(d.str),n=n.times(d),e=nt.product(d.transposed(),e,d),console.log(e.str)}const i=e.map((t,r)=>r%5==0?Math.sqrt(t):0);return{U:nt.product(r,n,i.map((t,r)=>r%5==0?1/t:0)),SIGMA:i,VSTAR:n.transposed()}}map(t){return nt.fromFunction4((r,e,n)=>t(this.m[n],n,this.m))}likeM4(t){return a(nt,t),this.m.every((r,e)=>g(r,t.m[e]))}transposed(t){return nt.transpose(this,t)}times(t){return nt.multiply(this,t)}vanishingPoint(t){U(t);const r=this.m,e=t.x,n=t.y,i=t.z,s=e*r[12]+n*r[13]+i*r[14];if(y(s))return;const o=e*r[0]+n*r[1]+i*r[2],h=e*r[4]+n*r[5]+i*r[6],a=e*r[8]+n*r[9]+i*r[10];return new V(o/s,h/s,a/s)}transformPoint(t){U(t);const r=this.m,e=t.x,n=t.y,i=t.z,s=e*r[0]+n*r[1]+i*r[2]+r[3],o=e*r[4]+n*r[5]+i*r[6]+r[7],h=e*r[8]+n*r[9]+i*r[10]+r[11],a=e*r[12]+n*r[13]+i*r[14]+r[15];return new V(s/a,o/a,h/a)}transformVector(t,r=!0){U(t);const e=this.m,n=t.x*e[12]+t.y*e[13]+t.z*e[14];return r&&c(y(n),()=>"w === 0 needs to be true for this to make sense (w ="+n+this.str),new V(e[0]*t.x+e[1]*t.y+e[2]*t.z,e[4]*t.x+e[5]*t.y+e[6]*t.z,e[8]*t.x+e[9]*t.y+e[10]*t.z)}transformVector2(t,r){U(t,r);const e=this.timesVector(C(r.x,r.y,r.z,1)),n=this.timesVector(C(t.x,t.y,t.z,0));return n.times(e.w).minus(e.times(n.w)).div(Math.pow(e.w,2)).V3()}transformedPoints(t){return t.map(t=>this.transformPoint(t))}transformedVectors(t){return t.map(t=>this.transformVector(t))}new(){return new nt}isRegular(){return!y(this.determinant())}isAxisAligned(){const t=this.m;return 1>=+!y(t[0])+ +!y(t[1])+ +!y(t[2])&&1>=+!y(t[4])+ +!y(t[5])+ +!y(t[6])&&1>=+!y(t[8])+ +!y(t[9])+ +!y(t[10])}isOrthogonal(){return nt.transpose(this,nt.temp0),nt.multiply(this,nt.temp0,nt.temp1),nt.IDENTITY.likeM4(nt.temp1)}isSymmetric(){return nt.transpose(this,nt.temp0),this.likeM4(nt.temp0)}isSkewSymmetric(t){return y(this.m[0],t)&&y(this.m[5],t)&&y(this.m[10],t)&&y(this.m[15],t)&&g(this.m[1],this.m[4],t)&&g(this.m[2],this.m[8],t)&&g(this.m[3],this.m[12],t)&&g(this.m[6],this.m[9],t)&&g(this.m[7],this.m[13],t)&&g(this.m[11],this.m[14],t)}isNormal(){return nt.transpose(this,nt.temp0),nt.multiply(this,nt.temp0,nt.temp1),nt.multiply(nt.temp0,this,nt.temp2),nt.temp1.likeM4(nt.temp2)}determinant(){const t=this.m,r=t[0],e=t[1],n=t[2],i=t[3],s=t[4],o=t[5],h=t[6],a=t[7],u=t[8],l=t[9],c=t[10],m=t[11],f=t[12],d=t[13],y=t[14],g=t[15],w=c*g-m*y,p=l*g-m*d,x=l*y-c*d,M=u*g-m*f,v=u*y-c*f,z=u*d-l*f;return r*(o*w-h*p+a*x)-e*(s*w-h*M+a*v)+n*(s*p-o*M+a*z)-i*(s*x-o*v+h*z)}determinant3(){const[t,r,e,,n,i,s,,o,h,a]=this.m;return t*(i*a-s*h)-r*(n*a-s*o)+e*(n*h-i*o)}isMirroring(){return this.determinant()<0}getTranslation(){const t=this.m,r=t[15];return new V(t[3]/r,t[7]/r,t[11]/r)}normalized(){const t=et(this.determinant());return 1==t?this:this.divScalar(Math.pow(t,.25))}normalized2(){const t=this.m[15];return 1==t?this:this.divScalar(Math.pow(t,.25))}like3x3(){const t=this.m;return g(1,t[15])&&y(t[12])&&y(t[13])&&y(t[14])&&y(t[3])&&y(t[7])&&y(t[11])}isNoProj(){const t=this.m;return 0==t[12]&&0==t[13]&&0==t[14]&&1==t[15]}likeIdentity(){return this.m.every((t,r)=>(r/4|0)==r%4?g(1,t):y(t))}isIdentity(){return this.m.every((t,r)=>(r/4|0)==r%4?1==t:0==t)}toString(t=(t=>t.toFixed(6).replace(/([0.])(?=0*$)/g," "))){c("string"==typeof t(0),typeof t(0));const r=Array.prototype.slice.call(this.m).map(t),e=[0,1,2,3].map(t=>Y(function(t,r,e,n,i=1){u(r,n),r<0&&(r=t.length+r),e<=0&&(e=t.length+e);const s=Math.ceil((e-r)/n),o=Array(s);let h=0;for(let s=r;s<e;s+=n)for(let r=s;r<Math.min(s+i,e);r++)o[h++]=t[r];return c(s==h),o}(r,t,0,4).map(t=>t.length)));return[0,1,2,3].map(t=>r.slice(4*t,4*t+4).map((t,r)=>" ".repeat(e[r]-t.length)+t).join(" ")).join("\n")}isTranslation(){return[1,0,0,2,0,1,0,2,0,0,1,2,0,0,0,1].every((t,r)=>2==t||t==this.m[r])}isScaling(){return[2,0,0,0,0,2,0,0,0,0,2,0,0,0,0,1].every((t,r)=>2==t||t==this.m[r])}isZRotation(){return[2,2,0,0,2,2,0,0,0,0,1,0,0,0,0,1].every((t,r)=>2==t||t==this.m[r])&&g(1,Math.pow(this.m[0],2)+Math.pow(this.m[1],2))&&this.m[0]==this.m[5]&&this.m[1]==-this.m[4]}toSource(){const t=nt.NAMEMAP.get(this);if(t)return t;if(this.isTranslation())return E("M4.translate",this.O);if(this.isScaling())return E("M4.scale",this.m[0],this.m[5],this.m[10]);if(this.isNoProj())return this.O.equals(V.O)?E("M4.forSys",this.X,this.Y,this.Z):E("M4.forSys",this.X,this.Y,this.Z,this.O);if(this.isMirror(0)){const t=this.m,r=Math.sqrt((1-t[0])/2),e=Math.sqrt((1-t[5])/2),n=Math.sqrt((1-t[10])/2),i=t[3]/2/r;return E("M4.mirror",{normal1:new V(r,e,n),w:i})}{const t=this.m;return"new M4(\n\t"+t[0]+",\t"+t[1]+",\t"+t[2]+",\t"+t[3]+",\n\t"+t[4]+",\t"+t[5]+",\t"+t[6]+",\t"+t[7]+",\n\t"+t[8]+",\t"+t[9]+",\t"+t[10]+",\t"+t[11]+",\n\t"+t[12]+",\t"+t[13]+",\t"+t[14]+",\t"+t[15]+")"}}xyAreaFactor(){return this.transformVector(V.X).cross(this.transformVector(V.Y)).length()}}nt.FOO=new nt(0,1,1,2,.3,.4,.8,13,2.1,3.4,5.5,8.9,0,0,0,1),nt.BAR=nt.FOO.inversed(),nt.IDENTITY=nt.identity(),nt.O=new nt(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),nt.YZX=nt.forSys(V.Y,V.Z,V.X),nt.ZXY=nt.forSys(V.Z,V.X,V.Y),nt.IDENTITY3=new nt(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0),nt.temp0=new nt,nt.temp1=new nt,nt.temp2=new nt,nt.NAMEMAP=(new n).set(nt.IDENTITY3,"M4.IDENTITY3").set(nt.FOO,"M4.FOO").set(nt.O,"M4.O").set(nt.BAR,"M4.BAR").set(nt.IDENTITY,"M4.IDENTITY").set(nt.ZXY,"M4.ZXY").set(nt.YZX,"M4.YZX"),nt.prototype.height=4,nt.prototype.width=4,z(nt.prototype,H.prototype,"constructor")}}]);