{"version":3,"file":"639.js","mappings":"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U,QAAU,QAAU,QAAU,QAAU,QAAU,SAAU,UAC1FC,SAAU,CACT,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,SAEDC,OAAQ,CACP,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,OAEDC,KAAM,CACL,QACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,QACA,QAEDC,KAAM,CACL,QACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,SAEDC,KAAM,CACL,QACA,QACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,OAEDC,OAAQ,CACP,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,SAEDC,KAAM,CACL,QACA,QACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,MACA,OAEDC,KAAM,CACL,QACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,SAEDC,KAAM,CACL,QACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,QACA,QACA,SAEDC,KAAM,CAAC,QAAU,SAAU,QAAU,SAAU,SAAU,SAAU,SAAU,UAC7EC,OAAQ,CAAC,QAAU,SAAU,SAAU,SAAU,QAAU,SAAU,SAAU,SAC/EC,KAAM,CAAC,SAAU,QAAU,QAAU,QAAU,SAAU,SAAU,SAAU,SAAU,UACvFC,KAAM,CACL,QACA,SACA,SACA,SACA,QACA,SACA,SACA,SACA,SACA,SACA,SACA,UAEDC,MAAO,CAAC,QAAU,SAAU,QAAU,SAAU,QAAU,SAAU,SAAU,SAC9EC,OAAQ,CACP,SACA,QACA,SACA,QACA,SACA,SACA,SACA,SACA,SACA,QACA,SACA,UAEDC,QAAS,CAAC,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,UAChFC,QAAS,CAAC,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,WAS9ExG,EAAS,CACrByG,UAAW,SACXC,aAAc,SACdC,KAAM,MACNC,WAAY,QACZC,MAAO,SACPC,MAAO,SACPC,OAAQ,SACRxF,MAAO,EACPyF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,aACN,KAAM,eACN,KAAM,aACN,KAAM,YACN,KAAM,UACN,KAAM,SACN,KAAM,OACN,KAAM,gBACN,KAAM,QACN,KAAM,iBACN,KAAM,MACN,KAAM,eACN,KAAM,QACN,KAAM,SACN,KAAM,UACN,KAAM,gBACN,KAAM,kBACN,KAAM,QACN,KAAM,MACN,KAAM,OACN,KAAM,YACN,KAAM,kBACN,KAAM,OACN,KAAM,UACN,KAAM,OACN,KAAM,OACN,KAAM,SACN,KAAM,WACN,KAAM,UACN,KAAM,UACN,KAAM,SACN,KAAM,yBACN,KAAM,wBACN,KAAM,wBACN,KAAM,uBACN,MAAO,qBACP,MAAO,qBACP,MAAO,iBACP,MAAO,iBACP,MAAO,SACP,MAAO,uBACP,MAAO,mBACP,MAAO,iBACP,MAAO,2BACP,MAAO,iBACP,MAAO,2BACP,MAAO,cACP,MAAO,WACP,MAAO,qBACP,MAAO,gBACP,MAAO,wBACP,MAAO,yBACP,MAAO,yBACP,MAAO,sBACP,MAAO,wBACP,MAAO,QACP,MAAO,UACP,MAAO,qBACP,MAAO,2BACP,MAAO,kBACP,MAAO,iBACP,MAAO,UACP,MAAO,wBACP,MAAO,yBACP,MAAO,gBACP,MAAO,gBACP,MAAO,kBACP,MAAO,kBACP,MAAO,gBACP,MAAO,uBACP,MAAO,oBACP,MAAO,2BACP,MAAO,uBACP,MAAO,kBACP,MAAO,2BACP,MAAO,2BACP,MAAO,WACP,MAAO,WACP,MAAO,WACP,MAAO,WACP,MAAO,WACP,MAAO,WACP,MAAO,WACP,MAAO,WACP,MAAO,WACP,MAAO,WACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,KAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,iBACP,MAAO,wBACP,MAAO,gBACP,MAAO,YACP,MAAO,YACP,MAAO,mBACP,MAAO,2BACP,MAAO,8BACP,MAAO,8BACP,MAAO,8BACP,MAAO,8BACP,MAAO,8BACP,MAAO,8BACP,MAAO,4BACP,MAAO,8BACP,MAAO,2BACP,MAAO,6BACP,MAAO,2BACP,MAAO,wBACP,MAAO,8BACP,MAAO,iCACP,MAAO,6BACP,MAAO,cACP,MAAO,eACP,MAAO,oBACP,MAAO,oBACP,MAAO,+BACP,MAAO,+BACP,MAAO,uBACP,MAAO,qBACP,MAAO,iCACP,MAAO,0BACP,MAAO,eACP,MAAO,uBACP,MAAO,uBACP,MAAO,+BACP,MAAO,qCACP,MAAO,cACP,MAAO,cACP,MAAO,eACP,MAAO,kBACP,MAAO,gBACP,MAAO,iCACP,MAAO,mCACP,MAAO,cACP,MAAO,aACP,MAAO,aACP,MAAO,aACP,MAAO,WACP,MAAO,WACP,MAAO,WACP,MAAO,OACP,MAAO,YACP,MAAO,YACP,MAAO,YACP,MAAO,aACP,MAAO,aACP,MAAO,aACP,MAAO,aACP,MAAO,eACP,MAAO,gBACP,MAAO,iBACP,MAAO,cACP,MAAO,kBACP,MAAO,kBACP,MAAO,mBACP,MAAO,kBACP,MAAO,4BACP,MAAO,uBACP,MAAO,oBACP,MAAO,8BACP,MAAO,2BACP,MAAO,kBACP,MAAO,mBACP,MAAO,0BACP,MAAO,yBACP,MAAO,sBACP,MAAO,uBACP,MAAO,qCACP,MAAO,qCACP,MAAO,uCACP,MAAO,+CACP,MAAO,uBACP,MAAO,oCACP,MAAO,4CACP,MAAO,oCACP,MAAO,0BACP,MAAO,oBACP,MAAO,mBACP,MAAO,qBACP,MAAO,cACP,MAAO,eACP,MAAO,qBACP,MAAO,sBACP,MAAO,+BACP,MAAO,iBACP,MAAO,wBACP,MAAO,0BACP,MAAO,yBACP,MAAO,0BACP,MAAO,0BACP,MAAO,4BACP,MAAO,SACP,MAAO,YACP,MAAO,eACP,MAAO,aACP,MAAO,UACP,MAAO,aACP,MAAO,WACP,MAAO,kBACP,MAAO,6BACP,MAAO,sBACP,MAAO,+BACP,MAAO,sBACP,MAAO,iCACP,MAAO,qBACP,MAAO,qCACP,MAAO,wB,iBCxST,IAAI6wC,EAAU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A,eACA,gBACA,WACA,gBACA,0BACA,eACA,eACA,eACA,eACA,SACA,cACA,kBACA,mBACA,eACA,eACA,cACA,eACA,kBACA,gBACA,iBACA,4BACA,uBACA,mBACA,yBACA,gBACA,0BACA,wBACA,mBACA,iBACA,2BACA,wBACA,mBACA,kCACA,oBACA,kCACA,eACA,sBACA,0BACA,qBACA,sBACA,sBACA,gCACA,gCACA,qBACA,4BACA,qCACA,8BACA,+BACA,sCACA,+CACA,wCACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,YACA,kBACA,iBACA,kBACA,kBACA,kBACA,kBACA,WACA,gBACA,qBACA,eACA,cACA,sBACA,6BACA,sCACA,+BACA,oBACA,cACA,qBACA,mBACA,0BACA,mCACA,4BACA,YACA,cACA,mBACA,cACA,SACA,WACA,gBACA,MACA,OACA,iBACA,MACA,MACA,MACA,MACA,YACA,MACA,WACA,MACA,UACA,UACA,UACA,OACA,MACA,aACA,OACA,OACA,MACA,YACA,eACA,gBACA,mBACA,cACA,iBACA,kBACA,sBACA,oBACA,mBACA,uBACA,qB,iBCnJJ,IAAIkiB,EAAO,EAAQ,MAInBA,EAAOA,EAAK9f,QAAQs5B,OAAO,SAAUx6B,GACnC,OAAQ,kBAAkB6iB,KAAK7iB,EACjC,GAEAnB,EAAOC,QAAUkiB,EAAKC,OAAO,CAEzB,cACA,gBACA,cACA,eACA,eACA,iBACA,eACA,gBACA,sBACA,6BACA,4BACA,6BACA,gCACA,kCACA,0BACA,+BACA,oBACA,2BACA,2BACA,0BACA,gBAGA,QACA,QACA,YACA,QACA,QACA,iBACA,kBACA,iBACA,kBACA,gBACA,kBACA,gBACA,kBACA,eACA,iBACA,eACA,YACA,cACA,UACA,UACA,cACA,cACA,aACA,gBACA,aACA,mBACA,oBACA,mBACA,iBACA,uBACA,cACA,oBACA,kBACA,yB,8BC1DJ,IAAIvG,EAAS,EAAQ,MAErB7b,EAAOC,QAAU,SAAiB6nC,EAAKliC,EAAKkvC,GAE1C,OAAOj5B,EADPi5B,OAAmB,IAAPA,EAAsBA,EAAK,GAAM,IAC3BlvC,GAAOkiC,CAC3B,C","sources":["/dev/workshop/./node_modules/glsl-tokenizer/lib/operators.js?","/dev/workshop/./node_modules/chroma.ts/src/index.ts?","/dev/workshop/./node_modules/glsl-shader-name/index.js?","/dev/workshop/./node_modules/glsl-tokenizer/lib/literals.js?","/dev/workshop/./node_modules/glsl-tokenizer/lib/literals-300es.js?","/dev/workshop/./node_modules/sprintf-js/src/sprintf.js?","/dev/workshop/./node_modules/tslib/tslib.es6.js?","/dev/workshop/./node_modules/tsgl/src/Buffer.ts?","/dev/workshop/./node_modules/tsgl/src/Mesh.ts?","/dev/workshop/./node_modules/tsgl/src/Shader.ts?","/dev/workshop/./node_modules/tsgl/src/Texture.ts?","/dev/workshop/./node_modules/tsgl/src/KhronosGroupWebGLDebug.ts?","/dev/workshop/./node_modules/tsgl/src/TSGLContext.ts?","/dev/workshop/./node_modules/tsgl/src/shaders/posCoordVS.glslx?","/dev/workshop/./node_modules/tsgl/src/shaders/sdfRenderFS.glslx?","/dev/workshop/./node_modules/gl-constants/1.0/numbers.js?","/dev/workshop/./node_modules/add-line-numbers/index.js?","/dev/workshop/./node_modules/repeat-string/index.js?","/dev/workshop/./node_modules/gl-format-compiler-error/index.js?","/dev/workshop/./node_modules/atob-lite/atob-browser.js?","/dev/workshop/./node_modules/glsl-tokenizer/string.js?","/dev/workshop/./node_modules/gl-constants/lookup.js?","/dev/workshop/./node_modules/glsl-tokenizer/index.js?","/dev/workshop/./node_modules/glsl-tokenizer/lib/builtins.js?","/dev/workshop/./node_modules/glsl-tokenizer/lib/builtins-300es.js?","/dev/workshop/./node_modules/pad-left/index.js?"],"sourcesContent":["module.exports = [\r\n    '<<='\r\n  , '>>='\r\n  , '++'\r\n  , '--'\r\n  , '<<'\r\n  , '>>'\r\n  , '<='\r\n  , '>='\r\n  , '=='\r\n  , '!='\r\n  , '&&'\r\n  , '||'\r\n  , '+='\r\n  , '-='\r\n  , '*='\r\n  , '/='\r\n  , '%='\r\n  , '&='\r\n  , '^^'\r\n  , '^='\r\n  , '|='\r\n  , '('\r\n  , ')'\r\n  , '['\r\n  , ']'\r\n  , '.'\r\n  , '!'\r\n  , '~'\r\n  , '*'\r\n  , '/'\r\n  , '%'\r\n  , '+'\r\n  , '-'\r\n  , '<'\r\n  , '>'\r\n  , '&'\r\n  , '^'\r\n  , '|'\r\n  , '?'\r\n  , ':'\r\n  , '='\r\n  , ','\r\n  , ';'\r\n  , '{'\r\n  , '}'\r\n]\r\n","/**\n * @license\n *\n * js - JavaScript library for color conversions\n *\n * Copyright (c) 2011-2017, Gregor Aisch\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. The name Gregor Aisch may not be used to endorse or promote products\n *    derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,\n * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\n * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n// tslint:disable:no-unnecessary-qualifier\n\nconst { abs, atan2, cos, floor, log, min, max, round, sign, sin, sqrt, cbrt, PI, hypot } = Math\n\nfunction lerp(a: number, b: number, f: number) {\n\treturn a + (b - a) * f\n}\nfunction lerpInv(a: number, b: number, f: number) {\n\treturn (f - a) / (b - a)\n}\nfunction clamp(x: number, min = 0, max = 1) {\n\treturn x < min ? min : x > max ? max : x\n}\n\nfunction newtonIterate1d(f: (x: number) => number, xStart: number, max_steps: number, eps: number = 1e-8): number {\n\tlet x = xStart,\n\t\tfx\n\twhile (max_steps-- && abs((fx = f(x))) > eps) {\n\t\tconst dfdx = (f(x + eps) - fx) / eps\n\t\tconsole.log(\"fx / dfdx\", fx / dfdx, \"fx\", fx, \"x\", x)\n\t\tx = x - fx / dfdx\n\t}\n\treturn x\n}\nfunction bisect(f: (x: number) => number, a: number, b: number, steps: number) {\n\t//assert(a < b)\n\tlet fA = f(a)\n\t// let fB = f(b)\n\t//assert(fA * fB < 0)\n\twhile (steps--) {\n\t\tconst c = (a + b) / 2\n\t\tconst fC = f(c)\n\t\t// console.log(\"fC\", fC, \"c\", c)\n\t\tif (sign(fA) == sign(fC)) {\n\t\t\ta = c\n\t\t\tfA = fC\n\t\t} else {\n\t\t\tb = c\n\t\t\t// fB = fC\n\t\t}\n\t}\n\t//assert(a <= (b + a) / 2)\n\t//assert(b >= (b + a) / 2)\n\treturn (a + b) / 2\n}\n\nconst TWOPI = 2 * PI\n\nconst DEG2RAD = PI / 180\n\nconst RAD2DEG = 180 / PI\n/**\n * @param alpha1 default=1\n * @example chroma.color(99, 99, 44, 0.7)\n */\nexport function color(red255: number, green255: number, blue255: number, alpha1?: number): Color\n/**\n * @example chroma.color('mediumorchid') // a css string\n * @example chroma.color([56, 203, 30]) // a RGB triple\n * @example chroma.color(0x4b0082) // a hex num\n * @example chroma.color([30, 0.8, 0.3], 'hsl') // explicit format\n */\nexport function color(x: Chromable, format?: ColorFormat): Color\n/**\n * This overload allows VS Code to suggest color names when you type `color('`.\n */\nexport function color(colorname: keyof typeof w3cx11, format?: \"name\"): Color\n/** @example chroma.color(30, 0.8, 0.3, 'hsl') */\nexport function color(channel0: number, channel1: number, channel2: number, format: ColorFormat): Color\n/** @example chroma.color(0.3, 0.8, 0.3, 1, 'gl') */\nexport function color(\n\tchannel0: number,\n\tchannel1: number,\n\tchannel2: number,\n\tchannel3: number,\n\tformat: ColorFormat,\n): Color\nexport function color(...args: any[]) {\n\tif (args[0] instanceof Color) {\n\t\treturn args[0]\n\t}\n\tif (args.length > 1 && \"string\" == typeof args[args.length - 1]) {\n\t\treturn guess(args.slice(0, args.length - 1), args[args.length - 1])\n\t} else if (Array.isArray(args[0])) {\n\t\treturn guess(args[0])\n\t} else {\n\t\treturn guess(args)\n\t}\n}\n/**\n * A Chromable is any value which can be converted to a color. For ease of use, most functions accept these instead of\n * only Color values.\n */\nexport type Chromable = number | string | Color | number[]\n\nexport class Color {\n\t/** @internal */\n\tconstructor(\n\t\tprivate readonly r: number,\n\t\tprivate readonly g: number,\n\t\tprivate readonly b: number,\n\t\tprivate readonly a = 1,\n\t) {}\n\n\t// public shade() {\n\t// \tconst shades: [string, string, number][] = [\n\t// \t\t[\"ff0000\", \"red\"],\n\t// \t\t[\"ffa500\", \"orange\"],\n\t// \t\t[\"ffff00\", \"yellow\"],\n\t// \t\t[\"008000\", \"green\"],\n\t// \t\t[\"0000ff\", \"blue\"],\n\t// \t\t[\"ee82ee\", \"violet\"],\n\t// \t\t[\"a52a2a\", \"brown\"],\n\t// \t\t[\"000000\", \"black\"],\n\t// \t\t[\"808080\", \"grey\"],\n\t// \t\t[\"ffffff\", \"white\"],\n\t// \t] as any\n\t// \tfunction angleDiff(a: number, b: number) {\n\t// \t\tconst d = (a - b) % 360\n\t// \t\tif (d > 180) return d - 360\n\t// \t\tif (d < -180) return d + 360\n\t// \t\treturn d\n\t// \t}\n\t// \tshades.forEach(arr => arr.push(color(arr[0]).hsl()[0]))\n\t// \tconst [h, s, l] = this.hsl()\n\t// \tif (l > 0.9) return \"white\"\n\t// \tif (l > 0.8 && s < 0.2) return \"white\"\n\t// \tif (s < 0.1) return \"grey\"\n\t// \tif (s < 0.4 && h > 0 && h < 48) return \"brown\"\n\n\t// \tconst distanceInXYZ: { [hue: number]: number } = { 0: 0 }\n\t// \tfor (let i = 60; i <= 360; i += 60) {\n\t// \t\tdistanceInXYZ[i] =\n\t// \t\t\tdistanceInXYZ[i - 60] + distance(hsl(i - 60, 1, 0.5), hsl(i, 1, 0.5), \"xyz\")\n\t// \t}\n\t// \t// console.log(distanceInXYZ)\n\n\t// \tconst shadeEnds: { [hue: number]: number } = {\n\t// \t\t0: 9,\n\t// \t\t38: 48,\n\t// \t\t60: 65,\n\t// \t\t120: 165,\n\t// \t\t240: 245,\n\t// \t\t300: 338,\n\t// \t\t360: 369,\n\t// \t}\n\n\t// \tconst getColorDistanceAlongXYZHue = (hueDegrees: number) => {\n\t// \t\tconst base = hueDegrees - (hueDegrees % 60)\n\t// \t\treturn (\n\t// \t\t\tdistanceInXYZ[base] + distance(hsl(base, 1, 0.5), hsl(hueDegrees, 1, 0.5), \"xyz\")\n\t// \t\t)\n\t// \t}\n\t// \tconst colorXYZD = getColorDistanceAlongXYZHue(this.hsl()[0])\n\t// \tconst md = distanceInXYZ[360]\n\t// \tconst shadeHue =\n\t// \t\t(Object.keys(shadeEnds) as any[]).find(shadeHue => shadeEnds[shadeHue | 0] >= this.hsl()[0])! % 360\n\t// \treturn shades.find(([_hex, _name, _hue]) => (_hue | 0) === shadeHue)![1]\n\t// \t// process.exit()\n\t// \treturn withMax(shades, ([_hex, _name, _hue]) => {\n\t// \t\treturn -abs(angleDiff(this.hsl()[0], _hue))\n\t// \t})[1]\n\t// \treturn withMax(shades, ([_hex, _name, _hue]) => {\n\t// \t\tconst [thisL, thisA, thisB] = this.lab()\n\t// \t\tconst [L, A, B] = color(_hex).lab()\n\t// \t\treturn -hypot(thisL - L, thisA - A, thisB - B)\n\t// \t})[1]\n\t// }\n\n\t/**\n\t * @see [[mix]]\n\t */\n\tpublic mix(col2: Chromable, f: number, m: InterpolationMode = \"rgb\") {\n\t\treturn mix(this, col2, f, m)\n\t}\n\tpublic rgb(doRound = true, clamp_ = true): RGB {\n\t\tconst f = (t: number) => {\n\t\t\tif (doRound) t = round(t)\n\t\t\tif (clamp_) t = clamp(t, 0, 255)\n\t\t\treturn t\n\t\t}\n\t\tconst { r, g, b } = this\n\t\treturn [f(r), f(g), f(b)]\n\t}\n\tpublic rgba(doRound = true, clamp_ = true): RGBA {\n\t\tconst f = (t: number) => {\n\t\t\tif (doRound) t = round(t)\n\t\t\tif (clamp_) t = clamp(t, 0, 255)\n\t\t\treturn t\n\t\t}\n\t\tconst { r, g, b, a } = this\n\t\treturn [f(r), f(g), f(b), a]\n\t}\n\n\t/**\n\t * Return a hex-string representation of this color.\n\t *\n\t * @param mode\n\t * @see #num for a hex-number representation.\n\t * @example chroma.color('yellow').alpha(0.7).hex()\n\t * @example chroma.color('yellow').alpha(0.7).hex('rgba')\n\t * @example chroma.color('yellow').alpha(0.7).hex('argb')\n\t */\n\tpublic hex(mode: \"rgb\" | \"rgba\" | \"argb\" = \"rgb\") {\n\t\tconst { r, g, b, a } = this\n\t\treturn rgb2hex(r, g, b, a, mode)\n\t}\n\n\t/**\n\t * Returns the [HSL] representation of this color. hue will always be in [0;360). Values are never NaN.\n\t *\n\t * @example chroma.color('purple').hsl()\n\t */\n\tpublic hsl(): HSL {\n\t\tconst { r, g, b } = this\n\t\treturn rgb2hsl(r, g, b)\n\t}\n\n\t/**\n\t * Returns the [HSL] representation of this color. hue will always be in [0;360). Values are never NaN.\n\t *\n\t * @example chroma.color('purple').hsv()\n\t */\n\tpublic hsv() {\n\t\tconst { r, g, b } = this\n\t\treturn rgb2hsv(r, g, b)\n\t}\n\n\t/**\n\t * Returns the [HSL] representation of this color. hue will always be in [0;360). Values are never NaN.\n\t *\n\t * @example chroma.color('purple').hcg()\n\t */\n\tpublic hcg() {\n\t\tconst { r, g, b } = this\n\t\treturn rgb2hcg(r, g, b)\n\t}\n\n\t/**\n\t * Returns a CSS `rgb(...)` or `hsl(...)` string representation that can be used as CSS-color definition. The alpha\n\t * value is not output if it 1.\n\t * @example chroma.color('teal').css() // == \"rgb(0,128,128)\"\n\t * @example chroma.color('teal').alpha(0.5).css() // == \"rgba(0,128,128,0.5)\"\n\t * @example chroma.color('teal').css('hsl') // == \"hsl(180,100%,25.1%)\"\n\t */\n\tpublic css(mode: \"rgb\" | \"hsl\" = \"rgb\") {\n\t\tif (\"rgb\" == mode) {\n\t\t\tconst { r, g, b, a } = this\n\t\t\treturn rgb2css(r, g, b, a)\n\t\t} else if (\"hsl\" == mode) {\n\t\t\treturn hsl2css(this.hsl(), this.alpha())\n\t\t} else {\n\t\t\tthrow new Error()\n\t\t}\n\t}\n\n\tpublic name(closest: true): string\n\t/**\n\t * Get the name of a color. By default, this method will try to match the color exactly (comparing rounded RGB\n\t * values). Pass `true` to return the name of the color which is closest to `this` in CIELAB color space. CIELAB is\n\t * used as it is perceptually uniform.\n\t * @param closest Whether this should find the closest color name. default=false\n\t * @return If `closest == false`, the name of this color or `undefined` if there is no match. Otherwise, will always\n\t * return a color name.\n\t * @example chroma.color('#ff0000').name() // == \"red\"\n\t * @example chroma.color('#ff0001').name() // == undefined\n\t * @example chroma.color('#ff0001').name(true) // == \"red\"\n\t */\n\tpublic name(closest?: boolean): string | undefined\n\tpublic name(closest: boolean = false): string | undefined {\n\t\tconst thisNum = this.num()\n\t\tconst name = Object.keys(w3cx11).find((name) => (w3cx11 as any)[name] == thisNum)\n\t\tif (!name && closest) {\n\t\t\tconst [thisLStar, thisAStar, thisBStar] = this.lab()\n\t\t\treturn withMax(Object.keys(w3cx11) as (keyof typeof w3cx11)[], (name) => {\n\t\t\t\tconst [lStar, aStar, bStar] = num(w3cx11[name]).lab()\n\t\t\t\treturn -hypot(thisLStar - lStar, thisAStar - aStar, thisBStar - bStar)\n\t\t\t})\n\t\t}\n\t\treturn name\n\t}\n\n\t/**\n\t * Get the [CMYK](#CMYK) representation of this color.\n\t *\n\t * @example chroma.color('red').cmyk()\n\t */\n\tpublic cmyk() {\n\t\tconst { r, g, b } = this\n\t\treturn rgb2cmyk(r, g, b)\n\t}\n\n\t/**\n\t * Returns the [GL] representation of this color.\n\t * @example chroma.color('33cc00').gl()\n\t */\n\tpublic gl(): GL {\n\t\tconst { r, g, b, a } = this\n\t\treturn [r / 255, g / 255, b / 255, a]\n\t}\n\n\t/**\n\t * Get luminance of the color. This is equal to the Y channel of the XYZ color space.\n\t * @example chroma.color('black').luminance() // == 0\n\t * @example chroma.color('white').luminance() // == 1\n\t * @example chroma.color('red').luminance() // == ~0.21\n\t * @see https://en.wikipedia.org/wiki/Relative_luminance\n\t */\n\tpublic luminance(): number\n\t/**\n\t * Return a new [Color] with `lum1` by linearly interpolating `this` with white (when increasing the luminance) or\n\t * black (otherwise) in the [XYZ] color space.\n\t * @see https://en.wikipedia.org/wiki/Relative_luminance\n\t * @example // Approximately doubling the luminance of red\n\t * @example chroma.color('red').luminance(0.4) // == #ff8686 // \"Vivid Tangerine\"\n\t * @param lum1 The desired luminance.\n\t */\n\tpublic luminance(lum1: number): this\n\tpublic luminance(lum1?: number) {\n\t\tconst { r, g, b, a } = this\n\t\tconst [, Y] = rgb2xyz(r, g, b)\n\t\tif (undefined === lum1) {\n\t\t\treturn Y\n\t\t}\n\t\tconst inverseLerp = (a: number, b: number, val: number) => (val - a) / (b - a)\n\t\tif (lum1 > Y) {\n\t\t\t// lerp to white\n\t\t\treturn mix(this, white, inverseLerp(Y, 1, lum1), \"xyz\").alpha(a)\n\t\t} else {\n\t\t\t// lerp to black\n\t\t\treturn mix(black, this, inverseLerp(0, Y, lum1), \"xyz\").alpha(a)\n\t\t}\n\t}\n\n\t/**\n\t * Get color temperature of this color in Kelvin. This only makes sense for colors close to those output by\n\t * kelvin\n\t *\n\t * @example [c = chroma.color('#ff3300'), c.temperature()]\n\t * @example [c = chroma.color('#ffe3cd'), c.temperature()]\n\t * @example [c = chroma.color('#b3ccff'), c.temperature()]\n\t */\n\tpublic temperature() {\n\t\tconst { r, g, b } = this\n\t\treturn rgb2kelvin(r, g, b)\n\t}\n\n\t/**\n\t * Returns a new [Color] with a channel changed.\n\t * @example chroma.color('skyblue').set('hsl.h', 0) // change hue to 0 deg (=red)\n\t * @example chroma.color('hotpink').set('lch.c', 30) // set chromaticity to 30\n\t * @example chroma.color('orangered').set('lab.l', x => x / 2) // half Lab lightness\n\t * @example chroma.color('darkseagreen').set('lch.c', x => x * 2) // double Lch saturation\n\t */\n\tpublic set(modeAndChannel: string, value: number | ((channel: number) => number)) {\n\t\tconst [mode, channel] = modeAndChannel.split(\".\") as [ColorMode, string]\n\t\tconst src = this[mode]()\n\t\tconst i = mode.indexOf(channel)\n\t\tif (-1 == i) throw new Error(\"invalid channel\")\n\t\tsrc[i] = \"number\" == typeof value ? value : value(src[i])\n\t\treturn color(src, mode).alpha(this.a)\n\t}\n\n\t/**\n\t * Returns whether this color is outside the RGB color cube and will be clipped/clamped when calling .rgb()\n\t *\n\t * @example [c = chroma.lch( 20, 40, 50), c.clipped()]\n\t * @example [c = chroma.lch( 40, 40, 50), c.clipped()]\n\t * @example [c = chroma.lch( 60, 40, 50), c.clipped()]\n\t * @example [c = chroma.lch( 80, 40, 50), c.clipped()]\n\t * @example [c = chroma.lch(100, 40, 50), c.clipped()]\n\t */\n\tpublic clipped() {\n\t\tconst { r, g, b } = this\n\t\treturn !(0 <= r && r <= 255 && 0 <= g && g <= 255 && 0 <= b && b <= 255)\n\t}\n\n\t/**\n\t * Returns black or white, whichever has the highest contrast to `this`.\n\t * In the readme you should see the result of this.\n\t *\n\t * @example chroma.color('red')\n\t * @example chroma.color('yellow')\n\t */\n\tpublic textColor() {\n\t\treturn this.luminance() > 0.5 ? black : white\n\t}\n\n\t/**\n\t * Get alpha value of color.\n\t * @example chroma.rgb(0, 0, 255, 0.5).alpha() // == 0.5\n\t */\n\tpublic alpha(): number\n\t/**\n\t * Return new [Color] with given alpha value.\n\t * @example chroma.color('green').alpha(0.3)\n\t * @example chroma.color('green').alpha(0.3).hex('rgba') // == \"#00ff004d\"\n\t * @param alpha1 The desired alpha value.\n\t */\n\tpublic alpha(alpha1: number): Color\n\tpublic alpha(alpha1?: number): number | Color {\n\t\tif (undefined === alpha1) {\n\t\t\treturn this.a\n\t\t}\n\t\tconst { r, g, b } = this\n\t\treturn rgb(r, g, b, alpha1)\n\t}\n\n\tpublic darker(amount = 1) {\n\t\tconst [l, a, b] = this.lab()\n\t\treturn lab(l - LAB_Kn * amount, a, b, this.alpha())\n\t}\n\n\t/**\n\t *\n\t * @param amount\n\t * @example chroma.color('hotpink')\n\t * @example chroma.color('hotpink').brighter()\n\t * @example chroma.color('hotpink').brighter(2)\n\t * @example chroma.color('hotpink').brighter(3)\n\t */\n\tpublic brighter(amount = 1) {\n\t\treturn this.darker(-amount)\n\t}\n\n\t/**\n\t * Returns a new [Color] with increased saturation.\n\t * @param amount How much.\n\t * @example chroma.color('slategray')\n\t * @example chroma.color('slategray').saturate()\n\t * @example chroma.color('slategray').saturate(2)\n\t * @example chroma.color('slategray').saturate(3)\n\t */\n\tpublic saturate(amount = 1) {\n\t\tconst [l, c, h] = this.lch()\n\t\treturn lch(l, max(0, c + amount * LAB_Kn), h, this.alpha())\n\t}\n\n\t/**\n\t * Equivalent to `saturate(-amount)`.\n\t * @see #saturate\n\t */\n\tpublic desaturate(amount = 1) {\n\t\treturn this.saturate(-amount)\n\t}\n\n\tpublic premultiplied() {\n\t\tconst { r, g, b, a } = this\n\t\treturn rgb(r * a, g * a, b * a, a)\n\t}\n\n\t/**\n\t * Returns the [HSI] representation of this color. hue will always be in [0; 360). Values are never NaN.\n\t *\n\t * @example chroma.color('purple').hsi()\n\t */\n\tpublic hsi() {\n\t\tconst { r, g, b } = this\n\t\treturn rgb2hsi(r, g, b)\n\t}\n\n\t/**\n\t * Returns the [LAB] representation of this color.\n\t *\n\t * @example chroma.color('purple').lab()\n\t */\n\tpublic lab() {\n\t\tconst { r, g, b } = this\n\t\treturn rgb2lab(r, g, b)\n\t}\n\n\t/**\n\t * Return a hex-num of this color.\n\t *\n\t * @param mode\n\t * @see #num for a hex-number representation.\n\t * @example chroma.color('yellow').alpha(0.7).hex()\n\t * @example chroma.color('yellow').alpha(0.7).hex('rgba')\n\t * @example chroma.color('yellow').alpha(0.7).hex('argb')\n\t */\n\tpublic num(mode: \"rgb\" | \"rgba\" | \"argb\" = \"rgb\") {\n\t\tconst { r, g, b, a } = this\n\t\treturn rgb2num(r, g, b, a, mode)\n\t}\n\n\t/**\n\t * Returns the [LCH] representation of this color. hue will always be in [0; 360). Values are never NaN.\n\t *\n\t * @example chroma.color('purple').lch()\n\t */\n\tpublic lch() {\n\t\tconst { r, g, b } = this\n\t\treturn rgb2lch(r, g, b)\n\t}\n\n\t/**\n\t * Returns the [XYZ] representation of this color. hue will always be in [0; 360). Values are never NaN.\n\t *\n\t * @example chroma.color('purple').xyz()\n\t */\n\tpublic xyz() {\n\t\tconst { r, g, b } = this\n\t\treturn rgb2xyz(r, g, b)\n\t}\n\n\t/**\n\t * Whether this [Color](#Color) is identical (strict equality of r, g, b, a) to `color`.\n\t */\n\tpublic equals(color: Color) {\n\t\tconst { r, g, b, a } = this\n\t\tconst { r: r2, g: g2, b: b2, a: a2 } = color\n\t\treturn r == r2 && g == g2 && b == b2 && a == a2\n\t}\n\n\tpublic hashCode() {\n\t\treturn this.num(\"rgba\")\n\t}\n\n\t/**\n\t * @example chroma.color('red').toSource() // == \"rgb(255, 0, 0)\"\n\t * @example chroma.rgb(-2, 100.02, 200, 0.5).toSource() // == \"rgb(-2, 100.02, 200, 0.5)\"\n\t */\n\tpublic toSource() {\n\t\tconst { r, g, b, a } = this\n\t\treturn \"chroma.rgb(\" + r + \", \" + g + \", \" + b + (a === 1 ? \")\" : \", \" + a + \")\")\n\t}\n}\nexport interface Color {\n\ttoString(): string\n\t//darker(amount: number): Color\n\t//brighter(amount: number): Color\n\tkelvin(): number\n}\nColor.prototype.toString = Color.prototype.css\nColor.prototype.kelvin = Color.prototype.temperature\n/**\n * @example chroma.black\n */\nexport const black = new Color(0, 0, 0, 1)\n\n/**\n * @example chroma.black\n */\nexport const white = new Color(255, 255, 255, 1)\n\nexport const brewer = {\n\tOrRd: [0xfff7ec, 0xfee8c8, 0xfdd49e, 0xfdbb84, 0xfc8d59, 0xef6548, 0xd7301f, 0xb30000, 0x7f0000],\n\tPuBu: [0xfff7fb, 0xece7f2, 0xd0d1e6, 0xa6bddb, 0x74a9cf, 0x3690c0, 0x0570b0, 0x045a8d, 0x023858],\n\tBuPu: [0xf7fcfd, 0xe0ecf4, 0xbfd3e6, 0x9ebcda, 0x8c96c6, 0x8c6bb1, 0x88419d, 0x810f7c, 0x4d004b],\n\tOranges: [0xfff5eb, 0xfee6ce, 0xfdd0a2, 0xfdae6b, 0xfd8d3c, 0xf16913, 0xd94801, 0xa63603, 0x7f2704],\n\tBuGn: [0xf7fcfd, 0xe5f5f9, 0xccece6, 0x99d8c9, 0x66c2a4, 0x41ae76, 0x238b45, 0x006d2c, 0x00441b],\n\tYlOrBr: [0xffffe5, 0xfff7bc, 0xfee391, 0xfec44f, 0xfe9929, 0xec7014, 0xcc4c02, 0x993404, 0x662506],\n\tYlGn: [0xffffe5, 0xf7fcb9, 0xd9f0a3, 0xaddd8e, 0x78c679, 0x41ab5d, 0x238443, 0x006837, 0x004529],\n\tReds: [0xfff5f0, 0xfee0d2, 0xfcbba1, 0xfc9272, 0xfb6a4a, 0xef3b2c, 0xcb181d, 0xa50f15, 0x67000d],\n\tRdPu: [0xfff7f3, 0xfde0dd, 0xfcc5c0, 0xfa9fb5, 0xf768a1, 0xdd3497, 0xae017e, 0x7a0177, 0x49006a],\n\tGreens: [0xf7fcf5, 0xe5f5e0, 0xc7e9c0, 0xa1d99b, 0x74c476, 0x41ab5d, 0x238b45, 0x006d2c, 0x00441b],\n\tYlGnBu: [0xffffd9, 0xedf8b1, 0xc7e9b4, 0x7fcdbb, 0x41b6c4, 0x1d91c0, 0x225ea8, 0x253494, 0x081d58],\n\tPurples: [0xfcfbfd, 0xefedf5, 0xdadaeb, 0xbcbddc, 0x9e9ac8, 0x807dba, 0x6a51a3, 0x54278f, 0x3f007d],\n\tGnBu: [0xf7fcf0, 0xe0f3db, 0xccebc5, 0xa8ddb5, 0x7bccc4, 0x4eb3d3, 0x2b8cbe, 0x0868ac, 0x084081],\n\tGreys: [0xffffff, 0xf0f0f0, 0xd9d9d9, 0xbdbdbd, 0x969696, 0x737373, 0x525252, 0x252525, 0x000000],\n\tYlOrRd: [0xffffcc, 0xffeda0, 0xfed976, 0xfeb24c, 0xfd8d3c, 0xfc4e2a, 0xe31a1c, 0xbd0026, 0x800026],\n\tPuRd: [0xf7f4f9, 0xe7e1ef, 0xd4b9da, 0xc994c7, 0xdf65b0, 0xe7298a, 0xce1256, 0x980043, 0x67001f],\n\tBlues: [0xf7fbff, 0xdeebf7, 0xc6dbef, 0x9ecae1, 0x6baed6, 0x4292c6, 0x2171b5, 0x08519c, 0x08306b],\n\tPuBuGn: [0xfff7fb, 0xece2f0, 0xd0d1e6, 0xa6bddb, 0x67a9cf, 0x3690c0, 0x02818a, 0x016c59, 0x014636],\n\tViridis: [0x440154, 0x482777, 0x3f4a8a, 0x31678e, 0x26838f, 0x1f9d8a, 0x6cce5a, 0xb6de2b, 0xfee825],\n\tSpectral: [\n\t\t0x9e0142,\n\t\t0xd53e4f,\n\t\t0xf46d43,\n\t\t0xfdae61,\n\t\t0xfee08b,\n\t\t0xffffbf,\n\t\t0xe6f598,\n\t\t0xabdda4,\n\t\t0x66c2a5,\n\t\t0x3288bd,\n\t\t0x5e4fa2,\n\t],\n\tRdYlGn: [\n\t\t0xa50026,\n\t\t0xd73027,\n\t\t0xf46d43,\n\t\t0xfdae61,\n\t\t0xfee08b,\n\t\t0xffffbf,\n\t\t0xd9ef8b,\n\t\t0xa6d96a,\n\t\t0x66bd63,\n\t\t0x1a9850,\n\t\t0x006837,\n\t],\n\tRdBu: [\n\t\t0x67001f,\n\t\t0xb2182b,\n\t\t0xd6604d,\n\t\t0xf4a582,\n\t\t0xfddbc7,\n\t\t0xf7f7f7,\n\t\t0xd1e5f0,\n\t\t0x92c5de,\n\t\t0x4393c3,\n\t\t0x2166ac,\n\t\t0x053061,\n\t],\n\tPiYG: [\n\t\t0x8e0152,\n\t\t0xc51b7d,\n\t\t0xde77ae,\n\t\t0xf1b6da,\n\t\t0xfde0ef,\n\t\t0xf7f7f7,\n\t\t0xe6f5d0,\n\t\t0xb8e186,\n\t\t0x7fbc41,\n\t\t0x4d9221,\n\t\t0x276419,\n\t],\n\tPRGn: [\n\t\t0x40004b,\n\t\t0x762a83,\n\t\t0x9970ab,\n\t\t0xc2a5cf,\n\t\t0xe7d4e8,\n\t\t0xf7f7f7,\n\t\t0xd9f0d3,\n\t\t0xa6dba0,\n\t\t0x5aae61,\n\t\t0x1b7837,\n\t\t0x00441b,\n\t],\n\tRdYlBu: [\n\t\t0xa50026,\n\t\t0xd73027,\n\t\t0xf46d43,\n\t\t0xfdae61,\n\t\t0xfee090,\n\t\t0xffffbf,\n\t\t0xe0f3f8,\n\t\t0xabd9e9,\n\t\t0x74add1,\n\t\t0x4575b4,\n\t\t0x313695,\n\t],\n\tBrBG: [\n\t\t0x543005,\n\t\t0x8c510a,\n\t\t0xbf812d,\n\t\t0xdfc27d,\n\t\t0xf6e8c3,\n\t\t0xf5f5f5,\n\t\t0xc7eae5,\n\t\t0x80cdc1,\n\t\t0x35978f,\n\t\t0x01665e,\n\t\t0x003c30,\n\t],\n\tRdGy: [\n\t\t0x67001f,\n\t\t0xb2182b,\n\t\t0xd6604d,\n\t\t0xf4a582,\n\t\t0xfddbc7,\n\t\t0xffffff,\n\t\t0xe0e0e0,\n\t\t0xbababa,\n\t\t0x878787,\n\t\t0x4d4d4d,\n\t\t0x1a1a1a,\n\t],\n\tPuOr: [\n\t\t0x7f3b08,\n\t\t0xb35806,\n\t\t0xe08214,\n\t\t0xfdb863,\n\t\t0xfee0b6,\n\t\t0xf7f7f7,\n\t\t0xd8daeb,\n\t\t0xb2abd2,\n\t\t0x8073ac,\n\t\t0x542788,\n\t\t0x2d004b,\n\t],\n\tSet2: [0x66c2a5, 0xfc8d62, 0x8da0cb, 0xe78ac3, 0xa6d854, 0xffd92f, 0xe5c494, 0xb3b3b3],\n\tAccent: [0x7fc97f, 0xbeaed4, 0xfdc086, 0xffff99, 0x386cb0, 0xf0027f, 0xbf5b17, 0x666666],\n\tSet1: [0xe41a1c, 0x377eb8, 0x4daf4a, 0x984ea3, 0xff7f00, 0xffff33, 0xa65628, 0xf781bf, 0x999999],\n\tSet3: [\n\t\t0x8dd3c7,\n\t\t0xffffb3,\n\t\t0xbebada,\n\t\t0xfb8072,\n\t\t0x80b1d3,\n\t\t0xfdb462,\n\t\t0xb3de69,\n\t\t0xfccde5,\n\t\t0xd9d9d9,\n\t\t0xbc80bd,\n\t\t0xccebc5,\n\t\t0xffed6f,\n\t],\n\tDark2: [0x1b9e77, 0xd95f02, 0x7570b3, 0xe7298a, 0x66a61e, 0xe6ab02, 0xa6761d, 0x666666],\n\tPaired: [\n\t\t0xa6cee3,\n\t\t0x1f78b4,\n\t\t0xb2df8a,\n\t\t0x33a02c,\n\t\t0xfb9a99,\n\t\t0xe31a1c,\n\t\t0xfdbf6f,\n\t\t0xff7f00,\n\t\t0xcab2d6,\n\t\t0x6a3d9a,\n\t\t0xffff99,\n\t\t0xb15928,\n\t],\n\tPastel2: [0xb3e2cd, 0xfdcdac, 0xcbd5e8, 0xf4cae4, 0xe6f5c9, 0xfff2ae, 0xf1e2cc, 0xcccccc],\n\tPastel1: [0xfbb4ae, 0xb3cde3, 0xccebc5, 0xdecbe4, 0xfed9a6, 0xffffcc, 0xe5d8bd, 0xfddaec, 0xf2f2f2],\n}\n\n/**\n * X11 color names\n * http://www.w3.org/TR/css3-color/#svg-color\n *\n * @example chroma.Object.keys(w3cx11).slice(0, 4)\n */\nexport const w3cx11 = {\n\taliceblue: 0xf0f8ff,\n\tantiquewhite: 0xfaebd7,\n\taqua: 0x00ffff,\n\taquamarine: 0x7fffd4,\n\tazure: 0xf0ffff,\n\tbeige: 0xf5f5dc,\n\tbisque: 0xffe4c4,\n\tblack: 0x000000,\n\tblanchedalmond: 0xffebcd,\n\tblue: 0x0000ff,\n\tblueviolet: 0x8a2be2,\n\tbrown: 0xa52a2a,\n\tburlywood: 0xdeb887,\n\tcadetblue: 0x5f9ea0,\n\tchartreuse: 0x7fff00,\n\tchocolate: 0xd2691e,\n\tcoral: 0xff7f50,\n\tcornflower: 0x6495ed,\n\tcornflowerblue: 0x6495ed,\n\tcornsilk: 0xfff8dc,\n\tcrimson: 0xdc143c,\n\tcyan: 0x00ffff,\n\tdarkblue: 0x00008b,\n\tdarkcyan: 0x008b8b,\n\tdarkgoldenrod: 0xb8860b,\n\tdarkgray: 0xa9a9a9,\n\tdarkgreen: 0x006400,\n\tdarkgrey: 0xa9a9a9,\n\tdarkkhaki: 0xbdb76b,\n\tdarkmagenta: 0x8b008b,\n\tdarkolivegreen: 0x556b2f,\n\tdarkorange: 0xff8c00,\n\tdarkorchid: 0x9932cc,\n\tdarkred: 0x8b0000,\n\tdarksalmon: 0xe9967a,\n\tdarkseagreen: 0x8fbc8f,\n\tdarkslateblue: 0x483d8b,\n\tdarkslategray: 0x2f4f4f,\n\tdarkslategrey: 0x2f4f4f,\n\tdarkturquoise: 0x00ced1,\n\tdarkviolet: 0x9400d3,\n\tdeeppink: 0xff1493,\n\tdeepskyblue: 0x00bfff,\n\tdimgray: 0x696969,\n\tdimgrey: 0x696969,\n\tdodgerblue: 0x1e90ff,\n\tfirebrick: 0xb22222,\n\tfloralwhite: 0xfffaf0,\n\tforestgreen: 0x228b22,\n\tfuchsia: 0xff00ff,\n\tgainsboro: 0xdcdcdc,\n\tghostwhite: 0xf8f8ff,\n\tgold: 0xffd700,\n\tgoldenrod: 0xdaa520,\n\tgray: 0x808080,\n\tgreen: 0x008000,\n\tgreenyellow: 0xadff2f,\n\tgrey: 0x808080,\n\thoneydew: 0xf0fff0,\n\thotpink: 0xff69b4,\n\tindianred: 0xcd5c5c,\n\tindigo: 0x4b0082,\n\tivory: 0xfffff0,\n\tkhaki: 0xf0e68c,\n\tlaserlemon: 0xffff54,\n\tlavender: 0xe6e6fa,\n\tlavenderblush: 0xfff0f5,\n\tlawngreen: 0x7cfc00,\n\tlemonchiffon: 0xfffacd,\n\tlightblue: 0xadd8e6,\n\tlightcoral: 0xf08080,\n\tlightcyan: 0xe0ffff,\n\tlightgoldenrod: 0xfafad2,\n\tlightgoldenrodyellow: 0xfafad2,\n\tlightgray: 0xd3d3d3,\n\tlightgreen: 0x90ee90,\n\tlightgrey: 0xd3d3d3,\n\tlightpink: 0xffb6c1,\n\tlightsalmon: 0xffa07a,\n\tlightseagreen: 0x20b2aa,\n\tlightskyblue: 0x87cefa,\n\tlightslategray: 0x778899,\n\tlightslategrey: 0x778899,\n\tlightsteelblue: 0xb0c4de,\n\tlightyellow: 0xffffe0,\n\tlime: 0x00ff00,\n\tlimegreen: 0x32cd32,\n\tlinen: 0xfaf0e6,\n\tmagenta: 0xff00ff,\n\tmaroon: 0x800000,\n\tmaroon2: 0x7f0000,\n\tmaroon3: 0xb03060,\n\tmediumaquamarine: 0x66cdaa,\n\tmediumblue: 0x0000cd,\n\tmediumorchid: 0xba55d3,\n\tmediumpurple: 0x9370db,\n\tmediumseagreen: 0x3cb371,\n\tmediumslateblue: 0x7b68ee,\n\tmediumspringgreen: 0x00fa9a,\n\tmediumturquoise: 0x48d1cc,\n\tmediumvioletred: 0xc71585,\n\tmidnightblue: 0x191970,\n\tmintcream: 0xf5fffa,\n\tmistyrose: 0xffe4e1,\n\tmoccasin: 0xffe4b5,\n\tnavajowhite: 0xffdead,\n\tnavy: 0x000080,\n\toldlace: 0xfdf5e6,\n\tolive: 0x808000,\n\tolivedrab: 0x6b8e23,\n\torange: 0xffa500,\n\torangered: 0xff4500,\n\torchid: 0xda70d6,\n\tpalegoldenrod: 0xeee8aa,\n\tpalegreen: 0x98fb98,\n\tpaleturquoise: 0xafeeee,\n\tpalevioletred: 0xdb7093,\n\tpapayawhip: 0xffefd5,\n\tpeachpuff: 0xffdab9,\n\tperu: 0xcd853f,\n\tpink: 0xffc0cb,\n\tplum: 0xdda0dd,\n\tpowderblue: 0xb0e0e6,\n\tpurple: 0x800080,\n\tpurple2: 0x7f007f,\n\tpurple3: 0xa020f0,\n\trebeccapurple: 0x663399,\n\tred: 0xff0000,\n\trosybrown: 0xbc8f8f,\n\troyalblue: 0x4169e1,\n\tsaddlebrown: 0x8b4513,\n\tsalmon: 0xfa8072,\n\tsandybrown: 0xf4a460,\n\tseagreen: 0x2e8b57,\n\tseashell: 0xfff5ee,\n\tsienna: 0xa0522d,\n\tsilver: 0xc0c0c0,\n\tskyblue: 0x87ceeb,\n\tslateblue: 0x6a5acd,\n\tslategray: 0x708090,\n\tslategrey: 0x708090,\n\tsnow: 0xfffafa,\n\tspringgreen: 0x00ff7f,\n\tsteelblue: 0x4682b4,\n\ttan: 0xd2b48c,\n\tteal: 0x008080,\n\tthistle: 0xd8bfd8,\n\ttomato: 0xff6347,\n\tturquoise: 0x40e0d0,\n\tviolet: 0xee82ee,\n\twheat: 0xf5deb3,\n\twhite: 0xffffff,\n\twhitesmoke: 0xf5f5f5,\n\tyellow: 0xffff00,\n\tyellowgreen: 0x9acd32,\n}\n\n/**\n * Return a new [[CubeHelix]].\n *\n * @example chroma.cubehelix() // use the default helix\n * @example chroma.cubehelix().start(200).rotations(-0.5).gamma(0.8).lightness([0.3, 0.8])\n */\nexport function cubehelix(\n\tstart = 300,\n\trotations = -1.5,\n\thue: number | [number, number] = 1,\n\tgamma = 1,\n\tlightness: number | [number, number] = [0, 1],\n) {\n\tconst f: CubeHelix = ((t) => f.at(t)) as CubeHelix\n\t;(Object.getOwnPropertyNames(CubeHelix.prototype) as (keyof typeof CubeHelix)[]).forEach(\n\t\t(key) => (f[key] = CubeHelix.prototype[key]),\n\t)\n\tf.start(start)\n\tf.rotations(rotations)\n\tf.hue(hue)\n\tf.gamma(gamma)\n\tf.lightness(lightness)\n\treturn f\n}\n\n/**\n * [Dave Green's cubehelix color scheme](http://www.mrao.cam.ac.uk/~dag/CUBEHELIX/)!\n *\n * A CubeHelix is a function defined on [0, 1] which returns colors.\n */\nexport interface CubeHelix {\n\t(f: number): Color\n}\nexport class CubeHelix {\n\tprivate _start!: number\n\tprivate _rotations!: number\n\tprivate _gamma!: number\n\tprivate _hue!: [number, number]\n\tprivate _lightness!: [number, number]\n\n\tpublic start(): number\n\tpublic start(s: number): this\n\tpublic start(s?: number) {\n\t\tif (undefined === s) {\n\t\t\treturn this._start\n\t\t}\n\t\tthis._start = s\n\t\treturn this\n\t}\n\n\tpublic rotations(): number\n\tpublic rotations(r: number): this\n\tpublic rotations(r?: number) {\n\t\tif (undefined === r) {\n\t\t\treturn this._rotations\n\t\t}\n\t\tthis._rotations = r\n\t\treturn this\n\t}\n\n\tpublic gamma(): number\n\tpublic gamma(g: number): this\n\tpublic gamma(g?: number) {\n\t\tif (undefined === g) {\n\t\t\treturn this._gamma\n\t\t}\n\t\tthis._gamma = g\n\t\treturn this\n\t}\n\n\tpublic hue(): [number, number]\n\tpublic hue(h: number | [number, number]): this\n\tpublic hue(h?: number | [number, number]) {\n\t\tif (undefined === h) {\n\t\t\treturn this._hue\n\t\t}\n\t\tthis._hue = Array.isArray(h) ? h : [h, h]\n\t\treturn this\n\t}\n\n\tpublic lightness(): [number, number]\n\tpublic lightness(h: number | [number, number]): this\n\tpublic lightness(h?: number | [number, number]) {\n\t\tif (undefined === h) {\n\t\t\treturn this._lightness\n\t\t}\n\t\tthis._lightness = Array.isArray(h) ? h : [h, h]\n\t\treturn this\n\t}\n\n\t/**\n\t * Convert to a [[Scale]].\n\t *\n\t * @example chroma.cubehelix().scale().correctLightness().domain(2, 22)\n\t */\n\tpublic scale() {\n\t\treturn scale(this)\n\t}\n\n\tpublic at(fract: number) {\n\t\tconst a = TWOPI * ((this._start + 120) / 360 + this._rotations * fract)\n\t\tconst l = lerp(this._lightness[0], this._lightness[1], fract) ** this._gamma\n\t\tconst h = lerp(this._hue[0], this._hue[1], fract)\n\t\tconst amp = (h * l * (1 - l)) / 2\n\t\tconst cos_a = cos(a)\n\t\tconst sin_a = sin(a)\n\t\tconst r = l + amp * (-0.14861 * cos_a + 1.78277 * sin_a)\n\t\tconst g = l + amp * (-0.29227 * cos_a - 0.90649 * sin_a)\n\t\tconst b = l + amp * (+1.97294 * cos_a)\n\t\treturn rgb([r * 255, g * 255, b * 255, 1])\n\t}\n}\n\n/**\n * Create a new random [Color] from a random point in the RGB color space.\n * @param randomSource A function which returns random `number`s in the interval [0; 1). Useful if you want to\n *     create a deterministic sequence of \"random\" colors. Defaults to `Math.random`.\n */\nexport function random(randomSource = Math.random) {\n\treturn num((randomSource() * 0x1_00_00_00) | 0)\n}\n\n/**\n * Create a valid RGB color (`.clipped() == false`) from a random point in the CIELAB color space. This results in\n * more colors in the RGB color space where humans can perceive more differences.\n * @param randomSource A function which returns random `number`s in the interval [0; 1). Useful if you want to\n *     create a deterministic sequence of \"random\" colors. Defaults to `Math.random`.\n * @example chroma.random((() => { let i = 0; return () => (i = (i *Math.SQRT2) % 1); })())\n */\n// export function randomLab(randomSource = Math.random) {\n// \tconst labAMin = -87,\n// \t\tlabAMax = 99,\n// \t\tlabBMin = -108,\n// \t\tlabBMax = 95\n// \tlet maxIterations = 100\n// \twhile (maxIterations--) {\n// \t\tconst u = randomSource(),\n// \t\t\tv = randomSource(),\n// \t\t\tw = randomSource()\n// \t\t// The following matrix multiplication transform the random point (u v w) in the unit cube into the\n// \t\t// oriented bounding box (OBB) of the projection of the RGB space into the LAB space. This is necessary to\n// \t\t// avoid a huge number of misses.\n// \t\tconst color = lab(\n// \t\t\tu * -53.903 + v * -88.755 + w * 71.7 + 99.707,\n// \t\t\tu * -82.784 + v * 187.036 + w * -2.422 + -28.17,\n// \t\t\tu * -75.813 + v * -141.406 + w * -48.261 + 152.469,\n// \t\t)\n// \t\tconsole.log(color.lab())\n// \t\tconsole.log(color.rgba(false, false))\n// \t\tif (!color.clipped()) return color\n// \t}\n// \tthrow new Error(\"Could find a random color in 100 iterations\")\n// }\n\n/**\n * Mixes two colors. The mix ratio is a value between 0 and 1.\n * The color mixing produces different results based the color space used for interpolation.\n *\n * @param col2\n * @param f\n * @param m\n * @example chroma.mix('red', 'blue')\n * @example chroma.mix('red', 'blue', 0.25)\n * @example chroma.mix('red', 'blue', 0.75)\n *\n * @example chroma.mix('red', 'blue', 0.5, 'rgb')\n * @example chroma.mix('red', 'blue', 0.5, 'hsl')\n * @example chroma.mix('red', 'blue', 0.5, 'lab')\n * @example chroma.mix('red', 'blue', 0.5, 'lch')\n * @example chroma.mix('red', 'blue', 0.5, 'lrgb')\n */\nexport function mix(col1: Chromable, col2: Chromable, f = 0.5, m: InterpolationMode = \"rgb\") {\n\tconst c1 = color(col1)\n\tconst c2 = color(col2)\n\tconst res = interpolators[m] && ((interpolators as any)[m](c1, c2, f, m) as Color)\n\tif (!res) {\n\t\tthrow new Error(\"color mode \" + m + \" is not supported\")\n\t}\n\treturn res.alpha(lerp(c1.alpha(), c2.alpha(), f))\n}\n\n/**\n * Parse a CSS color. See [MDN](https://developer.mozilla.org/en-US/docs/Web/CSS/color) for all the possible\n * variants.\n *\n * @example chroma.css('hsl(2rad 90% 50% / 0.9)')\n * @example chroma.css('laserlemon')\n */\nexport function css(cssString: string) {\n\tconst [r, g, b, a] = css2rgb(cssString)\n\treturn new Color(r, g, b, a)\n}\n\n/**\n * @example chroma.cmyk(0.2, 0.8, 0, 0)\n * @example chroma.color(0.2, 0.8, 0, 0, 'cmyk')\n */\nexport function cmyk(cmyk: CMYK): Color\nexport function cmyk(cyan1: number, magenta1: number, yellow1: number, key1: number): Color\nexport function cmyk(...args: any[]) {\n\treturn guess(args, \"cmyk\")\n}\n\n/**\n * @example chroma.gl(1, 1, 0, 1)\n */\nexport function gl(gl: RGBA | RGB): Color\n/**\n * @example chroma.gl([1, 0, 1, 0.5])\n */\nexport function gl(red1: number, green1: number, blue1: number, alpha1: number): Color\nexport function gl(...args: any[]) {\n\treturn guess(args, \"gl\")\n}\n\nexport function hcg(hcg: HCG): Color\n/**\n * @param alpha1 default=1\n */\nexport function hcg(h: number, c: number, g: number, alpha1?: number): Color\nexport function hcg(...args: any[]) {\n\treturn guess(args, \"hcg\")\n}\n\nexport function lch(lch: LCH): Color\n/**\n * @param alpha1 default=1\n */\nexport function lch(h: number, c: number, l: number, alpha1?: number): Color\nexport function lch(...args: any[]) {\n\treturn guess(args, \"lch\")\n}\n\nexport function hsi(hsi: HSI): Color\n/**\n * @param alpha1 default=1\n */\nexport function hsi(h: number, s: number, i: number, alpha1?: number): Color\nexport function hsi(...args: any[]) {\n\treturn guess(args, \"hsi\")\n}\n\nexport function hsl(hsl: HSL): Color\n/**\n * @param alpha1 default=1\n * @example chroma.hsl(30, 1, 0.5)\n * @example chroma.hsl(30, 0.6, 0.5)\n */\nexport function hsl(hueDegrees: number, saturation1: number, lightness1: number, alpha1?: number): Color\nexport function hsl(...args: any[]) {\n\treturn guess(args, \"hsl\")\n}\n\nexport function hsv(hsv: LAB): Color\nexport function hsv(h: number, s: number, v: number): Color\nexport function hsv(...args: any[]) {\n\treturn guess(args, \"hsv\")\n}\n\n/**\n *\n * @param temperature\n * @example chroma.kelvin(2000) // candle light\n * @example chroma.kelvin(3500) // sunset\n * @example chroma.kelvin(6500) // daylight\n * @example x0_1 => chroma.kelvin(x0_1 * 30000) // effective range: [0; 30000]\n */\nexport function kelvin(temperature: number) {\n\tconst [r, g, b] = kelvin2rgb(temperature)\n\treturn new Color(r, g, b)\n}\n\nexport function lab(lab: LAB): Color\n/**\n * @param alpha1 default=1\n */\nexport function lab(lightness1: number, a1: number, b: number, alpha1?: number): Color\nexport function lab(...args: any[]) {\n\treturn guess(args, \"lab\")\n}\n\n/**\n * @example chroma.num(0x663399) // rebeccapurple\n */\nexport function num(num: number) {\n\tconst [r, g, b] = num2rgb(num)\n\treturn new Color(r, g, b)\n}\n\nexport function rgb(rgb: RGBA | RGB): Color\n/**\n * @param alpha1 default=1\n * @example chroma.rgb(0, 100, 200)\n */\nexport function rgb(red255: number, green255: number, blue255: number, alpha1?: number): Color\nexport function rgb(...args: any[]) {\n\treturn guess(args, \"rgb\")\n}\n\nexport function xyz(xyz: XYZ): Color\n/** @param alpha1 default=1 */\nexport function xyz(x1: number, y1: number, z1: number, alpha1?: number): Color\nexport function xyz(...args: any[]) {\n\treturn guess(args, \"xyz\")\n}\n\n/**\n * Similar to mix, but accepts more than two colors.\n *\n * @example colors = ['#ddd', 'yellow', 'red', 'teal']\n * @example chroma.average(colors) // default = 'rgb'\n * @example chroma.average(colors, 'lab')\n * @example chroma.average(colors, 'lch')\n * @example chroma.average(colors, 'lrgb')\n * @example chroma.average(['red', 'rgba(0,0,0,0.5)']).css()\n */\nexport function average(chromables: Chromable[], mode: InterpolationMode = \"rgb\") {\n\tconst colors = chromables.map((c) => color(c))\n\tif (mode == \"lrgb\") {\n\t\treturn _average_lrgb(colors)\n\t}\n\tif (mode == \"num\") {\n\t\tlet numSum = 0,\n\t\t\talphaSum = 0\n\t\tfor (const col of colors) {\n\t\t\tnumSum += col.num()\n\t\t\talphaSum += col.alpha()\n\t\t}\n\t\treturn num(numSum / colors.length).alpha(alphaSum / colors.length)\n\t}\n\tconst xyz = [0, 0, 0]\n\tlet dx = 0\n\tlet dy = 0\n\tlet alphaSum = 0\n\tfor (const c of colors) {\n\t\tconst xyz2 = c[mode]()\n\t\talphaSum += c.alpha()\n\n\t\tfor (let i = 0; i < xyz.length; i++) {\n\t\t\tif (mode.charAt(i) == \"h\") {\n\t\t\t\tconst A = xyz2[i] * DEG2RAD\n\t\t\t\tdx += cos(A)\n\t\t\t\tdy += sin(A)\n\t\t\t} else {\n\t\t\t\txyz[i] += xyz2[i]\n\t\t\t}\n\t\t}\n\t}\n\tfor (let i = 0; i < xyz.length; i++) {\n\t\tif (mode.charAt(i) == \"h\") {\n\t\t\tconst A = atan2(dy / colors.length, dx / colors.length) * RAD2DEG\n\t\t\txyz[i] = (A + 360) % 360\n\t\t} else {\n\t\t\txyz[i] = xyz[i] / colors.length\n\t\t}\n\t}\n\treturn guess(xyz, mode).alpha(alphaSum / colors.length)\n}\n\n/**\n *\n * @param chromables\n * @example chroma.scale('black', 'red', 'gold') // linear interpolation\n * @example chroma.bezier('black', 'red', 'gold') // bezier interpolation\n */\nexport function bezier(chromables: Chromable[]): { (t: number): Color; scale(): Scale }\nexport function bezier(...chromables: Chromable[]): { (t: number): Color; scale(): Scale }\nexport function bezier(...args: any[]) {\n\tconst chromables: Chromable[] = Array.isArray(args[0]) ? args[0] : args\n\tconst f = _bezier(chromables) as { (t: number): Color; scale(): Scale }\n\tf.scale = CubeHelix.prototype.scale\n\treturn f\n}\n\n/**\n * Blends two colors using RGB channel-wise blend functions.\n * @param bottom\n * @param top\n * @param mode\n * @example chroma.blend('4CBBFC', 'EEEE22', 'multiply')\n * @example chroma.blend('4CBBFC', 'EEEE22', 'darken')\n * @example chroma.blend('4CBBFC', 'EEEE22', 'lighten')\n */\nexport function blend(bottom: Chromable, top: Chromable, mode: BlendMode) {\n\tif (!blend_fs[mode]) {\n\t\tthrow new Error(\"unknown blend mode \" + mode)\n\t}\n\treturn blend_fs[mode](bottom, top)\n}\nexport type BlendMode = keyof typeof blend_fs\nconst blend_fs = {\n\tnormal: blend_f(each((a, _) => a)),\n\tmultiply: blend_f(each((a, b) => (a * b) / 255)),\n\tscreen: blend_f(each(_screen)),\n\toverlay: blend_f(each(_overlay)),\n\tdarken: blend_f(each(min)),\n\tlighten: blend_f(each(max)),\n\tdodge: blend_f(each(_dodge)),\n\tburn: blend_f(each(_burn)),\n}\n\n/**\n * @param colors\n * @example scale = chroma.scale(['yellow', '008ae5'])\n * @example scale(0.25)\n * @example scale(0.5)\n * @example scale(0.75)\n * @example chroma.scale('Viridis')\n */\nexport function scale(colors: Chromable[] | keyof typeof brewer | ((f: number) => Color)): Scale\nexport function scale(...colors: Chromable[]): Scale\nexport function scale(...args: any[]) {\n\tconst f: Scale = ((t) => (f as any)._at(t)) as Scale\n\t;(Object.getOwnPropertyNames(Scale.prototype) as (keyof typeof Scale)[]).forEach(\n\t\t(key) => (f[key] = Scale.prototype[key]),\n\t)\n\tif (Array.isArray(args[0])) args = args[0]\n\tif (args.length == 1 && \"string\" == typeof args[0]) args = brewer[args[0] as keyof typeof brewer]\n\t;(f as any)._init(\"function\" == typeof args[0] ? args[0] : args.map((a) => color(a)))\n\t//f.setColors(args.length > 1 ? args : args[0])\n\treturn f\n}\n/**\n * A color scale, created with scale, is a function that maps numeric values to a color palette.\n *\n * The type parameter describes the output type and can be changed with out(). Defaults to Color objects.\n *\n * @param T The output format. default=Color\n * @example chroma.scale('Purples')\n * @example chroma.scale('Purples')(0.4)\n */\nexport interface Scale<T = Color> {\n\t(val: number): T\n}\nexport class Scale<T = Color> {\n\tprivate _colors!: Color[] | ((t: number) => Color)\n\tprivate _classes!: number[] | undefined\n\t/**\n\t * Color cache. undefined if the cache should not be used.\n\t */\n\tprivate _cache!: Map<number, Color> | undefined\n\tprivate _correctLightness!: boolean\n\tprivate _gamma!: number\n\tprivate _mode!: InterpolationMode\n\tprivate _out!: ColorFormat | undefined\n\tprivate _min!: number\n\tprivate _max!: number\n\tprivate _paddingLeft!: number\n\tprivate _paddingRight!: number\n\t// positions of the colors on the interval [0, 1]. guaranteed to have the same length as _colors\n\t// undefined when _colors is a function\n\tprivate _pos: number[] | undefined\n\n\t/**\n\t * Get the current scale classes.\n\t */\n\tpublic classes(): number[]\n\t/**\n\t * Make the scale return a number of distint color instead of a continuous gradient.\n\t * If you pass a number the scale will broken into equi-distant classes:\n\t *\n\t * @example chroma.scale('OrRd') // continous\n\t * @example chroma.scale('OrRd').classes(5) // equidistant classes\n\t * @example chroma.scale('OrRd').classes(8)\n\t *\n\t * @example chroma.scale('OrRd').classes([0, 6, 11, 17, 20]) // also sets domain\n\t */\n\tpublic classes(classes: number | number[]): this\n\tpublic classes(classes?: number | number[]) {\n\t\tif (undefined === classes) {\n\t\t\treturn this._classes\n\t\t}\n\t\tif (Array.isArray(classes)) {\n\t\t\tthis._classes = classes\n\t\t\tthis.domain(classes[0], classes[classes.length - 1])\n\t\t} else {\n\t\t\tif (classes % 1 != 0 || classes < 1) throw new Error(\"invalid classes param\")\n\t\t\t// const d = analyze(this.domain())\n\t\t\tthis._classes = limits(this.domain(), \"e\", classes)\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t * Get the domain.\n\t * @return If _colors is a function, [this._min, this._max]. If _colors is an array of colors, an array with the\n\t * same length as the number of colors.\n\t * @example chroma.scale(\"red\", \"white\", \"blue\").domain(0, 20).domain() // == [0, 10, 20]\n\t */\n\tpublic domain(): number[]\n\t/**\n\t * Set the domain interval on which the scale is defined. Colors are distributed equidistantly along the\n\t * interval.\n\t * @param start\n\t * @param end\n\t * @return `this`\n\t * @example chroma.scale(\"red\", \"white\", \"blue\").domain(0, 100)(50) // == white\n\t * @example chroma.scale(\"red\", \"white\", \"blue\").domain(0, 0.25, 1).domain(0, 100).domain() // == [0, 25, 100]\n\t */\n\tpublic domain(start: number, end: number): this\n\t/**\n\t * Set the domain interval and the individual positions of the colors. The number of passed values must match\n\t * the number of colors which define the scale. Not valid if the scale is defined by a function.\n\t * @param domain The positions of all scale colors. Values must be in ascending order and should not have\n\t * duplicates.\n\t * @return `this`\n\t * @example scale = chroma.scale(\"red\", \"white\", \"blue\").domain(0, 25, 100)\n\t * @example scale(25) // == white\n\t * @example scale(100) // == blue\n\t * @example scale(50) // == #aaaaff\n\t */\n\tpublic domain(...domain: number[]): this\n\tpublic domain(...domain: number[]): number[] | this {\n\t\tif (undefined === domain[0]) {\n\t\t\treturn \"function\" !== typeof this._colors\n\t\t\t\t? this._pos!.map((p) => lerp(this._min, this._max, p))\n\t\t\t\t: [this._min, this._max]\n\t\t}\n\t\tthis._min = domain[0]\n\t\tthis._max = domain[domain.length - 1]\n\t\tif (2 == domain.length) {\n\t\t\tif (\"function\" !== typeof this._colors) {\n\t\t\t\t// equidistant positions\n\t\t\t\tthis._pos = this._colors.map((_, c) => c / (this._colors.length - 1))\n\t\t\t}\n\t\t} else if (\"function\" !== typeof this._colors && domain.length == this._colors.length) {\n\t\t\tthis._pos = domain.map((d) => lerpInv(this._min, this._max, d))\n\t\t} else {\n\t\t\tthrow new Error(\"invalid domain \" + domain)\n\t\t}\n\t\treturn this\n\t}\n\n\t/**\n\t * Get the interpolation mode used when calculating colors.\n\t */\n\tpublic mode(): InterpolationMode\n\t/**\n\t * Set the interpolation mode used when calculating colors. The defaut mode is \"rgb\".\n\t * See also {@link chroma#mix}\n\t * @param mode the mode to set.\n\t * @return `this`\n\t * @example chroma.scale(\"red\", \"green\").mode(\"lab\")\n\t * @example chroma.scale(\"red\", \"green\").mode(\"lrgb\")\n\t */\n\tpublic mode(mode: InterpolationMode): this\n\tpublic mode(mode?: InterpolationMode) {\n\t\tif (undefined === mode) {\n\t\t\treturn this._mode\n\t\t}\n\t\tthis._mode = mode\n\t\tthis._resetCache()\n\t\treturn this\n\t}\n\n\t/**\n\t * Set the output format return by `this(x)` and `this.colors(n)`.\n\t * @param outputFormat The color format to use. Pass `undefined` to return [Color] objects.\n\t * @return `this`\n\t * @example chroma.scale(\"red\", \"white\").out(\"hex\")(0) // == \"#ff0000\"\n\t * @example chroma.scale(\"red\", \"white\").out(\"num\").colors(2) // == [0xff0000, 0xffffff]\n\t */\n\tpublic out<M extends ColorFormat | undefined>(\n\t\toutputFormat: M,\n\t): Scale<M extends ColorFormat ? ReturnType<Color[M]> : Color> {\n\t\tthis._out = outputFormat\n\t\treturn this as any\n\t}\n\n\t/**\n\t * This makes sure the lightness range is spread evenly across a color scale. Especially useful when working\n\t * with [multi-hue color scales](https://www.vis4.net/blog/2013/09/mastering-multi-hued-color-scales/), where\n\t * simple gamma correction can't help you very much.\n\t *\n\t * @example chroma.scale('black','red','yellow','white')\n\t * @example chroma.scale('black','red','yellow','white').correctLightness()\n\t */\n\tpublic correctLightness(enableCorrectLightness = true) {\n\t\tif (this._correctLightness != enableCorrectLightness) {\n\t\t\tthis._resetCache()\n\t\t\tconst colors = this._colors\n\t\t\tif (enableCorrectLightness && \"function\" !== typeof colors) {\n\t\t\t\t// make sure that the colors have ascending or descending lightnesses\n\t\t\t\tlet sign = 0\n\t\t\t\tfor (let i = 1; i < colors.length; i++) {\n\t\t\t\t\tconst sign2 = colors[i].lab()[0] - colors[i - 1].lab()[0]\n\t\t\t\t\tif (0 == sign) {\n\t\t\t\t\t\tsign = sign2\n\t\t\t\t\t} else if (sign * sign2 < 0) {\n\t\t\t\t\t\tthrow new Error(\"scale color lightnesses must be monotonic\")\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._correctLightness = enableCorrectLightness\n\t\treturn this\n\t}\n\n\t/**\n\t * Get the padding.\n\t * @returns [paddingLeft, paddingRight]\n\t */\n\tpublic padding(): [number, number]\n\t/**\n\t * Set the padding. Positive values will \"cut off\" the ends of gradient, while negative values will add a\n\t * section of constant color at the ends.\n\t * @example chroma.scale(\"red\", \"white\").padding(0.2)\n\t * @example chroma.scale(\"red\", \"white\").padding(0.1)(0) // == color('#ff1a1a'), instead of red\n\t * @example chroma.scale(\"red\", \"white\").padding(-0.1)(0) // == color('red')\n\t * @param paddingLeft padding on left side.(lower-valued end of the interval).\n\t * @param paddingRight padding on right (higher-valued end of the interval).\n\t * default=paddingLeft\n\t */\n\tpublic padding(paddingLeft: number, paddingRight?: number): this\n\tpublic padding(paddingLeft?: number, paddingRight: number | undefined = paddingLeft) {\n\t\tif (!paddingLeft) {\n\t\t\treturn [this._paddingLeft, this._paddingRight]\n\t\t}\n\t\tthis._paddingLeft = paddingLeft\n\t\tthis._paddingRight = paddingRight!\n\t\treturn this\n\t}\n\n\t/**\n\t * Get a number of equidistant colors.\n\t * @param numColors The number of colors to return.\n\t * @param format Output format. Defaults to `\"hex\"`. Pass `\"color\"` to get {@link Color} objects.\n\t * @returns If `numColors` is `undefined`, the colors which define this [Scale]. If `numColors` is 1,\n\t * `[this((min + max) / 2)]`. Otherwise, an array where the first element is `this(min)`, the last one is\n\t * `this(max)` and the rest are equidistant samples between min and max.\n\t * @example chroma.scale('OrRd').colors(5)\n\t * @example chroma.scale(['white', 'black']).colors(12)\n\t */\n\tpublic colors<M extends ColorFormat | \"color\" | undefined = \"hex\">(\n\t\tnumColors?: number,\n\t\tformat: M = \"hex\" as any,\n\t): Array<M extends ColorFormat ? ReturnType<Color[M]> : M extends \"color\" ? Color : string> {\n\t\tlet result: Color[]\n\t\tif (undefined === numColors) {\n\t\t\tresult = (this._colors as Color[]).slice()\n\t\t} else if (numColors == 1) {\n\t\t\tresult = [this._color((this._min + this._max) / 2)]\n\t\t} else if (numColors > 1) {\n\t\t\tresult = Array.from({ length: numColors }, (_, i) =>\n\t\t\t\tthis._color(lerp(this._min, this._max, i / (numColors - 1))),\n\t\t\t)\n\t\t} else {\n\t\t\t// returns all colors based on the defined classes\n\t\t\tlet samples\n\t\t\tif (this._classes && this._classes.length > 2) {\n\t\t\t\tsamples = Array.from(\n\t\t\t\t\t{ length: this._classes.length - 1 },\n\t\t\t\t\t(_, i) => (this._classes![i] + this._classes![i + 1]) * 0.5,\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\tsamples = this.domain() // TODO?!\n\t\t\t}\n\t\t\tresult = samples.map((s) => this._color(s))\n\t\t}\n\n\t\treturn (format != \"color\" ? result.map((c) => c[format as \"hex\"]()) : result) as any\n\t}\n\n\t/**\n\t * Get whether the cache is enabled. Defaults to true.\n\t */\n\tpublic cache(): boolean\n\t/**\n\t * Enable or disable the cache.\n\t * @param enableCache Whether the cache should be enabled.\n\t */\n\tpublic cache(enableCache: boolean): this\n\tpublic cache(enableCache?: boolean) {\n\t\tif (undefined === enableCache) {\n\t\t\treturn !!this._cache\n\t\t}\n\t\tthis._cache = enableCache ? this._cache || new Map() : undefined\n\t\treturn this\n\t}\n\n\t/**\n\t * Get the current gamma value. Defaults to 1.\n\t */\n\tpublic gamma(): number\n\t/**\n\t * Set the gamma value. Gamma-correction can be used to \"shift\" a scale's center more the the beginning (gamma <\n\t * 1) or end (gamma > 1), typically used to \"even\" the lightness gradient. Default is 1.\n\t * @example chroma.scale('YlGn').gamma(0.5)\n\t * @example chroma.scale('YlGn').gamma(1)\n\t * @example chroma.scale('YlGn').gamma(2)\n\t */\n\tpublic gamma(gamma: number): this\n\tpublic gamma(gamma?: number) {\n\t\tif (undefined === gamma) {\n\t\t\treturn this._gamma\n\t\t}\n\t\tthis._gamma = gamma\n\t\treturn this\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic _at(t: number) {\n\t\tconst c = this._color(t)\n\t\treturn this._out ? c[this._out]() : c\n\t}\n\n\t/**\n\t * @ignore\n\t */\n\tpublic _init(colorsOrFunction: Color[] | ((t: number) => Color)) {\n\t\tthis._colors = colorsOrFunction\n\t\tif (\"function\" != typeof colorsOrFunction) {\n\t\t\tthis._pos = colorsOrFunction.map((_, i) => i / (colorsOrFunction.length - 1))\n\t\t}\n\t\tthis._mode = \"rgb\"\n\t\tthis.domain(0, 1)\n\t\tthis._paddingLeft = 0\n\t\tthis._paddingRight = 0\n\t\tthis._correctLightness = false\n\t\tthis._cache = new Map()\n\t\tthis._gamma = 1\n\t}\n\n\tprivate _getClass(value: number) {\n\t\treturn this._classes!.findIndex((cls) => value <= cls) - 1\n\t}\n\n\tprivate _color(val: number, bypassMap = false) {\n\t\tlet t\n\t\tif (!bypassMap) {\n\t\t\tconst min = this._min,\n\t\t\t\tmax = this._max\n\t\t\tif (this._classes && this._classes.length > 2) {\n\t\t\t\tconst c = this._getClass(val)\n\t\t\t\tt = c / (this._classes.length - 2)\n\t\t\t} else if (max !== min) {\n\t\t\t\tt = (val - min) / (max - min)\n\t\t\t} else {\n\t\t\t\tt = 1\n\t\t\t}\n\t\t\tif (this._correctLightness) {\n\t\t\t\tt = this._tCorrectedLightness(t)\n\t\t\t}\n\t\t} else {\n\t\t\tt = val\n\t\t}\n\t\tt = t ** this._gamma\n\t\tt = (this._paddingLeft + t) / (1 + this._paddingLeft + this._paddingRight)\n\t\t//\tt = this._paddingLeft + t * (1 - this._paddingLeft - this._paddingRight)\n\t\tt = clamp(t, 0, 1)\n\t\tconst tHash = t\n\t\tconst cacheResult = this._cache && this._cache.get(tHash)\n\t\tif (cacheResult) {\n\t\t\treturn cacheResult\n\t\t} else {\n\t\t\tlet col: Color\n\t\t\tif (Array.isArray(this._colors)) {\n\t\t\t\tfor (let i = 0; i < this._pos!.length; i++) {\n\t\t\t\t\tconst p = this._pos![i]\n\t\t\t\t\tif (t <= p) {\n\t\t\t\t\t\tcol = this._colors[i]\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tif (t >= p && i == this._pos!.length - 1) {\n\t\t\t\t\t\tcol = this._colors[i]\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tif (t > p && t < this._pos![i + 1]) {\n\t\t\t\t\t\tt = (t - p) / (this._pos![i + 1] - p)\n\t\t\t\t\t\tcol = mix(this._colors[i], this._colors[i + 1], t, this._mode)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcol = this._colors(t)\n\t\t\t}\n\t\t\tif (this._cache) {\n\t\t\t\t// tslint:disable-next-line\n\t\t\t\tthis._cache.set(tHash, col!)\n\t\t\t}\n\t\t\t// tslint:disable-next-line\n\t\t\treturn col!\n\t\t}\n\t}\n\tprivate _tCorrectedLightness(t0_1: number) {\n\t\tconst L0 = this._color(0, true).lab()[0]\n\t\tconst L1 = this._color(1, true).lab()[0]\n\t\tconst L_ideal = lerp(L0, L1, t0_1)\n\t\treturn bisect((t) => this._color(t, true).lab()[0] - L_ideal, 0, 1, 8)\n\t}\n\tprivate _resetCache() {\n\t\tif (this._cache) this._cache.clear()\n\t}\n}\n\nexport namespace scales {\n\t/**\n\t * @example chroma.scales.cool()\n\t */\n\texport function cool() {\n\t\treturn scale([hsl(180, 1, 0.9), hsl(250, 0.7, 0.4)])\n\t}\n\n\t/**\n\t * @example chroma.scales.hot()\n\t */\n\texport function hot() {\n\t\treturn scale([\"#000\", \"#f00\", \"#ff0\", \"#fff\"]).mode(\"rgb\")\n\t}\n}\n\n/**\n * Computes the WCAG contrast ratio between two colors. A minimum contrast of 4.5:1\n * [is recommended](http://www.w3.org/TR/WCAG20-TECHS/G18.html) to ensure that text is still readable against a\n * background color.\n *\n * @param a\n * @param b\n */\nexport function contrast(a: Chromable, b: Chromable) {\n\tconst l1 = color(a).luminance()\n\tconst l2 = color(b).luminance()\n\tif (l1 > l2) {\n\t\treturn (l1 + 0.05) / (l2 + 0.05)\n\t} else {\n\t\treturn (l2 + 0.05) / (l1 + 0.05)\n\t}\n}\n\n/**\n * Compute the [euclidean distance](https://en.wikipedia.org/wiki/Euclidean_distance#Three_dimensions) between two\n * colors in a given color space.\n * @param a First color.\n * @param b Second color.\n * @param mode The color space in which to compute the distance. Defaults to \"lab\".\n * @example chroma.distance('#fff', '#ff0', 'rgb')\n * @example chroma.distance('#fff', '#f0f', 'rgb')\n * @example chroma.distance('#fff', '#ff0')\n * @example chroma.distance('#fff', '#f0f')\n */\nexport function distance(a: Chromable, b: Chromable, mode: ColorMode = \"lab\") {\n\tconst l1 = color(a)[mode]()\n\tconst l2 = color(b)[mode]()\n\tconst channelDifferences = l1.map((channelValue: number, channelIndex: number) => channelValue - l2[channelIndex])\n\treturn hypot(...channelDifferences)\n}\n\n/**\n * Computes color difference as developed by the Colour Measurement Committee of the Society of Dyers and Colourists\n * (CMC) in 1984. The implementation is adapted from Bruce Lindbloom. The parameters L and C are weighting factors\n * for lightness and chromaticity.\n * @param reference\n * @param sample\n * @param L\n * @param C\n * @example [r = '#ededee', s = '#edeeed', chroma.deltaE(r, s)]\n * @example [r = '#ececee', s = '#eceeec', chroma.deltaE(r, s)]\n * @example [r = '#e9e9ee', s = '#e9eee9', chroma.deltaE(r, s)]\n * @example [r = '#e4e4ee', s = '#e4eee4', chroma.deltaE(r, s)]\n * @example [r = '#e0e0ee', s = '#e0eee0', chroma.deltaE(r, s)]\n */\nexport function deltaE(reference: Chromable, sample: Chromable, L = 1, C = 1) {\n\tconst [L1, a1, b1] = color(reference).lab()\n\tconst [L2, a2, b2] = color(sample).lab()\n\tconst c1 = sqrt(a1 * a1 + b1 * b1)\n\tconst c2 = sqrt(a2 * a2 + b2 * b2)\n\tconst sl = L1 < 16.0 ? 0.511 : (0.040975 * L1) / (1.0 + 0.01765 * L1)\n\tconst sc = (0.0638 * c1) / (1.0 + 0.0131 * c1) + 0.638\n\tconst h1 = norm360(c1 < 0.000001 ? 0.0 : atan2(b1, a1) * RAD2DEG)\n\tconst t =\n\t\th1 >= 164.0 && h1 <= 345.0\n\t\t\t? 0.56 + abs(0.2 * cos((h1 + 168.0) * DEG2RAD))\n\t\t\t: 0.36 + abs(0.4 * cos((h1 + 35.0) * DEG2RAD))\n\tconst c4 = c1 * c1 * c1 * c1\n\tconst f = sqrt(c4 / (c4 + 1900.0))\n\tconst sh = sc * (f * t + 1.0 - f)\n\tconst delL = L1 - L2\n\tconst delC = c1 - c2\n\tconst delA = a1 - a2\n\tconst delB = b1 - b2\n\tconst dH2 = delA * delA + delB * delB - delC * delC\n\tconst v1 = delL / (L * sl)\n\tconst v2 = delC / (C * sc)\n\tconst v3 = sh\n\treturn sqrt(v1 * v1 + v2 * v2 + dH2 / (v3 * v3))\n}\ntype DataInfo = {\n\tmin: number\n\tmax: number\n\tsum: number\n\tvalues: number[]\n\tcount: number\n\tdomain: [number, number]\n\tlimits(mode: LimitsMode, num: number): number[]\n}\nexport function analyze(data: number[]): DataInfo {\n\tconst r: DataInfo = {\n\t\tmin: Infinity,\n\t\tmax: -Infinity,\n\t\tsum: 0,\n\t\tvalues: [] as number[],\n\t\tcount: 0,\n\t} as DataInfo\n\tfunction add(val: number) {\n\t\tif (val != undefined && !isNaN(val)) {\n\t\t\tr.values.push(val)\n\t\t\tr.sum += val\n\t\t\tif (val < r.min) r.min = val\n\t\t\tif (val > r.max) r.max = val\n\t\t\tr.count += 1\n\t\t}\n\t}\n\tdata.forEach((val) => add(val))\n\tr.domain = [r.min, r.max]\n\tr.limits = function (mode, num) {\n\t\treturn limits(this, mode, num)\n\t}\n\treturn r\n}\n\ntype LimitsMode = \"c\" | \"e\" | \"q\" | \"l\" | \"k\"\nexport function limits(data: number[] | DataInfo, mode: LimitsMode = \"e\", num = 7): number[] {\n\tconst info = Array.isArray(data) ? analyze(data) : data\n\tconst { min, max, values } = info\n\tvalues.sort((a, b) => a - b)\n\tif (num == 1) {\n\t\treturn [min, max]\n\t}\n\tif (mode.startsWith(\"c\")) {\n\t\treturn [min, max]\n\t} else if (mode.startsWith(\"e\")) {\n\t\treturn Array.from({ length: num + 1 }, (_, i) => lerp(min, max, i / num))\n\t} else if (mode.startsWith(\"l\")) {\n\t\tif (min <= 0) {\n\t\t\tthrow new Error(\"Logarithmic scales are only possible for values > 0\")\n\t\t}\n\t\tconst min_log = Math.LOG10E * log(min)\n\t\tconst max_log = Math.LOG10E * log(max)\n\t\treturn Array.from({ length: num + 1 }, (_, i) => 10 ** lerp(min_log, max_log, i / num))\n\t} else if (mode.startsWith(\"q\")) {\n\t\treturn Array.from({ length: num + 1 }, (_, i) => {\n\t\t\tconst p = ((values.length - 1) * i) / num\n\t\t\tconst pb = floor(p)\n\t\t\treturn pb == p ? values[pb] : lerp(values[pb], values[pb + 1], p - pb)\n\t\t})\n\t} else if (mode.startsWith(\"k\")) {\n\t\t// implementation based on\n\t\t// http://code.google.com/p/figue/source/browse/trunk/figue.js#336\n\t\t// simplified for 1-d input values\n\t\tconst n = values.length\n\t\tconst assignments = new Array(n)\n\t\tconst clusterSizes = new Array(num)\n\t\tlet repeat = true\n\t\tlet nb_iters = 0\n\t\tlet centroids = Array.from({ length: num + 1 }, (_, i) => lerp(min, max, i / num))\n\t\tdo {\n\t\t\t// assignment step\n\t\t\tclusterSizes.fill(0)\n\t\t\tfor (let i = 0; i < values.length; i++) {\n\t\t\t\tconst value = values[i]\n\t\t\t\tconst minDistIndex = indexOfMax(centroids, (c) => -abs(c - value))\n\t\t\t\tclusterSizes[minDistIndex]++\n\t\t\t\tassignments[i] = minDistIndex\n\t\t\t}\n\n\t\t\t// update centroids step\n\t\t\tconst newCentroids = new Array(num).fill(0)\n\t\t\tfor (let i = 0; i < assignments.length; i++) {\n\t\t\t\tconst cluster = assignments[i]\n\t\t\t\tnewCentroids[cluster] += values[i]\n\t\t\t}\n\t\t\tfor (let j = 0; j < newCentroids.length; j++) {\n\t\t\t\tnewCentroids[j] /= clusterSizes[j]\n\t\t\t}\n\n\t\t\t// check convergence\n\t\t\trepeat = newCentroids.some((nc, j) => nc != centroids[j])\n\t\t\tcentroids = newCentroids\n\t\t} while (nb_iters++ < 200 && repeat)\n\n\t\t// finished k-means clustering\n\t\t// the next part is borrowed from gabrielflor.it\n\t\tconst kClusters: number[][] = Array.from({ length: num }, () => [])\n\t\tfor (let i = 0; i < assignments.length; i++) {\n\t\t\tconst cluster = assignments[i]\n\t\t\tkClusters[cluster].push(values[i])\n\t\t}\n\t\tconst tmpKMeansBreaks = []\n\t\tfor (const kCluster of kClusters) {\n\t\t\ttmpKMeansBreaks.push(kCluster[0], kCluster[kCluster.length - 1])\n\t\t}\n\t\ttmpKMeansBreaks.sort((a, b) => a - b)\n\n\t\tconst limits = []\n\t\tlimits.push(tmpKMeansBreaks[0])\n\t\tfor (let i = 1; i < tmpKMeansBreaks.length; i += 2) {\n\t\t\tconst v = tmpKMeansBreaks[i]\n\t\t\tif (!isNaN(v) && limits.indexOf(v) == -1) {\n\t\t\t\tlimits.push(v)\n\t\t\t}\n\t\t}\n\t\treturn limits\n\t} else {\n\t\tthrow new Error(\"unknown mode\")\n\t}\n}\n\nconst interpolators: { [K in InterpolationMode]?: (color1: Color, color2: Color, f: number, mode: K) => Color } = {}\n\n// const _guess_formats: { p: number; test: (args: any[]) => ColorFormat | undefined }[] = []\nconst _input: {\n\t[mode: string]: (...args: any[]) => RGB | RGBA\n} = {}\n\nfunction linear_interpolator(col1: Color, col2: Color, f: number, m: ColorMode) {\n\tconst xyz1 = col1[m]()\n\tconst xyz2 = col2[m]()\n\treturn guess(\n\t\t[\n\t\t\tlerp(xyz1[0], xyz2[0], f),\n\t\t\tlerp(xyz1[1], xyz2[1], f),\n\t\t\tlerp(xyz1[2], xyz2[2], f),\n\t\t\tlerp(col1.alpha(), col2.alpha(), f),\n\t\t],\n\t\tm,\n\t)\n}\ninterpolators.xyz = interpolators.rgb = interpolators.lab = linear_interpolator\n\ninterpolators.num = function (col1, col2, f) {\n\tconst n1 = col1.num()\n\tconst n2 = col2.num()\n\treturn num(lerp(n1, n2, f))\n}\n\ninterpolators.lrgb = function (col1, col2, f) {\n\tconst [r1, g1, b1, a1] = col1.rgba(false, false)\n\tconst [r2, g2, b2, a2] = col2.rgba(false, false)\n\treturn new Color(\n\t\tsqrt(r1 ** 2 * (1 - f) + r2 ** 2 * f),\n\t\tsqrt(g1 ** 2 * (1 - f) + g2 ** 2 * f),\n\t\tsqrt(b1 ** 2 * (1 - f) + b2 ** 2 * f),\n\t\tlerp(a1, a2, f),\n\t)\n}\n\nfunction _bezier(chromables: Chromable[]): (t: number) => Color {\n\tconst colors = chromables.map((c) => color(c))\n\tconst [lab0, lab1, lab2, lab3] = colors.map((c) => c.lab())\n\tif (2 == chromables.length) {\n\t\t// linear interpolation\n\t\treturn (t) => {\n\t\t\treturn lab([0, 1, 2].map((i) => lerp(lab0[i], lab1[i], t)) as LAB)\n\t\t}\n\t} else if (3 == chromables.length) {\n\t\t// quadratic bezier interpolation\n\t\tconst bezier2 = (p0: number, p1: number, p2: number, t: number) =>\n\t\t\t(1 - t) ** 2 * p0 + 2 * (1 - t) * t * p1 + t ** 2 * p2\n\t\treturn (t) => lab([0, 1, 2].map((i) => bezier2(lab0[i], lab1[i], lab2[i], t)) as LAB)\n\t} else if (4 == chromables.length) {\n\t\t// cubic bezier interpolation\n\t\tconst bezier3 = (p0: number, p1: number, p2: number, p3: number, t: number) =>\n\t\t\t(1 - t) ** 3 * p0 + 3 * (1 - t) ** 2 * t * p1 + 3 * (1 - t) * t ** 2 * p2 + t ** 3 * p3\n\t\treturn (t) => lab([0, 1, 2].map((i) => bezier3(lab0[i], lab1[i], lab2[i], lab3[i], t)) as LAB)\n\t} else if (5 == chromables.length) {\n\t\tconst I0 = _bezier(colors.slice(0, 3))\n\t\tconst I1 = _bezier(colors.slice(2, 5))\n\t\treturn (t) => (t < 0.5 ? I0(t * 2) : I1((t - 0.5) * 2))\n\t} else throw new Error()\n}\n\nfunction guess(args: any[], mode?: ColorFormat): Color {\n\tif (Array.isArray(args[0])) args = args[0]\n\tif (!mode) {\n\t\tif (args.length == 1 && args[0] in w3cx11) {\n\t\t\tmode = \"name\"\n\t\t} else if (args.length == 1 && \"string\" == typeof args[0]) {\n\t\t\tmode = \"css\"\n\t\t} else if (args.length == 3) {\n\t\t\tmode = \"rgb\"\n\t\t} else if (args.length == 4 && \"number\" == typeof args[3] && args[3] >= 0 && args[3] <= 1) {\n\t\t\tmode = \"rgb\"\n\t\t} else if (args.length == 1 && \"number\" == typeof args[0] && args[0] >= 0 && args[0] <= 0xffffff) {\n\t\t\tmode = \"num\"\n\t\t} else throw new Error(\"could not guess mode. args \" + JSON.stringify(args))\n\t}\n\tconst channels = _input[mode](...args)\n\treturn new Color(channels[0], channels[1], channels[2], undefined !== channels[3] ? channels[3] : 1)\n}\n\nfunction _average_lrgb(colors: Color[]) {\n\tlet rSquareSum = 0,\n\t\tgSquareSum = 0,\n\t\tbSquareSum = 0,\n\t\talphaSum = 0\n\tfor (const col of colors) {\n\t\tconst [r, g, b, alpha] = col.rgba(false, false)\n\t\trSquareSum += r ** 2\n\t\tgSquareSum += g ** 2\n\t\tbSquareSum += b ** 2\n\t\talphaSum += alpha\n\t}\n\treturn new Color(\n\t\tsqrt(rSquareSum) / colors.length,\n\t\tsqrt(gSquareSum) / colors.length,\n\t\tsqrt(bSquareSum) / colors.length,\n\t\talphaSum / colors.length,\n\t)\n}\n\nfunction hex2rgb(hex: string): RGBA {\n\tlet m\n\tif ((m = hex.match(/^#?([A-F\\d]{2})([A-F\\d]{2})([A-F\\d]{2})([A-F\\d]{2})?$/i))) {\n\t\treturn [parseInt(m[1], 16), parseInt(m[2], 16), parseInt(m[3], 16), m[4] ? parseInt(m[4], 16) / 255 : 1]\n\t} else if ((m = hex.match(/^#?([A-F\\d])([A-F\\d])([A-F\\d])([A-F\\d])?$/i))) {\n\t\treturn [\n\t\t\tparseInt(m[1], 16) * 0x11,\n\t\t\tparseInt(m[2], 16) * 0x11,\n\t\t\tparseInt(m[3], 16) * 0x11,\n\t\t\tm[4] ? (parseInt(m[4], 16) * 0x11) / 255 : 1,\n\t\t]\n\t}\n\tthrow new Error(\"invalid hex color: \" + hex)\n}\n// color mode, i.e. representation as array of number\nexport type ColorMode = \"rgb\" | \"cmyk\" | \"lab\" | \"hsv\" | \"hsi\" | \"hcg\" | \"hsl\" | \"gl\" | \"lch\" | \"xyz\"\nexport type InterpolationMode = \"rgb\" | \"lab\" | \"hsv\" | \"hsi\" | \"hcg\" | \"hsl\" | \"lch\" | \"xyz\" | \"lrgb\" | \"num\"\nexport type ColorFormat = ColorMode | \"hex\" | \"num\" | \"name\" | \"kelvin\" | \"css\"\n/**\n * CMYK color space\n * @see https://en.wikipedia.org/wiki/cmyk_color_model\n * [cyan, magenta, yellow, alpha1]\n */\ntype CMYK = [number, number, number, number]\n/**\n * WebGL colors. Like RGB, but floats in [0; 1] instead of 0-255.\n * [red255, green255, blue255, alpha1]\n */\ntype GL = [number, number, number, number]\n/**\n * Red, green, blue ranging from 0-255.\n * Can be floats and outside the above range internally.\n */\ntype RGB = [number, number, number]\n/**\n * RGB plus alpha ranging from 0-1\n * [red255, green255, blue255, alpha1]\n */\ntype RGBA = [number, number, number, number]\n/**\n * CIELAB color space\n * [lightness, A*, B*]\n * @see https://en.wikipedia.org/wiki/CIELAB_color_space\n */\ntype LAB = [number, number, number]\n/**\n * Cylindrical representation of CIELAB\n * @see https://en.wikipedia.org/wiki/CIELAB_color_space#Cylindrical_representation:_CIELCh_or_CIEHLC\n *\n */\ntype LCH = [number, number, number]\n/**\n * @see https://en.wikipedia.org/wiki/HSL_and_HSV\n * [hueDegrees, saturation1, lightness1]\n */\ntype HSL = [number, number, number]\n/**\n * @see https://en.wikipedia.org/wiki/HSL_and_HSV\n * [hueDegrees, saturation1, value1]\n */\ntype HSV = [number, number, number]\n/**\n * @see https://en.wikipedia.org/w/index.php?title=HSI_color_space&redirect=no\n * [hueDegrees, saturation1, intensity1]\n */\ntype HSI = [number, number, number]\ntype XYZ = [number, number, number]\n/**\n * HCG Color Model\n * See https://github.com/acterhd/hcg-color\n * A color value in the HCG format is an array of three numbers [h, c, g], where\n * `h` is the hue as an angle in degrees [0; 360)\n * `c` is the chroma value in [0; 1]\n * `g` is the gray value in [0; 1]\n */\ntype HCG = [number, number, number]\n\n// interface ColorModes {\n// \tcmyk: CMYK\n// \tgl: GL\n// \trgb: RGB\n// \trgba: RGBA\n// \tlab: LAB\n// \thsl: HSL\n// \thsv: HSV\n// \thsi: HSI\n// \txyz: XYZ\n// \thcg: HCG\n// \tlch: LCH\n// \thex: string\n// \tnum: number\n// \tname: string\n// \tkelvin: number\n// \tcss: string\n// }\nfunction rgb2hex(r255: number, g255: number, b255: number, a1: number, mode: \"rgb\" | \"rgba\" | \"argb\" = \"rgb\") {\n\tr255 = clamp(round(r255), 0, 255)\n\tg255 = clamp(round(g255), 0, 255)\n\tb255 = clamp(round(b255), 0, 255)\n\tconst rgb = (r255 << 16) | (g255 << 8) | b255\n\tconst rgbString = rgb.toString(16).padStart(6, \"0\")\n\tconst alphaString = round(clamp(a1) * 255)\n\t\t.toString(16)\n\t\t.padStart(2, \"0\")\n\treturn \"#\" + (\"argb\" == mode ? alphaString + rgbString : \"rgba\" == mode ? rgbString + alphaString : rgbString)\n}\n\n_input.lrgb = _input.rgb\n\n_input.hex = hex2rgb\n_input.hsl = hsl2rgb\nfunction norm360(degrees: number) {\n\treturn ((degrees % 360) + 360) % 360\n}\n\n_input.hsv = hsv2rgb\n\nfunction num2rgb(num: number): RGBA {\n\tif (!(\"number\" == typeof num && num >= 0 && num <= 0xffffff)) {\n\t\tthrow new Error(\"unknown num color: \" + num)\n\t}\n\tconst r = num >> 16\n\tconst g = (num >> 8) & 0xff\n\tconst b = num & 0xff\n\treturn [r, g, b, 1]\n}\n\nfunction rgb2num(r255: number, g255: number, b255: number, a1: number = 1, mode: \"rgb\" | \"rgba\" | \"argb\" = \"rgb\") {\n\tconst rgbNum = (round(r255) << 16) | (round(g255) << 8) | round(b255)\n\tif (\"rgb\" === mode) {\n\t\treturn rgbNum\n\t} else if (\"rgba\" === mode) {\n\t\treturn (rgbNum << 8) | (round(a1 * 255) << 24)\n\t} else {\n\t\treturn (round(a1 * 255) << 24) | rgbNum\n\t}\n}\n\n_input.num = num2rgb\n\nconst WS = \"\\\\s*\"\nconst FLOAT = \"([+-]?(?:\\\\d*\\\\.?)?\\\\d+(?:[eE][+-]?\\\\d+)?)\"\nconst CSS_RGB_REGEX = new RegExp(\n\t[\"^rgba?\\\\(\", FLOAT, \",\", FLOAT, \",\", FLOAT, \"(?:,\", FLOAT + \"(%)?\", \")?\\\\)$\"].join(WS),\n\t\"i\",\n)\nconst CSS_RGB_WS_REGEX = new RegExp([\"^rgba?\\\\(\", FLOAT, FLOAT, FLOAT, \"(?:/\", FLOAT + \"(%)?\", \")?\\\\)$\"].join(WS), \"i\")\nconst CSS_RGB_PERCENT_REGEX = new RegExp(\n\t[\"^rgba?\\\\(\", FLOAT + \"%\", \",\", FLOAT + \"%\", \",\", FLOAT + \"%\", \"(?:,\", FLOAT + \"(%)?\", \")?\\\\)$\"].join(WS),\n\t\"i\",\n)\nconst CSS_RGB_WS_PERCENT_REGEX = new RegExp(\n\t[\"^rgba?\\\\(\", FLOAT + \"%\", FLOAT + \"%\", FLOAT + \"%\", \"(?:/\", FLOAT + \"(%)?\", \")?\\\\)$\"].join(WS),\n\t\"i\",\n)\nconst CSS_HSL_REGEX = new RegExp(\n\t[\"^hsla?\\\\(\", FLOAT + \"(deg|rad|turn)?\", \",\", FLOAT + \"%\", \",\", FLOAT + \"%\", \"(?:,\", FLOAT + \"(%)?\", \")?\\\\)$\"].join(\n\t\tWS,\n\t),\n\t\"i\",\n)\nconst CSS_HSL_WS_REGEX = new RegExp(\n\t[\"^hsla?\\\\(\", FLOAT + \"(deg|rad|turn)?\\\\s+\" + FLOAT + \"%\", FLOAT + \"%\", \"(?:/\", FLOAT + \"(%)?\", \")?\\\\)$\"].join(WS),\n\t\"i\",\n)\nfunction css2rgb(css: string): RGBA {\n\tif (w3cx11 && w3cx11.hasOwnProperty(css)) {\n\t\treturn num2rgb((w3cx11 as any)[css.toLowerCase()])\n\t}\n\tlet m\n\tif ((m = css.match(CSS_RGB_REGEX) || css.match(CSS_RGB_WS_REGEX))) {\n\t\treturn [\n\t\t\tclamp(+m[1], 0, 255),\n\t\t\tclamp(+m[2], 0, 255),\n\t\t\tclamp(+m[3], 0, 255),\n\t\t\tm[4] ? clamp(m[5] ? +m[4] / 100 : +m[4]) : 1,\n\t\t]\n\t} else if ((m = css.match(CSS_RGB_PERCENT_REGEX) || css.match(CSS_RGB_WS_PERCENT_REGEX))) {\n\t\treturn [\n\t\t\tclamp(+m[1] / 100) * 255,\n\t\t\tclamp(+m[2] / 100) * 255,\n\t\t\tclamp(+m[3] / 100) * 255,\n\t\t\tm[4] ? clamp(m[5] ? +m[4] / 100 : +m[4]) : 1,\n\t\t]\n\t} else if ((m = css.match(CSS_HSL_REGEX) || css.match(CSS_HSL_WS_REGEX))) {\n\t\tconst CONVERSION = { deg: 1, rad: RAD2DEG, turn: 360 }\n\t\tconst angleUnit = (m[2] ? m[2].toLowerCase() : \"deg\") as \"deg\" | \"rad\" | \"turn\"\n\t\treturn hsl2rgb(\n\t\t\t(((+m[1] * CONVERSION[angleUnit]) % 360) + 360) % 360,\n\t\t\tclamp(+m[3] / 100),\n\t\t\tclamp(+m[4] / 100),\n\t\t\tm[5] ? clamp(m[6] ? +m[5] / 100 : +m[5]) : 1,\n\t\t)\n\t} else {\n\t\treturn hex2rgb(css)\n\t}\n}\n\nfunction rgb2css(r: number, g: number, b: number, a = 1) {\n\tif (a >= 1) {\n\t\treturn \"rgb(\" + [r, g, b].map(round).join(\",\") + \")\"\n\t} else {\n\t\treturn \"rgba(\" + [r, g, b].map(round).join(\",\") + \",\" + a + \")\"\n\t}\n}\n\nfunction rnd(a: any) {\n\treturn round(a * 100) / 100\n}\n\nfunction hsl2css([h, s, l]: HSL, alpha: number) {\n\tconst mode = alpha < 1 ? \"hsla\" : \"hsl\"\n\treturn (\n\t\tmode +\n\t\t\"(\" +\n\t\trnd(h) +\n\t\t\",\" +\n\t\trnd(s * 100) +\n\t\t\"%\" +\n\t\t\",\" +\n\t\trnd(l * 100) +\n\t\t\"%\" +\n\t\t(\"hsla\" == mode ? \",\" + rnd(alpha) : \"\") +\n\t\t\")\"\n\t)\n}\n\n_input.css = css2rgb\n\n_input.name = function (name) {\n\treturn num2rgb((w3cx11 as any)[name])\n}\n\nfunction lch2lab(l: number, c: number, hueDegrees: number): LAB {\n\t/*\n    Convert from a qualitative parameter h and a quantitative parameter l to a 24-bit pixel.\n    These formulas were invented by David Dalrymple to obtain maximum contrast without going\n    out of gamut if the parameters are in the range 0-1.\n\n    A saturation multiplier was added by Gregor Aisch\n     */\n\treturn [l, cos(hueDegrees * DEG2RAD) * c, sin(hueDegrees * DEG2RAD) * c]\n}\n\nfunction lch2rgb(l: number, c: number, hDegrees: number, alpha1 = 1): RGBA {\n\tconst [, a, b] = lch2lab(l, c, hDegrees)\n\treturn cielab2rgb(l, a, b, alpha1)\n}\n\nfunction lab2lch(l: number, a: number, b: number): LCH {\n\tconst c = hypot(a, b)\n\tconst h = (atan2(b, a) * RAD2DEG + 360) % 360\n\treturn [l, c, h]\n}\n\nfunction rgb2lch(r255: number, g255: number, b255: number) {\n\tconst [l, a, b2] = rgb2lab(r255, g255, b255)\n\treturn lab2lch(l, a, b2)\n}\n\n_input.lch = lch2rgb\n\nfunction rgb2cmyk(r255: number, g255: number, b255: number): CMYK {\n\tr255 /= 255\n\tg255 /= 255\n\tb255 /= 255\n\tconst k = 1 - max(r255, g255, b255)\n\tif (1 == k) return [0, 0, 0, 1]\n\tconst c = (1 - r255 - k) / (1 - k)\n\tconst m = (1 - g255 - k) / (1 - k)\n\tconst y = (1 - b255 - k) / (1 - k)\n\treturn [c, m, y, k]\n}\n\nfunction cmyk2rgb(c1: number, m1: number, y1: number, k1: number, alpha1 = 1): RGBA {\n\tif (k1 == 1) {\n\t\treturn [0, 0, 0, alpha1]\n\t}\n\tconst r255 = 255 * (1 - c1) * (1 - k1)\n\tconst g255 = 255 * (1 - m1) * (1 - k1)\n\tconst b255 = 255 * (1 - y1) * (1 - k1)\n\treturn [r255, g255, b255, alpha1]\n}\n\n_input.cmyk = cmyk2rgb\n\n_input.gl = function (r: number, g: number, b: number, a: number = 1): RGBA {\n\treturn [r * 255, g * 255, b * 255, a]\n}\n\n//function rgb2luminance(r: number, g: number, b: number) {\n//\t// https://en.wikipedia.org/wiki/Relative_luminance\n//\tconst [, Y] = rgb2xyz(r, g, b)\n//\treturn Y\n//}\n\nfunction rgbChannel2RgbLinear(x255: number) {\n\tconst x1 = x255 / 255\n\t// http://entropymine.com/imageworsener/srgbformula/\n\tif (x1 <= 0.04045) {\n\t\treturn x1 / 12.92\n\t} else {\n\t\treturn ((x1 + 0.055) / 1.055) ** 2.4\n\t}\n}\nfunction rgbLinearChannel2Rgb(xLinear1: number) {\n\tif (xLinear1 <= 0.0031308) {\n\t\treturn 255 * (12.92 * xLinear1)\n\t} else {\n\t\treturn 255 * ((1 + 0.055) * xLinear1 ** (1 / 2.4) - 0.055)\n\t}\n}\n\nfunction kelvin2rgb(kelvin: number): RGB {\n\tconst t = kelvin / 100\n\tlet r, g, b\n\tif (t < 66) {\n\t\tr = 255\n\t\tg = -155.25485562709179 - 0.44596950469579133 * (t - 2) + 104.49216199393888 * log(t - 2)\n\t\tb = t < 20 ? 0 : -254.76935184120902 + 0.8274096064007395 * (t - 10) + 115.67994401066147 * log(t - 10)\n\t} else {\n\t\tr = 351.97690566805693 + 0.114206453784165 * (t - 55) - 40.25366309332127 * log(t - 55)\n\t\tg = 325.4494125711974 + 0.07943456536662342 * (t - 50) - 28.0852963507957 * log(t - 50)\n\t\tb = 255\n\t}\n\treturn [r, g, b]\n}\n\n_input.rgb = (...args: number[]) => args as RGB\n\nfunction rgb2kelvin(r255: number, g255: number, b255: number) {\n\tconsole.log(b255 - r255)\n\tif (g255 + b255 < 158.61) {\n\t\tconsole.log(\"0 < t < 20\")\n\t\t// calc from green\n\t\treturn round(\n\t\t\tnewtonIterate1d(\n\t\t\t\t(t) => g255 - (-155.25485562709179 - 0.44596950469579133 * (t - 2) + 104.49216199393888 * log(t - 2)),\n\t\t\t\t15,\n\t\t\t\t4,\n\t\t\t) * 100,\n\t\t)\n\t\treturn (Math.E ** ((g255 + 155.25485562709179 + 0.44596950469579133 * (15 - 2)) / 104.49216199393888) + 2) * 100\n\t} else if (b255 - r255 < 0) {\n\t\tconsole.log(\"20 < t < 66\")\n\t\treturn round(\n\t\t\tnewtonIterate1d(\n\t\t\t\t(t) => b255 - (-254.76935184120902 + 0.8274096064007395 * (t - 10) + 115.67994401066147 * log(t - 10)),\n\t\t\t\t43,\n\t\t\t\t4,\n\t\t\t) * 100,\n\t\t)\n\t\treturn (\n\t\t\t(Math.E ** ((b255 + 254.76935184120902 - 0.8274096064007395 * (43 - 10)) / 115.67994401066147) + 10) * 100\n\t\t)\n\t} else {\n\t\tconsole.log(\"0 < t < 400, start= \" + (-1.4 * (r255 + g255) + 755))\n\t\treturn round(\n\t\t\tnewtonIterate1d(\n\t\t\t\t(t) => r255 - (351.97690566805693 + 0.114206453784165 * (t - 55) - 40.25366309332127 * log(t - 55)),\n\t\t\t\t-1.4 * (r255 + g255) + 755,\n\t\t\t\t8,\n\t\t\t) * 100,\n\t\t)\n\t\treturn ((r255 / 329.698727446) ** (1 / -0.1332047592) + 60) * 100\n\t}\n\treturn newtonIterate1d(\n\t\t(k) => {\n\t\t\tconst eps = 1e-9\n\t\t\tconst [kr, kg, kb] = kelvin2rgb(k)\n\t\t\tconst [kr2, kg2, kb2] = kelvin2rgb(k + eps)\n\t\t\tconst dkr = (kr2 - kr) / eps,\n\t\t\t\tdkg = (kg2 - kg) / eps,\n\t\t\t\tdkb = (kb2 - kb) / eps\n\t\t\treturn dkr * (kr - r255) + dkg * (kg - g255) + dkb * (kb - b255)\n\n\t\t\treturn kb / kr - b255 / r255\n\t\t},\n\t\t//1000,\n\t\t//40000,\n\t\tMath.E ** ((b255 / r255 + 2.5) / 0.4),\n\t\t20,\n\t\t//1e-6,\n\t)\n\tlet maxTemp = 40000\n\tlet minTemp = 1000\n\tconst eps = 0.4\n\tlet temp: number = 0\n\tlet rgb\n\twhile (maxTemp - minTemp > eps) {\n\t\ttemp = (maxTemp + minTemp) * 0.5\n\t\trgb = kelvin2rgb(temp)\n\t\tif (rgb[2] / rgb[0] >= b255 / r255) {\n\t\t\tmaxTemp = temp\n\t\t} else {\n\t\t\tminTemp = temp\n\t\t}\n\t}\n\treturn round(temp)\n}\n\n_input.temperature = _input.kelvin = _input.K = kelvin2rgb\n\nfunction blend_f(f: (c1: RGB, c2: RGB) => RGB) {\n\treturn function (bottom: Chromable, top: Chromable) {\n\t\tconst [r, g, b] = f(color(top).rgb(), color(bottom).rgb())\n\t\treturn rgb(r, g, b)\n\t}\n}\n\nfunction each(f: (a: number, b: number) => number) {\n\treturn function (c1: RGB, c2: RGB): RGB {\n\t\treturn c1.map((e, i) => f(e, c2[i])) as RGB\n\t}\n}\n\nfunction _screen(a: number, b: number) {\n\treturn 255 * (1 - (1 - a / 255) * (1 - b / 255))\n}\n\nfunction _overlay(a: number, b: number) {\n\tif (b < 128) {\n\t\treturn (2 * a * b) / 255\n\t} else {\n\t\treturn 255 * (1 - 2 * (1 - a / 255) * (1 - b / 255))\n\t}\n}\n\nfunction _burn(a: number, b: number) {\n\treturn 255 * (1 - (1 - b / 255) / (a / 255))\n}\n\nfunction _dodge(a: number, b: number) {\n\tif (a == 255) {\n\t\treturn 255\n\t}\n\treturn 255 * min(1, b / 255 / (1 - a / 255))\n}\n\n/**\n * r, g, b can be in any interval (0-1 or 0-255)\n * @param r\n * @param g\n * @param b\n */\nfunction rgb2hexhue(r: number, g: number, b: number) {\n\tconst m = min(r, g, b)\n\tconst M = max(r, g, b)\n\tconst delta = M - m\n\tlet hueTurnX6 // angle as value between 0 and 6\n\tif (0 == delta) {\n\t\thueTurnX6 = 0\n\t} else if (r == M) {\n\t\t// second term to make sure the value is > 0\n\t\thueTurnX6 = (g - b) / delta + (g < b ? 6 : 0)\n\t} else if (g == M) {\n\t\thueTurnX6 = 2 + (b - r) / delta\n\t} else {\n\t\thueTurnX6 = 4 + (r - g) / delta\n\t}\n\treturn [hueTurnX6 * 60, m, M]\n}\nfunction hcxm2rgb(hueDegrees: number, c1: number, x1: number, m1: number, alpha1: number): RGBA {\n\tconst m255 = m1 * 255\n\tconst cm255 = c1 * 255 + m255\n\tconst xm255 = x1 * 255 + m255\n\tif (hueDegrees < 60) {\n\t\treturn [cm255, xm255, m255, alpha1]\n\t} else if (hueDegrees < 120) {\n\t\treturn [xm255, cm255, m255, alpha1]\n\t} else if (hueDegrees < 180) {\n\t\treturn [m255, cm255, xm255, alpha1]\n\t} else if (hueDegrees < 240) {\n\t\treturn [m255, xm255, cm255, alpha1]\n\t} else if (hueDegrees < 300) {\n\t\treturn [xm255, m255, cm255, alpha1]\n\t} else {\n\t\treturn [cm255, m255, xm255, alpha1]\n\t}\n}\n\n/**\n * https://en.wikipedia.org/w/index.php?title=HSL_and_HSV&oldid=856714654#From_HSL\n */\nfunction hsl2rgb(hueDegrees: number, s1: number, l1: number, alpha1 = 1): RGBA {\n\thueDegrees = norm360(hueDegrees)\n\tconst c1 = (1 - abs(2 * l1 - 1)) * s1\n\treturn hcxm2rgb(hueDegrees, c1, c1 * (1 - abs(((hueDegrees / 60) % 2) - 1)), l1 - c1 / 2, alpha1)\n}\nfunction rgb2hsl(r255: number, g255: number, b255: number): HSL {\n\tconst [hue, min1, max1] = rgb2hexhue(r255 / 255, g255 / 255, b255 / 255)\n\tconst l1 = (max1 + min1) / 2\n\tlet s1: number\n\tif (max1 == min1) {\n\t\ts1 = 0\n\t} else {\n\t\ts1 = l1 < 0.5 ? (max1 - min1) / (max1 + min1) : (max1 - min1) / (2 - max1 - min1)\n\t}\n\treturn [hue, s1, l1]\n}\n\nfunction hsv2rgb(hueDegrees: number, s1: number, v1: number, alpha1: number = 1): RGBA {\n\thueDegrees = norm360(hueDegrees)\n\tconst c1 = v1 * s1\n\treturn hcxm2rgb(hueDegrees, c1, c1 * (1 - abs(((hueDegrees / 60) % 2) - 1)), v1 - c1, alpha1)\n}\n\nfunction rgb2hsv(r255: number, g255: number, b255: number): HSV {\n\tconst [hue, min255, max255] = rgb2hexhue(r255, g255, b255)\n\tconst delta255 = max255 - min255\n\tconst v1 = max255 / 255.0\n\tconst s1 = max255 == 0 ? 0 : delta255 / max255\n\treturn [hue, s1, v1]\n}\n\nfunction hcg2rgb(hueDegrees: number, c1: number, g1: number, alpha1 = 1): RGBA {\n\thueDegrees = norm360(hueDegrees)\n\tconst p = g1 * (1 - c1)\n\treturn hcxm2rgb(hueDegrees, c1, c1 * (1 - abs(((hueDegrees / 60) % 2) - 1)), p, alpha1)\n}\n\nfunction rgb2hcg(r255: number, g255: number, b255: number): HCG {\n\tconst [hue, min255, max255] = rgb2hexhue(r255, g255, b255)\n\tconst c1 = (max255 - min255) / 255\n\tconst _g1 = c1 < 1 ? min255 / 255 / (1 - c1) : 0\n\treturn [hue, c1, _g1]\n}\n\n_input.hcg = hcg2rgb\n\nfunction cielab2rgb(LStar100: number, aStar: number, bStar: number, alpha = 1): RGBA {\n\tconst [x, y, z] = cielab2xyz(LStar100, aStar, bStar)\n\treturn xyz2rgb(x, y, z, alpha)\n}\n\nfunction cielab2xyz(LStar100: number, aStar: number, bStar: number) {\n\tfunction fInv(t: number) {\n\t\tif (t > LAB_delta) {\n\t\t\treturn t ** 3\n\t\t} else {\n\t\t\treturn LAB_3DeltaPow2 * (t - 4 / 29)\n\t\t}\n\t}\n\treturn [\n\t\tLAB_Xn * fInv((LStar100 + 16) / 116 + aStar / 500),\n\t\tLAB_Yn * fInv((LStar100 + 16) / 116),\n\t\tLAB_Zn * fInv((LStar100 + 16) / 116 - bStar / 200),\n\t]\n}\nfunction xyz2cielab(x: number, y: number, z: number): LAB {\n\t// https://en.wikipedia.org/w/index.php?title=CIELAB_color_space&oldid=849576085#Forward_transformation\n\tfunction f(t: number) {\n\t\tif (t > LAB_deltaPow3) {\n\t\t\treturn cbrt(t)\n\t\t} else {\n\t\t\treturn t / LAB_3DeltaPow2 + 4 / 29\n\t\t}\n\t}\n\treturn [116 * f(y / LAB_Yn) - 16, 500 * (f(x / LAB_Xn) - f(y / LAB_Yn)), 200 * (f(y / LAB_Yn) - f(z / LAB_Zn))]\n}\n\n// const LAB_CONSTANTS = {\nconst LAB_Kn = 18\nconst LAB_Xn = 0.95047\nconst LAB_Yn = 1\nconst LAB_Zn = 1.08883\nconst LAB_delta = 0.206896552 // delta = 6 / 29\nconst LAB_3DeltaPow2 = 0.12841855 // 3 * delta ** 2\nconst LAB_deltaPow3 = 0.008856452 // delta ** 3\n// }\n\nfunction rgb2lab(r255: number, g255: number, b255: number): RGB {\n\tconst [x, y, z] = rgb2xyz(r255, g255, b255)\n\treturn xyz2cielab(x, y, z)\n}\n\nfunction rgb2xyz(r255: number, g255: number, b255: number): XYZ {\n\t// https://en.wikipedia.org/wiki/SRGB#The_reverse_transformation\n\tconst r1Linear = rgbChannel2RgbLinear(r255)\n\tconst g1Linear = rgbChannel2RgbLinear(g255)\n\tconst b1Linear = rgbChannel2RgbLinear(b255)\n\tconst X = 0.4124564 * r1Linear + 0.3575761 * g1Linear + 0.1804375 * b1Linear\n\tconst Y = 0.2126729 * r1Linear + 0.7151522 * g1Linear + 0.072175 * b1Linear\n\tconst Z = 0.0193339 * r1Linear + 0.119192 * g1Linear + 0.9503041 * b1Linear\n\treturn [X, Y, Z]\n}\nfunction xyz2rgb(X1: number, Y1: number, Z1: number, alpha1 = 1): RGBA {\n\t// https://en.wikipedia.org/wiki/SRGB#The_forward_transformation_(CIE_XYZ_to_sRGB)\n\tconst r1Linear = 3.2404542 * X1 - 1.5371385 * Y1 - 0.4985314 * Z1\n\tconst g1Linear = -0.969266 * X1 + 1.8760108 * Y1 + 0.041556 * Z1\n\tconst b1Linear = 0.0556434 * X1 - 0.2040259 * Y1 + 1.0572252 * Z1\n\treturn [rgbLinearChannel2Rgb(r1Linear), rgbLinearChannel2Rgb(g1Linear), rgbLinearChannel2Rgb(b1Linear), alpha1]\n}\n\n_input.xyz = xyz2rgb\n_input.lab = cielab2rgb\n\n/**\n * For HSI, we use the direct angle calculation. I.e. atan2(beta, alpha). See wikipedia link. This is why we don't use\n * hcxm2rgb.\n */\nfunction hsi2rgb(hueDegrees: number, s1: number, i1: number, alpha1 = 1): RGBA {\n\t/*\n    borrowed from here:\n    http://hummer.stanford.edu/museinfo/doc/examples/humdrum/keyscape2/hsi2rgb.cpp\n     */\n\tlet r, g, b\n\tlet hRad = hueDegrees * DEG2RAD\n\tif (hRad < (2 * PI) / 3) {\n\t\tb = (1 - s1) / 3\n\t\tr = (1 + (s1 * cos(hRad)) / cos(PI / 3 - hRad)) / 3\n\t\tg = 1 - (b + r)\n\t} else if (hRad < (4 * PI) / 3) {\n\t\thRad -= (2 * PI) / 3\n\t\tr = (1 - s1) / 3\n\t\tg = (1 + (s1 * cos(hRad)) / cos(PI / 3 - hRad)) / 3\n\t\tb = 1 - (r + g)\n\t} else {\n\t\thRad -= (4 * PI) / 3\n\t\tg = (1 - s1) / 3\n\t\tb = (1 + (s1 * cos(hRad)) / cos(PI / 3 - hRad)) / 3\n\t\tr = 1 - (g + b)\n\t}\n\treturn [3 * i1 * r * 255, 3 * i1 * g * 255, 3 * i1 * b * 255, alpha1]\n}\n\n/**\n * For HSI, we use the direct angle calculation. I.e. atan2(beta, alpha). See wikipedia link. This is why we don't use\n * rgb2hexhue.\n */\nfunction rgb2hsi(r255: number, g255: number, b255: number): HSI {\n\t// See https://en.wikipedia.org/wiki/HSL_and_HSV#Hue_and_chroma\n\t// See https://en.wikipedia.org/wiki/HSL_and_HSV#Lightness\n\tconst r1 = r255 / 255\n\tconst g1 = g255 / 255\n\tconst b1 = b255 / 255\n\tconst i1 = (r1 + g1 + b1) / 3\n\tif (r1 == g1 && g1 == b1) {\n\t\treturn [0, 0, i1]\n\t} else {\n\t\tconst alpha = (1 / 2) * (2 * r1 - g1 - b1)\n\t\tconst beta = (sqrt(3) / 2) * (g1 - b1)\n\t\tconst hRad = atan2(beta, alpha)\n\t\tconst min1 = min(r1, g1, b1)\n\t\tconst s1 = 1 - min1 / i1\n\t\treturn [(hRad < 0 ? 2 * PI + hRad : hRad) * RAD2DEG, s1, i1]\n\t}\n}\n\n_input.hsi = hsi2rgb\n\ninterpolators.hsv = interpolators.hsl = interpolators.hsi = interpolators.lch = interpolators.hcg = function interpolate_hsx(\n\tcolor1: Color,\n\tcolor2: Color,\n\tf: number,\n\tm: \"hsv\" | \"hsl\" | \"hsi\" | \"lch\" | \"hcg\",\n) {\n\tconst [a1, b1, c1] = color1[m]()\n\tconst [a2, b2, c2] = color2[m]()\n\tfunction lerpHue(hue1: number, hue2: number, f: number) {\n\t\tconst dh = norm360(hue2 - hue1 + 180) - 180\n\t\treturn hue1 + f * dh\n\t}\n\treturn color(\n\t\t(\"h\" == m.charAt(0) ? lerpHue : lerp)(a1, a2, f),\n\t\tlerp(b1, b2, f),\n\t\t(\"h\" == m.charAt(2) ? lerpHue : lerp)(c1, c2, f),\n\t\tm,\n\t)\n}\n\nfunction indexOfMax<T>(arr: ArrayLike<T>, f: (el: T) => number) {\n\tlet maxValue = -Infinity,\n\t\tmaxValueIndex = -1\n\tfor (let i = 0; i < arr.length; i++) {\n\t\tconst value = f(arr[i])\n\t\tif (value > maxValue) {\n\t\t\tmaxValue = value\n\t\t\tmaxValueIndex = i\n\t\t}\n\t}\n\treturn maxValueIndex\n}\nfunction withMax<T>(arr: ArrayLike<T>, f: (el: T) => number): T {\n\treturn arr[indexOfMax(arr, f)]\n}\n","var tokenize = require('glsl-tokenizer')\nvar atob     = require('atob-lite')\n\nmodule.exports = getName\n\nfunction getName(src) {\n  var tokens = Array.isArray(src)\n    ? src\n    : tokenize(src)\n\n  for (var i = 0; i < tokens.length; i++) {\n    var token = tokens[i]\n    if (token.type !== 'preprocessor') continue\n    var match = token.data.match(/\\#define\\s+SHADER_NAME(_B64)?\\s+(.+)$/)\n    if (!match) continue\n    if (!match[2]) continue\n\n    var b64  = match[1]\n    var name = match[2]\n\n    return (b64 ? atob(name) : name).trim()\n  }\n}\n","module.exports = [\r\n  // current\r\n    'precision'\r\n  , 'highp'\r\n  , 'mediump'\r\n  , 'lowp'\r\n  , 'attribute'\r\n  , 'const'\r\n  , 'uniform'\r\n  , 'varying'\r\n  , 'break'\r\n  , 'continue'\r\n  , 'do'\r\n  , 'for'\r\n  , 'while'\r\n  , 'if'\r\n  , 'else'\r\n  , 'in'\r\n  , 'out'\r\n  , 'inout'\r\n  , 'float'\r\n  , 'int'\r\n  , 'uint'\r\n  , 'void'\r\n  , 'bool'\r\n  , 'true'\r\n  , 'false'\r\n  , 'discard'\r\n  , 'return'\r\n  , 'mat2'\r\n  , 'mat3'\r\n  , 'mat4'\r\n  , 'vec2'\r\n  , 'vec3'\r\n  , 'vec4'\r\n  , 'ivec2'\r\n  , 'ivec3'\r\n  , 'ivec4'\r\n  , 'bvec2'\r\n  , 'bvec3'\r\n  , 'bvec4'\r\n  , 'sampler1D'\r\n  , 'sampler2D'\r\n  , 'sampler3D'\r\n  , 'samplerCube'\r\n  , 'sampler1DShadow'\r\n  , 'sampler2DShadow'\r\n  , 'struct'\r\n\r\n  // future\r\n  , 'asm'\r\n  , 'class'\r\n  , 'union'\r\n  , 'enum'\r\n  , 'typedef'\r\n  , 'template'\r\n  , 'this'\r\n  , 'packed'\r\n  , 'goto'\r\n  , 'switch'\r\n  , 'default'\r\n  , 'inline'\r\n  , 'noinline'\r\n  , 'volatile'\r\n  , 'public'\r\n  , 'static'\r\n  , 'extern'\r\n  , 'external'\r\n  , 'interface'\r\n  , 'long'\r\n  , 'short'\r\n  , 'double'\r\n  , 'half'\r\n  , 'fixed'\r\n  , 'unsigned'\r\n  , 'input'\r\n  , 'output'\r\n  , 'hvec2'\r\n  , 'hvec3'\r\n  , 'hvec4'\r\n  , 'dvec2'\r\n  , 'dvec3'\r\n  , 'dvec4'\r\n  , 'fvec2'\r\n  , 'fvec3'\r\n  , 'fvec4'\r\n  , 'sampler2DRect'\r\n  , 'sampler3DRect'\r\n  , 'sampler2DRectShadow'\r\n  , 'sizeof'\r\n  , 'cast'\r\n  , 'namespace'\r\n  , 'using'\r\n]\r\n","var v100 = require('./literals')\r\n\r\nmodule.exports = v100.slice().concat([\r\n   'layout'\r\n  , 'centroid'\r\n  , 'smooth'\r\n  , 'case'\r\n  , 'mat2x2'\r\n  , 'mat2x3'\r\n  , 'mat2x4'\r\n  , 'mat3x2'\r\n  , 'mat3x3'\r\n  , 'mat3x4'\r\n  , 'mat4x2'\r\n  , 'mat4x3'\r\n  , 'mat4x4'\r\n  , 'uvec2'\r\n  , 'uvec3'\r\n  , 'uvec4'\r\n  , 'samplerCubeShadow'\r\n  , 'sampler2DArray'\r\n  , 'sampler2DArrayShadow'\r\n  , 'isampler2D'\r\n  , 'isampler3D'\r\n  , 'isamplerCube'\r\n  , 'isampler2DArray'\r\n  , 'usampler2D'\r\n  , 'usampler3D'\r\n  , 'usamplerCube'\r\n  , 'usampler2DArray'\r\n  , 'coherent'\r\n  , 'restrict'\r\n  , 'readonly'\r\n  , 'writeonly'\r\n  , 'resource'\r\n  , 'atomic_uint'\r\n  , 'noperspective'\r\n  , 'patch'\r\n  , 'sample'\r\n  , 'subroutine'\r\n  , 'common'\r\n  , 'partition'\r\n  , 'active'\r\n  , 'filter'\r\n  , 'image1D'\r\n  , 'image2D'\r\n  , 'image3D'\r\n  , 'imageCube'\r\n  , 'iimage1D'\r\n  , 'iimage2D'\r\n  , 'iimage3D'\r\n  , 'iimageCube'\r\n  , 'uimage1D'\r\n  , 'uimage2D'\r\n  , 'uimage3D'\r\n  , 'uimageCube'\r\n  , 'image1DArray'\r\n  , 'image2DArray'\r\n  , 'iimage1DArray'\r\n  , 'iimage2DArray'\r\n  , 'uimage1DArray'\r\n  , 'uimage2DArray'\r\n  , 'image1DShadow'\r\n  , 'image2DShadow'\r\n  , 'image1DArrayShadow'\r\n  , 'image2DArrayShadow'\r\n  , 'imageBuffer'\r\n  , 'iimageBuffer'\r\n  , 'uimageBuffer'\r\n  , 'sampler1DArray'\r\n  , 'sampler1DArrayShadow'\r\n  , 'isampler1D'\r\n  , 'isampler1DArray'\r\n  , 'usampler1D'\r\n  , 'usampler1DArray'\r\n  , 'isampler2DRect'\r\n  , 'usampler2DRect'\r\n  , 'samplerBuffer'\r\n  , 'isamplerBuffer'\r\n  , 'usamplerBuffer'\r\n  , 'sampler2DMS'\r\n  , 'isampler2DMS'\r\n  , 'usampler2DMS'\r\n  , 'sampler2DMSArray'\r\n  , 'isampler2DMSArray'\r\n  , 'usampler2DMSArray'\r\n])\r\n","/* global window, exports, define */\n\n!function() {\n    'use strict'\n\n    var re = {\n        not_string: /[^s]/,\n        not_bool: /[^t]/,\n        not_type: /[^T]/,\n        not_primitive: /[^v]/,\n        number: /[diefg]/,\n        numeric_arg: /[bcdiefguxX]/,\n        json: /[j]/,\n        not_json: /[^j]/,\n        text: /^[^\\x25]+/,\n        modulo: /^\\x25{2}/,\n        placeholder: /^\\x25(?:([1-9]\\d*)\\$|\\(([^)]+)\\))?(\\+)?(0|'[^$])?(-)?(\\d+)?(?:\\.(\\d+))?([b-gijostTuvxX])/,\n        key: /^([a-z_][a-z_\\d]*)/i,\n        key_access: /^\\.([a-z_][a-z_\\d]*)/i,\n        index_access: /^\\[(\\d+)\\]/,\n        sign: /^[+-]/\n    }\n\n    function sprintf(key) {\n        // `arguments` is not an array, but should be fine for this call\n        return sprintf_format(sprintf_parse(key), arguments)\n    }\n\n    function vsprintf(fmt, argv) {\n        return sprintf.apply(null, [fmt].concat(argv || []))\n    }\n\n    function sprintf_format(parse_tree, argv) {\n        var cursor = 1, tree_length = parse_tree.length, arg, output = '', i, k, ph, pad, pad_character, pad_length, is_positive, sign\n        for (i = 0; i < tree_length; i++) {\n            if (typeof parse_tree[i] === 'string') {\n                output += parse_tree[i]\n            }\n            else if (typeof parse_tree[i] === 'object') {\n                ph = parse_tree[i] // convenience purposes only\n                if (ph.keys) { // keyword argument\n                    arg = argv[cursor]\n                    for (k = 0; k < ph.keys.length; k++) {\n                        if (arg == undefined) {\n                            throw new Error(sprintf('[sprintf] Cannot access property \"%s\" of undefined value \"%s\"', ph.keys[k], ph.keys[k-1]))\n                        }\n                        arg = arg[ph.keys[k]]\n                    }\n                }\n                else if (ph.param_no) { // positional argument (explicit)\n                    arg = argv[ph.param_no]\n                }\n                else { // positional argument (implicit)\n                    arg = argv[cursor++]\n                }\n\n                if (re.not_type.test(ph.type) && re.not_primitive.test(ph.type) && arg instanceof Function) {\n                    arg = arg()\n                }\n\n                if (re.numeric_arg.test(ph.type) && (typeof arg !== 'number' && isNaN(arg))) {\n                    throw new TypeError(sprintf('[sprintf] expecting number but found %T', arg))\n                }\n\n                if (re.number.test(ph.type)) {\n                    is_positive = arg >= 0\n                }\n\n                switch (ph.type) {\n                    case 'b':\n                        arg = parseInt(arg, 10).toString(2)\n                        break\n                    case 'c':\n                        arg = String.fromCharCode(parseInt(arg, 10))\n                        break\n                    case 'd':\n                    case 'i':\n                        arg = parseInt(arg, 10)\n                        break\n                    case 'j':\n                        arg = JSON.stringify(arg, null, ph.width ? parseInt(ph.width) : 0)\n                        break\n                    case 'e':\n                        arg = ph.precision ? parseFloat(arg).toExponential(ph.precision) : parseFloat(arg).toExponential()\n                        break\n                    case 'f':\n                        arg = ph.precision ? parseFloat(arg).toFixed(ph.precision) : parseFloat(arg)\n                        break\n                    case 'g':\n                        arg = ph.precision ? String(Number(arg.toPrecision(ph.precision))) : parseFloat(arg)\n                        break\n                    case 'o':\n                        arg = (parseInt(arg, 10) >>> 0).toString(8)\n                        break\n                    case 's':\n                        arg = String(arg)\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 't':\n                        arg = String(!!arg)\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'T':\n                        arg = Object.prototype.toString.call(arg).slice(8, -1).toLowerCase()\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'u':\n                        arg = parseInt(arg, 10) >>> 0\n                        break\n                    case 'v':\n                        arg = arg.valueOf()\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'x':\n                        arg = (parseInt(arg, 10) >>> 0).toString(16)\n                        break\n                    case 'X':\n                        arg = (parseInt(arg, 10) >>> 0).toString(16).toUpperCase()\n                        break\n                }\n                if (re.json.test(ph.type)) {\n                    output += arg\n                }\n                else {\n                    if (re.number.test(ph.type) && (!is_positive || ph.sign)) {\n                        sign = is_positive ? '+' : '-'\n                        arg = arg.toString().replace(re.sign, '')\n                    }\n                    else {\n                        sign = ''\n                    }\n                    pad_character = ph.pad_char ? ph.pad_char === '0' ? '0' : ph.pad_char.charAt(1) : ' '\n                    pad_length = ph.width - (sign + arg).length\n                    pad = ph.width ? (pad_length > 0 ? pad_character.repeat(pad_length) : '') : ''\n                    output += ph.align ? sign + arg + pad : (pad_character === '0' ? sign + pad + arg : pad + sign + arg)\n                }\n            }\n        }\n        return output\n    }\n\n    var sprintf_cache = Object.create(null)\n\n    function sprintf_parse(fmt) {\n        if (sprintf_cache[fmt]) {\n            return sprintf_cache[fmt]\n        }\n\n        var _fmt = fmt, match, parse_tree = [], arg_names = 0\n        while (_fmt) {\n            if ((match = re.text.exec(_fmt)) !== null) {\n                parse_tree.push(match[0])\n            }\n            else if ((match = re.modulo.exec(_fmt)) !== null) {\n                parse_tree.push('%')\n            }\n            else if ((match = re.placeholder.exec(_fmt)) !== null) {\n                if (match[2]) {\n                    arg_names |= 1\n                    var field_list = [], replacement_field = match[2], field_match = []\n                    if ((field_match = re.key.exec(replacement_field)) !== null) {\n                        field_list.push(field_match[1])\n                        while ((replacement_field = replacement_field.substring(field_match[0].length)) !== '') {\n                            if ((field_match = re.key_access.exec(replacement_field)) !== null) {\n                                field_list.push(field_match[1])\n                            }\n                            else if ((field_match = re.index_access.exec(replacement_field)) !== null) {\n                                field_list.push(field_match[1])\n                            }\n                            else {\n                                throw new SyntaxError('[sprintf] failed to parse named argument key')\n                            }\n                        }\n                    }\n                    else {\n                        throw new SyntaxError('[sprintf] failed to parse named argument key')\n                    }\n                    match[2] = field_list\n                }\n                else {\n                    arg_names |= 2\n                }\n                if (arg_names === 3) {\n                    throw new Error('[sprintf] mixing positional and named placeholders is not (yet) supported')\n                }\n\n                parse_tree.push(\n                    {\n                        placeholder: match[0],\n                        param_no:    match[1],\n                        keys:        match[2],\n                        sign:        match[3],\n                        pad_char:    match[4],\n                        align:       match[5],\n                        width:       match[6],\n                        precision:   match[7],\n                        type:        match[8]\n                    }\n                )\n            }\n            else {\n                throw new SyntaxError('[sprintf] unexpected placeholder')\n            }\n            _fmt = _fmt.substring(match[0].length)\n        }\n        return sprintf_cache[fmt] = parse_tree\n    }\n\n    /**\n     * export to either browser or node.js\n     */\n    /* eslint-disable quote-props */\n    if (typeof exports !== 'undefined') {\n        exports['sprintf'] = sprintf\n        exports['vsprintf'] = vsprintf\n    }\n    if (typeof window !== 'undefined') {\n        window['sprintf'] = sprintf\n        window['vsprintf'] = vsprintf\n\n        if (typeof define === 'function' && define['amd']) {\n            define(function() {\n                return {\n                    'sprintf': sprintf,\n                    'vsprintf': vsprintf\n                }\n            })\n        }\n    }\n    /* eslint-enable quote-props */\n}(); // eslint-disable-line\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","/// <reference types=\"webgl-strict-types\" />\nimport { assert, int, NLA_DEBUG, V3 } from \"ts3dutils\"\nimport { currentGL, TSGLContext } from \"./index\"\n\nimport GL = WebGLRenderingContextStrict\nconst WGL =\n  WebGLRenderingContext as any as WebGLRenderingContextStrict.Constants\n\nexport class Buffer {\n  buffer: WebGLBuffer | undefined = undefined\n  data: any[] = []\n\n  /** Number of elements in buffer. 2 V3s is still 2, not 6. */\n  count: int = 0\n\n  /** Space between elements in buffer. 3 for V3s. */\n  spacing: 1 | 2 | 3 | 4 = 1\n\n  hasBeenCompiled: boolean = false\n\n  name?: string\n\n  maxValue?: number\n\n  bindSize: GL[\"UNSIGNED_INT\"] | GL[\"UNSIGNED_SHORT\"]\n\n  /**\n   * Provides a simple method of uploading data to a GPU buffer.\n   *\n   * @example\n   *     const vertices = new Buffer(WGL.ARRAY_BUFFER, Float32Array)\n   *     vertices.data = [[0, 0, 0], [1, 0, 0], [0, 1, 0], [1, 1, 0]]\n   *     vertices.compile()\n   *\n   * @example\n   *     const indices = new Buffer(WGL.ELEMENT_ARRAY_BUFFER, Uint16Array)\n   *     indices.data = [[0, 1, 2], [2, 1, 3]]\n   *     indices.compile()\n   *\n   * @param target Specifies the target to which the buffer object is bound.\n   * @param type\n   */\n  constructor(\n    public readonly target: GL.BufferTarget,\n    public readonly type:\n      | typeof Float32Array\n      | typeof Uint16Array\n      | typeof Uint32Array,\n  ) {\n    assert(\n      target == WGL.ARRAY_BUFFER || target == WGL.ELEMENT_ARRAY_BUFFER,\n      \"target == WGL.ARRAY_BUFFER || target == WGL.ELEMENT_ARRAY_BUFFER\",\n    )\n    assert(\n      type == Float32Array || type == Uint16Array || type == Uint32Array,\n      \"type == Float32Array || type == Uint16Array || type == Uint32Array\",\n    )\n    if (Uint16Array == type) {\n      this.bindSize = WGL.UNSIGNED_SHORT\n    } else if (Uint32Array == type) {\n      this.bindSize = WGL.UNSIGNED_INT\n    }\n  }\n\n  /**\n   * Upload the contents of `data` to the GPU in preparation for rendering. The data must be a list of lists\n   * where each inner list has the same length. For example, each element of data for vertex normals would be a\n   * list of length three. This will remember the data length and element length for later use by shaders.\n   *\n   * This could have used `[].concat.apply([], this.data)` to flatten the array but Google\n   * Chrome has a maximum number of arguments so the concatenations are chunked to avoid that limit.\n   *\n   * @param usage Either `WGL.STATIC_DRAW` or `WGL.DYNAMIC_DRAW`. Defaults to `WGL.STATIC_DRAW`\n   */\n  compile(\n    usage: GL.BufferDataUsage = WGL.STATIC_DRAW,\n    gl: TSGLContext = currentGL(),\n  ): void {\n    assert(\n      WGL.STATIC_DRAW == usage || WGL.DYNAMIC_DRAW == usage,\n      \"WGL.STATIC_DRAW == type || WGL.DYNAMIC_DRAW == type\",\n    )\n    this.buffer = this.buffer || gl.createBuffer()!\n    let buffer: Float32Array | Uint16Array | Uint32Array\n    if (this.data.length == 0) {\n      console.warn(\"empty buffer \" + this.name)\n      //console.trace()\n    }\n    if (this.data.length == 0 || this.data[0] instanceof V3) {\n      assert(!(this.data[0] instanceof V3) || this.type == Float32Array)\n      V3.pack(\n        this.data,\n        (buffer = new this.type(this.data.length * 3) as Float32Array),\n      ) // asserts that all\n      // elements are V3s\n      this.spacing = 3\n      this.count = this.data.length\n      this.maxValue = 0\n    } else {\n      //assert(Array != this.data[0].constructor, this.name + this.data[0])\n      if (Array.isArray(this.data[0])) {\n        const bufferLength = this.data.length * this.data[0].length\n        buffer = new this.type(bufferLength)\n        let i = this.data.length,\n          destPtr = bufferLength\n        while (i--) {\n          const subArray = this.data[i]\n          let j = subArray.length\n          while (j--) {\n            buffer[--destPtr] = subArray[j]\n          }\n        }\n        assert(0 == destPtr)\n      } else {\n        buffer = new this.type(this.data)\n      }\n\n      const spacing = this.data.length ? buffer.length / this.data.length : 0\n      assert(\n        spacing % 1 == 0,\n        `buffer ${this.name} elements not of consistent size, average size is ` +\n          spacing,\n      )\n      if (NLA_DEBUG) {\n        if (10000 <= buffer.length) {\n          this.maxValue = 0\n        } else {\n          this.maxValue = Math.max.apply(undefined, buffer)\n        }\n      }\n      assert([1, 2, 3, 4].includes(spacing))\n      this.spacing = spacing as 1 | 2 | 3 | 4\n      this.count = this.data.length\n    }\n    gl.bindBuffer(this.target, this.buffer)\n    gl.bufferData(this.target, buffer, usage)\n    this.hasBeenCompiled = true\n  }\n}\n","/// <reference types=\"webgl-strict-types\" />\nimport {\n  AABB,\n  arrayFromFunction,\n  assert,\n  assertVectors,\n  eq0,\n  int,\n  lerp,\n  M4,\n  NLA_PRECISION,\n  raddd,\n  TAU,\n  Transformable,\n  Tuple3,\n  V,\n  V3,\n} from \"ts3dutils\"\n\nimport { Buffer, currentGL, GL_COLOR, pushQuad, TSGLContext } from \"./index\"\n\nconst { cos, sin, PI, min, max } = Math\n\nconst WGL =\n  WebGLRenderingContext as any as WebGLRenderingContextStrict.Constants\nimport GL = WebGLRenderingContextStrict\n\nconst tempM4_1 = new M4()\nconst tempM4_2 = new M4()\n\nexport interface MeshData {\n  normals: V3[]\n  coords: [number, number][]\n  colors: GL_COLOR[]\n  TRIANGLES: int[]\n  LINES: int[]\n}\nexport type MeshWith<T extends keyof MeshData = never> = Mesh &\n  Pick<MeshData, T>\n\n/**\n * @example new Mesh()\n *        .addIndexBuffer('TRIANGLES')\n *        .addIndexBuffer('LINES')\n *        .addVertexBuffer('normals', 'ts_Normal')\n */\nexport class Mesh extends Transformable {\n  hasBeenCompiled: boolean = false\n  vertexBuffers: { [name: string]: Buffer } = {}\n  indexBuffers: { [name: string]: Buffer } = {}\n\n  vertices: V3[]\n  normals?: V3[]\n\n  constructor() {\n    super()\n    this.addVertexBuffer(\"vertices\", \"ts_Vertex\")\n  }\n\n  /**\n   * Calculate area, volume and centroid of the mesh.\n   *\n   * The area is the sum of the areas of the triangles.\n   *\n   * For closed meshes, the volume is the contained volume. If the volume is inside-out, i.e. the face normals point\n   * inwards, the returned value is negative. In general, this calculates the sum of the z-direction shadow volumes\n   * of the triangles. The z-dir shadow volume is the cut-off prism with the triangle projected onto the XY plane as\n   * the base face and the triangle itself as the top face.\n   *\n   * The centroid is the \"mean point of all points inside the volume\". If a uniform density is assumed, this is\n   * equivalent to the center of gravity. In general, this calculates the weighted average of the centroids of all the\n   * triangle shadow volumes.\n   */\n  calcVolume(this: Mesh & { TRIANGLES: int[] }): {\n    volume: number\n    centroid: V3\n    area: number\n  } {\n    let totalVolumeX2 = 0,\n      totalCentroidWithZX2 = V3.O,\n      totalAreaX2 = 0\n    const triangles = this.TRIANGLES\n    const vertices = this.vertices\n    for (let i = 0; i < triangles.length; i += 3) {\n      const ai = triangles[i + 0],\n        bi = triangles[i + 1],\n        ci = triangles[i + 2]\n      const a = vertices[ai],\n        b = vertices[bi],\n        c = vertices[ci]\n      const ab = b.minus(a),\n        ac = c.minus(a)\n      const normal = ab.cross(ac)\n      //const centroidZ = (v0.z + v1.z + v2.z) / 3\n      const faceCentroid = V3.add(a, b, c).div(3)\n      //totalVolume += centroidZ * (area === v01.cross(v02).length() / 2) * v01.cross(v02).unit().z\n      totalVolumeX2 += faceCentroid.z * normal.z\n      const faceAreaX2 = normal.length()\n      totalAreaX2 += faceAreaX2\n\n      // NB: the shadow volume centroid does NOT have the same XY coordinates\n      // as the face centroid.\n      // calculate the weighted centroid of the shadow volume:\n      // faceShadowCentroid = INTEGRATE [0; 1] (\n      //   INTEGRATE [0; 1 - s] (\n      //     normal.z *\n      //     ((1 - s - t) a + s b + t c) *\n      //     ((1 - s - t) a + s b + t c).z\n      //   ) dt\n      // ) ds\n      // = (a (2 a.z + b.z + c.z) + b (a.z + 2 b.z + c.z) + c (a.z + b.z + 2 c.z)) / 24\n      const faceShadowCentroid = V3.add(\n        a.times(2 * a.z + b.z + c.z),\n        b.times(a.z + 2 * b.z + c.z),\n        c.times(a.z + b.z + 2 * c.z),\n      ).times(normal.z) // 1/24 factor is done at very end\n      totalCentroidWithZX2 = totalCentroidWithZX2.plus(faceShadowCentroid)\n    }\n    // sumInPlaceTree adds negligible additional accuracy for XY sphere\n    const volume = totalVolumeX2 / 2\n    return {\n      volume,\n      centroid: eq0(volume)\n        ? V3.O\n        : totalCentroidWithZX2.div(24 * volume).schur(new V3(1, 1, 0.5)),\n      area: totalAreaX2 / 2,\n    }\n  }\n\n  /**\n   * Add a new vertex buffer with a list as a property called `name` on this object and map it to\n   * the attribute called `attribute` in all shaders that draw this mesh.\n   * @example new Mesh().addVertexBuffer('coords', 'ts_TexCoord')\n   */\n  addVertexBuffer<K extends string>(\n    name: K,\n    attribute: string,\n  ): this & { [k in K]: any[] } {\n    assert(\n      !this.vertexBuffers[attribute],\n      \"Buffer \" + attribute + \" already exists.\",\n    )\n    //assert(!this[name])\n    this.hasBeenCompiled = false\n    assert(\"string\" == typeof name)\n    assert(\"string\" == typeof attribute)\n    const buffer = (this.vertexBuffers[attribute] = new Buffer(\n      WGL.ARRAY_BUFFER,\n      Float32Array,\n    ))\n    buffer.name = name\n    ;(this as any)[name] = []\n    return this as any\n  }\n\n  /**\n   * Add a new index buffer.\n   * @example new Mesh().addIndexBuffer('TRIANGLES')\n   * @example new Mesh().addIndexBuffer('LINES')\n   */\n  addIndexBuffer<K extends string>(\n    name: K,\n    type: GL[\"UNSIGNED_SHORT\"] | GL[\"UNSIGNED_INT\"] = WGL.UNSIGNED_SHORT,\n  ): this & { [k in K]: int[] } {\n    this.hasBeenCompiled = false\n    const arrayType = WGL.UNSIGNED_SHORT == type ? Uint16Array : Uint32Array\n    const buffer = (this.indexBuffers[name] = new Buffer(\n      WGL.ELEMENT_ARRAY_BUFFER,\n      arrayType,\n    ))\n    buffer.name = name\n    ;(this as any)[name] = []\n    return this as any\n  }\n\n  concat(...others: this[]): this {\n    const result = new Mesh() as any\n    const allMeshes = [this as Mesh].concat(others)\n    Object.getOwnPropertyNames(this.vertexBuffers).forEach((attribute) => {\n      assert(others.every((other) => !!other.vertexBuffers[attribute]))\n      const bufferName = this.vertexBuffers[attribute].name!\n      if (\"ts_Vertex\" !== attribute) {\n        result.addVertexBuffer(bufferName, attribute)\n      }\n      result[bufferName] = [].concat(\n        ...allMeshes.map((mesh) => (mesh as any)[bufferName]),\n      )\n    })\n    Object.getOwnPropertyNames(this.indexBuffers).forEach((name) => {\n      assert(others.every((other) => !!other.indexBuffers[name]))\n      result.addIndexBuffer(name, this.indexBuffers[name].bindSize)\n      const newIndexBufferData = new Array(\n        allMeshes.reduce((sum, mesh) => sum + (mesh as any)[name].length, 0),\n      )\n      let ptr = 0\n      let startIndex = 0\n      for (const mesh of allMeshes) {\n        for (const index of (mesh as any)[name] as int[]) {\n          newIndexBufferData[ptr++] = startIndex + index\n        }\n        startIndex += mesh.vertices.length\n      }\n      result[name] = newIndexBufferData\n    })\n    result.compile()\n    return result\n  }\n\n  /**\n   * Upload all attached buffers to the GPU in preparation for rendering. This doesn't need to be called every\n   * frame, only needs to be done when the data changes.\n   *\n   * Sets `this.hasBeenCompiled` to true.\n   */\n  compile(gl: TSGLContext = currentGL()) {\n    // figure out shortest vertex buffer to make sure indexBuffers are in bounds\n    let minVertexBufferLength = Infinity // TODO, _minBufferName\n    Object.getOwnPropertyNames(this.vertexBuffers).forEach((attribute) => {\n      const buffer = this.vertexBuffers[attribute]\n      buffer.data = (this as any)[buffer.name!]\n      buffer.compile(undefined, gl)\n      if ((this as any)[buffer.name!].length < minVertexBufferLength) {\n        // _minBufferName = attribute\n        minVertexBufferLength = (this as any)[buffer.name!].length\n      }\n    })\n\n    for (const name in this.indexBuffers) {\n      const buffer = this.indexBuffers[name]\n      buffer.data = (this as any)[buffer.name!]\n      buffer.compile(undefined, gl)\n      // if (NLA_DEBUG && buffer.maxValue >= minVertexBufferLength) {\n      // \tthrow new Error(`max index value for buffer ${name}\n      // \tis too large ${buffer.maxValue} min Vbuffer size: ${minVertexBufferLength} ${minBufferName}`)\n      // }\n    }\n    this.hasBeenCompiled = true\n    return this\n  }\n\n  static async fromBinarySTL(stl: Blob) {\n    return new Promise<Mesh & { normals: V3[] }>((resolve, reject) => {\n      const mesh = new Mesh().addVertexBuffer(\"normals\", \"ts_Normal\")\n      const fileReader = new FileReader()\n      fileReader.onerror = reject\n      fileReader.onload = function (_progressEvent) {\n        const dataView = new DataView(this.result as ArrayBuffer)\n        const HEADER_BYTE_SIZE = 80\n        const triangleCount = dataView.getUint32(HEADER_BYTE_SIZE, true)\n        mesh.normals.length = triangleCount * 3\n        mesh.vertices.length = triangleCount * 3\n        let i = triangleCount * 3,\n          bufferPtr = HEADER_BYTE_SIZE + 4\n\n        function readV3() {\n          const x = dataView.getFloat32(bufferPtr, true)\n          bufferPtr += 4\n          const y = dataView.getFloat32(bufferPtr, true)\n          bufferPtr += 4\n          const z = dataView.getFloat32(bufferPtr, true)\n          bufferPtr += 4\n          return new V3(x, y, z)\n        }\n\n        while (i) {\n          i -= 3\n          const normal = readV3()\n          mesh.normals[i + 0] = normal\n          mesh.normals[i + 1] = normal\n          mesh.normals[i + 2] = normal\n          mesh.vertices[i + 0] = readV3()\n          mesh.vertices[i + 1] = readV3()\n          mesh.vertices[i + 2] = readV3()\n\n          bufferPtr += 2\n        }\n        resolve(mesh)\n      }\n      fileReader.readAsArrayBuffer(stl)\n    })\n  }\n\n  toBinarySTL(this: Mesh & { TRIANGLES: number[] }): Blob {\n    if (!this.TRIANGLES) throw new Error(\"TRIANGLES must be defined.\")\n    const HEADER_BYTE_SIZE = 80,\n      FLOAT_BYTE_SIZE = 4\n    const triangles = this.TRIANGLES\n    const triangleCount = triangles.length / 3\n    const buffer = new ArrayBuffer(\n      HEADER_BYTE_SIZE + 4 + triangleCount * (4 * 3 * FLOAT_BYTE_SIZE + 2),\n    )\n    const dataView = new DataView(buffer)\n    dataView.setUint32(HEADER_BYTE_SIZE, triangleCount, true)\n    let bufferPtr = HEADER_BYTE_SIZE + 4\n    let i = triangles.length\n    while (i) {\n      i -= 3\n      const a = this.vertices[triangles[i]],\n        b = this.vertices[triangles[i + 1]],\n        c = this.vertices[triangles[i + 2]]\n      const normal = V3.normalOnPoints(a, b, c)\n      ;[normal, a, b, c].forEach((v) => {\n        dataView.setFloat32(bufferPtr, v.x, true)\n        bufferPtr += 4\n        dataView.setFloat32(bufferPtr, v.y, true)\n        bufferPtr += 4\n        dataView.setFloat32(bufferPtr, v.z, true)\n        bufferPtr += 4\n      })\n      // skip 2 bytes, already initalized to zero\n      bufferPtr += 2\n    }\n    assert(bufferPtr == buffer.byteLength, bufferPtr + \" \" + buffer.byteLength)\n    return new Blob([buffer], { type: \"application/octet-stream\" })\n  }\n\n  /**\n   * Returns a new Mesh with transformed vertices.\n   *\n   * Transform all vertices by `matrix` and all normals by the inverse transpose of `matrix`.\n   *\n   * Index buffer data is referenced.\n   */\n  transform(m4: M4): this {\n    const mesh = new Mesh()\n    mesh.vertices = m4.transformedPoints(this.vertices)\n    if (this.normals) {\n      mesh.addVertexBuffer(\"normals\", \"ts_Normal\")\n      const invTrans = m4\n        .as3x3(tempM4_1)\n        .inversed(tempM4_2)\n        .transposed(tempM4_1)\n      mesh.normals = this.normals.map((n) => invTrans.transformVector(n).unit())\n      // mesh.normals.forEach(n => assert(n.hasLength(1)))\n    }\n    for (const name in this.indexBuffers) {\n      mesh.addIndexBuffer(name)\n      ;(mesh as any)[name] = (this as any)[name]\n    }\n    for (const attribute in this.vertexBuffers) {\n      if (\"ts_Vertex\" !== attribute && \"ts_Normal\" !== attribute) {\n        const name = this.vertexBuffers[attribute].name!\n        mesh.addVertexBuffer(name, attribute)\n        ;(mesh as any)[name] = (this as any)[name]\n      }\n    }\n    // this.hasBeenCompiled && mesh.compile()\n    return mesh as this\n  }\n\n  /**\n   * Computes a new normal for each vertex from the average normal of the neighboring triangles. This means\n   * adjacent triangles must share vertices for the resulting normals to be smooth.\n   */\n  computeNormalsFromFlatTriangles(\n    this: Mesh & { TRIANGLES: int[] },\n  ): this & { normals: V3[] } {\n    if (!this.normals) this.addVertexBuffer(\"normals\", \"ts_Normal\")\n    // tslint:disable:no-string-literal\n    //this.vertexBuffers['ts_Normal'].data = arrayFromFunction(this.vertices.length, i => V3.O)\n\n    const TRIANGLES = this.TRIANGLES,\n      vertices = this.vertices,\n      normals = this.normals!\n    normals.length = vertices.length\n    for (let i = 0; i < TRIANGLES.length; i += 3) {\n      const ai = TRIANGLES[i],\n        bi = TRIANGLES[i + 1],\n        ci = TRIANGLES[i + 2]\n      const a = vertices[ai]\n      const b = vertices[bi]\n      const c = vertices[ci]\n      const normal = b.minus(a).cross(c.minus(a))\n      const normal1 = normal.likeO() ? V3.O : normal.unit()\n      normals[ai] = normals[ai] ? normals[ai].plus(normal1) : normal1\n      normals[bi] = normals[bi] ? normals[bi].plus(normal1) : normal1\n      normals[ci] = normals[ci] ? normals[ci].plus(normal1) : normal1\n    }\n    for (let i = 0; i < vertices.length; i++) {\n      normals[i] = normals[i].unit()\n    }\n    this.hasBeenCompiled = false\n    return this as any\n  }\n\n  /**\n   * Populate the specified index buffer (default 'LINES') from the `triangles` index buffer.\n   */\n  computeWireframeFromFlatTriangles(\n    this: Mesh & { TRIANGLES: int[] },\n  ): this & { LINES: int[] }\n  computeWireframeFromFlatTriangles<T extends string>(\n    this: Mesh & { TRIANGLES: int[] },\n    indexBufferName: T,\n  ): this & { [k in T]: int[] }\n  computeWireframeFromFlatTriangles(\n    this: any,\n    indexBufferName: string = \"LINES\",\n  ): this {\n    if (!this.TRIANGLES) throw new Error(\"TRIANGLES must be defined.\")\n    const canonEdges = new Set<number>()\n\n    function canonEdge(i0: int, i1: int) {\n      const iMin = min(i0, i1),\n        iMax = max(i0, i1)\n      return (iMin << 16) | iMax\n    }\n\n    // function uncanonEdge(key) {\n    // \treturn [key >> 16, key & 0xffff]\n    // }\n    const t = this.TRIANGLES\n    for (let i = 0; i < t.length; i += 3) {\n      canonEdges.add(canonEdge(t[i + 0], t[i + 1]))\n      canonEdges.add(canonEdge(t[i + 1], t[i + 2]))\n      canonEdges.add(canonEdge(t[i + 2], t[i + 0]))\n    }\n    const data = indexBufferName\n    if (!this[data]) this.addIndexBuffer(indexBufferName)\n    //this.LINES = new Array(canonEdges.size)\n    canonEdges.forEach((val) => this[data].push(val >> 16, val & 0xffff))\n    this.hasBeenCompiled = false\n    return this\n  }\n\n  computeWireframeFromFlatTrianglesClosedMesh(\n    this: Mesh & { TRIANGLES: int[] },\n  ): this & { LINES: int[] }\n  computeWireframeFromFlatTrianglesClosedMesh<T extends string>(\n    this: Mesh & { TRIANGLES: int[] },\n    indexBufferName: T,\n  ): this & { [k in T]: int[] }\n  computeWireframeFromFlatTrianglesClosedMesh(\n    this: any,\n    indexBufferName: string = \"LINES\",\n  ): this {\n    if (!this.TRIANGLES) throw new Error(\"TRIANGLES must be defined.\")\n    if (!this.LINES) this.addIndexBuffer(\"LINES\")\n    const tris = this.TRIANGLES\n    if (!this[indexBufferName]) this.addIndexBuffer(indexBufferName)\n    const lines = this[indexBufferName]\n    for (let i = 0; i < tris.length; i += 3) {\n      if (tris[i + 0] < tris[i + 1]) lines.push(tris[i + 0], tris[i + 1])\n      if (tris[i + 1] < tris[i + 2]) lines.push(tris[i + 1], tris[i + 2])\n      if (tris[i + 2] < tris[i + 0]) lines.push(tris[i + 2], tris[i + 0])\n    }\n    this.hasBeenCompiled = false\n    return this\n  }\n\n  computeNormalLines(\n    this: Mesh & { normals: V3[] },\n    length: number,\n  ): this & { LINES: int[] }\n  computeNormalLines<T extends string>(\n    this: Mesh & { normals: V3[] },\n    length: number,\n    indexBufferName: T,\n  ): this & { [k in T]: int[] }\n  computeNormalLines(\n    this: any,\n    length: number = 1,\n    indexBufferName: string = \"LINES\",\n  ) {\n    if (!this.normals) {\n      throw new Error(\"normals must be defined.\")\n    }\n    const vs = this.vertices,\n      si = this.vertices.length\n    if (!this[indexBufferName]) this.addIndexBuffer(indexBufferName)\n\n    for (let i = 0; i < this.normals.length; i++) {\n      vs[si + i] = vs[i].plus(this.normals[i].toLength(length))\n      this[indexBufferName].push(si + i, i)\n    }\n    this.hasBeenCompiled = false\n    return this\n  }\n\n  getAABB(): AABB {\n    return new AABB().addPoints(this.vertices)\n  }\n\n  getBoundingSphere(): { center: V3; radius: number } {\n    const sphere = { center: this.getAABB().getCenter(), radius: 0 }\n    for (let i = 0; i < this.vertices.length; i++) {\n      sphere.radius = Math.max(\n        sphere.radius,\n        this.vertices[i].minus(sphere.center).length(),\n      )\n    }\n    return sphere\n  }\n\n  /**\n   * Generates a square mesh in the XY plane.\n   * Texture coordinates (buffer \"coords\") are set to go from 0 to 1 in either direction.\n   *\n   * @param options foo\n   * @param options.detail Defaults to 1\n   * @param options.detailX Defaults to options.detail. Number of subdivisions in X direction.\n   * @param options.detailY Defaults to options.detail. Number of subdivisions in Y direction.j\n   * @param options.width defaults to 1\n   * @param options.height defaults to 1\n   * @param options.startX defaults to 0\n   * @param options.startY defaults to 0\n   */\n  static plane(\n    options: {\n      detail?: int\n      detailX?: int\n      detailY?: int\n      width?: number\n      height?: number\n      startX?: number\n      startY?: number\n    } = {},\n  ) {\n    const detailX = options.detailX || options.detail || 1\n    const detailY = options.detailY || options.detail || 1\n    const startX = options.startX || 0\n    const startY = options.startY || 0\n    const width = options.width || 1\n    const height = options.height || 1\n    const mesh = new Mesh()\n      .addIndexBuffer(\"LINES\")\n      .addIndexBuffer(\"TRIANGLES\")\n      .addVertexBuffer(\"normals\", \"ts_Normal\")\n      .addVertexBuffer(\"coords\", \"ts_TexCoord\")\n\n    for (let j = 0; j <= detailY; j++) {\n      const t = j / detailY\n      for (let i = 0; i <= detailX; i++) {\n        const s = i / detailX\n        mesh.vertices.push(new V3(startX + s * width, startY + t * height, 0))\n        mesh.coords.push([s, t])\n        mesh.normals.push(V3.Z)\n        if (i < detailX && j < detailY) {\n          const offset = i + j * (detailX + 1)\n          mesh.TRIANGLES.push(\n            offset,\n            offset + 1,\n            offset + detailX + 1,\n            offset + detailX + 1,\n            offset + 1,\n            offset + detailX + 2,\n          )\n        }\n      }\n    }\n\n    for (let i = 0; i < detailX; i++) {\n      mesh.LINES.push(i, i + 1)\n      mesh.LINES.push(\n        (detailX + 1) * detailY + i,\n        (detailX + 1) * detailY + i + 1,\n      )\n    }\n    for (let j = 0; j < detailY; j++) {\n      mesh.LINES.push(detailX * j, detailX * (j + 1) + 1)\n      mesh.LINES.push(detailX * (j + 1), detailX * (j + 2) + 1)\n    }\n\n    mesh.compile()\n    return mesh\n  }\n\n  // unique corners of a unit cube. Used by Mesh.cube to generate a cube mesh.\n  //  Z            Y\n  //  ^  6      7 /\n  //  |  +------+\n  //  4/ |   5 /|\n  //  +------+  |\n  //  |  +---|--+\n  //  | /2   | /3\n  //  +------+     --> X\n  //  0      1\n  static UNIT_CUBE_CORNERS = [\n    V3.O,\n    new V3(0, 0, 1),\n    new V3(0, 1, 0),\n    new V3(0, 1, 1),\n\n    new V3(1, 0, 0),\n    new V3(1, 0, 1),\n    new V3(1, 1, 0),\n    V3.XYZ,\n  ]\n  static box(xDetail: int = 1, yDetail: int = 1, zDetail: int = 1) {\n    const mesh = new Mesh()\n      .addIndexBuffer(\"LINES\")\n      .addIndexBuffer(\"TRIANGLES\")\n      .addVertexBuffer(\"normals\", \"ts_Normal\")\n    mesh.vertices.length = mesh.normals.length =\n      2 *\n      ((xDetail + 1) * (yDetail + 1) +\n        (yDetail + 1) * (zDetail + 1) +\n        (zDetail + 1) * (xDetail + 1))\n    mesh.TRIANGLES.length =\n      4 * (xDetail * yDetail + yDetail * zDetail + zDetail * xDetail)\n    let vi = 0,\n      ti = 0\n    function x(\n      detailX: int,\n      detailY: int,\n      m: M4,\n      startX = 0,\n      width = 1,\n      startY = 0,\n      height = 1,\n    ) {\n      const normal = m.transformVector(V3.Z)\n      for (let j = 0; j <= detailY; j++) {\n        const t = j / detailY\n        for (let i = 0; i <= detailX; i++) {\n          const s = i / detailX\n          mesh.vertices[vi] = m.transformPoint(\n            new V3(startX + s * width, startY + t * height, 0),\n          )\n          mesh.normals[vi] = normal\n          vi++\n          if (i < detailX && j < detailY) {\n            const offset = i + j * (detailX + 1)\n            mesh.TRIANGLES[ti++] = offset\n            mesh.TRIANGLES[ti++] = offset + detailX + 1\n            mesh.TRIANGLES[ti++] = offset + 1\n            mesh.TRIANGLES[ti++] = offset + detailX + 1\n            mesh.TRIANGLES[ti++] = offset + detailX + 2\n            mesh.TRIANGLES[ti++] = offset + 1\n          }\n        }\n      }\n    }\n    x(yDetail, xDetail, M4.forSys(V3.Y, V3.X, V3.Z.negated()))\n    x(xDetail, yDetail, M4.translate(V3.Z))\n    x(zDetail, yDetail, M4.forSys(V3.Z, V3.Y, V3.X.negated()))\n    x(yDetail, zDetail, M4.forSys(V3.Y, V3.Z, V3.X, V3.X))\n    x(xDetail, zDetail, M4.forSys(V3.X, V3.Z, V3.Y.negated()))\n    x(zDetail, xDetail, M4.forSys(V3.Z, V3.X, V3.Y, V3.Y))\n    return mesh\n  }\n\n  /**\n   * Generates a unit cube (1x1x1) starting at the origin and extending into the (+ + +) octant.\n   * I.e. box from V3.O to V3(1,1,1)\n   * Creates line (only cube edges), triangle, vertex and normal1 buffers.\n   */\n  static cube() {\n    const mesh = new Mesh()\n      .addVertexBuffer(\"normals\", \"ts_Normal\")\n      .addIndexBuffer(\"TRIANGLES\")\n      .addIndexBuffer(\"LINES\")\n\n    // basically indexes for faces of the cube. vertices each need to be added 3 times,\n    // as they have different normals depending on the face being rendered\n    const VERTEX_CORNERS = [\n      [0, 4, 6, 2], // X = 0\n      [1, 3, 7, 5], // X = 1\n\n      [0, 1, 5, 4], // Y = 0\n      [2, 6, 7, 3], // Y = 1\n\n      [0, 2, 3, 1], // Z = 0\n      [4, 5, 7, 6], // Z = 1\n    ]\n\n    const VERTEX_NORMALS = [\n      V3.X.negated(),\n      V3.X,\n      V3.Y.negated(),\n      V3.Y,\n      V3.Z.negated(),\n      V3.Z,\n    ]\n\n    for (let i = 0; i < 6; i++) {\n      pushQuad(\n        mesh.TRIANGLES,\n        true,\n        mesh.vertices.length,\n        mesh.vertices.length + 1,\n        mesh.vertices.length + 3,\n        mesh.vertices.length + 2,\n      )\n      mesh.vertices.push(\n        ...VERTEX_CORNERS[i].map((j) => Mesh.UNIT_CUBE_CORNERS[j]),\n      )\n      mesh.normals.push(\n        VERTEX_NORMALS[i],\n        VERTEX_NORMALS[i],\n        VERTEX_NORMALS[i],\n        VERTEX_NORMALS[i],\n      )\n    }\n    // indexes of LINES relative to UNIT_CUBE_CORNERS. Mapped to VERTEX_CORNERS.indexOf\n    // so they make sense in the context of the mesh\n    mesh.LINES = [\n      [0, 1],\n      [0, 2],\n      [1, 3],\n      [2, 3],\n\n      [0, 4],\n      [1, 5],\n      [2, 6],\n      [3, 7],\n\n      [4, 5],\n      [4, 6],\n      [5, 7],\n      [6, 7],\n    ]\n      .flatMap((x) => x)\n      .map((i) => {\n        let fvi: number = 0\n        const fi = VERTEX_CORNERS.findIndex(\n          (faceVertexIndexes) => (fvi = faceVertexIndexes.indexOf(i)) != -1,\n        )\n        return fi * 4 + fvi\n      })\n\n    mesh.compile()\n    return mesh\n  }\n\n  static isocahedron() {\n    return Mesh.sphere(0)\n  }\n\n  static sphere2(latitudes: int, longitudes: int) {\n    const baseVertices = arrayFromFunction(latitudes, (i) => {\n      const angle = (i / (latitudes - 1)) * PI - PI / 2\n      return new V3(0, cos(angle), sin(angle))\n    })\n    const vqs = arrayFromFunction(latitudes, (i) => {\n      const angle = (i / (latitudes - 1)) * PI - PI / 2\n      const q = cos(angle)\n      return [(i / (latitudes - 1)) * q, q] as [number, number]\n    })\n    return Mesh.rotation(\n      baseVertices,\n      { anchor: V3.O, dir1: V3.Z },\n      2 * PI,\n      longitudes,\n      true,\n      baseVertices,\n      vqs,\n    )\n  }\n\n  /**\n   * Returns a sphere mesh with radius 1 created by subdividing the faces of a isocahedron (20-sided) recursively\n   * The sphere is positioned at the origin\n   * @param subdivisions\n   *      How many recursive divisions to do. A subdivision divides a triangle into 4,\n   *      so the total number of triangles is 20 * 4^subdivisions\n   * @returns\n   *      Contains vertex and normal1 buffers and index buffers for triangles and LINES\n   */\n  static sphere(subdivisions: int = 3) {\n    const golden = (1 + Math.sqrt(5)) / 2,\n      u = new V3(1, golden, 0).unit(),\n      s = u.x,\n      t = u.y\n    // base vertices of isocahedron\n    const vertices = [\n      new V3(-s, t, 0),\n      new V3(s, t, 0),\n      new V3(-s, -t, 0),\n      new V3(s, -t, 0),\n\n      new V3(0, -s, t),\n      new V3(0, s, t),\n      new V3(0, -s, -t),\n      new V3(0, s, -t),\n\n      new V3(t, 0, -s),\n      new V3(t, 0, s),\n      new V3(-t, 0, -s),\n      new V3(-t, 0, s),\n    ]\n    // base triangles of isocahedron\n    // prettier-ignore\n    const triangles = [\n\t\t\t// 5 faces around point 0\n\t\t\t0, 11, 5,\n\t\t\t0, 5, 1,\n\t\t\t0, 1, 7,\n\t\t\t0, 7, 10,\n\t\t\t0, 10, 11,\n\n\t\t\t// 5 adjacent faces\n\t\t\t1, 5, 9,\n\t\t\t5, 11, 4,\n\t\t\t11, 10, 2,\n\t\t\t10, 7, 6,\n\t\t\t7, 1, 8,\n\n\t\t\t// 5 faces around point 3\n\t\t\t3, 9, 4,\n\t\t\t3, 4, 2,\n\t\t\t3, 2, 6,\n\t\t\t3, 6, 8,\n\t\t\t3, 8, 9,\n\n\t\t\t// 5 adjacent faces\n\t\t\t4, 9, 5,\n\t\t\t2, 4, 11,\n\t\t\t6, 2, 10,\n\t\t\t8, 6, 7,\n\t\t\t9, 8, 1,\n\t\t]\n\n    /**\n     * Tesselates triangle a b c\n     * a b c must already be in vertices with the indexes ia ib ic\n     * res is the number of subdivisions to do. 0 just results in triangle and line indexes being added to the\n     * respective buffers.\n     */\n    function tesselateRecursively(\n      a: V3,\n      b: V3,\n      c: V3,\n      res: int,\n      vertices: V3[],\n      triangles: int[],\n      ia: int,\n      ib: int,\n      ic: int,\n      lines: int[],\n    ) {\n      if (0 == res) {\n        triangles.push(ia, ib, ic)\n        if (ia < ib) lines.push(ia, ib)\n        if (ib < ic) lines.push(ib, ic)\n        if (ic < ia) lines.push(ic, ia)\n      } else {\n        // subdivide the triangle abc into 4 by adding a vertex (with the correct distance from the origin)\n        // between each segment ab, bc and cd, then calling the function recursively\n        const abMid1 = a.plus(b).toLength(1),\n          bcMid1 = b.plus(c).toLength(1),\n          caMid1 = c.plus(a).toLength(1)\n        // indexes of new vertices:\n        const iabm = vertices.length,\n          ibcm = iabm + 1,\n          icam = iabm + 2\n        vertices.push(abMid1, bcMid1, caMid1)\n        tesselateRecursively(\n          abMid1,\n          bcMid1,\n          caMid1,\n          res - 1,\n          vertices,\n          triangles,\n          iabm,\n          ibcm,\n          icam,\n          lines,\n        )\n        tesselateRecursively(\n          a,\n          abMid1,\n          caMid1,\n          res - 1,\n          vertices,\n          triangles,\n          ia,\n          iabm,\n          icam,\n          lines,\n        )\n        tesselateRecursively(\n          b,\n          bcMid1,\n          abMid1,\n          res - 1,\n          vertices,\n          triangles,\n          ib,\n          ibcm,\n          iabm,\n          lines,\n        )\n        tesselateRecursively(\n          c,\n          caMid1,\n          bcMid1,\n          res - 1,\n          vertices,\n          triangles,\n          ic,\n          icam,\n          ibcm,\n          lines,\n        )\n      }\n    }\n\n    const mesh = new Mesh()\n      .addVertexBuffer(\"normals\", \"ts_Normal\")\n      .addIndexBuffer(\"TRIANGLES\")\n      .addIndexBuffer(\"LINES\")\n    mesh.vertices.push(...vertices)\n    subdivisions = undefined == subdivisions ? 4 : subdivisions\n    for (let i = 0; i < 20; i++) {\n      const [ia, ic, ib] = triangles.slice(i * 3, i * 3 + 3)\n      tesselateRecursively(\n        vertices[ia],\n        vertices[ic],\n        vertices[ib],\n        subdivisions,\n        mesh.vertices,\n        mesh.TRIANGLES,\n        ia,\n        ic,\n        ib,\n        mesh.LINES,\n      )\n    }\n\n    mesh.normals = mesh.vertices\n    mesh.compile()\n    return mesh\n  }\n\n  static aabb(aabb: AABB) {\n    const matrix = M4.product(\n      M4.translate(aabb.min),\n      M4.scale(\n        aabb.size().max(new V3(NLA_PRECISION, NLA_PRECISION, NLA_PRECISION)),\n      ),\n    )\n    const mesh = Mesh.cube().transform(matrix)\n    // mesh.vertices = aabb.corners()\n    mesh.computeNormalLines(20)\n    mesh.compile()\n\n    return mesh\n  }\n\n  static offsetVertices(\n    vertices: V3[],\n    offset: V3,\n    close: boolean,\n  ): Mesh & { TRIANGLES: int[]; coords: [number, number][] }\n  static offsetVertices(\n    vertices: V3[],\n    offset: V3,\n    close: boolean,\n    normals: V3[],\n  ): Mesh & { TRIANGLES: int[]; coords: [number, number][]; normals: V3[] }\n  static offsetVertices(\n    vertices: V3[],\n    offset: V3,\n    close: boolean,\n    normals?: V3[],\n  ) {\n    assertVectors.apply(undefined, vertices)\n    assertVectors(offset)\n\n    const mesh = new Mesh()\n      .addIndexBuffer(\"TRIANGLES\")\n      .addVertexBuffer(\"coords\", \"ts_TexCoord\")\n    normals && mesh.addVertexBuffer(\"normals\", \"ts_Normal\")\n    mesh.vertices = vertices.concat(vertices.map((v) => v.plus(offset)))\n    const vl = vertices.length\n    mesh.coords = arrayFromFunction(vl * 2, (i): [number, number] => [\n      (i % vl) / vl,\n      (i / vl) | 0,\n    ])\n\n    const triangles = mesh.TRIANGLES\n    for (let i = 0; i < vertices.length - 1; i++) {\n      pushQuad(\n        triangles,\n        false,\n        i,\n        i + 1,\n        vertices.length + i,\n        vertices.length + i + 1,\n      )\n    }\n    if (close) {\n      pushQuad(\n        triangles,\n        false,\n        vertices.length - 1,\n        0,\n        vertices.length * 2 - 1,\n        vertices.length,\n      )\n    }\n    if (normals) {\n      mesh.normals = normals.concat(normals)\n    }\n    mesh.compile()\n    return mesh\n  }\n\n  // Creates a new $Mesh by rotating $vertices by $totalRads around $lineAxis (according to the right-hand\n  // rule). $steps is the number of steps to take. $close is whether the vertices of the first and last step\n  // should be connected by triangles. If $normals is set (pass an array of V3s of the same length as $vertices),\n  // these will also be rotated and correctly added to the mesh.\n  // @example const precious = Mesh.rotation([V(10, 0, -2), V(10, 0, 2), V(11, 0, 2), V(11, 0, -2)], , L3.Z, 512)\n  static rotation(\n    vertices: V3[],\n    lineAxis: { anchor: V3; dir1: V3 },\n    totalRads: raddd,\n    steps: int,\n    close = true,\n    normals?: V3[],\n    vqs?: [number, number][],\n  ) {\n    const mesh = new Mesh().addIndexBuffer(\"TRIANGLES\")\n    normals && mesh.addVertexBuffer(\"normals\", \"ts_Normal\")\n    vqs && mesh.addVertexBuffer(\"coordsUVQ\", \"ts_TexCoordUVQ\")\n    const vc = vertices.length,\n      vTotal = vc * steps\n\n    const rotMat = new M4()\n    const triangles = mesh.TRIANGLES\n    for (let i = 0; i < steps; i++) {\n      // add triangles\n      const rads = totalRads * (i / steps)\n      M4.rotateLine(lineAxis.anchor, lineAxis.dir1, rads, rotMat)\n      mesh.vertices.push(...rotMat.transformedPoints(vertices))\n\n      normals && mesh.normals!.push(...rotMat.transformedVectors(normals))\n      vqs &&\n        (\n          mesh as unknown as {\n            coordsUVQ: [number, number, number][]\n          }\n        ).coordsUVQ.push(\n          ...vqs.map(([v, q]): [number, number, number] => [\n            (i / steps) * q,\n            v,\n            q,\n          ]),\n        )\n      if (close || i !== steps - 1) {\n        for (let j = 0; j < vc - 1; j++) {\n          pushQuad(\n            triangles,\n            false,\n            i * vc + j + 1,\n            i * vc + j,\n            ((i + 1) * vc + j + 1) % vTotal,\n            ((i + 1) * vc + j) % vTotal,\n          )\n        }\n      }\n    }\n\n    mesh.compile()\n    return mesh\n  }\n\n  static spiral(\n    vertices: V3[],\n    lineAxis: { anchor: V3; dir1: V3 },\n    totalRads: raddd,\n    steps: int,\n    gradient: number,\n    normals?: V3[],\n    vqs?: [number, number][],\n  ) {\n    const mesh = new Mesh().addIndexBuffer(\"TRIANGLES\")\n    normals && mesh.addVertexBuffer(\"normals\", \"ts_Normal\")\n    vqs && mesh.addVertexBuffer(\"coordsUVQ\", \"ts_TexCoordUVQ\")\n    const vc = vertices.length,\n      vTotal = vc * steps\n\n    const rotMat = new M4()\n    const triangles = mesh.TRIANGLES\n    for (let i = 0; i < steps; i++) {\n      // add triangles\n      const rads = totalRads * (i / steps)\n      M4.rotateLine(lineAxis.anchor, lineAxis.dir1, rads, rotMat)\n\n      mesh.vertices.push(\n        ...rotMat\n          .translate(\n            lineAxis.dir1.toLength((totalRads / TAU) * (i / steps) * gradient),\n          )\n          .transformedPoints(vertices),\n      )\n\n      normals && mesh.normals!.push(...rotMat.transformedVectors(normals))\n      vqs &&\n        (\n          mesh as unknown as {\n            coordsUVQ: [number, number, number][]\n          }\n        ).coordsUVQ.push(\n          ...vqs.map(([v, q]): [number, number, number] => [\n            (i / steps) * q,\n            v,\n            q,\n          ]),\n        )\n      if (i !== steps - 1) {\n        for (let j = 0; j < vc - 1; j++) {\n          pushQuad(\n            triangles,\n            false,\n            i * vc + j + 1,\n            i * vc + j,\n            ((i + 1) * vc + j + 1) % vTotal,\n            ((i + 1) * vc + j) % vTotal,\n          )\n        }\n      }\n    }\n\n    mesh.compile()\n    return mesh\n  }\n\n  static parametric(\n    pF: (d: number, z: number) => V3,\n    pN: undefined,\n    sMin: number,\n    sMax: number,\n    tMin: number,\n    tMax: number,\n    sRes: number,\n    tRes: number,\n  ): Mesh & { TRIANGLES: int[] }\n  static parametric(\n    pF: (d: number, z: number) => V3,\n    pN: (d: number, z: number) => V3,\n    sMin: number,\n    sMax: number,\n    tMin: number,\n    tMax: number,\n    sRes: number,\n    tRes: number,\n  ): Mesh & { normals: V3[]; TRIANGLES: int[] }\n  static parametric(\n    pF: (d: number, z: number) => V3,\n    pN: ((d: number, z: number) => V3) | undefined,\n    sMin: number,\n    sMax: number,\n    tMin: number,\n    tMax: number,\n    sRes: number,\n    tRes: number,\n  ) {\n    const mesh = new Mesh()\n      .addIndexBuffer(\"TRIANGLES\")\n      .addVertexBuffer(\"normals\", \"ts_Normal\")\n    for (let si = 0; si <= sRes; si++) {\n      const s = lerp(sMin, sMax, si / sRes)\n      for (let ti = 0; ti <= tRes; ti++) {\n        const t = lerp(tMin, tMax, ti / tRes)\n        mesh.vertices.push(pF(s, t))\n        pN && mesh.normals.push(pN(s, t))\n        if (ti < tRes && si < sRes) {\n          const offset = ti + si * (tRes + 1)\n          pushQuad(\n            mesh.TRIANGLES,\n            false,\n            offset,\n            offset + tRes + 1,\n            offset + 1,\n            offset + tRes + 2,\n          )\n        }\n      }\n    }\n    return mesh\n  }\n\n  static load(json: {\n    vertices: Tuple3<number>[]\n    triangles?: Tuple3<number>[]\n    normals?: Tuple3<number>[]\n  }) {\n    const mesh = new Mesh()\n    if (Array.isArray(json.vertices[0])) {\n      mesh.vertices = json.vertices.map((x) => V(x))\n    } else {\n      throw new Error()\n    }\n    if (json.triangles) {\n      mesh.addIndexBuffer(\"TRIANGLES\")\n      ;(mesh as any).TRIANGLES = json.triangles\n    }\n    if (json.normals) {\n      mesh.addVertexBuffer(\"normals\", \"ts_Normal\")\n      ;(mesh as any).normals = json.normals\n    }\n    mesh.compile()\n    return mesh\n  }\n\n  toJSON() {\n    return {\n      vertices: this.vertices.map((x) => x.toArray()),\n      TRIANGLES: (this as any).TRIANGLES,\n    }\n  }\n}\n","/* tslint:disable:no-string-literal */\n/// <reference types=\"webgl-strict-types\" />\nimport {\n  assert,\n  assertf,\n  assertInst,\n  assertVectors,\n  int,\n  M4,\n  NLA_DEBUG,\n  V3,\n} from \"ts3dutils\"\n\nimport { Buffer, currentGL, GL_COLOR, Mesh, TSGLContext } from \"./index\"\n\nimport GL = WebGLRenderingContextStrict\nimport formatCompilerError from \"gl-format-compiler-error\"\nconst WGL =\n  WebGLRenderingContext as any as WebGLRenderingContextStrict.Constants\n\n/**\n * These are all the draw modes usable in OpenGL ES\n */\nconst DRAW_MODE_NAMES = {\n  [WGL.POINTS]: \"POINTS\",\n  [WGL.LINES]: \"LINES\",\n  [WGL.LINE_STRIP]: \"LINE_STRIP\",\n  [WGL.LINE_LOOP]: \"LINE_LOOP\",\n  [WGL.TRIANGLES]: \"TRIANGLES\",\n  [WGL.TRIANGLE_STRIP]: \"TRIANGLE_STRIP\",\n  [WGL.TRIANGLE_FAN]: \"TRIANGLE_FAN\",\n}\nconst DRAW_MODE_CHECKS: { [type: string]: (x: int) => boolean } = {\n  [WGL.POINTS]: (_) => true,\n  [WGL.LINES]: (x) => 0 == x % 2, // divisible by 2\n  [WGL.LINE_STRIP]: (x) => x > 2, // need at least 2\n  [WGL.LINE_LOOP]: (x) => x > 2, // more like > 3, but oh well\n  [WGL.TRIANGLES]: (x) => 0 == x % 3, // divisible by 3\n  [WGL.TRIANGLE_STRIP]: (x) => x > 3,\n  [WGL.TRIANGLE_FAN]: (x) => x > 3,\n}\n\nexport const SHADER_VAR_TYPES = [\n  \"FLOAT\",\n  \"FLOAT_MAT2\",\n  \"FLOAT_MAT3\",\n  \"FLOAT_MAT4\",\n  \"FLOAT_VEC2\",\n  \"FLOAT_VEC3\",\n  \"FLOAT_VEC4\",\n  \"INT\",\n  \"INT_VEC2\",\n  \"INT_VEC3\",\n  \"INT_VEC4\",\n  \"UNSIGNED_INT\",\n]\n\nexport function isArray<T>(obj: any): obj is T[] {\n  return (\n    Array == obj.constructor ||\n    Float32Array == obj.constructor ||\n    Float64Array == obj.constructor\n  )\n}\n\nexport interface UniformTypesMap {\n  FLOAT_VEC4: GL_COLOR | V3\n  FLOAT_VEC3: [number, number, number] | V3\n  FLOAT_VEC2: [number, number] | V3\n  FLOAT: number\n  INT: int\n  UNSIGNED_INT: int\n  FLOAT_MAT4: M4 | number[]\n  FLOAT_MAT3: M4 | number[]\n  SAMPLER_2D: int\n  BOOL: boolean\n}\nexport type UniformTypes = keyof UniformTypesMap\n\nfunction isFloatArray(obj: any): obj is number[] | Float64Array | Float32Array {\n  return (\n    Float32Array == obj.constructor ||\n    Float64Array == obj.constructor ||\n    (Array.isArray(obj) && obj.every((x) => \"number\" == typeof x))\n  )\n}\n\nfunction isIntArray(x: any) {\n  if (\n    [\n      Int8Array,\n      Uint8Array,\n      Uint8ClampedArray,\n      Int16Array,\n      Uint16Array,\n      Int32Array,\n      Uint32Array,\n    ].some((y) => x instanceof y)\n  ) {\n    return true\n  }\n  return (\n    (x instanceof Float32Array ||\n      x instanceof Float64Array ||\n      Array.isArray(x)) &&\n    (x as number[]).every((x) => Number.isInteger(x))\n  )\n}\n\nexport type ShaderType<UniformTypes, AttributeTypes = {}> = string & {\n  T?: UniformTypes\n  A?: AttributeTypes\n}\nexport type VarTypeMap = { [name: string]: UniformTypes }\nexport type ShaderSource<\n  U extends VarTypeMap,\n  IN extends VarTypeMap,\n  OUT extends VarTypeMap,\n  kind extends \"vertex\" | \"fragment\",\n> = string & { U: U; IN: IN; OUT: OUT; kind: kind }\n\n//const x:UniformTypes = undefined as 'FLOAT_VEC4' | 'FLOAT_VEC3'\nexport class Shader<\n  UniformTypes extends VarTypeMap = any,\n  AttributeTypes extends VarTypeMap = any,\n> {\n  program: WebGLProgram\n  activeMatrices: { [matrixName: string]: boolean }\n  attributeLocations: { [attributeName: string]: number }\n  constantAttributes: { [attributeName: string]: boolean }\n  uniformLocations: { [uniformName: string]: WebGLUniformLocation }\n  uniformInfos: { [uniformName: string]: GL.WebGLActiveInfo<GL.UniformType> }\n  projectionMatrixVersion = -1\n  modelViewMatrixVersion = -1\n\n  /**\n   * Create shader drom typed vertex and fragment source. Weird generic\n   * arguments are because the vertex shader is required to have the OUT types\n   * the fragment shader needs as IN, but not vice-versa.\n   */\n  static create<\n    FragSrc extends ShaderSource<{}, {}, {}, \"fragment\">,\n    VertSrc extends ShaderSource<{}, {}, FragSrc[\"IN\"], \"vertex\">,\n  >(\n    vertexSource: VertSrc,\n    fragmentSource: FragSrc,\n    gl?: TSGLContext,\n  ): Shader<VertSrc[\"U\"] & FragSrc[\"U\"], VertSrc[\"IN\"]>\n  /**\n   * Create shader from typed vertex and untyped fragment source. Uniform of\n   * the fragment shader can optionally be manually specified.\n   */\n  static create<\n    FU extends VarTypeMap,\n    VertSrc extends ShaderSource<{}, {}, {}, \"vertex\">,\n  >(\n    vertexSource: VertSrc,\n    fragmentSource: string & { IN?: undefined },\n    gl?: TSGLContext,\n  ): Shader<FU & VertSrc[\"U\"], VertSrc[\"IN\"]>\n  /**\n   * Create shader from untyped vertex and typed fragment source. Uniform and\n   * attribute types of the shader can optionally be manually specified.\n   */\n  static create<\n    VU extends VarTypeMap,\n    VA extends VarTypeMap,\n    FragSrc extends ShaderSource<{}, {}, {}, \"vertex\">,\n  >(\n    vertexSource: string & { IN?: undefined },\n    fragmentSource: FragSrc,\n    gl?: TSGLContext,\n  ): Shader<VU & FragSrc[\"U\"], VA>\n  /**\n   * Create shader from untyped vertex and fragment source. Uniform and\n   * attribute types of the shader can optionally be manually specified.\n   */\n  static create<U extends VarTypeMap = {}, A extends VarTypeMap = {}>(\n    vertexSource: string & { IN?: undefined },\n    fragmentSource: string & { IN?: undefined },\n    gl?: TSGLContext,\n    name?: string,\n  ): Shader<U, A>\n  static create(\n    vertexSource: string,\n    fragmentSource: string,\n    gl?: TSGLContext,\n    name?: string,\n  ) {\n    return new Shader(vertexSource, fragmentSource, gl, name) as any\n  }\n\n  /**\n   * Provides a convenient wrapper for WebGL shaders. A few uniforms and\n   * attributes, prefixed with `gl_`, are automatically added to all shader\n   * sources to make simple shaders easier to write. Headers for the following\n   * variables are automatically prepended to the passed source. The correct\n   * variables are also automatically passed to the shader when drawing.\n   *\n   * For vertex and fragment shaders:\n   uniform mat3 ts_NormalMatrix;\n   uniform mat4 ts_ModelViewMatrix;\n   uniform mat4 ts_ProjectionMatrix;\n   uniform mat4 ts_ModelViewProjectionMatrix;\n   uniform mat4 ts_ModelViewMatrixInverse;\n   uniform mat4 ts_ProjectionMatrixInverse;\n   uniform mat4 ts_ModelViewProjectionMatrixInverse;\n   *\n   *\n   * Example usage:\n   *\n   *  const shader = new GL.Shader(\n   *      `void main() { gl_Position = ts_ModelViewProjectionMatrix *\n   * ts_Vertex; }`,\n   *      `uniform vec4 color; void main() { gl_FragColor = color; }`)\n   *\n   *  shader.uniforms({ color: [1, 0, 0, 1] }).draw(mesh)\n   *\n   * Compiles a shader program using the provided vertex and fragment shaders.\n   */\n  protected constructor(\n    vertexSource: string,\n    fragmentSource: string,\n    readonly gl = currentGL(),\n    readonly name?: string,\n  ) {\n    // const versionRegex = /^(?:\\s+|\\/\\/[\\s\\S]*?[\\r\\n]+|\\/\\*[\\s\\S]*?\\*\\/)+(#version\\s+(\\d+)\\s+es)/\n    // Headers are prepended to the sources to provide some automatic functionality.\n    const header = `\n    uniform mat3 ts_NormalMatrix;\n    uniform mat4 ts_ModelViewMatrix;\n    uniform mat4 ts_ProjectionMatrix;\n    uniform mat4 ts_ModelViewProjectionMatrix;\n    uniform mat4 ts_ModelViewMatrixInverse;\n    uniform mat4 ts_ProjectionMatrixInverse;\n    uniform mat4 ts_ModelViewProjectionMatrixInverse;\n  `\n    const matrixNames = header.match(/\\bts_\\w+/g)\n\n    // Compile and link errors are thrown as strings.\n    function compileSource(type: GL.ShaderType, source: string) {\n      const shader = gl.createShader(type)!\n      gl.shaderSource(shader, source)\n      gl.compileShader(shader)\n      if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n        const shaderInfoLog = gl.getShaderInfoLog(shader)!\n        const fmt = formatCompilerError(shaderInfoLog, source, type)\n        console.warn(fmt.long)\n        throw Object.assign(new Error(fmt.short), { shaderSource: source })\n      }\n      return shader\n    }\n\n    this.program = gl.createProgram()!\n    gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource))\n    gl.attachShader(\n      this.program,\n      compileSource(gl.FRAGMENT_SHADER, fragmentSource),\n    )\n    gl.linkProgram(this.program)\n    if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n      throw new Error(\"link error: \" + gl.getProgramInfoLog(this.program))\n    }\n    this.attributeLocations = {}\n    this.uniformLocations = {}\n    this.constantAttributes = {}\n\n    // Check for the use of built-in matrices that require expensive matrix\n    // multiplications to compute, and record these in `activeMatrices`.\n    this.activeMatrices = {}\n    matrixNames &&\n      matrixNames.forEach((name) => {\n        if (gl.getUniformLocation(this.program, name)) {\n          this.activeMatrices[name] = true\n        }\n      })\n\n    this.uniformInfos = {}\n    for (\n      let i = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\n      i-- > 0;\n\n    ) {\n      // see https://www.khronos.org/registry/OpenGL-Refpages/es2.0/xhtml/glGetActiveUniform.xml\n      // this.program has already been checked\n      // i is in bounds\n      const info = gl.getActiveUniform(this.program, i)!\n      this.uniformInfos[info.name] = info\n    }\n  }\n\n  /**\n   * Set a uniform for each property of `uniforms`. The correct\n   * `viewerGL.uniform*()` method is inferred from the value types and from the\n   * stored uniform sampler flags.\n   */\n  uniforms(\n    uniforms: Partial<{\n      [K in keyof UniformTypes]: UniformTypesMap[UniformTypes[K]]\n    }>,\n  ): this {\n    const gl = this.gl\n    gl.useProgram(this.program)\n\n    for (const name in uniforms) {\n      const location =\n        this.uniformLocations[name] || gl.getUniformLocation(this.program, name)\n      // !location && console.warn(name + ' uniform is not used in shader')\n      if (!location) continue\n      this.uniformLocations[name] = location\n      let value: any = uniforms[name] as any\n      const info = this.uniformInfos[name]\n      if (NLA_DEBUG) {\n        if (!info) {\n          throw new Error(\n            `uniform ${name} is not defined (available = ${Object.keys(\n              this.uniformInfos,\n            ).join(\",\")})`,\n          )\n        }\n        // TODO: better errors\n        if (\n          gl.SAMPLER_2D == info.type ||\n          gl.SAMPLER_CUBE == info.type ||\n          gl.INT == info.type\n        ) {\n          if (1 == info.size) {\n            assert(Number.isInteger(value))\n          } else {\n            assert(\n              isIntArray(value) && value.length == info.size,\n              \"value must be int array if info.size != 1\",\n            )\n          }\n        }\n        assert(\n          gl.FLOAT != info.type ||\n            (1 == info.size && \"number\" === typeof value) ||\n            isFloatArray(value),\n        )\n        assert(\n          gl.FLOAT_VEC3 != info.type ||\n            (1 == info.size && value instanceof V3) ||\n            (Array.isArray(value) &&\n              info.size == value.length &&\n              assertVectors(...value)),\n        )\n        assert(\n          gl.FLOAT_VEC4 != info.type ||\n            1 != info.size ||\n            (isFloatArray(value) && value.length == 4),\n        )\n        assert(gl.FLOAT_MAT4 != info.type || value instanceof M4, () =>\n          value.toSource(),\n        )\n        assert(\n          gl.FLOAT_MAT3 != info.type ||\n            value.length == 9 ||\n            value instanceof M4,\n        )\n      }\n      if (value instanceof V3) {\n        value = value.toArray()\n      }\n      if (gl.FLOAT_VEC4 == info.type && info.size != 1) {\n        if (value instanceof Float32Array || value instanceof Float64Array) {\n          gl.uniform4fv(\n            location,\n            value instanceof Float32Array ? value : Float32Array.from(value),\n          )\n        } else {\n          gl.uniform4fv(\n            location,\n            value.flatMap((x: any[]) => x),\n          )\n        }\n      } else if (gl.FLOAT == info.type && info.size != 1) {\n        gl.uniform1fv(location, value)\n      } else if (gl.FLOAT_VEC3 == info.type && info.size != 1) {\n        gl.uniform3fv(location, V3.pack(value))\n      } else if (value.length) {\n        switch (value.length) {\n          case 1:\n            gl.uniform1fv(location, value)\n            break\n          case 2:\n            gl.uniform2fv(location, value)\n            break\n          case 3:\n            gl.uniform3fv(location, value)\n            break\n          case 4:\n            gl.uniform4fv(location, value)\n            break\n          // Matrices are automatically transposed, since WebGL uses column-major\n          // indices instead of row-major indices.\n          case 9:\n            // prettier-ignore\n            gl.uniformMatrix3fv(location, false, new Float32Array([\n              value[0], value[3], value[6],\n              value[1], value[4], value[7],\n              value[2], value[5], value[8],\n            ]))\n            break\n          case 16:\n            // prettier-ignore\n            gl.uniformMatrix4fv(location, false, new Float32Array([\n              value[0], value[4], value[8], value[12],\n              value[1], value[5], value[9], value[13],\n              value[2], value[6], value[10], value[14],\n              value[3], value[7], value[11], value[15],\n            ]))\n            break\n          default:\n            throw new Error(\n              \"don't know how to load uniform \\\"\" +\n                name +\n                '\" of length ' +\n                value.length,\n            )\n        }\n      } else if (\"number\" == typeof value) {\n        if (gl.FLOAT === info.type) {\n          gl.uniform1f(location, value)\n        } else {\n          gl.uniform1i(location, value)\n        }\n      } else if (\"boolean\" == typeof value) {\n        gl.uniform1i(location, +value)\n      } else if (value instanceof M4) {\n        const m = value.m\n        if (gl.FLOAT_MAT4 == info.type) {\n          // prettier-ignore\n          gl.uniformMatrix4fv(location, false, [\n            m[0], m[4], m[8], m[12],\n            m[1], m[5], m[9], m[13],\n            m[2], m[6], m[10], m[14],\n            m[3], m[7], m[11], m[15]])\n        } else if (gl.FLOAT_MAT3 == info.type) {\n          // prettier-ignore\n          gl.uniformMatrix3fv(location, false, [\n            m[0], m[4], m[8],\n            m[1], m[5], m[9],\n            m[2], m[6], m[10]])\n        } else if (gl.FLOAT_MAT2 == info.type) {\n          // prettier-ignore\n          gl.uniformMatrix2fv(location, false, new Float32Array([\n            m[0], m[4],\n            m[1], m[5]]))\n        } else {\n          throw new Error(`Can't assign M4 to ${info.type}`)\n        }\n      } else {\n        throw new Error(\n          'attempted to set uniform \"' + name + '\" to invalid value ' + value,\n        )\n      }\n    }\n\n    return this\n  }\n\n  attributes(\n    attributes: Partial<{\n      [K in keyof AttributeTypes]: UniformTypesMap[AttributeTypes[K]]\n    }>,\n  ): this {\n    const gl = this.gl\n    gl.useProgram(this.program)\n\n    for (const name in attributes) {\n      const location =\n        this.attributeLocations[name] ||\n        gl.getAttribLocation(this.program, name)\n      if (location == -1) {\n        if (!name.startsWith(\"ts_\")) {\n          console.warn(\n            `[shader ${this.name}] Vertex buffer ${name} was not bound because the attribute is not active.`,\n          )\n        }\n        continue\n      }\n      this.attributeLocations[name] = location\n      gl.disableVertexAttribArray(location)\n      let value = attributes[name]\n      if (value instanceof V3) {\n        // TODO: figure out the types here...\n        value = value.toArray() as any\n      }\n      if (\"number\" === typeof value) {\n        gl.vertexAttrib1f(location, value)\n      } else {\n        gl.vertexAttrib4fv(location, value as number[])\n        // switch ((value as number[]).length) {\n        //   case 1:\n        //     gl.vertexAttrib1fv(location, value as number[])\n        //     break\n        //   case 2:\n        //     gl.vertexAttrib2fv(location, value as number[])\n        //     break\n        //   case 3:\n        //     gl.vertexAttrib3fv(location, value as number[])\n        //     break\n        //   case 4:\n        //     break\n        // }\n      }\n      this.constantAttributes[name] = true\n    }\n    return this\n  }\n\n  /**\n   * Sets all uniform matrix attributes, binds all relevant buffers, and draws\n   * the mesh geometry as indexed triangles or indexed LINES. Set `mode` to\n   * `gl.LINES` (and either add indices to `LINES` or call\n   * `computeWireframe()`) to draw the mesh in wireframe.\n   *\n   * @param mesh\n   * @param mode Defaults to 'TRIANGLES'. Must be passed as string so the\n   *   correct index buffer can be automatically drawn.\n   * @param start int\n   * @param count int\n   */\n  draw(\n    mesh: Mesh,\n    mode: GL.DrawMode = WGL.TRIANGLES,\n    start?: int,\n    count?: int,\n  ): this {\n    assert(mesh.hasBeenCompiled, \"mesh.hasBeenCompiled\")\n    assert(undefined != DRAW_MODE_NAMES[mode])\n    const modeName: string = DRAW_MODE_NAMES[mode]\n    // assert(mesh.indexBuffers[modeStr], `mesh.indexBuffers[${modeStr}] undefined`)\n    return this.drawBuffers(\n      mesh.vertexBuffers,\n      mesh.indexBuffers[modeName],\n      mode,\n      start,\n      count,\n    )\n  }\n\n  private outputWarnings: { [key: string]: boolean } = {}\n\n  /**\n   * Sets all uniform matrix attributes, binds all relevant buffers, and draws\n   * the indexed mesh geometry. The `vertexBuffers` argument is a map from\n   * attribute names to `Buffer` objects of type `WGL.ARRAY_BUFFER`,\n   * `indexBuffer` is a `Buffer` object of type `WGL.ELEMENT_ARRAY_BUFFER`, and\n   * `mode` is a WebGL primitive mode like `WGL.TRIANGLES` or `WGL.LINES`. This\n   * method automatically creates and caches vertex attribute pointers for\n   * attributes as needed.\n   */\n  drawBuffers(\n    vertexBuffers: { [attributeName: string]: Buffer },\n    indexBuffer: Buffer | undefined,\n    mode: GL.DrawMode = WGL.TRIANGLES,\n    start: int = 0,\n    count?: int,\n  ): this {\n    const gl = this.gl\n    assert(undefined != DRAW_MODE_NAMES[mode])\n    assertf(() => 1 <= Object.keys(vertexBuffers).length)\n    Object.keys(vertexBuffers).forEach((key) =>\n      assertInst(Buffer, vertexBuffers[key]),\n    )\n\n    // Only varruct up the built-in matrices that are active in the shader\n    const on = this.activeMatrices\n    const modelViewMatrixInverse =\n      (on[\"ts_ModelViewMatrixInverse\"] || on[\"ts_NormalMatrix\"]) &&\n      //&& this.modelViewMatrixVersion != gl.modelViewMatrixVersion\n      gl.modelViewMatrix.inversed()\n    const projectionMatrixInverse =\n      on[\"ts_ProjectionMatrixInverse\"] &&\n      //&& this.projectionMatrixVersion != gl.projectionMatrixVersion\n      gl.projectionMatrix.inversed()\n    const modelViewProjectionMatrix =\n      (on[\"ts_ModelViewProjectionMatrix\"] ||\n        on[\"ts_ModelViewProjectionMatrixInverse\"]) &&\n      //&& (this.projectionMatrixVersion != gl.projectionMatrixVersion || this.modelViewMatrixVersion !=\n      // gl.modelViewMatrixVersion)\n      gl.projectionMatrix.times(gl.modelViewMatrix)\n\n    const uni: { [matrixName: string]: M4 } = {} // Uniform Matrices\n    on[\"ts_ModelViewMatrix\"] &&\n      this.modelViewMatrixVersion != gl.modelViewMatrixVersion &&\n      (uni[\"ts_ModelViewMatrix\"] = gl.modelViewMatrix)\n    on[\"ts_ModelViewMatrixInverse\"] &&\n      (uni[\"ts_ModelViewMatrixInverse\"] = modelViewMatrixInverse as M4)\n    on[\"ts_ProjectionMatrix\"] &&\n      this.projectionMatrixVersion != gl.projectionMatrixVersion &&\n      (uni[\"ts_ProjectionMatrix\"] = gl.projectionMatrix)\n    projectionMatrixInverse &&\n      (uni[\"ts_ProjectionMatrixInverse\"] = projectionMatrixInverse)\n    modelViewProjectionMatrix &&\n      (uni[\"ts_ModelViewProjectionMatrix\"] = modelViewProjectionMatrix)\n    modelViewProjectionMatrix &&\n      on[\"ts_ModelViewProjectionMatrixInverse\"] &&\n      (uni[\"ts_ModelViewProjectionMatrixInverse\"] =\n        modelViewProjectionMatrix.inversed())\n    on[\"ts_NormalMatrix\"] &&\n      this.modelViewMatrixVersion != gl.modelViewMatrixVersion &&\n      (uni[\"ts_NormalMatrix\"] = (modelViewMatrixInverse as M4).transposed())\n    this.uniforms(uni as any)\n    this.projectionMatrixVersion = gl.projectionMatrixVersion\n    this.modelViewMatrixVersion = gl.modelViewMatrixVersion\n\n    // Create and enable attribute pointers as necessary.\n    let minVertexBufferLength = Infinity\n    for (const attribute in vertexBuffers) {\n      const buffer = vertexBuffers[attribute]\n      assert(buffer.hasBeenCompiled)\n      const location =\n        this.attributeLocations[attribute] ||\n        gl.getAttribLocation(this.program, attribute)\n      if (location == -1 || !buffer.buffer) {\n        if (!attribute.startsWith(\"ts_\")) {\n          console.warn(\n            `[shader ${this.name}] Vertex buffer ${attribute} was not bound because the attribute is not active.`,\n          )\n        }\n        continue\n      }\n      this.attributeLocations[attribute] = location\n      gl.bindBuffer(WGL.ARRAY_BUFFER, buffer.buffer)\n\n      gl.enableVertexAttribArray(location)\n\n      gl.vertexAttribPointer(location, buffer.spacing, WGL.FLOAT, false, 0, 0)\n\n      minVertexBufferLength = Math.min(minVertexBufferLength, buffer.count)\n    }\n\n    // Disable unused attribute pointers.\n    for (const attribute in this.attributeLocations) {\n      if (!(attribute in vertexBuffers)) {\n        gl.disableVertexAttribArray(this.attributeLocations[attribute])\n      }\n    }\n\n    if (NLA_DEBUG) {\n      const numAttribs = gl.getProgramParameter(\n        this.program,\n        gl.ACTIVE_ATTRIBUTES,\n      )\n      for (let i = 0; i < numAttribs; ++i) {\n        const buffer = gl.getVertexAttrib(\n          i,\n          gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING,\n        )\n        if (!buffer) {\n          const info = gl.getActiveAttrib(this.program, i)!\n          if (\n            !this.constantAttributes[info.name] &&\n            !this.outputWarnings[info.name]\n          ) {\n            this.outputWarnings[info.name] = true\n            console.warn(\n              \"No buffer is bound to attribute \" +\n                info.name +\n                \" and it was not set with .attributes()\",\n            )\n          }\n        }\n        // console.log('name:', info.name, 'type:', info.type, 'size:', info.size)\n      }\n    }\n\n    // Draw the geometry.\n    if (minVertexBufferLength) {\n      if (undefined === count) {\n        count = indexBuffer ? indexBuffer.count : minVertexBufferLength\n      }\n      assert(\n        DRAW_MODE_CHECKS[mode](count),\n        \"count \" +\n          count +\n          \"doesn't fulfill requirement +\" +\n          DRAW_MODE_CHECKS[mode].toString() +\n          \" for mode \" +\n          DRAW_MODE_NAMES[mode],\n      )\n\n      if (indexBuffer) {\n        assert(indexBuffer.hasBeenCompiled)\n        assert(minVertexBufferLength > indexBuffer.maxValue!)\n        assert(count % indexBuffer.spacing == 0)\n        assert(start % indexBuffer.spacing == 0)\n        if (start + count > indexBuffer.count) {\n          throw new Error(\n            \"Buffer not long enough for passed parameters start/length/buffer length \" +\n              start +\n              \" \" +\n              count +\n              \" \" +\n              indexBuffer.count,\n          )\n        }\n        gl.bindBuffer(WGL.ELEMENT_ARRAY_BUFFER, indexBuffer.buffer!)\n        // start parameter has to be multiple of sizeof(WGL.UNSIGNED_SHORT)\n        gl.drawElements(\n          mode,\n          count,\n          indexBuffer.bindSize as GL[\"UNSIGNED_SHORT\"],\n          indexBuffer.type.BYTES_PER_ELEMENT * start,\n        )\n      } else {\n        if (start + count > minVertexBufferLength) {\n          throw new Error(\"invalid\")\n        }\n        gl.drawArrays(mode, start, count)\n      }\n      gl.drawCallCount++\n    }\n\n    return this\n  }\n}\n","/// <reference types=\"webgl-strict-types\" />\nimport { assert, int } from \"ts3dutils\"\n\nimport { currentGL, TSGLContext } from \"./index\"\nimport GL = WebGLRenderingContextStrict\nimport GL2 = WebGL2RenderingContextStrict\n\nexport interface TextureOptions {\n  wrap?: GL.TextureWrap // defaults to WGL.CLAMP_TO_EDGE, or set wrapS and wrapT individually.\n  wrapS?: GL.TextureWrap\n  wrapT?: GL.TextureWrap\n  filter?: GL.TextureMagFilter // defaults to WGL.LINEAR, or set minFilter and magFilter individually.\n  minFilter?: GL.TextureMinFilter\n  magFilter?: GL.TextureMagFilter\n  format?: GL2.TextureFormat // defaults to WGL.RGBA.\n  internalFormat?: GL2.TextureInternalFormat\n  type?: GL.ReadPixelsType // defaults to WGL.UNSIGNED_BYTE.\n  data?: any\n}\n\nexport class Texture {\n  height: int\n  width: int\n  texture: WebGLTexture\n  // e.g. viewerGL.UNSIGNED_BYTE, viewerGL.FLOAT\n  internalFormat: GL2.TextureInternalFormat\n  format: GL2.TextureFormat\n  // e.g. viewerGL.RGBA\n  type: GL.ReadPixelsType\n\n  /**\n   * Provides a simple wrapper around WebGL textures that supports render-to-texture.\n   *\n   * The arguments `width` and `height` give the size of the texture in texels.\n   * WebGL texture dimensions must be powers of two unless `filter` is set to\n   * either `WGL.NEAREST` or `WGL.LINEAR` and `wrap` is set to `WGL.CLAMP_TO_EDGE`\n   * (which they are by default).\n   *\n   * Texture parameters can be passed in via the `options` argument.\n   * Example usage:\n   *\n   *      let tex = new GL.Texture(256, 256, {\n   *       magFilter: WGL.NEAREST,\n   *       minFilter: WGL.LINEAR,\n   *\n   *       wrapS: WGL.REPEAT,\n   *       wrapT: WGL.REPEAT,\n   *\n   *       format: WGL.RGB, // Defaults to WGL.RGBA\n   *       type: WGL.FLOAT // Defaults to WGL.UNSIGNED_BYTE\n   *     })\n   *\n   */\n  constructor(\n    width: int,\n    height: int,\n    options: TextureOptions = {},\n    readonly gl = currentGL(),\n  ) {\n    this.width = width\n    this.height = height\n    this.format = options.format || gl.RGBA\n    this.internalFormat = options.internalFormat || gl.RGBA\n    this.type = options.type || gl.UNSIGNED_BYTE\n    const magFilter = options.filter || options.magFilter || gl.LINEAR\n    const minFilter = options.filter || options.minFilter || gl.LINEAR\n    if (this.type === gl.FLOAT) {\n      if (gl.version != 2 && !gl.getExtension(\"OES_texture_float\")) {\n        throw new Error(\"OES_texture_float is required but not supported\")\n      }\n      if (\n        (minFilter !== gl.NEAREST || magFilter !== gl.NEAREST) &&\n        !gl.getExtension(\"OES_texture_float_linear\")\n      ) {\n        throw new Error(\n          \"OES_texture_float_linear is required but not supported\",\n        )\n      }\n    } else if (this.type === gl.HALF_FLOAT_OES) {\n      if (!gl.getExtension(\"OES_texture_half_float\")) {\n        throw new Error(\"OES_texture_half_float is required but not supported\")\n      }\n      if (\n        (minFilter !== gl.NEAREST || magFilter !== gl.NEAREST) &&\n        !gl.getExtension(\"OES_texture_half_float_linear\")\n      ) {\n        throw new Error(\n          \"OES_texture_half_float_linear is required but not supported\",\n        )\n      }\n    }\n\n    this.texture = gl.createTexture()!\n    gl.bindTexture(gl.TEXTURE_2D, this.texture)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, magFilter)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter)\n    gl.texParameteri(\n      gl.TEXTURE_2D,\n      gl.TEXTURE_WRAP_S,\n      options.wrap || options.wrapS || gl.CLAMP_TO_EDGE,\n    )\n    gl.texParameteri(\n      gl.TEXTURE_2D,\n      gl.TEXTURE_WRAP_T,\n      options.wrap || options.wrapT || gl.CLAMP_TO_EDGE,\n    )\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      this.internalFormat as any,\n      width,\n      height,\n      0,\n      this.format as any,\n      this.type as any,\n      options.data,\n    )\n  }\n\n  setData(data: ArrayBufferView) {\n    this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture)\n    this.gl.texImage2D(\n      this.gl.TEXTURE_2D,\n      0,\n      this.internalFormat as any,\n      this.width,\n      this.height,\n      0,\n      this.format as any,\n      this.type as any,\n      data as any,\n    )\n  }\n\n  downloadData(data: ArrayBufferView) {\n    if (!this.framebuffer) {\n      throw new Error(\n        \"No framebuffer. You need to draw to this texture before it makes sense to read from it.\",\n      )\n    }\n    const gl = this.gl\n    const prevFramebuffer = gl.getParameter(gl.FRAMEBUFFER_BINDING)\n    this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this.framebuffer)\n    this.gl.readPixels(\n      0,\n      0,\n      this.width,\n      this.height,\n      this.format as any,\n      this.type as any,\n      data as any,\n    )\n    prevFramebuffer !== this.framebuffer &&\n      gl.bindFramebuffer(gl.FRAMEBUFFER, prevFramebuffer)\n  }\n\n  bind(unit: int) {\n    this.gl.activeTexture((this.gl.TEXTURE0 + unit) as GL.TextureUnit)\n    this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture)\n  }\n\n  unbind(unit: int) {\n    this.gl.activeTexture((this.gl.TEXTURE0 + unit) as GL.TextureUnit)\n    this.gl.bindTexture(this.gl.TEXTURE_2D, null)\n  }\n\n  private framebuffer: WebGLFramebuffer | undefined\n  static checkerBoardCanvas: HTMLCanvasElement\n\n  drawTo(render: (gl: TSGLContext) => void): void {\n    const gl = this.gl\n    const prevFramebuffer = gl.getParameter(gl.FRAMEBUFFER_BINDING)\n    if (!this.framebuffer) {\n      // create a renderbuffer for the depth component\n      const prevRenderbuffer = gl.getParameter(gl.RENDERBUFFER_BINDING)\n      const depthRenderbuffer = gl.createRenderbuffer()\n      gl.bindRenderbuffer(gl.RENDERBUFFER, depthRenderbuffer)\n      // DEPTH_COMPONENT16 is the only depth format\n      gl.renderbufferStorage(\n        gl.RENDERBUFFER,\n        gl.DEPTH_COMPONENT16,\n        this.width,\n        this.height,\n      )\n      gl.bindRenderbuffer(gl.RENDERBUFFER, prevRenderbuffer)\n\n      // create a framebuffer to render to\n      this.framebuffer = gl.createFramebuffer()!\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer)\n      gl.framebufferTexture2D(\n        gl.FRAMEBUFFER,\n        gl.COLOR_ATTACHMENT0,\n        gl.TEXTURE_2D,\n        this.texture,\n        0,\n      )\n      gl.framebufferRenderbuffer(\n        gl.FRAMEBUFFER,\n        gl.DEPTH_ATTACHMENT,\n        gl.RENDERBUFFER,\n        depthRenderbuffer,\n      )\n      if (\n        gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE\n      ) {\n        throw new Error(\n          \"Rendering to this texture is not supported (incomplete this.framebuffer)\",\n        )\n      }\n    } else if (prevFramebuffer !== this.framebuffer) {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer)\n    }\n\n    const prevViewport = gl.getParameter(gl.VIEWPORT)\n\n    gl.viewport(0, 0, this.width, this.height)\n    render(gl)\n\n    // restore previous state\n    prevFramebuffer !== this.framebuffer &&\n      gl.bindFramebuffer(gl.FRAMEBUFFER, prevFramebuffer)\n    gl.viewport(\n      prevViewport[0],\n      prevViewport[1],\n      prevViewport[2],\n      prevViewport[3],\n    )\n  }\n\n  swapWith(other: Texture): void {\n    assert(this.gl == other.gl)\n    let temp\n    temp = other.texture\n    other.texture = this.texture\n    this.texture = temp\n\n    temp = other.width\n    other.width = this.width\n    this.width = temp\n\n    temp = other.height\n    other.height = this.height\n    this.height = temp\n\n    temp = other.framebuffer\n    other.framebuffer = this.framebuffer\n    this.framebuffer = temp\n  }\n\n  /**\n   * Return a new texture created from `imgElement`, an `<img>` tag.\n   */\n  static fromImage(\n    imgElement: HTMLImageElement | HTMLCanvasElement,\n    options: TextureOptions = {},\n    gl: TSGLContext = currentGL(),\n  ): Texture {\n    const texture = new Texture(\n      imgElement.width,\n      imgElement.height,\n      options,\n      gl,\n    )\n    try {\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        0,\n        texture.format as any,\n        texture.format as any,\n        texture.type as any,\n        imgElement,\n      )\n    } catch (e) {\n      if (location.protocol == \"file:\") {\n        throw new Error(\n          'imgElement not loaded for security reasons (serve this page over \"http://\" instead)',\n        )\n      } else {\n        throw new Error(\n          \"imgElement not loaded for security reasons (imgElement must originate from the same \" +\n            \"domain as this page or use Cross-Origin Resource Sharing)\",\n        )\n      }\n    }\n    if (\n      options.minFilter &&\n      options.minFilter != gl.NEAREST &&\n      options.minFilter != gl.LINEAR\n    ) {\n      gl.generateMipmap(gl.TEXTURE_2D)\n    }\n    return texture\n  }\n\n  /**\n   * Returns a checkerboard texture that will switch to the correct texture when it loads.\n   */\n  static fromURLSwitch(\n    url: string,\n    options?: TextureOptions,\n    gl = currentGL(),\n  ): Texture {\n    Texture.checkerBoardCanvas =\n      Texture.checkerBoardCanvas ||\n      (function () {\n        const c = document.createElement(\"canvas\").getContext(\"2d\")\n        if (!c) throw new Error(\"Could not create 2d canvas.\")\n        c.canvas.width = c.canvas.height = 128\n        for (let y = 0; y < c.canvas.height; y += 16) {\n          for (let x = 0; x < c.canvas.width; x += 16) {\n            //noinspection JSBitwiseOperatorUsage\n            c.fillStyle = (x ^ y) & 16 ? \"#FFF\" : \"#DDD\"\n            c.fillRect(x, y, 16, 16)\n          }\n        }\n        return c.canvas\n      })()\n    const texture = Texture.fromImage(Texture.checkerBoardCanvas, options)\n    const image = new Image()\n    image.onload = () => Texture.fromImage(image, options, gl).swapWith(texture)\n    // error event doesn't return a reason. Most likely a 404.\n    image.onerror = () => {\n      throw new Error(\"Could not load image \" + image.src + \". 404?\")\n    }\n    image.src = url\n    return texture\n  }\n\n  static fromURL(\n    url: string,\n    options?: TextureOptions,\n    gl = currentGL(),\n  ): Promise<Texture> {\n    return new Promise((resolve, reject) => {\n      const image = new Image()\n      image.onload = () => resolve(Texture.fromImage(image, options, gl))\n      image.onerror = (ev) =>\n        reject(\"Could not load image \" + image.src + \". 404?\" + ev)\n      image.src = url\n    })\n  }\n}\n","/*\n ** Copyright (c) 2012 The Khronos Group Inc.\n **\n ** Permission is hereby granted, free of charge, to any person obtaining a\n ** copy of this software and/or associated documentation files (the\n ** 'Materials'), to deal in the Materials without restriction, including\n ** without limitation the rights to use, copy, modify, merge, publish,\n ** distribute, sublicense, and/or sell copies of the Materials, and to\n ** permit persons to whom the Materials are furnished to do so, subject to\n ** the following conditions:\n **\n ** The above copyright notice and this permission notice shall be included\n ** in all copies or substantial portions of the Materials.\n **\n ** THE MATERIALS ARE PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n ** EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n ** MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n ** IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n ** CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n ** TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n ** MATERIALS OR THE USE OR OTHER DEALINGS IN THE MATERIALS.\n */\n\n// tslint:disable\nimport GL = WebGLRenderingContextStrict\nconst GL = WebGLRenderingContext as any as new () => WebGLRenderingContextStrict\n\n// Various functions for helping debug WebGL apps.\n\n/**\n * Wrapped logging function.\n * @param msg Message to log.\n */\nfunction log(msg: string) {\n  if (window.console && window.console.log) {\n    window.console.log(msg)\n  }\n}\n\n/**\n * Wrapped error logging function.\n * @param msg Message to log.\n */\nfunction error(msg: string) {\n  if (window.console && window.console.error) {\n    window.console.error(msg)\n  } else {\n    log(msg)\n  }\n}\n\n/**\n * Which arguments are enums based on the number of arguments to the function.\n * So\n *    'texImage2D': {\n *       9: { 0:true, 2:true, 6:true, 7:true },\n *       6: { 0:true, 2:true, 3:true, 4:true },\n *    },\n *\n * means if there are 9 arguments then 6 and 7 are enums, if there are 6\n * arguments 3 and 4 are enums\n *\n * @type {!Object.<number, !Object.<number, string>}\n */\nconst glValidEnumContexts: {\n  [funcName: string]: {\n    [argCount: number]: {\n      [argIndex: number]: boolean | { enumBitwiseOr: string[] }\n    }\n  }\n} = {\n  // Generic setters and getters\n\n  enable: { 1: { 0: true } },\n  disable: { 1: { 0: true } },\n  getParameter: { 1: { 0: true } },\n\n  // Rendering\n\n  drawArrays: { 3: { 0: true } },\n  drawElements: { 4: { 0: true, 2: true } },\n\n  // Shaders\n\n  createShader: { 1: { 0: true } },\n  getShaderParameter: { 2: { 1: true } },\n  getProgramParameter: { 2: { 1: true } },\n  getShaderPrecisionFormat: { 2: { 0: true, 1: true } },\n\n  // Vertex attributes\n\n  getVertexAttrib: { 2: { 1: true } },\n  vertexAttribPointer: { 6: { 2: true } },\n\n  // Textures\n\n  bindTexture: { 2: { 0: true } },\n  activeTexture: { 1: { 0: true } },\n  getTexParameter: { 2: { 0: true, 1: true } },\n  texParameterf: { 3: { 0: true, 1: true } },\n  texParameteri: { 3: { 0: true, 1: true, 2: true } },\n  // texImage2D and texSubImage2D are defined below with WebGL 2 entrypoints\n  copyTexImage2D: { 8: { 0: true, 2: true } },\n  copyTexSubImage2D: { 8: { 0: true } },\n  generateMipmap: { 1: { 0: true } },\n  // compressedTexImage2D and compressedTexSubImage2D are defined below with WebGL 2 entrypoints\n\n  // Buffer objects\n\n  bindBuffer: { 2: { 0: true } },\n  // bufferData and bufferSubData are defined below with WebGL 2 entrypoints\n  getBufferParameter: { 2: { 0: true, 1: true } },\n\n  // Renderbuffers and framebuffers\n\n  pixelStorei: { 2: { 0: true, 1: true } },\n  // readPixels is defined below with WebGL 2 entrypoints\n  bindRenderbuffer: { 2: { 0: true } },\n  bindFramebuffer: { 2: { 0: true } },\n  checkFramebufferStatus: { 1: { 0: true } },\n  framebufferRenderbuffer: { 4: { 0: true, 1: true, 2: true } },\n  framebufferTexture2D: { 5: { 0: true, 1: true, 2: true } },\n  getFramebufferAttachmentParameter: { 3: { 0: true, 1: true, 2: true } },\n  getRenderbufferParameter: { 2: { 0: true, 1: true } },\n  renderbufferStorage: { 4: { 0: true, 1: true } },\n\n  // Frame buffer operations (clear, blend, depth test, stencil)\n\n  clear: {\n    1: {\n      0: {\n        enumBitwiseOr: [\n          \"COLOR_BUFFER_BIT\",\n          \"DEPTH_BUFFER_BIT\",\n          \"STENCIL_BUFFER_BIT\",\n        ],\n      },\n    },\n  },\n  depthFunc: { 1: { 0: true } },\n  blendFunc: { 2: { 0: true, 1: true } },\n  blendFuncSeparate: { 4: { 0: true, 1: true, 2: true, 3: true } },\n  blendEquation: { 1: { 0: true } },\n  blendEquationSeparate: { 2: { 0: true, 1: true } },\n  stencilFunc: { 3: { 0: true } },\n  stencilFuncSeparate: { 4: { 0: true, 1: true } },\n  stencilMaskSeparate: { 2: { 0: true } },\n  stencilOp: { 3: { 0: true, 1: true, 2: true } },\n  stencilOpSeparate: { 4: { 0: true, 1: true, 2: true, 3: true } },\n\n  // Culling\n\n  cullFace: { 1: { 0: true } },\n  frontFace: { 1: { 0: true } },\n\n  // ANGLE_instanced_arrays extension\n\n  drawArraysInstancedANGLE: { 4: { 0: true } },\n  drawElementsInstancedANGLE: { 5: { 0: true, 2: true } },\n\n  // EXT_blend_minmax extension\n\n  blendEquationEXT: { 1: { 0: true } },\n\n  // WebGL 2 Buffer objects\n\n  bufferData: {\n    3: { 0: true, 2: true }, // WebGL 1\n    4: { 0: true, 2: true }, // WebGL 2\n    5: { 0: true, 2: true }, // WebGL 2\n  },\n  bufferSubData: {\n    3: { 0: true }, // WebGL 1\n    4: { 0: true }, // WebGL 2\n    5: { 0: true }, // WebGL 2\n  },\n  copyBufferSubData: { 5: { 0: true, 1: true } },\n  getBufferSubData: { 3: { 0: true }, 4: { 0: true }, 5: { 0: true } },\n\n  // WebGL 2 Framebuffer objects\n\n  blitFramebuffer: {\n    10: {\n      8: {\n        enumBitwiseOr: [\n          \"COLOR_BUFFER_BIT\",\n          \"DEPTH_BUFFER_BIT\",\n          \"STENCIL_BUFFER_BIT\",\n        ],\n      },\n      9: true,\n    },\n  },\n  framebufferTextureLayer: { 5: { 0: true, 1: true } },\n  invalidateFramebuffer: { 2: { 0: true } },\n  invalidateSubFramebuffer: { 6: { 0: true } },\n  readBuffer: { 1: { 0: true } },\n\n  // WebGL 2 Renderbuffer objects\n\n  getInternalformatParameter: { 3: { 0: true, 1: true, 2: true } },\n  renderbufferStorageMultisample: { 5: { 0: true, 2: true } },\n\n  // WebGL 2 Texture objects\n\n  texStorage2D: { 5: { 0: true, 2: true } },\n  texStorage3D: { 6: { 0: true, 2: true } },\n  texImage2D: {\n    9: { 0: true, 2: true, 6: true, 7: true }, // WebGL 1 & 2\n    6: { 0: true, 2: true, 3: true, 4: true }, // WebGL 1\n    10: { 0: true, 2: true, 6: true, 7: true }, // WebGL 2\n  },\n  texImage3D: {\n    10: { 0: true, 2: true, 7: true, 8: true },\n    11: { 0: true, 2: true, 7: true, 8: true },\n  },\n  texSubImage2D: {\n    9: { 0: true, 6: true, 7: true }, // WebGL 1 & 2\n    7: { 0: true, 4: true, 5: true }, // WebGL 1\n    10: { 0: true, 6: true, 7: true }, // WebGL 2\n  },\n  texSubImage3D: {\n    11: { 0: true, 8: true, 9: true },\n    12: { 0: true, 8: true, 9: true },\n  },\n  copyTexSubImage3D: { 9: { 0: true } },\n  compressedTexImage2D: {\n    7: { 0: true, 2: true }, // WebGL 1 & 2\n    8: { 0: true, 2: true }, // WebGL 2\n    9: { 0: true, 2: true }, // WebGL 2\n  },\n  compressedTexImage3D: {\n    8: { 0: true, 2: true },\n    9: { 0: true, 2: true },\n    10: { 0: true, 2: true },\n  },\n  compressedTexSubImage2D: {\n    8: { 0: true, 6: true }, // WebGL 1 & 2\n    9: { 0: true, 6: true }, // WebGL 2\n    10: { 0: true, 6: true }, // WebGL 2\n  },\n  compressedTexSubImage3D: {\n    10: { 0: true, 8: true },\n    11: { 0: true, 8: true },\n    12: { 0: true, 8: true },\n  },\n\n  // WebGL 2 Vertex attribs\n\n  vertexAttribIPointer: { 5: { 2: true } },\n\n  // WebGL 2 Writing to the drawing buffer\n\n  drawArraysInstanced: { 4: { 0: true } },\n  drawElementsInstanced: { 5: { 0: true, 2: true } },\n  drawRangeElements: { 6: { 0: true, 4: true } },\n\n  // WebGL 2 Reading back pixels\n\n  readPixels: {\n    7: { 4: true, 5: true }, // WebGL 1 & 2\n    8: { 4: true, 5: true }, // WebGL 2\n  },\n\n  // WebGL 2 Multiple Render Targets\n\n  clearBufferfv: { 3: { 0: true }, 4: { 0: true } },\n  clearBufferiv: { 3: { 0: true }, 4: { 0: true } },\n  clearBufferuiv: { 3: { 0: true }, 4: { 0: true } },\n  clearBufferfi: { 4: { 0: true } },\n\n  // WebGL 2 Query objects\n\n  beginQuery: { 2: { 0: true } },\n  endQuery: { 1: { 0: true } },\n  getQuery: { 2: { 0: true, 1: true } },\n  getQueryParameter: { 2: { 1: true } },\n\n  // WebGL 2 Sampler objects\n\n  samplerParameteri: { 3: { 1: true, 2: true } },\n  samplerParameterf: { 3: { 1: true } },\n  getSamplerParameter: { 2: { 1: true } },\n\n  // WebGL 2 Sync objects\n\n  fenceSync: { 2: { 0: true, 1: { enumBitwiseOr: [] } } },\n  clientWaitSync: {\n    3: { 1: { enumBitwiseOr: [\"SYNC_FLUSH_COMMANDS_BIT\"] } },\n  },\n  waitSync: { 3: { 1: { enumBitwiseOr: [] } } },\n  getSyncParameter: { 2: { 1: true } },\n\n  // WebGL 2 Transform Feedback\n\n  bindTransformFeedback: { 2: { 0: true } },\n  beginTransformFeedback: { 1: { 0: true } },\n  transformFeedbackVaryings: { 3: { 2: true } },\n\n  // WebGL2 Uniform Buffer Objects and Transform Feedback Buffers\n\n  bindBufferBase: { 3: { 0: true } },\n  bindBufferRange: { 5: { 0: true } },\n  getIndexedParameter: { 2: { 0: true } },\n  getActiveUniforms: { 3: { 2: true } },\n  getActiveUniformBlockParameter: { 3: { 2: true } },\n}\n\n/**\n * Map of numbers to names.\n * @type {Object}\n */\nlet glEnums: { [k: number]: string } = null as any\n\n/**\n * Map of names to numbers.\n * @type {Object}\n */\nlet enumStringToValue: { [k: string]: GL.GLenum<string> } = null as any\n\n/**\n * Initializes this module. Safe to call more than once.\n * @param ctx A WebGL context. If\n *    you have more than one context it doesn't matter which one\n *    you pass in, it is only used to pull out constants.\n */\nexport function init() {\n  if (null === glEnums) {\n    glEnums = {}\n    enumStringToValue = {}\n    const c =\n      (window as any).WebGL2RenderingContext ||\n      (window as any).WebGLRenderingContext\n    if (!c)\n      throw new Error(\n        \"Neither WebGL2RenderingContext nor WebGLRenderingContext exists on window.\",\n      )\n    for (const propertyName in c) {\n      const prop = c[propertyName]\n      if (\"number\" === typeof prop) {\n        glEnums[prop] = propertyName\n        enumStringToValue[propertyName] = prop as any\n      }\n    }\n  }\n}\n\n/**\n * Returns true or false if value matches any WebGL enum\n * @param value Value to check if it might be an enum.\n * @return True if value matches one of the WebGL defined enums\n */\nexport function mightBeEnum(value: number): boolean {\n  init()\n  return glEnums[value] !== undefined\n}\n\n/**\n * Gets an string version of an WebGL enum.\n *\n * Example:\n *   var str = WebGLDebugUtil.glEnumToString(ctx.getError())\n *\n * @param value Value to return an enum for\n * @return The string version of the enum.\n */\nexport function glEnumToString(value: GL.GLenum<string>): string {\n  init()\n  var name = glEnums[value as any]\n  return name !== undefined\n    ? \"gl.\" + name\n    : \"/*UNKNOWN WebGL ENUM*/ 0x\" + (value as any).toString(16) + \"\"\n}\n\n/**\n * Converts the argument of a WebGL function to a string.\n * Attempts to convert enum arguments to strings.\n *\n * Example:\n *   WebGLDebugUtil.init(ctx)\n *   var str = WebGLDebugUtil.glFunctionArgToString('bindTexture', 2, 0, gl.TEXTURE_2D)\n *\n * would return 'TEXTURE_2D'\n *\n * @param functionName the name of the WebGL function.\n * @param numArgs the number of arguments passed to the function.\n * @param argumentIndex the index of the argument.\n * @param value The value of the argument.\n * @return The value as a string.\n */\nexport function glFunctionArgToString(\n  functionName: string,\n  numArgs: number,\n  argumentIndex: number,\n  value: any,\n): string {\n  const funcInfo = glValidEnumContexts[functionName]\n  if (funcInfo !== undefined) {\n    const funcOverloadInfo = funcInfo[numArgs]\n    if (funcOverloadInfo !== undefined) {\n      const argInfo = funcOverloadInfo[argumentIndex]\n      if (argInfo) {\n        if (typeof argInfo === \"object\") {\n          const enums = argInfo.enumBitwiseOr\n          const orEnums = []\n          let orResult = 0\n          for (let i = 0; i < enums.length; ++i) {\n            const enumValue = enumStringToValue[enums[i]]\n            if ((value & enumValue) !== 0) {\n              orResult |= enumValue\n              orEnums.push(glEnumToString(enumValue))\n            }\n          }\n          if (orResult === value) {\n            return orEnums.join(\" | \")\n          } else {\n            return glEnumToString(value)\n          }\n        } else {\n          return glEnumToString(value)\n        }\n      }\n    }\n  }\n  if (value === null) {\n    return \"null\"\n  } else if (value === undefined) {\n    return \"undefined\"\n  } else {\n    return value.toString()\n  }\n}\n\n/**\n * Converts the arguments of a WebGL function to a string.\n * Attempts to convert enum arguments to strings.\n *\n * @param functionName the name of the WebGL function.\n * @param args The arguments.\n * @return The arguments as a string.\n */\nexport function glFunctionArgsToString(\n  functionName: string,\n  args: number[],\n): string {\n  // apparently we can't do args.join(',')\n  var argStr = \"\"\n  var numArgs = args.length\n  for (var ii = 0; ii < numArgs; ++ii) {\n    argStr +=\n      (ii == 0 ? \"\" : \", \") +\n      glFunctionArgToString(functionName, numArgs, ii, args[ii])\n  }\n  return argStr\n}\n\nfunction makePropertyWrapper(\n  wrapper: any,\n  original: any,\n  propertyName: string,\n) {\n  //log('wrap prop: ' + propertyName)\n  wrapper.__defineGetter__(propertyName, function () {\n    return original[propertyName]\n  })\n  // TODO(gmane): this needs to handle properties that take more than\n  // one value?\n  wrapper.__defineSetter__(propertyName, function (value: any) {\n    //log('set: ' + propertyName)\n    original[propertyName] = value\n  })\n}\n\n/**\n * Given a WebGL context returns a wrapped context that calls\n * gl.getError after every command and calls a function if the\n * result is not NO_ERROR.\n *\n * You can supply your own function if you want. For example, if you'd like\n * an exception thrown on any GL error you could do this\n *\n *    function throwOnGLError(err, funcName, args) {\n *      throw new Error(WebGLDebugUtils.glEnumToString(err) +\n *            ' was caused by call to ' + funcName)\n *    }\n *\n *    ctx = WebGLDebugUtils.makeDebugContext(\n *        canvas.getContext('webgl'), throwOnGLError)\n *\n * @param ctx The webgl context to wrap.\n * @param opt_onErrorFunc The function\n *     to call when gl.getError returns an error. If not specified the default\n *     function calls console.log with a message.\n * @param opt_onFunc The\n *     function to call when each webgl function is called. You\n *     can use this to log all calls for example.\n * @param opt_err_ctx The webgl context\n *        to call getError on if different than ctx.\n */\nexport function makeDebugContext(\n  ctx: WebGLRenderingContextStrict,\n  opt_onErrorFunc?: (err: GL.Error, funcName: string, args: any[]) => void,\n  opt_onFunc?: (funcName: string, args: any[]) => void,\n  opt_err_ctx: WebGLRenderingContextStrict = ctx,\n): WebGLRenderingContext {\n  init()\n  opt_onErrorFunc =\n    opt_onErrorFunc ||\n    function (err, functionName, args) {\n      // apparently we can't do args.join(',')\n      var argStr = \"\"\n      var numArgs = args.length\n      for (let i = 0; i < numArgs; ++i) {\n        argStr +=\n          (i == 0 ? \"\" : \", \") +\n          glFunctionArgToString(functionName, numArgs, i, args[i])\n      }\n      error(\n        \"WebGL error \" +\n          glEnumToString(err) +\n          \" in \" +\n          functionName +\n          \"(\" +\n          argStr +\n          \")\",\n      )\n    }\n\n  // Holds booleans for each GL error so after we get the error ourselves\n  // we can still return it to the client app.\n  const glErrorShadow: { [k: number]: boolean } = {}\n\n  // Makes a function that calls a WebGL function and then calls getError.\n  function makeErrorWrapper(\n    ctx: WebGLRenderingContextStrict,\n    functionName: string,\n  ) {\n    return function (...args: any[]) {\n      if (opt_onFunc) {\n        opt_onFunc(functionName, args)\n      }\n      const result = (ctx as any)[functionName].apply(ctx, args)\n      const err = opt_err_ctx.getError()\n      if (err != 0) {\n        glErrorShadow[err] = true\n        opt_onErrorFunc!(err, functionName, args)\n      }\n      return result\n    }\n  }\n\n  // Make a an object that has a copy of every property of the WebGL context\n  // but wraps all functions.\n  const wrapper: any = {}\n  for (let propertyName in ctx) {\n    const prop = ctx[propertyName as keyof WebGLRenderingContextStrict]\n    if (\"function\" === typeof prop) {\n      if (propertyName != \"getExtension\") {\n        wrapper[propertyName] = makeErrorWrapper(ctx, propertyName)\n      } else {\n        let wrapped = makeErrorWrapper(ctx, propertyName)\n        wrapper[propertyName as any] = function () {\n          const result = wrapped.apply(ctx, arguments)\n          if (!result) {\n            return null\n          }\n          return makeDebugContext(\n            result,\n            opt_onErrorFunc,\n            opt_onFunc,\n            opt_err_ctx,\n          )\n        }\n      }\n    } else {\n      makePropertyWrapper(wrapper, ctx, propertyName)\n    }\n  }\n\n  // Override the getError function with one that returns our saved results.\n  wrapper.getError = function () {\n    for (const err in glErrorShadow) {\n      if (glErrorShadow.hasOwnProperty(err)) {\n        if (glErrorShadow[err]) {\n          glErrorShadow[err] = false\n          return parseInt(err)\n        }\n      }\n    }\n    return ctx.NO_ERROR\n  }\n\n  return wrapper\n}\nexport function isWebGL2RenderingContext(\n  o: any,\n): o is WebGL2RenderingContextStrict {\n  return !!o.createTransformFeedback\n}\n/**\n * Resets a context to the initial state.\n * @param ctx The webgl context to\n *     reset.\n */\nexport function resetToInitialState(\n  ctx2: WebGL2RenderingContextStrict | WebGLRenderingContextStrict,\n) {\n  if (isWebGL2RenderingContext(ctx2)) {\n    ctx2.bindVertexArray(null)\n  }\n\n  const numAttribs = ctx2.getParameter(ctx2.MAX_VERTEX_ATTRIBS)\n  const tmp = ctx2.createBuffer()\n  ctx2.bindBuffer(ctx2.ARRAY_BUFFER, tmp)\n  for (let ii = 0; ii < numAttribs; ++ii) {\n    ctx2.disableVertexAttribArray(ii)\n    ctx2.vertexAttribPointer(ii, 4, ctx2.FLOAT, false, 0, 0)\n    ctx2.vertexAttrib1f(ii, 0)\n    if (isWebGL2RenderingContext(ctx2)) {\n      ctx2.vertexAttribDivisor(ii, 0)\n    }\n  }\n  ctx2.deleteBuffer(tmp)\n\n  const numTextureUnits = ctx2.getParameter(ctx2.MAX_TEXTURE_IMAGE_UNITS)\n  for (let ii = 0; ii < numTextureUnits; ++ii) {\n    ctx2.activeTexture((ctx2.TEXTURE0 + ii) as GL.TextureUnit)\n    ctx2.bindTexture(ctx2.TEXTURE_CUBE_MAP, null)\n    ctx2.bindTexture(ctx2.TEXTURE_2D, null)\n    if (isWebGL2RenderingContext(ctx2)) {\n      ctx2.bindTexture(ctx2.TEXTURE_2D_ARRAY, null)\n      ctx2.bindTexture(ctx2.TEXTURE_3D, null)\n      ctx2.bindSampler(ii, null)\n    }\n  }\n\n  ctx2.activeTexture(ctx2.TEXTURE0)\n  ctx2.useProgram(null)\n  ctx2.bindBuffer(ctx2.ARRAY_BUFFER, null)\n  ctx2.bindBuffer(ctx2.ELEMENT_ARRAY_BUFFER, null)\n  ctx2.bindFramebuffer(ctx2.FRAMEBUFFER, null)\n  ctx2.bindRenderbuffer(ctx2.RENDERBUFFER, null)\n  ctx2.disable(ctx2.BLEND)\n  ctx2.disable(ctx2.CULL_FACE)\n  ctx2.disable(ctx2.DEPTH_TEST)\n  ctx2.disable(ctx2.DITHER)\n  ctx2.disable(ctx2.SCISSOR_TEST)\n  ctx2.blendColor(0, 0, 0, 0)\n  ctx2.blendEquation(ctx2.FUNC_ADD)\n  ctx2.blendFunc(ctx2.ONE, ctx2.ZERO)\n  ctx2.clearColor(0, 0, 0, 0)\n  ctx2.clearDepth(1)\n  ctx2.clearStencil(-1)\n  ctx2.colorMask(true, true, true, true)\n  ctx2.cullFace(ctx2.BACK)\n  ctx2.depthFunc(ctx2.LESS)\n  ctx2.depthMask(true)\n  ctx2.depthRange(0, 1)\n  ctx2.frontFace(ctx2.CCW)\n  ctx2.hint(ctx2.GENERATE_MIPMAP_HINT, ctx2.DONT_CARE)\n  ctx2.lineWidth(1)\n  ctx2.pixelStorei(ctx2.PACK_ALIGNMENT, 4)\n  ctx2.pixelStorei(ctx2.UNPACK_ALIGNMENT, 4)\n  ctx2.pixelStorei(ctx2.UNPACK_FLIP_Y_WEBGL, false)\n  ctx2.pixelStorei(ctx2.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false)\n  ctx2.pixelStorei(\n    ctx2.UNPACK_COLORSPACE_CONVERSION_WEBGL,\n    ctx2.BROWSER_DEFAULT_WEBGL,\n  )\n  ctx2.polygonOffset(0, 0)\n  ctx2.sampleCoverage(1, false)\n  ctx2.scissor(0, 0, ctx2.canvas.width, ctx2.canvas.height)\n  ctx2.stencilFunc(ctx2.ALWAYS, 0, 0xffffffff)\n  ctx2.stencilMask(0xffffffff)\n  ctx2.stencilOp(ctx2.KEEP, ctx2.KEEP, ctx2.KEEP)\n  ctx2.viewport(0, 0, ctx2.canvas.width, ctx2.canvas.height)\n  ctx2.clear(\n    ctx2.COLOR_BUFFER_BIT | ctx2.DEPTH_BUFFER_BIT | ctx2.STENCIL_BUFFER_BIT,\n  )\n\n  if (isWebGL2RenderingContext(ctx2)) {\n    ctx2.drawBuffers([ctx2.BACK])\n    ctx2.readBuffer(ctx2.BACK)\n    ctx2.bindBuffer(ctx2.COPY_READ_BUFFER, null)\n    ctx2.bindBuffer(ctx2.COPY_WRITE_BUFFER, null)\n    ctx2.bindBuffer(ctx2.PIXEL_PACK_BUFFER, null)\n    ctx2.bindBuffer(ctx2.PIXEL_UNPACK_BUFFER, null)\n    const numTransformFeedbacks = ctx2.getParameter(\n      ctx2.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS,\n    )\n    for (let ii = 0; ii < numTransformFeedbacks; ++ii) {\n      ctx2.bindBufferBase(ctx2.TRANSFORM_FEEDBACK_BUFFER, ii, null)\n    }\n    const numUBOs = ctx2.getParameter(ctx2.MAX_UNIFORM_BUFFER_BINDINGS)\n    for (let ii = 0; ii < numUBOs; ++ii) {\n      ctx2.bindBufferBase(ctx2.UNIFORM_BUFFER, ii, null)\n    }\n    ctx2.disable(ctx2.RASTERIZER_DISCARD)\n    ctx2.pixelStorei(ctx2.UNPACK_IMAGE_HEIGHT, 0)\n    ctx2.pixelStorei(ctx2.UNPACK_SKIP_IMAGES, 0)\n    ctx2.pixelStorei(ctx2.UNPACK_ROW_LENGTH, 0)\n    ctx2.pixelStorei(ctx2.UNPACK_SKIP_ROWS, 0)\n    ctx2.pixelStorei(ctx2.UNPACK_SKIP_PIXELS, 0)\n    ctx2.pixelStorei(ctx2.PACK_ROW_LENGTH, 0)\n    ctx2.pixelStorei(ctx2.PACK_SKIP_ROWS, 0)\n    ctx2.pixelStorei(ctx2.PACK_SKIP_PIXELS, 0)\n    ctx2.hint(ctx2.FRAGMENT_SHADER_DERIVATIVE_HINT, ctx2.DONT_CARE)\n  }\n\n  // TODO: This should NOT be needed but Firefox fails with 'hint'\n  while (ctx2.getError()) {}\n}\n\n/**\n * Given a canvas element returns a wrapped canvas element that will\n * simulate lost context. The canvas returned adds the following functions.\n *\n * loseContext:\n *   simulates a lost context event.\n *\n * restoreContext:\n *   simulates the context being restored.\n *\n * lostContextInNCalls:\n *   loses the context after N gl calls.\n *\n * getNumCalls:\n *   tells you how many gl calls there have been so far.\n *\n * setRestoreTimeout:\n *   sets the number of milliseconds until the context is restored\n *   after it has been lost. Defaults to 0. Pass -1 to prevent\n *   automatic restoring.\n *\n * @param canvas The canvas element to wrap.\n */\nexport function makeLostContextSimulatingCanvas(canvas: HTMLCanvasElement) {\n  const canvas2 = canvas as any\n  let unwrappedContext_:\n    | WebGLRenderingContextStrict\n    | WebGL2RenderingContextStrict\n  const onLost_: WebGLContextEventListener[] = []\n  const onRestored_: WebGLContextEventListener[] = []\n  let wrappedContext_: any = {}\n  let contextId_ = 1\n  let contextLost_ = false\n  // const resourceId_ = 0\n  const resourceDb_: WebGLObject[] = []\n  let numCallsToLoseContext_ = 0\n  let numCalls_ = 0\n  let canRestore_ = false\n  let restoreTimeout_ = 0\n\n  // Holds booleans for each GL error so can simulate errors.\n  const glErrorShadow_: { [e: number]: boolean } = {}\n\n  canvas2.getContext = (function (f) {\n    return function () {\n      const ctx = f.apply(canvas2, arguments) as WebGLRenderingContextStrict\n      // Did we get a context and is it a WebGL context?\n      // @ts-ignore\n      if (\n        ctx instanceof GL ||\n        ((window as any).WebGL2RenderingContext &&\n          ctx instanceof WebGL2RenderingContext)\n      ) {\n        if (ctx != unwrappedContext_) {\n          if (unwrappedContext_) {\n            throw new Error(\"got different context\")\n          }\n          unwrappedContext_ = ctx\n          wrappedContext_ = makeLostContextSimulatingContext(unwrappedContext_)\n        }\n        return wrappedContext_\n      }\n      return ctx\n    }\n  })(canvas2.getContext)\n\n  function wrapEvent(\n    listener:\n      | WebGLContextEventListener\n      | { handleEvent: WebGLContextEventListener },\n  ) {\n    if (typeof listener == \"function\") {\n      return listener\n    } else {\n      return function (e: CustomWebGLContextEvent) {\n        listener.handleEvent(e)\n      }\n    }\n  }\n\n  function addOnContextLostListener(\n    listener:\n      | WebGLContextEventListener\n      | { handleEvent: WebGLContextEventListener },\n  ) {\n    onLost_.push(wrapEvent(listener))\n  }\n\n  function addOnContextRestoredListener(\n    listener:\n      | WebGLContextEventListener\n      | { handleEvent: WebGLContextEventListener },\n  ) {\n    onRestored_.push(wrapEvent(listener))\n  }\n\n  function wrapAddEventListener(canvas: HTMLCanvasElement) {\n    const f = canvas.addEventListener\n    canvas.addEventListener = function (type: string, listener: any) {\n      switch (type) {\n        case \"webglcontextlost\":\n          addOnContextLostListener(listener)\n          break\n        case \"webglcontextrestored\":\n          addOnContextRestoredListener(listener)\n          break\n        default:\n          f.apply(canvas, arguments)\n      }\n    }\n  }\n\n  wrapAddEventListener(canvas2)\n\n  canvas2.loseContext = function () {\n    if (!contextLost_) {\n      contextLost_ = true\n      numCallsToLoseContext_ = 0\n      ++contextId_\n      while (unwrappedContext_.getError()) clearErrors()\n      glErrorShadow_[unwrappedContext_.CONTEXT_LOST_WEBGL] = true\n      const event = makeWebGLContextEvent(\"context lost\")\n      const callbacks = onLost_.slice()\n      setTimeout(function () {\n        //log('numCallbacks:' + callbacks.length)\n        for (let ii = 0; ii < callbacks.length; ++ii) {\n          //log('calling callback:' + ii)\n          callbacks[ii](event)\n        }\n        if (restoreTimeout_ >= 0) {\n          setTimeout(function () {\n            canvas2.restoreContext()\n          }, restoreTimeout_)\n        }\n      }, 0)\n    }\n  }\n\n  canvas2.restoreContext = function () {\n    if (contextLost_) {\n      if (onRestored_.length) {\n        setTimeout(function () {\n          if (!canRestore_) {\n            throw new Error(\n              \"can not restore. webglcontestlost listener did not call event.preventDefault\",\n            )\n          }\n          freeResources()\n          resetToInitialState(unwrappedContext_)\n          contextLost_ = false\n          numCalls_ = 0\n          canRestore_ = false\n          const callbacks = onRestored_.slice()\n          const event = makeWebGLContextEvent(\"context restored\")\n          for (let ii = 0; ii < callbacks.length; ++ii) {\n            callbacks[ii](event)\n          }\n        }, 0)\n      }\n    }\n  }\n\n  canvas2.loseContextInNCalls = function (numCalls: number) {\n    if (contextLost_) {\n      throw new Error(\"You can not ask a lost context to be lost\")\n    }\n    numCallsToLoseContext_ = numCalls_ + numCalls\n  }\n\n  canvas2.getNumCalls = function () {\n    return numCalls_\n  }\n\n  canvas2.setRestoreTimeout = function (timeout: number) {\n    restoreTimeout_ = timeout\n  }\n\n  // function isWebGLObject(obj: any): obj is WebGLObject {\n  // \t//return false\n  // \treturn (\n  // \t\tobj instanceof WebGLBuffer ||\n  // \t\tobj instanceof WebGLFramebuffer ||\n  // \t\tobj instanceof WebGLProgram ||\n  // \t\tobj instanceof WebGLRenderbuffer ||\n  // \t\tobj instanceof WebGLShader ||\n  // \t\tobj instanceof WebGLTexture\n  // \t)\n  // }\n\n  // function checkResources(args: any[]) {\n  // \tfor (let i = 0; i < args.length; ++i) {\n  // \t\tconst arg = args[i]\n  // \t\tif (isWebGLObject(arg)) {\n  // \t\t\treturn (arg as any).__webglDebugContextLostId__ == contextId_\n  // \t\t}\n  // \t}\n  // \treturn true\n  // }\n\n  function clearErrors() {\n    const k = Object.keys(glErrorShadow_) as any as number[]\n    for (let i = 0; i < k.length; ++i) {\n      delete glErrorShadow_[k[i]]\n    }\n  }\n\n  function loseContextIfTime() {\n    ++numCalls_\n    if (!contextLost_) {\n      if (numCallsToLoseContext_ == numCalls_) {\n        canvas2.loseContext()\n      }\n    }\n  }\n\n  // Makes a function that simulates WebGL when out of context.\n  function makeLostContextFunctionWrapper(\n    ctx: WebGLRenderingContextStrict,\n    functionName: string,\n  ) {\n    const f = (ctx as any)[functionName]\n    return function () {\n      // log('calling:' + functionName)\n      // Only call the functions if the context is not lost.\n      loseContextIfTime()\n      if (!contextLost_) {\n        //if (!checkResources(arguments)) {\n        //  glErrorShadow_[wrappedContext_.INVALID_OPERATION] = true\n        //  return\n        //}\n        const result = f.apply(ctx, arguments)\n        return result\n      }\n    }\n  }\n\n  function freeResources() {\n    for (let ii = 0; ii < resourceDb_.length; ++ii) {\n      const resource = resourceDb_[ii]\n      if (resource instanceof WebGLBuffer) {\n        unwrappedContext_.deleteBuffer(resource)\n      } else if (resource instanceof WebGLFramebuffer) {\n        unwrappedContext_.deleteFramebuffer(resource)\n      } else if (resource instanceof WebGLProgram) {\n        unwrappedContext_.deleteProgram(resource)\n      } else if (resource instanceof WebGLRenderbuffer) {\n        unwrappedContext_.deleteRenderbuffer(resource)\n      } else if (resource instanceof WebGLShader) {\n        unwrappedContext_.deleteShader(resource)\n      } else if (resource instanceof WebGLTexture) {\n        unwrappedContext_.deleteTexture(resource)\n      } else if (isWebGL2RenderingContext(unwrappedContext_)) {\n        if (resource instanceof WebGLQuery) {\n          unwrappedContext_.deleteQuery(resource)\n        } else if (resource instanceof WebGLSampler) {\n          unwrappedContext_.deleteSampler(resource)\n        } else if (resource instanceof WebGLSync) {\n          unwrappedContext_.deleteSync(resource)\n        } else if (resource instanceof WebGLTransformFeedback) {\n          unwrappedContext_.deleteTransformFeedback(resource)\n        } else if (resource instanceof WebGLVertexArrayObject) {\n          unwrappedContext_.deleteVertexArray(resource)\n        }\n      }\n    }\n  }\n  interface CustomWebGLContextEvent {\n    statusMessage: string\n    preventDefault: () => void\n  }\n  type WebGLContextEventListener = (e: CustomWebGLContextEvent) => void\n  function makeWebGLContextEvent(\n    statusMessage: string,\n  ): CustomWebGLContextEvent {\n    return {\n      statusMessage: statusMessage,\n      preventDefault: function () {\n        canRestore_ = true\n      },\n    }\n  }\n\n  return canvas2\n\n  function makeLostContextSimulatingContext(ctx: WebGLRenderingContextStrict) {\n    // copy all functions and properties to wrapper\n    for (const propertyName in ctx) {\n      if (typeof (ctx as any)[propertyName] == \"function\") {\n        wrappedContext_[propertyName] = makeLostContextFunctionWrapper(\n          ctx,\n          propertyName,\n        )\n      } else {\n        makePropertyWrapper(wrappedContext_, ctx, propertyName)\n      }\n    }\n\n    // Wrap a few functions specially.\n    wrappedContext_.getError = function () {\n      loseContextIfTime()\n      if (!contextLost_) {\n        let err\n        while ((err = unwrappedContext_.getError())) {\n          glErrorShadow_[err] = true\n        }\n      }\n      for (const err in glErrorShadow_) {\n        if (glErrorShadow_[err]) {\n          delete glErrorShadow_[err]\n          return err\n        }\n      }\n      return wrappedContext_.NO_ERROR\n    }\n\n    const creationFunctions = [\n      \"createBuffer\",\n      \"createFramebuffer\",\n      \"createProgram\",\n      \"createRenderbuffer\",\n      \"createShader\",\n      \"createTexture\",\n    ]\n    if (isWebGL2RenderingContext(ctx)) {\n      creationFunctions.push(\n        \"createQuery\",\n        \"createSampler\",\n        \"fenceSync\",\n        \"createTransformFeedback\",\n        \"createVertexArray\",\n      )\n    }\n    for (let i = 0; i < creationFunctions.length; ++i) {\n      const functionName = creationFunctions[i]\n      wrappedContext_[functionName] = (function (f) {\n        return function () {\n          loseContextIfTime()\n          if (contextLost_) {\n            return null\n          }\n          const obj = f.apply(ctx, arguments)\n          obj.__webglDebugContextLostId__ = contextId_\n          resourceDb_.push(obj)\n          return obj\n        }\n      })((ctx as any)[functionName])\n    }\n\n    const functionsThatShouldReturnNull = [\n      \"getActiveAttrib\",\n      \"getActiveUniform\",\n      \"getBufferParameter\",\n      \"getContextAttributes\",\n      \"getAttachedShaders\",\n      \"getFramebufferAttachmentParameter\",\n      \"getParameter\",\n      \"getProgramParameter\",\n      \"getProgramInfoLog\",\n      \"getRenderbufferParameter\",\n      \"getShaderParameter\",\n      \"getShaderInfoLog\",\n      \"getShaderSource\",\n      \"getTexParameter\",\n      \"getUniform\",\n      \"getUniformLocation\",\n      \"getVertexAttrib\",\n    ]\n    if (isWebGL2RenderingContext(ctx)) {\n      functionsThatShouldReturnNull.push(\n        \"getInternalformatParameter\",\n        \"getQuery\",\n        \"getQueryParameter\",\n        \"getSamplerParameter\",\n        \"getSyncParameter\",\n        \"getTransformFeedbackVarying\",\n        \"getIndexedParameter\",\n        \"getUniformIndices\",\n        \"getActiveUniforms\",\n        \"getActiveUniformBlockParameter\",\n        \"getActiveUniformBlockName\",\n      )\n    }\n    for (let ii = 0; ii < functionsThatShouldReturnNull.length; ++ii) {\n      const functionName = functionsThatShouldReturnNull[ii]\n      wrappedContext_[functionName] = (function (f) {\n        return function () {\n          loseContextIfTime()\n          if (contextLost_) {\n            return null\n          }\n          return f.apply(ctx, arguments)\n        }\n      })(wrappedContext_[functionName])\n    }\n\n    const isFunctions = [\n      \"isBuffer\",\n      \"isEnabled\",\n      \"isFramebuffer\",\n      \"isProgram\",\n      \"isRenderbuffer\",\n      \"isShader\",\n      \"isTexture\",\n    ]\n    if (isWebGL2RenderingContext(ctx)) {\n      isFunctions.push(\n        \"isQuery\",\n        \"isSampler\",\n        \"isSync\",\n        \"isTransformFeedback\",\n        \"isVertexArray\",\n      )\n    }\n    for (let ii = 0; ii < isFunctions.length; ++ii) {\n      const functionName = isFunctions[ii]\n      wrappedContext_[functionName] = (function (f) {\n        return function () {\n          loseContextIfTime()\n          if (contextLost_) {\n            return false\n          }\n          return f.apply(ctx, arguments)\n        }\n      })(wrappedContext_[functionName])\n    }\n\n    wrappedContext_.checkFramebufferStatus = (function (f) {\n      return function () {\n        loseContextIfTime()\n        if (contextLost_) {\n          return wrappedContext_.FRAMEBUFFER_UNSUPPORTED\n        }\n        return f.apply(ctx, arguments)\n      }\n    })(wrappedContext_.checkFramebufferStatus)\n\n    wrappedContext_.getAttribLocation = (function (f) {\n      return function () {\n        loseContextIfTime()\n        if (contextLost_) {\n          return -1\n        }\n        return f.apply(ctx, arguments)\n      }\n    })(wrappedContext_.getAttribLocation)\n\n    wrappedContext_.getVertexAttribOffset = (function (f) {\n      return function () {\n        loseContextIfTime()\n        if (contextLost_) {\n          return 0\n        }\n        return f.apply(ctx, arguments)\n      }\n    })(wrappedContext_.getVertexAttribOffset)\n\n    wrappedContext_.isContextLost = function () {\n      return contextLost_\n    }\n\n    if (isWebGL2RenderingContext(ctx)) {\n      wrappedContext_.getFragDataLocation = (function (f) {\n        return function () {\n          loseContextIfTime()\n          if (contextLost_) {\n            return -1\n          }\n          return f.apply(ctx, arguments)\n        }\n      })(wrappedContext_.getFragDataLocation)\n\n      wrappedContext_.clientWaitSync = (function (f) {\n        return function () {\n          loseContextIfTime()\n          if (contextLost_) {\n            return wrappedContext_.WAIT_FAILED\n          }\n          return f.apply(ctx, arguments)\n        }\n      })(wrappedContext_.clientWaitSync)\n\n      wrappedContext_.getUniformBlockIndex = (function (f) {\n        return function () {\n          loseContextIfTime()\n          if (contextLost_) {\n            return wrappedContext_.INVALID_INDEX\n          }\n          return f.apply(ctx, arguments)\n        }\n      })(wrappedContext_.getUniformBlockIndex)\n    }\n\n    return wrappedContext_\n  }\n}\n","/// <reference types=\"webgl-strict-types\" />\nimport * as chroma from \"chroma.ts\"\nimport { addOwnProperties, assert, DEG, int, M4, P3ZX, V, V3 } from \"ts3dutils\"\n\nimport posCoordVS from \"../src/shaders/posCoordVS.glslx\"\nimport sdfRenderFS from \"../src/shaders/sdfRenderFS.glslx\"\nimport { makeDebugContext, Mesh, Shader, Texture } from \"./index\"\nimport { glEnumToString } from \"./KhronosGroupWebGLDebug\"\n\nimport GL = WebGLRenderingContextStrict\nexport type GL_COLOR = [number, number, number, number]\n/**\n * There's only one constant, use it for default values. Use chroma.ts or\n * similar for actual colors.\n */\nexport const GL_COLOR_BLACK: GL_COLOR = [0, 0, 0, 1]\n\nexport function currentGL(): TSGLContext {\n  return TSGLContextBase.gl\n}\n\nexport function isNumber(obj: any) {\n  const str = Object.prototype.toString.call(obj)\n  return str == \"[object Number]\" || str == \"[object Boolean]\"\n}\nexport type TSGLContext = TSGLContextBase & WebGLRenderingContextStrict\nexport type TSGL2Context = TSGLContextBase & WebGL2RenderingContextStrict\nexport interface TSGLContextBase extends WebGLRenderingContextStrict.Base {}\nexport class TSGLContextBase {\n  modelViewMatrix: M4 = M4.identity()\n  projectionMatrix: M4 = M4.identity()\n  static readonly MODELVIEW: { __MATRIX_MODE_CONSTANT: any } = 0 as any\n  static readonly PROJECTION: { __MATRIX_MODE_CONSTANT: any } = 1 as any\n  MODELVIEW: typeof TSGLContextBase.MODELVIEW\n  PROJECTION: typeof TSGLContextBase.PROJECTION\n\n  readonly version: 1 | 2\n\n  static HALF_FLOAT_OES: int = 0x8d61\n  HALF_FLOAT_OES: int\n\n  private tempMatrix = new M4()\n  private resultMatrix = new M4()\n  private modelViewStack: M4[] = []\n  private projectionStack: M4[] = []\n  private currentMatrixName: \"modelViewMatrix\" | \"projectionMatrix\"\n  private stack: M4[]\n\n  meshes: { [name: string]: Mesh }\n  shaders: { [name: string]: Shader }\n  public drawCallCount: int = 0\n  public projectionMatrixVersion: int = 0\n  public modelViewMatrixVersion: int = 0\n  textCtx!: CanvasRenderingContext2D\n  TEXT_TEXTURE_HEIGHT: string\n  TEXT_TEXTURE_FONT: string\n  textMetrics: FontJsonMetrics\n  textAtlas: Texture\n  textRenderShader: Shader\n\n  protected constructor(\n    gl: TSGLContext,\n    private immediate = {\n      mesh: new Mesh()\n        .addVertexBuffer(\"coords\", \"ts_TexCoord\")\n        .addVertexBuffer(\"colors\", \"ts_Color\"),\n      mode: -1 as GL.DrawMode | -1,\n      coord: [0, 0] as [number, number],\n      color: [1, 1, 1, 1] as GL_COLOR,\n      pointSize: 1,\n      shader: Shader.create(\n        `\n        attribute vec4 ts_Color;\n        attribute vec4 ts_Vertex;\n        uniform mat4 ts_ModelViewProjectionMatrix;\n        attribute vec2 ts_TexCoord;\n        uniform float pointSize;\n        varying vec4 color;\n        varying vec2 coord;\n        void main() {\n            color = ts_Color;\n            coord = ts_TexCoord;\n            gl_Position = ts_ModelViewProjectionMatrix * ts_Vertex;\n            gl_PointSize = pointSize;\n        }\n        `,\n        `\n        precision highp float;\n        uniform sampler2D texture;\n        uniform float pointSize;\n        // uniform bool useTexture;\n        varying vec4 color;\n        varying vec2 coord;\n        void main() {\n            gl_FragColor = color;\n            // if (useTexture) gl_FragColor *= texture2D(texture, coord.xy);\n        }\n        `,\n        gl,\n      ),\n    },\n  ) {\n    this.matrixMode(TSGLContextBase.MODELVIEW)\n  }\n\n  /// Implement the OpenGL modelview and projection matrix stacks, along with some other useful GLU matrix functions.\n  matrixMode(mode: { __MATRIX_MODE_CONSTANT: any }): void {\n    switch (mode) {\n      case this.MODELVIEW:\n        this.currentMatrixName = \"modelViewMatrix\"\n        this.stack = this.modelViewStack\n        break\n      case this.PROJECTION:\n        this.currentMatrixName = \"projectionMatrix\"\n        this.stack = this.projectionStack\n        break\n      default:\n        throw new Error(\"invalid matrix mode \" + mode)\n    }\n  }\n\n  loadIdentity(): void {\n    M4.identity(this[this.currentMatrixName])\n    this.currentMatrixName == \"projectionMatrix\"\n      ? this.projectionMatrixVersion++\n      : this.modelViewMatrixVersion++\n  }\n\n  loadMatrix(m4: M4) {\n    M4.copy(m4, this[this.currentMatrixName])\n    this.currentMatrixName == \"projectionMatrix\"\n      ? this.projectionMatrixVersion++\n      : this.modelViewMatrixVersion++\n  }\n\n  multMatrix(m4: M4) {\n    M4.multiply(this[this.currentMatrixName], m4, this.resultMatrix)\n    const temp = this.resultMatrix\n    this.resultMatrix = this[this.currentMatrixName]\n    this[this.currentMatrixName] = temp\n    this.currentMatrixName == \"projectionMatrix\"\n      ? this.projectionMatrixVersion++\n      : this.modelViewMatrixVersion++\n  }\n\n  mirror(plane: { normal1: V3; w: number }) {\n    this.multMatrix(M4.mirror(plane))\n  }\n\n  perspective(fovDegrees: number, aspect: number, near: number, far: number) {\n    this.multMatrix(\n      M4.perspectiveRad(fovDegrees * DEG, aspect, near, far, this.tempMatrix),\n    )\n  }\n\n  frustum(\n    left: number,\n    right: number,\n    bottom: number,\n    top: number,\n    near: number,\n    far: number,\n  ) {\n    this.multMatrix(\n      M4.frustum(left, right, bottom, top, near, far, this.tempMatrix),\n    )\n  }\n\n  ortho(\n    left: number,\n    right: number,\n    bottom: number,\n    top: number,\n    near: number,\n    far: number,\n  ) {\n    this.multMatrix(\n      M4.ortho(left, right, bottom, top, near, far, this.tempMatrix),\n    )\n  }\n\n  scale(x: number, y: number, z?: number): void\n  scale(scale: number): void\n  scale(v: V3): void\n  scale(...args: any[]) {\n    this.multMatrix((M4.scale as any)(...args, this.tempMatrix))\n  }\n\n  mirroredX() {\n    this.multMatrix(M4.mirror(P3ZX))\n  }\n\n  translate(x: number, y?: number, z?: number): void\n  translate(v: V3): void\n  translate(x: any, y?: any, z?: any) {\n    if (undefined !== y) {\n      this.multMatrix(M4.translate(x, y, z, this.tempMatrix))\n    } else {\n      this.multMatrix(M4.translate(x, this.tempMatrix))\n    }\n  }\n\n  rotate(angleDegrees: number, x: number, y: number, z: number) {\n    this.multMatrix(M4.rotate(angleDegrees * DEG, { x, y, z }, this.tempMatrix))\n  }\n\n  lookAt(eye: V3, center: V3, up: V3) {\n    this.multMatrix(M4.lookAt(eye, center, up, this.tempMatrix))\n  }\n\n  pushMatrix() {\n    this.stack.push(M4.copy(this[this.currentMatrixName]))\n  }\n\n  popMatrix() {\n    const pop = this.stack.pop()\n    assert(undefined !== pop)\n    this[this.currentMatrixName] = pop as M4\n    this.currentMatrixName == \"projectionMatrix\"\n      ? this.projectionMatrixVersion++\n      : this.modelViewMatrixVersion++\n  }\n\n  /**\n   * World coordinates (WC) to screen/window coordinates matrix\n   */\n  wcToWindowMatrix() {\n    const viewport = this.getParameter(this.VIEWPORT)\n    const [x, y, w, h] = viewport\n    // prettier-ignore\n    const viewportToScreenMatrix = new M4([\n      w / 2, 0, 0, x + w / 2,\n      h / 2, 0, 0, y + h / 2,\n      0, 0, 1, 0,\n      0, 0, 0, 1,\n    ])\n    return M4.product(\n      viewportToScreenMatrix,\n      this.projectionMatrix,\n      this.modelViewMatrix,\n    )\n  }\n\n  /////////// IMMEDIATE MODE\n  // ### Immediate mode\n  //\n  // Provide an implementation of OpenGL's deprecated immediate mode. This is\n  // deprecated for a reason: constantly re-specifying the geometry is a bad\n  // idea for performance. You should use a `GL.Mesh` instead, which specifies\n  // the geometry once and caches it on the graphics card. Still, nothing\n  // beats a quick `viewerGL.begin(WGL.POINTS); viewerGL.vertex(1, 2, 3); viewerGL.end();` for\n  // debugging. This intentionally doesn't implement fixed-function lighting\n  // because it's only meant for quick debugging tasks.\n\n  pointSize(pointSize: number): void {\n    this.immediate.shader.uniforms({ pointSize: pointSize })\n  }\n\n  begin(mode: GL.DrawMode) {\n    if (this.immediate.mode != -1)\n      throw new Error(\"mismatched viewerGL.begin() and viewerGL.end() calls\")\n    this.immediate.mode = mode\n    this.immediate.mesh.colors = []\n    this.immediate.mesh.coords = []\n    this.immediate.mesh.vertices = []\n  }\n\n  color(cssColor: string): void\n  color(r: number, g: number, b: number, a?: number): void\n  color(hexInt: int): void\n  color(glColor: GL_COLOR): void\n  color(...args: any[]) {\n    this.immediate.color =\n      1 == args.length && Array.isArray(args[0])\n        ? (args[0] as GL_COLOR)\n        : 1 == args.length && \"number\" == typeof args[0]\n        ? hexIntToGLColor(args[0])\n        : 1 == args.length && \"string\" == typeof args[0]\n        ? chroma.color(args[0]).gl()\n        : [args[0], args[1], args[2], args[3] || 1]\n  }\n\n  texCoord(s: number, t: number): void\n  texCoord(coords: [number, number]): void\n  texCoord(coords: { x: number; y: number }): void\n  texCoord(...args: any[]) {\n    this.immediate.coord = V.apply(undefined, args).toArray(2)\n  }\n\n  vertex(v: V3): void\n  vertex(x: number, y: number, z: number): void\n  vertex(...args: any[]) {\n    this.immediate.mesh.colors.push(this.immediate.color)\n    this.immediate.mesh.coords.push(this.immediate.coord)\n    this.immediate.mesh.vertices.push(V.apply(undefined, args))\n  }\n\n  end(): void {\n    if (this.immediate.mode == -1)\n      throw new Error(\"mismatched viewerGL.begin() and viewerGL.end() calls\")\n    this.immediate.mesh.compile()\n    this.immediate.shader\n      .uniforms({\n        useTexture: !!TSGLContextBase.gl.getParameter(this.TEXTURE_BINDING_2D),\n      })\n      .drawBuffers(\n        this.immediate.mesh.vertexBuffers,\n        undefined,\n        this.immediate.mode,\n      )\n    this.immediate.mode = -1\n  }\n\n  ////////// MISCELLANEOUS METHODS\n  static gl: TSGLContext\n\n  makeCurrent() {\n    TSGLContextBase.gl = this as any\n  }\n\n  /**\n   * Starts an animation loop.\n   */\n  animate(\n    callback: (\n      this: TSGLContextBase,\n      domHighResTimeStamp: number,\n      timeSinceLast: number,\n    ) => void,\n  ): () => void {\n    const requestAnimationFrame: typeof window.requestAnimationFrame =\n      window.requestAnimationFrame ||\n      (window as any).mozRequestAnimationFrame ||\n      window.webkitRequestAnimationFrame ||\n      function (callback: FrameRequestCallback) {\n        setTimeout(() => callback(performance.now()), 1000 / 60)\n      }\n    let time = performance.now(),\n      keepUpdating = true\n    const update = (now: number) => {\n      if (keepUpdating) {\n        callback.call(this, now, now - time)\n        time = now\n        requestAnimationFrame(update)\n      }\n    }\n    requestAnimationFrame(update)\n    return () => {\n      keepUpdating = false\n    }\n  }\n\n  /**\n   * Provide an easy way to get a fullscreen app running, including an\n   * automatic 3D perspective projection matrix by default. This should be\n   * called once.\n   *\n   * Just fullscreen, no automatic camera:\n   *\n   *     viewerGL.fullscreen({ camera: false })\n   *\n   * Adjusting field of view, near plane distance, and far plane distance:\n   *\n   *     viewerGL.fullscreen({ fov: 45, near: 0.1, far: 1000 })\n   *\n   * Adding padding from the edge of the window:\n   *\n   *     viewerGL.fullscreen({ paddingLeft: 250, paddingBottom: 60 })\n   */\n  fullscreen(\n    options: {\n      paddingTop?: number\n      paddingLeft?: number\n      paddingRight?: number\n      paddingBottom?: number\n      camera?: boolean\n      fov?: number\n      near?: number\n      far?: number\n    } = {},\n  ) {\n    const top = options.paddingTop || 0\n    const left = options.paddingLeft || 0\n    const right = options.paddingRight || 0\n    const bottom = options.paddingBottom || 0\n    if (!document.body) {\n      throw new Error(\n        \"document.body doesn't exist yet (call viewerGL.fullscreen() from \" +\n          \"window.onload() or from inside the <body> tag)\",\n      )\n    }\n    //document.body.appendChild(this.canvas)\n    //document.body.style.overflow = \"hidden\"\n    Object.assign(this.canvas.style, {\n      position: \"absolute\",\n      left: left + \"px\",\n      top: top + \"px\",\n      width: window.innerWidth - left - right + \"px\",\n      height: window.innerHeight - top - bottom + \"px\",\n    })\n    this.addResizeListener()\n\n    return this\n  }\n\n  addResizeListener(\n    options: {\n      camera?: boolean\n      fov?: number\n      near?: number\n      far?: number\n    } = {},\n  ): TSGLContext {\n    const gl = this\n\n    function windowOnResize() {\n      const bb = gl.canvas.getBoundingClientRect()\n      gl.canvas.width = bb.width * window.devicePixelRatio\n      gl.canvas.height = bb.height * window.devicePixelRatio\n      gl.viewport(0, 0, gl.canvas.width, gl.canvas.height)\n      if (options.camera) {\n        gl.matrixMode(TSGLContextBase.PROJECTION)\n        gl.loadIdentity()\n        gl.perspective(\n          options.fov || 45,\n          gl.canvas.width / gl.canvas.height,\n          options.near || 0.1,\n          options.far || 1000,\n        )\n        gl.matrixMode(TSGLContextBase.MODELVIEW)\n      }\n    }\n\n    window.addEventListener(\"resize\", windowOnResize)\n    windowOnResize()\n    return this as unknown as TSGLContext\n  }\n\n  getMouseLine(e: MouseEvent): { anchor: V3; dir: V3 }\n  getMouseLine(canvasPosX: number, canvasPosY: number): { anchor: V3; dir: V3 }\n  getMouseLine(\n    canvasPosXOrE: number | MouseEvent,\n    canvasPosY?: number,\n  ): { anchor: V3; dir: V3 } {\n    if (canvasPosXOrE instanceof MouseEvent) {\n      return this.getMouseLine(canvasPosXOrE.offsetX, canvasPosXOrE.offsetY)\n    }\n    const ndc1 = V(\n      (canvasPosXOrE * 2) / this.canvas.offsetWidth - 1,\n      (-canvasPosY! * 2) / this.canvas.offsetHeight + 1,\n      0,\n    )\n    const ndc2 = V(\n      (canvasPosXOrE * 2) / this.canvas.offsetWidth - 1,\n      (-canvasPosY! * 2) / this.canvas.offsetHeight + 1,\n      1,\n    )\n    const inverseProjectionMatrix = this.projectionMatrix.inversed()\n    const anchor = inverseProjectionMatrix.transformPoint(ndc1)\n    const dir = inverseProjectionMatrix.transformPoint(ndc2).minus(anchor)\n    return { anchor, dir }\n  }\n\n  viewportFill() {\n    this.viewport(0, 0, this.canvas.width, this.canvas.height)\n  }\n\n  async setupTextRendering(pngURL: string, jsonURL: string) {\n    this.textRenderShader = Shader.create(posCoordVS, sdfRenderFS)\n    ;[this.textAtlas, this.textMetrics] = await Promise.all([\n      Texture.fromURL(pngURL, {\n        format: this.LUMINANCE,\n        internalFormat: this.LUMINANCE,\n        type: this.UNSIGNED_BYTE,\n      }),\n      fetch(jsonURL).then((r) => r.json()),\n    ])\n    // const cs = this.textMetrics.chars\n    // const maxY = Object.keys(cs).reduce((a, b) => Math.max(a, cs[b][3]), 0)\n    // const minY = Object.keys(cs).reduce((a, b) => Math.min(a, cs[b][3] - cs[b][1]), 0)\n    // console.log(maxY, minY)\n  }\n\n  cachedSDFMeshes: {\n    [str: string]: Mesh & {\n      TRIANGLES: int[]\n      coords: number[]\n      width: number\n      lineCount: int\n    }\n  } = {}\n\n  getSDFMeshForString(str: string) {\n    assert(this.textMetrics)\n    return (\n      this.cachedSDFMeshes[str] ||\n      (this.cachedSDFMeshes[str] = createTextMesh(\n        this.textMetrics,\n        this.textAtlas,\n        str,\n      ))\n    )\n  }\n\n  renderText(\n    string: string,\n    color: GL_COLOR,\n    size = 1,\n    xAlign: \"left\" | \"center\" | \"right\" = \"left\",\n    baseline: \"top\" | \"middle\" | \"alphabetic\" | \"bottom\" = \"bottom\",\n    gamma = 0.05,\n    lineHeight = 1.2,\n  ) {\n    const strMesh = this.getSDFMeshForString(string)\n    this.pushMatrix()\n    this.scale(size)\n    const xTranslate = { left: 0, center: -0.5, right: -1 }\n    const yTranslate = {\n      top: -this.textMetrics.ascender / this.textMetrics.size,\n      middle:\n        (-this.textMetrics.ascender - this.textMetrics.descender) /\n        2 /\n        this.textMetrics.size,\n      alphabetic: 0,\n      bottom: -this.textMetrics.descender / this.textMetrics.size,\n    }\n    // console.log('yTranslate[baseline]', yTranslate[baseline])\n    this.translate(xTranslate[xAlign] * strMesh.width, yTranslate[baseline], 0)\n    this.multMatrix(M4.forSys(V3.X, V3.Y, new V3(0, -lineHeight, 0)))\n    this.textAtlas.bind(0)\n    this.textRenderShader\n      .uniforms({\n        texture: 0,\n        u_color: color,\n        u_debug: 0,\n        u_gamma: gamma,\n        u_buffer: 192 / 256,\n      })\n      .draw(strMesh)\n    this.popMatrix()\n\n    // gl.uniform1f(shader.u_debug, debug ? 1 : 0)\n\n    // gl.uniform4fv(shader.u_color, [1, 1, 1, 1])\n    // gl.uniform1f(shader.u_buffer, buffer)\n    // gl.drawArrays(gl.TRIANGLES, 0, vertexBuffer.numItems)\n\n    // gl.uniform4fv(shader.u_color, [0, 0, 0, 1])\n    // gl.uniform1f(shader.u_buffer, 192 / 256)\n    // gl.uniform1f(shader.u_gamma, (gamma * 1.4142) / scale)\n    // gl.drawArrays(gl.TRIANGLES, 0, vertexBuffer.numItems)\n  }\n\n  static create(\n    options: Partial<\n      GL.WebGLContextAttributes & {\n        canvas: HTMLCanvasElement\n        throwOnError: boolean\n      }\n    > = {},\n  ): TSGLContext {\n    const canvas = options.canvas || document.createElement(\"canvas\")\n    if (!options.canvas) {\n      canvas.width = 800\n      canvas.height = 600\n    }\n    if (!(\"alpha\" in options)) options.alpha = false\n    let newGL: any = undefined\n    try {\n      newGL = canvas.getContext(\"webgl2\", options)\n      newGL && (newGL.version = 2)\n      if (!newGL) {\n        newGL =\n          canvas.getContext(\"webgl\", options) ||\n          canvas.getContext(\"experimental-webgl\", options)\n        newGL && (newGL.version = 1)\n      }\n    } catch (e) {\n      console.log(e, \"Failed to get context\")\n    }\n    if (!newGL) throw new Error(\"WebGL not supported\")\n    if (options.throwOnError) {\n      newGL = makeDebugContext(newGL, (err, funcName) => {\n        throw new Error(glEnumToString(err) + \" was caused by \" + funcName)\n      })\n    }\n\n    TSGLContextBase.gl = newGL\n    addOwnProperties(newGL, TSGLContextBase.prototype)\n    addOwnProperties(newGL, new TSGLContextBase(newGL))\n    //addEventListeners(newGL)\n    return newGL\n  }\n\n  /**\n   * Sets the canvas render resolution (canvas.width and canvas.height) to\n   * match the display. I.e. it takes into account window.devicePixelRatio.\n   * @param maxPixelRatio A limit for the pixelRatio. Useful for very high DPI\n   *   devices such as mobile devices.\n   */\n  fixCanvasRes(maxPixelRatio = Infinity) {\n    this.canvas.width =\n      this.canvas.clientWidth * Math.min(window.devicePixelRatio, maxPixelRatio)\n    this.canvas.height =\n      this.canvas.clientHeight *\n      Math.min(window.devicePixelRatio, maxPixelRatio)\n    this.viewport(0, 0, this.canvas.width, this.canvas.height)\n  }\n\n  drawVector(\n    vector: V3,\n    anchor: V3,\n    color: GL_COLOR = GL_COLOR_BLACK,\n    size = 1,\n  ) {\n    if (vector.likeO()) return\n    this.pushMatrix()\n\n    const headLength = size * 4\n    if (headLength > vector.length()) return\n\n    const vT = vector.getPerpendicular().unit()\n    this.multMatrix(\n      M4.forSys(vector.unit(), vT, vector.cross(vT).unit(), anchor),\n    )\n    this.scale(vector.length() - headLength, size / 2, size / 2)\n\n    this.shaders.singleColor\n      .uniforms({\n        color: color,\n      })\n      .draw(this.meshes.vectorShaft)\n\n    this.scale(1 / (vector.length() - headLength), 1, 1)\n    this.translate(vector.length() - headLength, 0, 0)\n    this.scale(headLength / 2, 1, 1)\n\n    this.shaders.singleColor.draw(this.meshes.vectorHead)\n    this.popMatrix()\n  }\n}\nexport namespace TSGLContext {\n  /**\n   * `create()` creates a new WebGL context and augments it with more methods.\n   * The alpha channel is disabled by default because it usually causes\n   * unintended transparencies in the canvas.\n   */\n  export const create = TSGLContextBase.create\n}\n\n// enum WGL_ERROR {\n//   NO_ERROR = WGL.NO_ERROR,\n//   INVALID_ENUM = WGL.INVALID_ENUM,\n//   INVALID_VALUE = WGL.INVALID_VALUE,\n//   INVALID_OPERATION = WGL.INVALID_OPERATION,\n//   INVALID_FRAMEBUFFER_OPERATION = WGL.INVALID_FRAMEBUFFER_OPERATION,\n//   OUT_OF_MEMORY = WGL.OUT_OF_MEMORY,\n//   CONTEXT_LOST_WEBGL = WGL.CONTEXT_LOST_WEBGL,\n// }\n\nTSGLContextBase.prototype.MODELVIEW = TSGLContextBase.MODELVIEW\nTSGLContextBase.prototype.PROJECTION = TSGLContextBase.PROJECTION\nTSGLContextBase.prototype.HALF_FLOAT_OES = TSGLContextBase.HALF_FLOAT_OES\n\n/**\n *\n * Push two triangles:\n * ```\n c - d\n | \\ |\n a - b\n ```\n */\nexport function pushQuad(\n  triangles: int[],\n  flipped: boolean,\n  a: int,\n  b: int,\n  c: int,\n  d: int,\n) {\n  // prettier-ignore\n  if (flipped) {\n    triangles.push(\n      a, c, b,\n      b, c, d)\n  } else {\n    triangles.push(\n      a, b, c,\n      b, d, c)\n  }\n}\n\nfunction hexIntToGLColor(color: int): GL_COLOR {\n  return [\n    (color >> 16) / 255.0,\n    ((color >> 8) & 0xff) / 255.0,\n    (color & 0xff) / 255.0,\n    1.0,\n  ]\n}\n\nexport interface FontJsonMetrics {\n  family: string\n  style: string\n\n  // buffer refers to the width of the margin around glyph bounding boxes with distance values\n  buffer: int\n  size: number\n\n  // [width, height, horiBearingX, horiBearingY, horiAdvance, posX, posY]\n  // see https://www.freetype.org/freetype2/docs/tutorial/step2.html\n  chars: {\n    [char: string]: [number, number, number, number, number, number, number]\n  }\n\n  descender: number\n  ascender: number\n}\n// function measureText(metrics: FontJsonMetrics, text: string, size: number) {\n//   const dimensions = {\n//     advance: 0,\n//   }\n\n//   const scale = size / metrics.size\n//   for (let i = 0; i < text.length; i++) {\n//     const horiAdvance = metrics.chars[text[i]][4]\n//     dimensions.advance += horiAdvance * scale\n//   }\n\n//   return dimensions\n// }\n\n// gl.getExtension('OES_standard_derivatives')\n\n// gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE)\n\n// gl.enable(gl.BLEND)\n\n// const texture = gl.createTexture()\n\n// const vertexBuffer = gl.createBuffer()\n// const textureBuffer = gl.createBuffer()\n\nfunction createTextMesh(\n  fontMetrics: FontJsonMetrics,\n  fontTextureAtlas: Texture,\n  str: string,\n  lineHeight = 1,\n) {\n  const mesh = new Mesh()\n    .addIndexBuffer(\"TRIANGLES\")\n    .addVertexBuffer(\"coords\", \"ts_TexCoord\")\n\n  let cursorX = 0\n  let cursorY = 0\n\n  function drawGlyph(chr: string) {\n    const metric = fontMetrics.chars[chr]\n    if (!metric) return\n\n    const [width, height, horiBearingX, horiBearingY, horiAdvance, posX, posY] =\n      metric\n    const { size, buffer } = fontMetrics\n    const quadStartIndex = mesh.vertices.length\n\n    // buffer = margin on texture\n    if (width > 0 && height > 0) {\n      // Add a quad (= two triangles) per glyph.\n      const left = (cursorX + horiBearingX - buffer) / size\n      const right = (cursorX + horiBearingX + width + buffer) / size\n      const bottom = (horiBearingY - height - buffer) / size\n      const top = (horiBearingY + buffer) / size\n      mesh.vertices.push(\n        new V3(left, bottom, cursorY / size),\n        new V3(right, bottom, cursorY / size),\n        new V3(left, top, cursorY / size),\n        new V3(right, top, cursorY / size),\n      )\n\n      const coordsLeft = posX / fontTextureAtlas.width\n      const coordsRight = (posX + width + 2 * buffer) / fontTextureAtlas.width\n      const coordsBottom =\n        (posY + height + 2 * buffer) / fontTextureAtlas.height\n      const coordsTop = posY / fontTextureAtlas.height\n      mesh.coords.push(\n        [coordsLeft, coordsBottom],\n        [coordsRight, coordsBottom],\n        [coordsLeft, coordsTop],\n        [coordsRight, coordsTop],\n      )\n      // mesh.coords.push([0, 0], [0, 1], [1, 0], [1, 1])\n\n      pushQuad(\n        mesh.TRIANGLES,\n        false,\n        quadStartIndex,\n        quadStartIndex + 1,\n        quadStartIndex + 2,\n        quadStartIndex + 3,\n      )\n    }\n\n    // pen.x += Math.ceil(horiAdvance * scale);\n    cursorX += horiAdvance\n  }\n\n  for (let i = 0; i < str.length; i++) {\n    const chr = str[i]\n    if (\"\\n\" == chr) {\n      cursorX = 0\n      cursorY += lineHeight * fontMetrics.size\n    } else {\n      drawGlyph(chr)\n    }\n  }\n\n  return Object.assign(mesh.compile(), {\n    width: cursorX / fontMetrics.size,\n    lineCount: cursorY + 1,\n  })\n}\n","\r\nattribute vec2 ts_TexCoord;\r\nattribute vec4 ts_Vertex;\r\nuniform mat4 ts_ModelViewProjectionMatrix;\r\nvarying vec2 coord;\r\nvoid main() {\r\n    coord = ts_TexCoord.xy;\r\n    gl_Position = ts_ModelViewProjectionMatrix * ts_Vertex;\r\n}","// A fragment shader for rendering signed distance fields. Main use case: text.\r\n\r\nprecision mediump float;\r\n\r\n// the atlas texture\r\nuniform sampler2D u_texture;\r\n\r\n// the color the text should be rendered\r\nuniform vec4 u_color;\r\n\r\n// the zero distance value in the texture\r\nuniform float u_buffer;\r\n\r\n// control the bluriness of the output 0.05 is a good value\r\nuniform float u_gamma;\r\n\r\n// set to > 1.0 to just output the texture \r\nuniform float u_debug;\r\n\r\nvarying vec2 coord;\r\n\r\nvoid main() {\r\n    float dist = texture2D(u_texture, coord).r;\r\n    if (u_debug > 0.0) {\r\n        gl_FragColor = vec4(dist, dist, dist, 1);\r\n    } else {\r\n        float alpha = smoothstep(u_buffer - u_gamma, u_buffer + u_gamma, dist);\r\n        gl_FragColor = vec4(u_color.rgb, alpha * u_color.a);\r\n        if (gl_FragColor.a == 0.0) {\r\n            discard;\r\n        }\r\n    }\r\n}","module.exports = {\n  0: 'NONE',\n  1: 'ONE',\n  2: 'LINE_LOOP',\n  3: 'LINE_STRIP',\n  4: 'TRIANGLES',\n  5: 'TRIANGLE_STRIP',\n  6: 'TRIANGLE_FAN',\n  256: 'DEPTH_BUFFER_BIT',\n  512: 'NEVER',\n  513: 'LESS',\n  514: 'EQUAL',\n  515: 'LEQUAL',\n  516: 'GREATER',\n  517: 'NOTEQUAL',\n  518: 'GEQUAL',\n  519: 'ALWAYS',\n  768: 'SRC_COLOR',\n  769: 'ONE_MINUS_SRC_COLOR',\n  770: 'SRC_ALPHA',\n  771: 'ONE_MINUS_SRC_ALPHA',\n  772: 'DST_ALPHA',\n  773: 'ONE_MINUS_DST_ALPHA',\n  774: 'DST_COLOR',\n  775: 'ONE_MINUS_DST_COLOR',\n  776: 'SRC_ALPHA_SATURATE',\n  1024: 'STENCIL_BUFFER_BIT',\n  1028: 'FRONT',\n  1029: 'BACK',\n  1032: 'FRONT_AND_BACK',\n  1280: 'INVALID_ENUM',\n  1281: 'INVALID_VALUE',\n  1282: 'INVALID_OPERATION',\n  1285: 'OUT_OF_MEMORY',\n  1286: 'INVALID_FRAMEBUFFER_OPERATION',\n  2304: 'CW',\n  2305: 'CCW',\n  2849: 'LINE_WIDTH',\n  2884: 'CULL_FACE',\n  2885: 'CULL_FACE_MODE',\n  2886: 'FRONT_FACE',\n  2928: 'DEPTH_RANGE',\n  2929: 'DEPTH_TEST',\n  2930: 'DEPTH_WRITEMASK',\n  2931: 'DEPTH_CLEAR_VALUE',\n  2932: 'DEPTH_FUNC',\n  2960: 'STENCIL_TEST',\n  2961: 'STENCIL_CLEAR_VALUE',\n  2962: 'STENCIL_FUNC',\n  2963: 'STENCIL_VALUE_MASK',\n  2964: 'STENCIL_FAIL',\n  2965: 'STENCIL_PASS_DEPTH_FAIL',\n  2966: 'STENCIL_PASS_DEPTH_PASS',\n  2967: 'STENCIL_REF',\n  2968: 'STENCIL_WRITEMASK',\n  2978: 'VIEWPORT',\n  3024: 'DITHER',\n  3042: 'BLEND',\n  3088: 'SCISSOR_BOX',\n  3089: 'SCISSOR_TEST',\n  3106: 'COLOR_CLEAR_VALUE',\n  3107: 'COLOR_WRITEMASK',\n  3317: 'UNPACK_ALIGNMENT',\n  3333: 'PACK_ALIGNMENT',\n  3379: 'MAX_TEXTURE_SIZE',\n  3386: 'MAX_VIEWPORT_DIMS',\n  3408: 'SUBPIXEL_BITS',\n  3410: 'RED_BITS',\n  3411: 'GREEN_BITS',\n  3412: 'BLUE_BITS',\n  3413: 'ALPHA_BITS',\n  3414: 'DEPTH_BITS',\n  3415: 'STENCIL_BITS',\n  3553: 'TEXTURE_2D',\n  4352: 'DONT_CARE',\n  4353: 'FASTEST',\n  4354: 'NICEST',\n  5120: 'BYTE',\n  5121: 'UNSIGNED_BYTE',\n  5122: 'SHORT',\n  5123: 'UNSIGNED_SHORT',\n  5124: 'INT',\n  5125: 'UNSIGNED_INT',\n  5126: 'FLOAT',\n  5386: 'INVERT',\n  5890: 'TEXTURE',\n  6401: 'STENCIL_INDEX',\n  6402: 'DEPTH_COMPONENT',\n  6406: 'ALPHA',\n  6407: 'RGB',\n  6408: 'RGBA',\n  6409: 'LUMINANCE',\n  6410: 'LUMINANCE_ALPHA',\n  7680: 'KEEP',\n  7681: 'REPLACE',\n  7682: 'INCR',\n  7683: 'DECR',\n  7936: 'VENDOR',\n  7937: 'RENDERER',\n  7938: 'VERSION',\n  9728: 'NEAREST',\n  9729: 'LINEAR',\n  9984: 'NEAREST_MIPMAP_NEAREST',\n  9985: 'LINEAR_MIPMAP_NEAREST',\n  9986: 'NEAREST_MIPMAP_LINEAR',\n  9987: 'LINEAR_MIPMAP_LINEAR',\n  10240: 'TEXTURE_MAG_FILTER',\n  10241: 'TEXTURE_MIN_FILTER',\n  10242: 'TEXTURE_WRAP_S',\n  10243: 'TEXTURE_WRAP_T',\n  10497: 'REPEAT',\n  10752: 'POLYGON_OFFSET_UNITS',\n  16384: 'COLOR_BUFFER_BIT',\n  32769: 'CONSTANT_COLOR',\n  32770: 'ONE_MINUS_CONSTANT_COLOR',\n  32771: 'CONSTANT_ALPHA',\n  32772: 'ONE_MINUS_CONSTANT_ALPHA',\n  32773: 'BLEND_COLOR',\n  32774: 'FUNC_ADD',\n  32777: 'BLEND_EQUATION_RGB',\n  32778: 'FUNC_SUBTRACT',\n  32779: 'FUNC_REVERSE_SUBTRACT',\n  32819: 'UNSIGNED_SHORT_4_4_4_4',\n  32820: 'UNSIGNED_SHORT_5_5_5_1',\n  32823: 'POLYGON_OFFSET_FILL',\n  32824: 'POLYGON_OFFSET_FACTOR',\n  32854: 'RGBA4',\n  32855: 'RGB5_A1',\n  32873: 'TEXTURE_BINDING_2D',\n  32926: 'SAMPLE_ALPHA_TO_COVERAGE',\n  32928: 'SAMPLE_COVERAGE',\n  32936: 'SAMPLE_BUFFERS',\n  32937: 'SAMPLES',\n  32938: 'SAMPLE_COVERAGE_VALUE',\n  32939: 'SAMPLE_COVERAGE_INVERT',\n  32968: 'BLEND_DST_RGB',\n  32969: 'BLEND_SRC_RGB',\n  32970: 'BLEND_DST_ALPHA',\n  32971: 'BLEND_SRC_ALPHA',\n  33071: 'CLAMP_TO_EDGE',\n  33170: 'GENERATE_MIPMAP_HINT',\n  33189: 'DEPTH_COMPONENT16',\n  33306: 'DEPTH_STENCIL_ATTACHMENT',\n  33635: 'UNSIGNED_SHORT_5_6_5',\n  33648: 'MIRRORED_REPEAT',\n  33901: 'ALIASED_POINT_SIZE_RANGE',\n  33902: 'ALIASED_LINE_WIDTH_RANGE',\n  33984: 'TEXTURE0',\n  33985: 'TEXTURE1',\n  33986: 'TEXTURE2',\n  33987: 'TEXTURE3',\n  33988: 'TEXTURE4',\n  33989: 'TEXTURE5',\n  33990: 'TEXTURE6',\n  33991: 'TEXTURE7',\n  33992: 'TEXTURE8',\n  33993: 'TEXTURE9',\n  33994: 'TEXTURE10',\n  33995: 'TEXTURE11',\n  33996: 'TEXTURE12',\n  33997: 'TEXTURE13',\n  33998: 'TEXTURE14',\n  33999: 'TEXTURE15',\n  34000: 'TEXTURE16',\n  34001: 'TEXTURE17',\n  34002: 'TEXTURE18',\n  34003: 'TEXTURE19',\n  34004: 'TEXTURE20',\n  34005: 'TEXTURE21',\n  34006: 'TEXTURE22',\n  34007: 'TEXTURE23',\n  34008: 'TEXTURE24',\n  34009: 'TEXTURE25',\n  34010: 'TEXTURE26',\n  34011: 'TEXTURE27',\n  34012: 'TEXTURE28',\n  34013: 'TEXTURE29',\n  34014: 'TEXTURE30',\n  34015: 'TEXTURE31',\n  34016: 'ACTIVE_TEXTURE',\n  34024: 'MAX_RENDERBUFFER_SIZE',\n  34041: 'DEPTH_STENCIL',\n  34055: 'INCR_WRAP',\n  34056: 'DECR_WRAP',\n  34067: 'TEXTURE_CUBE_MAP',\n  34068: 'TEXTURE_BINDING_CUBE_MAP',\n  34069: 'TEXTURE_CUBE_MAP_POSITIVE_X',\n  34070: 'TEXTURE_CUBE_MAP_NEGATIVE_X',\n  34071: 'TEXTURE_CUBE_MAP_POSITIVE_Y',\n  34072: 'TEXTURE_CUBE_MAP_NEGATIVE_Y',\n  34073: 'TEXTURE_CUBE_MAP_POSITIVE_Z',\n  34074: 'TEXTURE_CUBE_MAP_NEGATIVE_Z',\n  34076: 'MAX_CUBE_MAP_TEXTURE_SIZE',\n  34338: 'VERTEX_ATTRIB_ARRAY_ENABLED',\n  34339: 'VERTEX_ATTRIB_ARRAY_SIZE',\n  34340: 'VERTEX_ATTRIB_ARRAY_STRIDE',\n  34341: 'VERTEX_ATTRIB_ARRAY_TYPE',\n  34342: 'CURRENT_VERTEX_ATTRIB',\n  34373: 'VERTEX_ATTRIB_ARRAY_POINTER',\n  34466: 'NUM_COMPRESSED_TEXTURE_FORMATS',\n  34467: 'COMPRESSED_TEXTURE_FORMATS',\n  34660: 'BUFFER_SIZE',\n  34661: 'BUFFER_USAGE',\n  34816: 'STENCIL_BACK_FUNC',\n  34817: 'STENCIL_BACK_FAIL',\n  34818: 'STENCIL_BACK_PASS_DEPTH_FAIL',\n  34819: 'STENCIL_BACK_PASS_DEPTH_PASS',\n  34877: 'BLEND_EQUATION_ALPHA',\n  34921: 'MAX_VERTEX_ATTRIBS',\n  34922: 'VERTEX_ATTRIB_ARRAY_NORMALIZED',\n  34930: 'MAX_TEXTURE_IMAGE_UNITS',\n  34962: 'ARRAY_BUFFER',\n  34963: 'ELEMENT_ARRAY_BUFFER',\n  34964: 'ARRAY_BUFFER_BINDING',\n  34965: 'ELEMENT_ARRAY_BUFFER_BINDING',\n  34975: 'VERTEX_ATTRIB_ARRAY_BUFFER_BINDING',\n  35040: 'STREAM_DRAW',\n  35044: 'STATIC_DRAW',\n  35048: 'DYNAMIC_DRAW',\n  35632: 'FRAGMENT_SHADER',\n  35633: 'VERTEX_SHADER',\n  35660: 'MAX_VERTEX_TEXTURE_IMAGE_UNITS',\n  35661: 'MAX_COMBINED_TEXTURE_IMAGE_UNITS',\n  35663: 'SHADER_TYPE',\n  35664: 'FLOAT_VEC2',\n  35665: 'FLOAT_VEC3',\n  35666: 'FLOAT_VEC4',\n  35667: 'INT_VEC2',\n  35668: 'INT_VEC3',\n  35669: 'INT_VEC4',\n  35670: 'BOOL',\n  35671: 'BOOL_VEC2',\n  35672: 'BOOL_VEC3',\n  35673: 'BOOL_VEC4',\n  35674: 'FLOAT_MAT2',\n  35675: 'FLOAT_MAT3',\n  35676: 'FLOAT_MAT4',\n  35678: 'SAMPLER_2D',\n  35680: 'SAMPLER_CUBE',\n  35712: 'DELETE_STATUS',\n  35713: 'COMPILE_STATUS',\n  35714: 'LINK_STATUS',\n  35715: 'VALIDATE_STATUS',\n  35716: 'INFO_LOG_LENGTH',\n  35717: 'ATTACHED_SHADERS',\n  35718: 'ACTIVE_UNIFORMS',\n  35719: 'ACTIVE_UNIFORM_MAX_LENGTH',\n  35720: 'SHADER_SOURCE_LENGTH',\n  35721: 'ACTIVE_ATTRIBUTES',\n  35722: 'ACTIVE_ATTRIBUTE_MAX_LENGTH',\n  35724: 'SHADING_LANGUAGE_VERSION',\n  35725: 'CURRENT_PROGRAM',\n  36003: 'STENCIL_BACK_REF',\n  36004: 'STENCIL_BACK_VALUE_MASK',\n  36005: 'STENCIL_BACK_WRITEMASK',\n  36006: 'FRAMEBUFFER_BINDING',\n  36007: 'RENDERBUFFER_BINDING',\n  36048: 'FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE',\n  36049: 'FRAMEBUFFER_ATTACHMENT_OBJECT_NAME',\n  36050: 'FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL',\n  36051: 'FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE',\n  36053: 'FRAMEBUFFER_COMPLETE',\n  36054: 'FRAMEBUFFER_INCOMPLETE_ATTACHMENT',\n  36055: 'FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT',\n  36057: 'FRAMEBUFFER_INCOMPLETE_DIMENSIONS',\n  36061: 'FRAMEBUFFER_UNSUPPORTED',\n  36064: 'COLOR_ATTACHMENT0',\n  36096: 'DEPTH_ATTACHMENT',\n  36128: 'STENCIL_ATTACHMENT',\n  36160: 'FRAMEBUFFER',\n  36161: 'RENDERBUFFER',\n  36162: 'RENDERBUFFER_WIDTH',\n  36163: 'RENDERBUFFER_HEIGHT',\n  36164: 'RENDERBUFFER_INTERNAL_FORMAT',\n  36168: 'STENCIL_INDEX8',\n  36176: 'RENDERBUFFER_RED_SIZE',\n  36177: 'RENDERBUFFER_GREEN_SIZE',\n  36178: 'RENDERBUFFER_BLUE_SIZE',\n  36179: 'RENDERBUFFER_ALPHA_SIZE',\n  36180: 'RENDERBUFFER_DEPTH_SIZE',\n  36181: 'RENDERBUFFER_STENCIL_SIZE',\n  36194: 'RGB565',\n  36336: 'LOW_FLOAT',\n  36337: 'MEDIUM_FLOAT',\n  36338: 'HIGH_FLOAT',\n  36339: 'LOW_INT',\n  36340: 'MEDIUM_INT',\n  36341: 'HIGH_INT',\n  36346: 'SHADER_COMPILER',\n  36347: 'MAX_VERTEX_UNIFORM_VECTORS',\n  36348: 'MAX_VARYING_VECTORS',\n  36349: 'MAX_FRAGMENT_UNIFORM_VECTORS',\n  37440: 'UNPACK_FLIP_Y_WEBGL',\n  37441: 'UNPACK_PREMULTIPLY_ALPHA_WEBGL',\n  37442: 'CONTEXT_LOST_WEBGL',\n  37443: 'UNPACK_COLORSPACE_CONVERSION_WEBGL',\n  37444: 'BROWSER_DEFAULT_WEBGL'\n}\n","var padLeft = require('pad-left')\n\nmodule.exports = addLineNumbers\nfunction addLineNumbers (string, start, delim) {\n  start = typeof start === 'number' ? start : 1\n  delim = delim || ': '\n\n  var lines = string.split(/\\r?\\n/)\n  var totalDigits = String(lines.length + start - 1).length\n  return lines.map(function (line, i) {\n    var c = i + start\n    var digits = String(c).length\n    var prefix = padLeft(c, totalDigits - digits)\n    return prefix + delim + line\n  }).join('\\n')\n}\n","/*!\n * repeat-string <https://github.com/jonschlinkert/repeat-string>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\n/**\n * Results cache\n */\n\nvar res = '';\nvar cache;\n\n/**\n * Expose `repeat`\n */\n\nmodule.exports = repeat;\n\n/**\n * Repeat the given `string` the specified `number`\n * of times.\n *\n * **Example:**\n *\n * ```js\n * var repeat = require('repeat-string');\n * repeat('A', 5);\n * //=> AAAAA\n * ```\n *\n * @param {String} `string` The string to repeat\n * @param {Number} `number` The number of times to repeat the string\n * @return {String} Repeated string\n * @api public\n */\n\nfunction repeat(str, num) {\n  if (typeof str !== 'string') {\n    throw new TypeError('expected a string');\n  }\n\n  // cover common, quick use cases\n  if (num === 1) return str;\n  if (num === 2) return str + str;\n\n  var max = str.length * num;\n  if (cache !== str || typeof cache === 'undefined') {\n    cache = str;\n    res = '';\n  } else if (res.length >= max) {\n    return res.substr(0, max);\n  }\n\n  while (max > res.length && num > 1) {\n    if (num & 1) {\n      res += str;\n    }\n\n    num >>= 1;\n    str += str;\n  }\n\n  res += str;\n  res = res.substr(0, max);\n  return res;\n}\n","\nvar sprintf = require('sprintf-js').sprintf;\nvar glConstants = require('gl-constants/lookup');\nvar shaderName = require('glsl-shader-name');\nvar addLineNumbers = require('add-line-numbers');\n\nmodule.exports = formatCompilerError;\n\nfunction formatCompilerError(errLog, src, type) {\n    \"use strict\";\n\n    var name = shaderName(src) || 'of unknown name (see npm glsl-shader-name)';\n\n    var typeName = 'unknown type';\n    if (type !== undefined) {\n        typeName = type === glConstants.FRAGMENT_SHADER ? 'fragment' : 'vertex'\n    }\n\n    var longForm = sprintf('Error compiling %s shader %s:\\n', typeName, name);\n    var shortForm = sprintf(\"%s%s\", longForm, errLog);\n\n    var errorStrings = errLog.split('\\n');\n    var errors = {};\n\n    for (var i = 0; i < errorStrings.length; i++) {\n        var errorString = errorStrings[i];\n        if (errorString === '' || errorString === \"\\0\") continue;\n        var lineNo = parseInt(errorString.split(':')[2]);\n        if (isNaN(lineNo)) {\n            throw new Error(sprintf('Could not parse error: %s', errorString));\n        }\n        errors[lineNo] = errorString;\n    }\n\n    var lines = addLineNumbers(src).split('\\n');\n\n    for (var i = 0; i < lines.length; i++) {\n        if (!errors[i+3] && !errors[i+2] && !errors[i+1]) continue;\n        var line = lines[i];\n        longForm += line + '\\n';\n        if (errors[i+1]) {\n            var e = errors[i+1];\n            e = e.substr(e.split(':', 3).join(':').length + 1).trim();\n            longForm += sprintf('^^^ %s\\n\\n', e);\n        }\n    }\n\n    return {\n        long: longForm.trim(),\n        short: shortForm.trim()\n    };\n}\n\n","module.exports = function _atob(str) {\n  return atob(str)\n}\n","var tokenize = require('./index')\r\n\r\nmodule.exports = tokenizeString\r\n\r\nfunction tokenizeString(str, opt) {\r\n  var generator = tokenize(opt)\r\n  var tokens = []\r\n\r\n  tokens = tokens.concat(generator(str))\r\n  tokens = tokens.concat(generator(null))\r\n\r\n  return tokens\r\n}\r\n","var gl10 = require('./1.0/numbers')\n\nmodule.exports = function lookupConstant (number) {\n  return gl10[number]\n}\n","module.exports = tokenize\r\n\r\nvar literals100 = require('./lib/literals')\r\n  , operators = require('./lib/operators')\r\n  , builtins100 = require('./lib/builtins')\r\n  , literals300es = require('./lib/literals-300es')\r\n  , builtins300es = require('./lib/builtins-300es')\r\n\r\nvar NORMAL = 999          // <-- never emitted\r\n  , TOKEN = 9999          // <-- never emitted\r\n  , BLOCK_COMMENT = 0\r\n  , LINE_COMMENT = 1\r\n  , PREPROCESSOR = 2\r\n  , OPERATOR = 3\r\n  , INTEGER = 4\r\n  , FLOAT = 5\r\n  , IDENT = 6\r\n  , BUILTIN = 7\r\n  , KEYWORD = 8\r\n  , WHITESPACE = 9\r\n  , EOF = 10\r\n  , HEX = 11\r\n\r\nvar map = [\r\n    'block-comment'\r\n  , 'line-comment'\r\n  , 'preprocessor'\r\n  , 'operator'\r\n  , 'integer'\r\n  , 'float'\r\n  , 'ident'\r\n  , 'builtin'\r\n  , 'keyword'\r\n  , 'whitespace'\r\n  , 'eof'\r\n  , 'integer'\r\n]\r\n\r\nfunction tokenize(opt) {\r\n  var i = 0\r\n    , total = 0\r\n    , mode = NORMAL\r\n    , c\r\n    , last\r\n    , content = []\r\n    , tokens = []\r\n    , token_idx = 0\r\n    , token_offs = 0\r\n    , line = 1\r\n    , col = 0\r\n    , start = 0\r\n    , isnum = false\r\n    , isoperator = false\r\n    , input = ''\r\n    , len\r\n\r\n  opt = opt || {}\r\n  var allBuiltins = builtins100\r\n  var allLiterals = literals100\r\n  if (opt.version === '300 es') {\r\n    allBuiltins = builtins300es\r\n    allLiterals = literals300es\r\n  }\r\n\r\n  // cache by name\r\n  var builtinsDict = {}, literalsDict = {}\r\n  for (var i = 0; i < allBuiltins.length; i++) {\r\n    builtinsDict[allBuiltins[i]] = true\r\n  }\r\n  for (var i = 0; i < allLiterals.length; i++) {\r\n    literalsDict[allLiterals[i]] = true\r\n  }\r\n\r\n  return function(data) {\r\n    tokens = []\r\n    if (data !== null) return write(data)\r\n    return end()\r\n  }\r\n\r\n  function token(data) {\r\n    if (data.length) {\r\n      tokens.push({\r\n        type: map[mode]\r\n      , data: data\r\n      , position: start\r\n      , line: line\r\n      , column: col\r\n      })\r\n    }\r\n  }\r\n\r\n  function write(chunk) {\r\n    i = 0\r\n\r\n    if (chunk.toString) chunk = chunk.toString()\r\n\r\n    input += chunk.replace(/\\r\\n/g, '\\n')\r\n    len = input.length\r\n\r\n\r\n    var last\r\n\r\n    while(c = input[i], i < len) {\r\n      last = i\r\n\r\n      switch(mode) {\r\n        case BLOCK_COMMENT: i = block_comment(); break\r\n        case LINE_COMMENT: i = line_comment(); break\r\n        case PREPROCESSOR: i = preprocessor(); break\r\n        case OPERATOR: i = operator(); break\r\n        case INTEGER: i = integer(); break\r\n        case HEX: i = hex(); break\r\n        case FLOAT: i = decimal(); break\r\n        case TOKEN: i = readtoken(); break\r\n        case WHITESPACE: i = whitespace(); break\r\n        case NORMAL: i = normal(); break\r\n      }\r\n\r\n      if(last !== i) {\r\n        switch(input[last]) {\r\n          case '\\n': col = 0; ++line; break\r\n          default: ++col; break\r\n        }\r\n      }\r\n    }\r\n\r\n    total += i\r\n    input = input.slice(i)\r\n    return tokens\r\n  }\r\n\r\n  function end(chunk) {\r\n    if(content.length) {\r\n      token(content.join(''))\r\n    }\r\n\r\n    mode = EOF\r\n    token('(eof)')\r\n    return tokens\r\n  }\r\n\r\n  function normal() {\r\n    content = content.length ? [] : content\r\n\r\n    if(last === '/' && c === '*') {\r\n      start = total + i - 1\r\n      mode = BLOCK_COMMENT\r\n      last = c\r\n      return i + 1\r\n    }\r\n\r\n    if(last === '/' && c === '/') {\r\n      start = total + i - 1\r\n      mode = LINE_COMMENT\r\n      last = c\r\n      return i + 1\r\n    }\r\n\r\n    if(c === '#') {\r\n      mode = PREPROCESSOR\r\n      start = total + i\r\n      return i\r\n    }\r\n\r\n    if(/\\s/.test(c)) {\r\n      mode = WHITESPACE\r\n      start = total + i\r\n      return i\r\n    }\r\n\r\n    isnum = /\\d/.test(c)\r\n    isoperator = /[^\\w_]/.test(c)\r\n\r\n    start = total + i\r\n    mode = isnum ? INTEGER : isoperator ? OPERATOR : TOKEN\r\n    return i\r\n  }\r\n\r\n  function whitespace() {\r\n    if(/[^\\s]/g.test(c)) {\r\n      token(content.join(''))\r\n      mode = NORMAL\r\n      return i\r\n    }\r\n    content.push(c)\r\n    last = c\r\n    return i + 1\r\n  }\r\n\r\n  function preprocessor() {\r\n    if((c === '\\r' || c === '\\n') && last !== '\\\\') {\r\n      token(content.join(''))\r\n      mode = NORMAL\r\n      return i\r\n    }\r\n    content.push(c)\r\n    last = c\r\n    return i + 1\r\n  }\r\n\r\n  function line_comment() {\r\n    return preprocessor()\r\n  }\r\n\r\n  function block_comment() {\r\n    if(c === '/' && last === '*') {\r\n      content.push(c)\r\n      token(content.join(''))\r\n      mode = NORMAL\r\n      return i + 1\r\n    }\r\n\r\n    content.push(c)\r\n    last = c\r\n    return i + 1\r\n  }\r\n\r\n  function operator() {\r\n    if(last === '.' && /\\d/.test(c)) {\r\n      mode = FLOAT\r\n      return i\r\n    }\r\n\r\n    if(last === '/' && c === '*') {\r\n      mode = BLOCK_COMMENT\r\n      return i\r\n    }\r\n\r\n    if(last === '/' && c === '/') {\r\n      mode = LINE_COMMENT\r\n      return i\r\n    }\r\n\r\n    if(c === '.' && content.length) {\r\n      while(determine_operator(content));\r\n\r\n      mode = FLOAT\r\n      return i\r\n    }\r\n\r\n    if(c === ';' || c === ')' || c === '(') {\r\n      if(content.length) while(determine_operator(content));\r\n      token(c)\r\n      mode = NORMAL\r\n      return i + 1\r\n    }\r\n\r\n    var is_composite_operator = content.length === 2 && c !== '='\r\n    if(/[\\w_\\d\\s]/.test(c) || is_composite_operator) {\r\n      while(determine_operator(content));\r\n      mode = NORMAL\r\n      return i\r\n    }\r\n\r\n    content.push(c)\r\n    last = c\r\n    return i + 1\r\n  }\r\n\r\n  function determine_operator(buf) {\r\n    var j = 0\r\n      , idx\r\n      , res\r\n\r\n    do {\r\n      idx = operators.indexOf(buf.slice(0, buf.length + j).join(''))\r\n      res = operators[idx]\r\n\r\n      if(idx === -1) {\r\n        if(j-- + buf.length > 0) continue\r\n        res = buf.slice(0, 1).join('')\r\n      }\r\n\r\n      token(res)\r\n\r\n      start += res.length\r\n      content = content.slice(res.length)\r\n      return content.length\r\n    } while(1)\r\n  }\r\n\r\n  function hex() {\r\n    if(/[^a-fA-F0-9]/.test(c)) {\r\n      token(content.join(''))\r\n      mode = NORMAL\r\n      return i\r\n    }\r\n\r\n    content.push(c)\r\n    last = c\r\n    return i + 1\r\n  }\r\n\r\n  function integer() {\r\n    if(c === '.') {\r\n      content.push(c)\r\n      mode = FLOAT\r\n      last = c\r\n      return i + 1\r\n    }\r\n\r\n    if(/[eE]/.test(c)) {\r\n      content.push(c)\r\n      mode = FLOAT\r\n      last = c\r\n      return i + 1\r\n    }\r\n\r\n    if(c === 'x' && content.length === 1 && content[0] === '0') {\r\n      mode = HEX\r\n      content.push(c)\r\n      last = c\r\n      return i + 1\r\n    }\r\n\r\n    if(/[^\\d]/.test(c)) {\r\n      token(content.join(''))\r\n      mode = NORMAL\r\n      return i\r\n    }\r\n\r\n    content.push(c)\r\n    last = c\r\n    return i + 1\r\n  }\r\n\r\n  function decimal() {\r\n    if(c === 'f') {\r\n      content.push(c)\r\n      last = c\r\n      i += 1\r\n    }\r\n\r\n    if(/[eE]/.test(c)) {\r\n      content.push(c)\r\n      last = c\r\n      return i + 1\r\n    }\r\n\r\n    if ((c === '-' || c === '+') && /[eE]/.test(last)) {\r\n      content.push(c)\r\n      last = c\r\n      return i + 1\r\n    }\r\n\r\n    if(/[^\\d]/.test(c)) {\r\n      token(content.join(''))\r\n      mode = NORMAL\r\n      return i\r\n    }\r\n\r\n    content.push(c)\r\n    last = c\r\n    return i + 1\r\n  }\r\n\r\n  function readtoken() {\r\n    if(/[^\\d\\w_]/.test(c)) {\r\n      var contentstr = content.join('')\r\n      if(literalsDict[contentstr]) {\r\n        mode = KEYWORD\r\n      } else if(builtinsDict[contentstr]) {\r\n        mode = BUILTIN\r\n      } else {\r\n        mode = IDENT\r\n      }\r\n      token(content.join(''))\r\n      mode = NORMAL\r\n      return i\r\n    }\r\n    content.push(c)\r\n    last = c\r\n    return i + 1\r\n  }\r\n}\r\n","module.exports = [\r\n  // Keep this list sorted\r\n  'abs'\r\n  , 'acos'\r\n  , 'all'\r\n  , 'any'\r\n  , 'asin'\r\n  , 'atan'\r\n  , 'ceil'\r\n  , 'clamp'\r\n  , 'cos'\r\n  , 'cross'\r\n  , 'dFdx'\r\n  , 'dFdy'\r\n  , 'degrees'\r\n  , 'distance'\r\n  , 'dot'\r\n  , 'equal'\r\n  , 'exp'\r\n  , 'exp2'\r\n  , 'faceforward'\r\n  , 'floor'\r\n  , 'fract'\r\n  , 'gl_BackColor'\r\n  , 'gl_BackLightModelProduct'\r\n  , 'gl_BackLightProduct'\r\n  , 'gl_BackMaterial'\r\n  , 'gl_BackSecondaryColor'\r\n  , 'gl_ClipPlane'\r\n  , 'gl_ClipVertex'\r\n  , 'gl_Color'\r\n  , 'gl_DepthRange'\r\n  , 'gl_DepthRangeParameters'\r\n  , 'gl_EyePlaneQ'\r\n  , 'gl_EyePlaneR'\r\n  , 'gl_EyePlaneS'\r\n  , 'gl_EyePlaneT'\r\n  , 'gl_Fog'\r\n  , 'gl_FogCoord'\r\n  , 'gl_FogFragCoord'\r\n  , 'gl_FogParameters'\r\n  , 'gl_FragColor'\r\n  , 'gl_FragCoord'\r\n  , 'gl_FragData'\r\n  , 'gl_FragDepth'\r\n  , 'gl_FragDepthEXT'\r\n  , 'gl_FrontColor'\r\n  , 'gl_FrontFacing'\r\n  , 'gl_FrontLightModelProduct'\r\n  , 'gl_FrontLightProduct'\r\n  , 'gl_FrontMaterial'\r\n  , 'gl_FrontSecondaryColor'\r\n  , 'gl_LightModel'\r\n  , 'gl_LightModelParameters'\r\n  , 'gl_LightModelProducts'\r\n  , 'gl_LightProducts'\r\n  , 'gl_LightSource'\r\n  , 'gl_LightSourceParameters'\r\n  , 'gl_MaterialParameters'\r\n  , 'gl_MaxClipPlanes'\r\n  , 'gl_MaxCombinedTextureImageUnits'\r\n  , 'gl_MaxDrawBuffers'\r\n  , 'gl_MaxFragmentUniformComponents'\r\n  , 'gl_MaxLights'\r\n  , 'gl_MaxTextureCoords'\r\n  , 'gl_MaxTextureImageUnits'\r\n  , 'gl_MaxTextureUnits'\r\n  , 'gl_MaxVaryingFloats'\r\n  , 'gl_MaxVertexAttribs'\r\n  , 'gl_MaxVertexTextureImageUnits'\r\n  , 'gl_MaxVertexUniformComponents'\r\n  , 'gl_ModelViewMatrix'\r\n  , 'gl_ModelViewMatrixInverse'\r\n  , 'gl_ModelViewMatrixInverseTranspose'\r\n  , 'gl_ModelViewMatrixTranspose'\r\n  , 'gl_ModelViewProjectionMatrix'\r\n  , 'gl_ModelViewProjectionMatrixInverse'\r\n  , 'gl_ModelViewProjectionMatrixInverseTranspose'\r\n  , 'gl_ModelViewProjectionMatrixTranspose'\r\n  , 'gl_MultiTexCoord0'\r\n  , 'gl_MultiTexCoord1'\r\n  , 'gl_MultiTexCoord2'\r\n  , 'gl_MultiTexCoord3'\r\n  , 'gl_MultiTexCoord4'\r\n  , 'gl_MultiTexCoord5'\r\n  , 'gl_MultiTexCoord6'\r\n  , 'gl_MultiTexCoord7'\r\n  , 'gl_Normal'\r\n  , 'gl_NormalMatrix'\r\n  , 'gl_NormalScale'\r\n  , 'gl_ObjectPlaneQ'\r\n  , 'gl_ObjectPlaneR'\r\n  , 'gl_ObjectPlaneS'\r\n  , 'gl_ObjectPlaneT'\r\n  , 'gl_Point'\r\n  , 'gl_PointCoord'\r\n  , 'gl_PointParameters'\r\n  , 'gl_PointSize'\r\n  , 'gl_Position'\r\n  , 'gl_ProjectionMatrix'\r\n  , 'gl_ProjectionMatrixInverse'\r\n  , 'gl_ProjectionMatrixInverseTranspose'\r\n  , 'gl_ProjectionMatrixTranspose'\r\n  , 'gl_SecondaryColor'\r\n  , 'gl_TexCoord'\r\n  , 'gl_TextureEnvColor'\r\n  , 'gl_TextureMatrix'\r\n  , 'gl_TextureMatrixInverse'\r\n  , 'gl_TextureMatrixInverseTranspose'\r\n  , 'gl_TextureMatrixTranspose'\r\n  , 'gl_Vertex'\r\n  , 'greaterThan'\r\n  , 'greaterThanEqual'\r\n  , 'inversesqrt'\r\n  , 'length'\r\n  , 'lessThan'\r\n  , 'lessThanEqual'\r\n  , 'log'\r\n  , 'log2'\r\n  , 'matrixCompMult'\r\n  , 'max'\r\n  , 'min'\r\n  , 'mix'\r\n  , 'mod'\r\n  , 'normalize'\r\n  , 'not'\r\n  , 'notEqual'\r\n  , 'pow'\r\n  , 'radians'\r\n  , 'reflect'\r\n  , 'refract'\r\n  , 'sign'\r\n  , 'sin'\r\n  , 'smoothstep'\r\n  , 'sqrt'\r\n  , 'step'\r\n  , 'tan'\r\n  , 'texture2D'\r\n  , 'texture2DLod'\r\n  , 'texture2DProj'\r\n  , 'texture2DProjLod'\r\n  , 'textureCube'\r\n  , 'textureCubeLod'\r\n  , 'texture2DLodEXT'\r\n  , 'texture2DProjLodEXT'\r\n  , 'textureCubeLodEXT'\r\n  , 'texture2DGradEXT'\r\n  , 'texture2DProjGradEXT'\r\n  , 'textureCubeGradEXT'\r\n]\r\n","// 300es builtins/reserved words that were previously valid in v100\r\nvar v100 = require('./builtins')\r\n\r\n// The texture2D|Cube functions have been removed\r\n// And the gl_ features are updated\r\nv100 = v100.slice().filter(function (b) {\r\n  return !/^(gl\\_|texture)/.test(b)\r\n})\r\n\r\nmodule.exports = v100.concat([\r\n  // the updated gl_ constants\r\n    'gl_VertexID'\r\n  , 'gl_InstanceID'\r\n  , 'gl_Position'\r\n  , 'gl_PointSize'\r\n  , 'gl_FragCoord'\r\n  , 'gl_FrontFacing'\r\n  , 'gl_FragDepth'\r\n  , 'gl_PointCoord'\r\n  , 'gl_MaxVertexAttribs'\r\n  , 'gl_MaxVertexUniformVectors'\r\n  , 'gl_MaxVertexOutputVectors'\r\n  , 'gl_MaxFragmentInputVectors'\r\n  , 'gl_MaxVertexTextureImageUnits'\r\n  , 'gl_MaxCombinedTextureImageUnits'\r\n  , 'gl_MaxTextureImageUnits'\r\n  , 'gl_MaxFragmentUniformVectors'\r\n  , 'gl_MaxDrawBuffers'\r\n  , 'gl_MinProgramTexelOffset'\r\n  , 'gl_MaxProgramTexelOffset'\r\n  , 'gl_DepthRangeParameters'\r\n  , 'gl_DepthRange'\r\n\r\n  // other builtins\r\n  , 'trunc'\r\n  , 'round'\r\n  , 'roundEven'\r\n  , 'isnan'\r\n  , 'isinf'\r\n  , 'floatBitsToInt'\r\n  , 'floatBitsToUint'\r\n  , 'intBitsToFloat'\r\n  , 'uintBitsToFloat'\r\n  , 'packSnorm2x16'\r\n  , 'unpackSnorm2x16'\r\n  , 'packUnorm2x16'\r\n  , 'unpackUnorm2x16'\r\n  , 'packHalf2x16'\r\n  , 'unpackHalf2x16'\r\n  , 'outerProduct'\r\n  , 'transpose'\r\n  , 'determinant'\r\n  , 'inverse'\r\n  , 'texture'\r\n  , 'textureSize'\r\n  , 'textureProj'\r\n  , 'textureLod'\r\n  , 'textureOffset'\r\n  , 'texelFetch'\r\n  , 'texelFetchOffset'\r\n  , 'textureProjOffset'\r\n  , 'textureLodOffset'\r\n  , 'textureProjLod'\r\n  , 'textureProjLodOffset'\r\n  , 'textureGrad'\r\n  , 'textureGradOffset'\r\n  , 'textureProjGrad'\r\n  , 'textureProjGradOffset'\r\n])\r\n","/*!\n * pad-left <https://github.com/jonschlinkert/pad-left>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT license.\n */\n\n'use strict';\n\nvar repeat = require('repeat-string');\n\nmodule.exports = function padLeft(str, num, ch) {\n  ch = typeof ch !== 'undefined' ? (ch + '') : ' ';\n  return repeat(ch, num) + str;\n};"],"names":["module","exports","abs","atan2","cos","floor","log","min","max","round","sign","sin","sqrt","cbrt","PI","hypot","Math","lerp","a","b","f","clamp","x","newtonIterate1d","xStart","max_steps","eps","fx","dfdx","console","DEG2RAD","RAD2DEG","color","args","Color","length","guess","slice","Array","isArray","constructor","r","g","mix","col2","m","this","rgb","doRound","clamp_","t","rgba","hex","mode","r255","g255","b255","a1","rgbString","toString","padStart","alphaString","rgb2hex","hsl","hue","min1","max1","rgb2hexhue","l1","s1","rgb2hsl","hsv","min255","max255","rgb2hsv","hcg","c1","rgb2hcg","css","map","join","rgb2css","h","s","l","alpha","rnd","hsl2css","Error","name","closest","thisNum","num","Object","keys","w3cx11","find","thisLStar","thisAStar","thisBStar","lab","lStar","aStar","bStar","arr","indexOfMax","cmyk","k","rgb2cmyk","gl","luminance","lum1","Y","rgb2xyz","undefined","inverseLerp","val","white","black","temperature","set","modeAndChannel","value","channel","split","src","i","indexOf","clipped","textColor","alpha1","darker","amount","LAB_Kn","brighter","saturate","c","lch","desaturate","premultiplied","hsi","r1","g1","b1","i1","beta","hRad","rgb2hsi","rgb2lab","rgbNum","rgb2num","b2","lab2lch","rgb2lch","xyz","equals","r2","g2","a2","hashCode","toSource","prototype","kelvin","brewer","OrRd","PuBu","BuPu","Oranges","BuGn","YlOrBr","YlGn","Reds","RdPu","Greens","YlGnBu","Purples","GnBu","Greys","YlOrRd","PuRd","Blues","PuBuGn","Viridis","Spectral","RdYlGn","RdBu","PiYG","PRGn","RdYlBu","BrBG","RdGy","PuOr","Set2","Accent","Set1","Set3","Dark2","Paired","Pastel2","Pastel1","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflower","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","laserlemon","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrod","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","maroon2","maroon3","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","purple2","purple3","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","whitesmoke","yellow","yellowgreen","col1","c2","res","interpolators","cssString","css2rgb","num2rgb","scale","_at","getOwnPropertyNames","Scale","forEach","key","_init","blend_f","each","_","classes","_classes","domain","limits","_colors","_pos","p","_min","_max","d","lerpInv","_mode","_resetCache","out","outputFormat","_out","correctLightness","enableCorrectLightness","_correctLightness","colors","sign2","padding","paddingLeft","paddingRight","_paddingLeft","_paddingRight","numColors","format","result","_color","from","samples","cache","enableCache","_cache","Map","gamma","_gamma","colorsOrFunction","_getClass","findIndex","cls","bypassMap","_tCorrectedLightness","tHash","cacheResult","get","col","t0_1","L_ideal","steps","fA","fC","bisect","clear","scales","data","info","Infinity","sum","values","count","isNaN","push","add","analyze","sort","startsWith","min_log","LOG10E","max_log","pb","n","assignments","clusterSizes","repeat","nb_iters","centroids","fill","minDistIndex","newCentroids","j","some","nc","kClusters","tmpKMeansBreaks","kCluster","v","cool","hot","_input","JSON","stringify","channels","hex2rgb","match","parseInt","norm360","degrees","xyz1","xyz2","lrgb","hsl2rgb","hueDegrees","v1","hcxm2rgb","WS","FLOAT","CSS_RGB_REGEX","RegExp","CSS_RGB_WS_REGEX","CSS_RGB_PERCENT_REGEX","CSS_RGB_WS_PERCENT_REGEX","CSS_HSL_REGEX","CSS_HSL_WS_REGEX","hasOwnProperty","toLowerCase","CONVERSION","deg","rad","turn","angleUnit","rgbChannel2RgbLinear","x255","x1","rgbLinearChannel2Rgb","xLinear1","bottom","top","e","M","delta","hueTurnX6","m1","m255","cm255","xm255","cielab2rgb","LStar100","y","z","fInv","LAB_delta","LAB_3DeltaPow2","LAB_Xn","LAB_Yn","LAB_Zn","cielab2xyz","xyz2rgb","hDegrees","lch2lab","y1","k1","K","LAB_deltaPow3","xyz2cielab","r1Linear","g1Linear","b1Linear","X1","Y1","Z1","maxValue","maxValueIndex","color1","color2","lerpHue","hue1","hue2","charAt","tokenize","atob","tokens","token","type","b64","trim","v100","concat","re","not_string","not_bool","not_type","not_primitive","number","numeric_arg","json","not_json","text","modulo","placeholder","key_access","index_access","sprintf","parse_tree","argv","arg","ph","pad","pad_character","pad_length","is_positive","cursor","tree_length","output","param_no","test","Function","TypeError","String","fromCharCode","width","precision","parseFloat","toExponential","toFixed","Number","toPrecision","substring","call","valueOf","toUpperCase","replace","pad_char","align","sprintf_format","fmt","sprintf_cache","_fmt","arg_names","exec","SyntaxError","field_list","replacement_field","field_match","sprintf_parse","arguments","vsprintf","apply","create","window","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","rejected","done","then","WGL","WebGLRenderingContext","Buffer","[object Object]","target","buffer","spacing","hasBeenCompiled","assert","ARRAY_BUFFER","ELEMENT_ARRAY_BUFFER","Float32Array","Uint16Array","Uint32Array","bindSize","UNSIGNED_SHORT","UNSIGNED_INT","usage","STATIC_DRAW","currentGL","DYNAMIC_DRAW","createBuffer","warn","V3","pack","bufferLength","destPtr","subArray","NLA_DEBUG","includes","bindBuffer","bufferData","tempM4_1","M4","tempM4_2","Mesh","Transformable","super","vertexBuffers","indexBuffers","addVertexBuffer","totalVolumeX2","totalCentroidWithZX2","O","totalAreaX2","triangles","TRIANGLES","vertices","ai","bi","ci","ab","minus","ac","normal","cross","div","faceShadowCentroid","times","plus","volume","centroid","eq0","schur","area","attribute","arrayType","others","allMeshes","every","other","bufferName","mesh","addIndexBuffer","newIndexBufferData","reduce","ptr","startIndex","index","compile","minVertexBufferLength","stl","fileReader","FileReader","onerror","onload","_progressEvent","dataView","DataView","triangleCount","getUint32","normals","bufferPtr","HEADER_BYTE_SIZE","readV3","getFloat32","readAsArrayBuffer","ArrayBuffer","setUint32","normalOnPoints","setFloat32","byteLength","Blob","m4","transformedPoints","invTrans","as3x3","inversed","transposed","transformVector","unit","normal1","likeO","indexBufferName","canonEdges","Set","canonEdge","i0","LINES","tris","lines","vs","si","toLength","AABB","addPoints","sphere","center","getAABB","getCenter","radius","plane","options","detailX","detail","detailY","startX","startY","height","coords","Z","offset","box","xDetail","yDetail","zDetail","vi","ti","transformPoint","forSys","X","negated","translate","cube","VERTEX_CORNERS","VERTEX_NORMALS","pushQuad","UNIT_CUBE_CORNERS","flatMap","fvi","faceVertexIndexes","isocahedron","sphere2","latitudes","longitudes","baseVertices","arrayFromFunction","angle","vqs","q","rotation","anchor","dir1","subdivisions","u","tesselateRecursively","ia","ib","ic","abMid1","bcMid1","caMid1","iabm","ibcm","icam","aabb","matrix","product","size","NLA_PRECISION","transform","computeNormalLines","offsetVertices","close","assertVectors","vl","lineAxis","totalRads","vc","vTotal","rotMat","rads","rotateLine","transformedVectors","coordsUVQ","spiral","gradient","TAU","parametric","pF","pN","sMin","sMax","tMin","tMax","sRes","tRes","load","V","toArray","XYZ","DRAW_MODE_NAMES","POINTS","LINE_STRIP","LINE_LOOP","TRIANGLE_STRIP","TRIANGLE_FAN","DRAW_MODE_CHECKS","isFloatArray","obj","Float64Array","isIntArray","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Int32Array","isInteger","Shader","vertexSource","fragmentSource","projectionMatrixVersion","modelViewMatrixVersion","outputWarnings","matrixNames","compileSource","source","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","shaderInfoLog","getShaderInfoLog","formatCompilerError","long","assign","short","program","createProgram","attachShader","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","attributeLocations","uniformLocations","constantAttributes","activeMatrices","getUniformLocation","uniformInfos","ACTIVE_UNIFORMS","getActiveUniform","uniforms","useProgram","location","SAMPLER_2D","SAMPLER_CUBE","INT","FLOAT_VEC3","FLOAT_VEC4","FLOAT_MAT4","FLOAT_MAT3","uniform4fv","uniform1fv","uniform3fv","uniform2fv","uniformMatrix3fv","uniformMatrix4fv","uniform1f","uniform1i","FLOAT_MAT2","uniformMatrix2fv","attributes","getAttribLocation","disableVertexAttribArray","vertexAttrib1f","vertexAttrib4fv","start","modeName","drawBuffers","indexBuffer","assertf","assertInst","on","modelViewMatrixInverse","modelViewMatrix","projectionMatrixInverse","projectionMatrix","modelViewProjectionMatrix","uni","enableVertexAttribArray","vertexAttribPointer","numAttribs","ACTIVE_ATTRIBUTES","getVertexAttrib","VERTEX_ATTRIB_ARRAY_BUFFER_BINDING","getActiveAttrib","drawElements","BYTES_PER_ELEMENT","drawArrays","drawCallCount","Texture","RGBA","internalFormat","UNSIGNED_BYTE","magFilter","filter","LINEAR","minFilter","version","getExtension","NEAREST","HALF_FLOAT_OES","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","wrap","wrapS","CLAMP_TO_EDGE","TEXTURE_WRAP_T","wrapT","texImage2D","framebuffer","prevFramebuffer","getParameter","FRAMEBUFFER_BINDING","bindFramebuffer","FRAMEBUFFER","readPixels","activeTexture","TEXTURE0","render","prevRenderbuffer","RENDERBUFFER_BINDING","depthRenderbuffer","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","createFramebuffer","framebufferTexture2D","COLOR_ATTACHMENT0","framebufferRenderbuffer","DEPTH_ATTACHMENT","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","prevViewport","VIEWPORT","viewport","temp","fromImage","imgElement","protocol","generateMipmap","fromURLSwitch","url","checkerBoardCanvas","document","createElement","getContext","canvas","fillStyle","fillRect","image","Image","swapWith","fromURL","ev","glValidEnumContexts","enable","1","0","disable","3","4","2","getShaderPrecisionFormat","6","getTexParameter","texParameterf","copyTexImage2D","8","copyTexSubImage2D","getBufferParameter","pixelStorei","5","getFramebufferAttachmentParameter","getRenderbufferParameter","enumBitwiseOr","depthFunc","blendFunc","blendFuncSeparate","blendEquation","blendEquationSeparate","stencilFunc","stencilFuncSeparate","stencilMaskSeparate","stencilOp","stencilOpSeparate","cullFace","frontFace","drawArraysInstancedANGLE","drawElementsInstancedANGLE","blendEquationEXT","bufferSubData","copyBufferSubData","getBufferSubData","blitFramebuffer","10","9","framebufferTextureLayer","invalidateFramebuffer","invalidateSubFramebuffer","readBuffer","getInternalformatParameter","renderbufferStorageMultisample","texStorage2D","texStorage3D","7","texImage3D","11","texSubImage2D","texSubImage3D","12","copyTexSubImage3D","compressedTexImage2D","compressedTexImage3D","compressedTexSubImage2D","compressedTexSubImage3D","vertexAttribIPointer","drawArraysInstanced","drawElementsInstanced","drawRangeElements","clearBufferfv","clearBufferiv","clearBufferuiv","clearBufferfi","beginQuery","endQuery","getQuery","getQueryParameter","samplerParameteri","samplerParameterf","getSamplerParameter","fenceSync","clientWaitSync","waitSync","getSyncParameter","bindTransformFeedback","beginTransformFeedback","transformFeedbackVaryings","bindBufferBase","bindBufferRange","getIndexedParameter","getActiveUniforms","getActiveUniformBlockParameter","glEnums","enumStringToValue","init","WebGL2RenderingContext","propertyName","prop","glEnumToString","glFunctionArgToString","functionName","numArgs","argumentIndex","funcInfo","funcOverloadInfo","argInfo","enums","orEnums","orResult","enumValue","makePropertyWrapper","wrapper","original","__defineGetter__","__defineSetter__","makeDebugContext","ctx","opt_onErrorFunc","opt_onFunc","opt_err_ctx","err","msg","argStr","error","glErrorShadow","makeErrorWrapper","getError","wrapped","NO_ERROR","GL_COLOR_BLACK","TSGLContextBase","str","immediate","coord","pointSize","identity","tempMatrix","resultMatrix","modelViewStack","projectionStack","cachedSDFMeshes","matrixMode","MODELVIEW","currentMatrixName","stack","PROJECTION","copy","multiply","multMatrix","mirror","fovDegrees","aspect","near","far","perspectiveRad","DEG","left","right","frustum","ortho","P3ZX","angleDegrees","rotate","eye","up","lookAt","pop","w","viewportToScreenMatrix","chroma","useTexture","TEXTURE_BINDING_2D","callback","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","setTimeout","performance","now","time","keepUpdating","update","paddingTop","paddingBottom","body","style","position","innerWidth","innerHeight","addResizeListener","windowOnResize","bb","getBoundingClientRect","devicePixelRatio","camera","loadIdentity","perspective","fov","addEventListener","canvasPosXOrE","canvasPosY","MouseEvent","getMouseLine","offsetX","offsetY","ndc1","offsetWidth","offsetHeight","ndc2","inverseProjectionMatrix","dir","pngURL","jsonURL","textRenderShader","textAtlas","textMetrics","all","LUMINANCE","fetch","fontMetrics","fontTextureAtlas","lineHeight","cursorX","cursorY","drawGlyph","chr","metric","chars","horiBearingX","horiBearingY","horiAdvance","posX","posY","quadStartIndex","coordsLeft","coordsRight","coordsBottom","coordsTop","lineCount","string","xAlign","baseline","strMesh","getSDFMeshForString","pushMatrix","yTranslate","ascender","middle","descender","alphabetic","bind","u_color","u_debug","u_gamma","u_buffer","draw","popMatrix","newGL","throwOnError","funcName","addOwnProperties","maxPixelRatio","clientWidth","clientHeight","vector","headLength","vT","getPerpendicular","shaders","singleColor","meshes","vectorShaft","vectorHead","TSGLContext","flipped","padLeft","delim","totalDigits","line","digits","substr","glConstants","shaderName","addLineNumbers","errLog","typeName","longForm","shortForm","errorStrings","errors","errorString","lineNo","opt","gl10","last","len","total","NORMAL","content","isnum","isoperator","input","allBuiltins","builtins100","allLiterals","literals100","builtins300es","literals300es","builtinsDict","literalsDict","chunk","BLOCK_COMMENT","block_comment","LINE_COMMENT","line_comment","PREPROCESSOR","preprocessor","OPERATOR","operator","INTEGER","integer","HEX","decimal","TOKEN","readtoken","WHITESPACE","whitespace","write","EOF","column","determine_operator","is_composite_operator","buf","idx","operators","contentstr","KEYWORD","BUILTIN","IDENT","ch"],"sourceRoot":""}