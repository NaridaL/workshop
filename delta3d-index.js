"use strict";(self.webpackChunkworkshop=self.webpackChunkworkshop||[]).push([[634],{7205:(t,o,e)=>{e.r(o),e.d(o,{default:()=>m});var n=e(7392),a=e(9526),r=e(2182),s=e(2004);n.$_("blue").gl();class i{__init3(){this.children=[]}constructor(t=r.M4.IDENTITY,o,e,...n){this.transform=t,this.mesh=o,this.color=e,i.prototype.__init3.call(this),n.forEach((t=>this.add(t)))}add(...t){for(const o of t)this.children.push(o),o.parent=this}getTransform(t){let o=t.transform;for(;t.parent!==this;)o=(t=t.parent).transform.times(o);return o}withGimbal(){return this.gimbal=!0,this}}const l=new i;function c(t,o){return t.map((t=>{const e=o.xy().distanceTo(t);return o.z+Math.sqrt(144-e*e)+1}))}const m=()=>{const t=(0,a.useRef)(null);return(0,a.useEffect)((()=>{const o=s.ZG.create({canvas:t.current});o.fixCanvasRes(),o.addResizeListener(),function(t){const o={pos:(0,r.V)(.75,0,1),lookDir:(0,r.V)(0,0,-1),axisPoss:[0,0,0]},e=()=>{localStorage.setItem("viewState",JSON.stringify({pos:o.pos.toArray(),lookDir:o.lookDir.toArray(),axisPoss:o.axisPoss}))};(()=>{if(null!==localStorage.getItem("viewState")){const t=JSON.parse(localStorage.getItem("viewState"));o.pos=r.V3.fromArray(t.pos),o.lookDir=r.V3.fromArray(t.lookDir),o.axisPoss=t.axisPoss||o.axisPoss}})();const a=s.Kj.cube();console.log("cubeMesh",a);const m=s.Kj.rotation([r.V3.O,(0,r.V)(1,0,1)],{anchor:r.V3.O,dir1:r.V3.Z},r.gc,16),f=(s.Kj.plane(),s.Kj.sphere(1).computeWireframeFromFlatTrianglesClosedMesh().compile()),d=s.Kj.spiral([(0,r.V)(-.1,1),(0,r.V)(0,1.1),(0,r.V)(.1,1,0)],{anchor:r.V3.O,dir1:r.V3.X},320*r.gc,5120,.2).computeNormalsFromFlatTriangles().compile();console.log("spiralMesh",d);const v=s.Kj.rotation([r.V3.Y,r.V3.XY],{anchor:r.V3.O,dir1:r.V3.X},2*Math.PI,16,!0),p=s.Kj.rotation([r.V3.O,r.V3.X,(0,r.V)(1,0,1),r.V3.Z],{anchor:r.V3.O,dir1:r.V3.Z},2*r.PI,3),u=new s.lW(t.ARRAY_BUFFER,Float32Array);let g=0;const h=n.bA("yellow","black").colors(6,"gl");console.log(f);const V=[],M=[],x=[],y=[],w=[];let P;l.add(new i(r.M4.translate((0,r.V)(-.5,-.5,-1)).scale(30,30,1),a,n.iv("lightgreen").gl()).withGimbal(),P=new i(r.M4.translate(0,0,5),void 0,void 0,new i(r.M4.scale(3,3,1).rotateZ(Math.PI/3),p,n.iv("orange").gl()),new i(r.M4.translate(0,0,-1),m,n.iv("silver").gl()),...[0,1,2].flatMap((t=>[0,1].map((o=>y[2*t+o]=new i(r.M4.scale(.2).translate(1.5,o?1.5:-1.5,.5).rotateZ(r.gc*(1/3*t)),f,h[2*t+o])))))),...[0,1,2,3,4,5].map((t=>w[t]=new i(void 0,v,h[t]))),...[0,1,2].map((t=>new i(r.M4.translate(10,0,0).rotateZ(2*r.PI/3*t),void 0,void 0,M[t]=new i(r.M4.rotateY(-r.PI/2),d,n.iv("green").gl()),new i(r.M4.scale(.4).translate(-2.5,0,0),a,n.iv("cyan").gl()),V[t]=new i(r.M4.translate(0,0,o.axisPoss[t]),void 0,void 0,new i(r.M4.translate(-.5,-.5).scale(2,3,1),a,n.iv("blue").gl()),...[0,1].map((o=>x[2*t+o]=new i(r.M4.scale(.2).translate(-1,o?1.5:-1.5,.5),f,h[2*t+o]))))))));const _=[0,1,2].map((t=>l.getTransform(V[t]).transformPoint((0,r.V)(-2.5,0,0)).xy()));function I(){[0,1,2].forEach((t=>{V[t].transform=r.M4.translate(0,0,o.axisPoss[t]),M[t].transform=r.M4.scale(1,.5,.5).rotateX(r.gc*-o.axisPoss[t]/.2).rotateY(-r.PI/2)}));const[t,e,n]=[0,1,2].map((t=>l.getTransform(V[t]).transformPoint((0,r.V)(-2.5,0,0)))),a=function(t,o,e,n,a,s){const i=t.to(e).unit(),l=t.to(a).rejectedFrom1(i).unit(),c=r.M4.forSys(i,l,void 0,t),m=t.to(e).length(),f=t.to(a).dot(i),d=t.to(a).dot(l),v=(0+m*m)/(2*m),p=(0-2*f*v+f*f+d*d)/(2*d),u=(0,r.V)(v,p,Math.sqrt(144-v*v-p*p));return c.transformPoint(u)}(e,0,t,0,n);P.transform=r.M4.translate(a);for(let t=0;t<6;t++){const o=l.getTransform(x[t]).O,e=l.getTransform(y[t]).O;w[t].transform=r.M4.scale(12,.1,.1).rotateAB(r.V3.X,o.to(e)).translate(o)}}o.axisPoss=c(_,r.V3.O),I();const k=s.ex.create("\n\tuniform mat4 ts_ModelViewMatrix;\n\tuniform mat3 ts_NormalMatrix;\n\tuniform mat4 ts_ModelViewProjectionMatrix;\n\tuniform float pointSize;\n\n\tattribute vec4 ts_Vertex;\n\tattribute vec3 ts_Normal;\n\n\tvarying vec3 coordUVQ;\n\tvarying vec2 coord;\n\tvarying vec3 normal;\n\tvarying vec3 position;\n\n\tvoid main() {\n\n\t  gl_Position = ts_ModelViewProjectionMatrix * ts_Vertex;\n\t  gl_PointSize = pointSize;\n\n\t  normal =ts_Normal;\n\t  vec4 position4 = ts_ModelViewMatrix * ts_Vertex;\n\t  position = position4.xyz;\n\t}\n  ","\n\tprecision highp float;\n\n\tuniform sampler2D texture;\n\tuniform vec3 lightPos;\n\tuniform vec4 color;\n\n\tvarying vec3 coordUVQ;\n\tvarying vec2 coord;\n\tvarying vec3 normal;\n\tvarying vec3 position;\n\n\tvoid main() {\n\t\tvec3 normal1 = normalize(normal);\n\t\tvec3 lightPos = vec3(1000, 2000, 4000);\n\t\tvec3 lightDir = normalize(position.xyz - lightPos);\n        float uMaterialShininess = 256.0;\n\t\tfloat lightIntensity = 0.2 + 0.8 * max(0.0, -dot(lightDir, normal1));\n\t\tgl_FragColor = vec4(normal,1.0);\n\t\tgl_FragColor = vec4(vec3(color) * lightIntensity, 1);\n\t}\n\t  ");t.clearColor(1,1,1,0),t.cullFace(t.BACK);const E=()=>{t.matrixMode(t.PROJECTION),t.loadIdentity(),t.perspective(70,t.canvas.width/t.canvas.height,.1,1e3),t.lookAt((0,r.V)(.75,0,1),(0,r.V)(.75,0,0),r.V3.Y),t.matrixMode(t.MODELVIEW)};E(),t.pointSize(10),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);const O={};console.log(t.canvas),t.canvas.contentEditable="true",t.canvas.focus(),t.canvas.onkeydown=function(o){O[o.key]=!0,"2"===o.key&&E(),"1"===o.key&&(t.matrixMode(t.PROJECTION),t.loadIdentity(),t.perspective(70,t.canvas.width/t.canvas.height,.1,1e3),t.lookAt((0,r.V)(0,.5,2.2),r.V3.O,r.V3.Y),t.matrixMode(t.MODELVIEW))},t.canvas.onkeypress=function(t){new r.V3(0,0,0)},t.canvas.onkeyup=function(t){O[t.key]=!1};let b=r.V3.O,T=r.M4.IDENTITY;function C(o){t.pushMatrix(),t.multMatrix(o.transform),o.gimbal&&t.drawGimbal(.1),o.mesh&&k.uniforms({color:o.color,pointSize:12,lightPos:(0,r.V)(100,0,100).toLength(-1)}).draw(o.mesh),o.children.forEach(C),t.popMatrix()}function D(t,o){return+!!O[t]-+!!O[o]}t.canvas.onmousemove2=function(t){const o=(0,r.V)(t.pageX,t.pageY),e=b.to(o);1&t.buttons&&(T=T.rotateZ(.25*e.x*r.Co),T=T.rotateX(.25*e.y*r.Co)),b=o},t.canvas.onmousemove=function(t){const e=(0,r.V)(t.pageX,t.pageY),n=b.to(e);if(1&t.buttons){const t=r.M4.rotateY(.25*-n.x*r.Co).rotateX(.25*-n.y*r.Co);o.lookDir=t.transformVector(o.lookDir).unit()}b=e};const S=[["u","j"],["i","k"],["o","l"]];u.data[g++]=r.V3.O,u.data[g++]=r.V3.O,t.animate((function(a,s){const i=r.M4.rotateX(70*r.Co).translate(0,0,3).transformPoint(r.V3.polar(2,a/500,1+a/1e5));o.axisPoss=c(_,i),u.data[g++]=i,u.compile(),I();for(let t=0;t<3;t++){const n=.1*D(...S[t]);0!==n&&(o.axisPoss[t]+=n,I(),e())}const m=new r.V3(+!!O.w-+!!O.s,+!!O.a-+!!O.d,+!!O.e-+!!O.q+ +!!O[" "]).times(.05);if(!m.likeO()){const t=o.lookDir;o.pos=o.pos.plus(r.M4.forSys(t,r.V3.Y.cross(t).unit()).transformVector(m)),e()}t.matrixMode(t.PROJECTION),t.loadIdentity(),t.perspective(70,t.canvas.width/t.canvas.height,.1,1e3),t.lookAt(o.pos,o.pos.plus(o.lookDir),r.V3.Y),t.matrixMode(t.MODELVIEW),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.loadIdentity(),t.rotate(-90,1,0,0),t.drawGimbal(.1),C(l),k.uniforms({color:n.iv("red").gl()}).drawBuffers({ts_Vertex:u},void 0,t.LINE_STRIP)}))}(o)}),[]),a.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100%"}},a.createElement("canvas",{ref:t,style:{flexGrow:1},tabIndex:0}))}}}]);