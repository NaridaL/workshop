/*! For license information please see 4.js.LICENSE.txt */
(self.webpackChunkworkshop=self.webpackChunkworkshop||[]).push([[4],{7431:(e,t,r)=>{var i=r(6435);e.exports=function(e,t,r){t="number"==typeof t?t:1,r=r||": ";var n=e.split(/\r?\n/),s=String(n.length+t-1).length;return n.map((function(e,n){var o=n+t,a=String(o).length;return i(o,s-a)+r+e})).join("\n")}},9811:e=>{e.exports=function(e){return atob(e)}},7392:(e,t,r)=>{"use strict";r.d(t,{$_:()=>x,bA:()=>B,iv:()=>L});const{abs:i,atan2:n,cos:s,floor:o,log:a,min:l,max:c,round:u,sign:h,sin:f,sqrt:d,cbrt:E,PI:m,hypot:_}=Math;function g(e,t,r){return e+(t-e)*r}function p(e,t=0,r=1){return e<t?t:e>r?r:e}function T(e,t,r,n=1e-8){let s,o=t;for(;r--&&i(s=e(o))>n;){const t=(e(o+n)-s)/n;console.log("fx / dfdx",s/t,"fx",s,"x",o),o-=s/t}return o}const A=m/180,R=180/m;function x(...e){return e[0]instanceof I?e[0]:e.length>1&&"string"==typeof e[e.length-1]?D(e.slice(0,e.length-1),e[e.length-1]):Array.isArray(e[0])?D(e[0]):D(e)}class I{constructor(e,t,r,i=1){this.r=e,this.g=t,this.b=r,this.a=i}mix(e,t,r="rgb"){return w(this,e,t,r)}rgb(e=!0,t=!0){const r=r=>(e&&(r=u(r)),t&&(r=p(r,0,255)),r),{r:i,g:n,b:s}=this;return[r(i),r(n),r(s)]}rgba(e=!0,t=!0){const r=r=>(e&&(r=u(r)),t&&(r=p(r,0,255)),r),{r:i,g:n,b:s,a:o}=this;return[r(i),r(n),r(s),o]}hex(e="rgb"){const{r:t,g:r,b:i,a:n}=this;return function(e,t,r,i,n="rgb"){const s=((e=p(u(e),0,255))<<16|(t=p(u(t),0,255))<<8|(r=p(u(r),0,255))).toString(16).padStart(6,"0"),o=u(255*p(i)).toString(16).padStart(2,"0");return"#"+("argb"==n?o+s:"rgba"==n?s+o:s)}(t,r,i,n,e)}hsl(){const{r:e,g:t,b:r}=this;return function(e,t,r){const[i,n,s]=ie(e/255,t/255,r/255),o=(s+n)/2;let a;return a=s==n?0:o<.5?(s-n)/(s+n):(s-n)/(2-s-n),[i,a,o]}(e,t,r)}hsv(){const{r:e,g:t,b:r}=this;return function(e,t,r){const[i,n,s]=ie(e,t,r);return[i,0==s?0:(s-n)/s,s/255]}(e,t,r)}hcg(){const{r:e,g:t,b:r}=this;return function(e,t,r){const[i,n,s]=ie(e,t,r),o=(s-n)/255;return[i,o,o<1?n/255/(1-o):0]}(e,t,r)}css(e="rgb"){if("rgb"==e){const{r:e,g:t,b:r,a:i}=this;return function(e,t,r,i=1){return i>=1?"rgb("+[e,t,r].map(u).join(",")+")":"rgba("+[e,t,r].map(u).join(",")+","+i+")"}(e,t,r,i)}if("hsl"==e)return function([e,t,r],i){const n=i<1?"hsla":"hsl";return n+"("+Q(e)+","+Q(100*t)+"%,"+Q(100*r)+"%"+("hsla"==n?","+Q(i):"")+")"}(this.hsl(),this.alpha());throw new Error}name(e=!1){const t=this.num(),r=Object.keys(b).find((e=>b[e]==t));if(!r&&e){const[e,t,r]=this.lab();return n=i=>{const[n,s,o]=F(b[i]).lab();return-_(e-n,t-s,r-o)},(i=Object.keys(b))[ge(i,n)]}var i,n;return r}cmyk(){const{r:e,g:t,b:r}=this;return function(e,t,r){const i=1-c(e/=255,t/=255,r/=255);return 1==i?[0,0,0,1]:[(1-e-i)/(1-i),(1-t-i)/(1-i),(1-r-i)/(1-i),i]}(e,t,r)}gl(){const{r:e,g:t,b:r,a:i}=this;return[e/255,t/255,r/255,i]}luminance(e){const{r:t,g:r,b:i,a:n}=this,[,s]=me(t,r,i);if(void 0===e)return s;const o=(e,t,r)=>(r-e)/(t-e);return e>s?w(this,S,o(s,1,e),"xyz").alpha(n):w(M,this,o(0,s,e),"xyz").alpha(n)}temperature(){const{r:e,g:t,b:r}=this;return i=e,n=t,s=r,console.log(s-i),n+s<158.61?(console.log("0 < t < 20"),u(100*T((e=>n-(-155.25485562709179-.44596950469579133*(e-2)+104.49216199393888*a(e-2))),15,4))):s-i<0?(console.log("20 < t < 66"),u(100*T((e=>s-(.8274096064007395*(e-10)-254.76935184120902+115.67994401066147*a(e-10))),43,4))):(console.log("0 < t < 400, start= "+(-1.4*(i+n)+755)),u(100*T((e=>i-(351.97690566805693+.114206453784165*(e-55)-40.25366309332127*a(e-55))),-1.4*(i+n)+755,8)));var i,n,s}set(e,t){const[r,i]=e.split("."),n=this[r](),s=r.indexOf(i);if(-1==s)throw new Error("invalid channel");return n[s]="number"==typeof t?t:t(n[s]),x(n,r).alpha(this.a)}clipped(){const{r:e,g:t,b:r}=this;return!(0<=e&&e<=255&&0<=t&&t<=255&&0<=r&&r<=255)}textColor(){return this.luminance()>.5?M:S}alpha(e){if(void 0===e)return this.a;const{r:t,g:r,b:i}=this;return y(t,r,i,e)}darker(e=1){const[t,r,i]=this.lab();return function(...e){return D(e,"lab")}(t-ae*e,r,i,this.alpha())}brighter(e=1){return this.darker(-e)}saturate(e=1){const[t,r,i]=this.lch();return function(...e){return D(e,"lch")}(t,c(0,r+e*ae),i,this.alpha())}desaturate(e=1){return this.saturate(-e)}premultiplied(){const{r:e,g:t,b:r,a:i}=this;return y(e*i,t*i,r*i,i)}hsi(){const{r:e,g:t,b:r}=this;return function(e,t,r){const i=e/255,s=t/255,o=r/255,a=(i+s+o)/3;if(i==s&&s==o)return[0,0,a];{const e=.5*(2*i-s-o),t=d(3)/2*(s-o),r=n(t,e),c=l(i,s,o);return[(r<0?2*m+r:r)*R,1-c/a,a]}}(e,t,r)}lab(){const{r:e,g:t,b:r}=this;return Ee(e,t,r)}num(e="rgb"){const{r:t,g:r,b:i,a:n}=this;return function(e,t,r,i=1,n="rgb"){const s=u(e)<<16|u(t)<<8|u(r);return"rgb"===n?s:"rgba"===n?s<<8|u(255*i)<<24:u(255*i)<<24|s}(t,r,i,n,e)}lch(){const{r:e,g:t,b:r}=this;return function(e,t,r){const[i,s,o]=Ee(e,t,r);return function(e,t,r){return[e,_(t,r),(n(r,t)*R+360)%360]}(i,s,o)}(e,t,r)}xyz(){const{r:e,g:t,b:r}=this;return me(e,t,r)}equals(e){const{r:t,g:r,b:i,a:n}=this,{r:s,g:o,b:a,a:l}=e;return t==s&&r==o&&i==a&&n==l}hashCode(){return this.num("rgba")}toSource(){const{r:e,g:t,b:r,a:i}=this;return"chroma.rgb("+e+", "+t+", "+r+(1===i?")":", "+i+")")}}I.prototype.toString=I.prototype.css,I.prototype.kelvin=I.prototype.temperature;const M=new I(0,0,0,1),S=new I(255,255,255,1),N={OrRd:[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072],PuBu:[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496],BuPu:[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347],Oranges:[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060],BuGn:[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435],YlOrBr:[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150],YlGn:[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705],Reds:[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221],RdPu:[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234],Greens:[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435],YlGnBu:[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800],Purples:[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893],GnBu:[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801],Greys:[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0],YlOrRd:[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646],PuRd:[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239],Blues:[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683],PuBuGn:[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510],Viridis:[4456788,4728695,4147850,3237774,2524047,2071946,7130714,11984427,16705573],Spectral:[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770],RdYlGn:[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679],RdBu:[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065],PiYG:[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529],PRGn:[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435],RdYlBu:[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237],BrBG:[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408],RdGy:[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618],PuOr:[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195],Set2:[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947],Accent:[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886],Set1:[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329],Set3:[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463],Dark2:[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886],Paired:[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696],Pastel2:[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772],Pastel1:[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]},b={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function w(e,t,r=.5,i="rgb"){const n=x(e),s=x(t),o=O[i]&&O[i](n,s,r,i);if(!o)throw new Error("color mode "+i+" is not supported");return o.alpha(g(n.alpha(),s.alpha(),r))}function L(e){const[t,r,i,n]=$(e);return new I(t,r,i,n)}function v(...e){return D(e,"hsl")}function F(e){const[t,r,i]=X(e);return new I(t,r,i)}function y(...e){return D(e,"rgb")}function B(...e){const t=e=>t._at(e);return Object.getOwnPropertyNames(C.prototype).forEach((e=>t[e]=C.prototype[e])),Array.isArray(e[0])&&(e=e[0]),1==e.length&&"string"==typeof e[0]&&(e=N[e[0]]),t._init("function"==typeof e[0]?e[0]:e.map((e=>x(e)))),t}te(re(((e,t)=>e))),te(re(((e,t)=>e*t/255))),te(re((function(e,t){return 255*(1-(1-e/255)*(1-t/255))}))),te(re((function(e,t){return t<128?2*e*t/255:255*(1-2*(1-e/255)*(1-t/255))}))),te(re(l)),te(re(c)),te(re((function(e,t){return 255==e?255:255*l(1,t/255/(1-e/255))}))),te(re((function(e,t){return 255*(1-(1-t/255)/(e/255))})));class C{classes(e){if(void 0===e)return this._classes;if(Array.isArray(e))this._classes=e,this.domain(e[0],e[e.length-1]);else{if(e%1!=0||e<1)throw new Error("invalid classes param");this._classes=V(this.domain(),"e",e)}return this}domain(...e){if(void 0===e[0])return"function"!=typeof this._colors?this._pos.map((e=>g(this._min,this._max,e))):[this._min,this._max];if(this._min=e[0],this._max=e[e.length-1],2==e.length)"function"!=typeof this._colors&&(this._pos=this._colors.map(((e,t)=>t/(this._colors.length-1))));else{if("function"==typeof this._colors||e.length!=this._colors.length)throw new Error("invalid domain "+e);this._pos=e.map((e=>{return(e-(t=this._min))/(this._max-t);var t}))}return this}mode(e){return void 0===e?this._mode:(this._mode=e,this._resetCache(),this)}out(e){return this._out=e,this}correctLightness(e=!0){if(this._correctLightness!=e){this._resetCache();const t=this._colors;if(e&&"function"!=typeof t){let e=0;for(let r=1;r<t.length;r++){const i=t[r].lab()[0]-t[r-1].lab()[0];if(0==e)e=i;else if(e*i<0)throw new Error("scale color lightnesses must be monotonic")}}}return this._correctLightness=e,this}padding(e,t=e){return e?(this._paddingLeft=e,this._paddingRight=t,this):[this._paddingLeft,this._paddingRight]}colors(e,t="hex"){let r;if(void 0===e)r=this._colors.slice();else if(1==e)r=[this._color((this._min+this._max)/2)];else if(e>1)r=Array.from({length:e},((t,r)=>this._color(g(this._min,this._max,r/(e-1)))));else{let e;e=this._classes&&this._classes.length>2?Array.from({length:this._classes.length-1},((e,t)=>.5*(this._classes[t]+this._classes[t+1]))):this.domain(),r=e.map((e=>this._color(e)))}return"color"!=t?r.map((e=>e[t]())):r}cache(e){return void 0===e?!!this._cache:(this._cache=e?this._cache||new Map:void 0,this)}gamma(e){return void 0===e?this._gamma:(this._gamma=e,this)}_at(e){const t=this._color(e);return this._out?t[this._out]():t}_init(e){this._colors=e,"function"!=typeof e&&(this._pos=e.map(((t,r)=>r/(e.length-1)))),this._mode="rgb",this.domain(0,1),this._paddingLeft=0,this._paddingRight=0,this._correctLightness=!1,this._cache=new Map,this._gamma=1}_getClass(e){return this._classes.findIndex((t=>e<=t))-1}_color(e,t=!1){let r;if(t)r=e;else{const t=this._min,i=this._max;r=this._classes&&this._classes.length>2?this._getClass(e)/(this._classes.length-2):i!==t?(e-t)/(i-t):1,this._correctLightness&&(r=this._tCorrectedLightness(r))}r=r**this._gamma,r=(this._paddingLeft+r)/(1+this._paddingLeft+this._paddingRight),r=p(r,0,1);const i=r,n=this._cache&&this._cache.get(i);if(n)return n;{let e;if(Array.isArray(this._colors))for(let t=0;t<this._pos.length;t++){const i=this._pos[t];if(r<=i){e=this._colors[t];break}if(r>=i&&t==this._pos.length-1){e=this._colors[t];break}if(r>i&&r<this._pos[t+1]){r=(r-i)/(this._pos[t+1]-i),e=w(this._colors[t],this._colors[t+1],r,this._mode);break}}else e=this._colors(r);return this._cache&&this._cache.set(i,e),e}}_tCorrectedLightness(e){const t=g(this._color(0,!0).lab()[0],this._color(1,!0).lab()[0],e);return function(e,t,r,i){let n=e(t);for(;i--;){const i=(t+r)/2,s=e(i);h(n)==h(s)?(t=i,n=s):r=i}return(t+r)/2}((e=>this._color(e,!0).lab()[0]-t),0,1,8)}_resetCache(){this._cache&&this._cache.clear()}}var P;function V(e,t="e",r=7){const n=Array.isArray(e)?function(e){const t={min:1/0,max:-1/0,sum:0,values:[],count:0};return e.forEach((e=>function(e){null==e||isNaN(e)||(t.values.push(e),t.sum+=e,e<t.min&&(t.min=e),e>t.max&&(t.max=e),t.count+=1)}(e))),t.domain=[t.min,t.max],t.limits=function(e,t){return V(this,e,t)},t}(e):e,{min:s,max:l,values:c}=n;if(c.sort(((e,t)=>e-t)),1==r)return[s,l];if(t.startsWith("c"))return[s,l];if(t.startsWith("e"))return Array.from({length:r+1},((e,t)=>g(s,l,t/r)));if(t.startsWith("l")){if(s<=0)throw new Error("Logarithmic scales are only possible for values > 0");const e=Math.LOG10E*a(s),t=Math.LOG10E*a(l);return Array.from({length:r+1},((i,n)=>10**g(e,t,n/r)))}if(t.startsWith("q"))return Array.from({length:r+1},((e,t)=>{const i=(c.length-1)*t/r,n=o(i);return n==i?c[n]:g(c[n],c[n+1],i-n)}));if(t.startsWith("k")){const e=c.length,t=new Array(e),n=new Array(r);let o=!0,a=0,u=Array.from({length:r+1},((e,t)=>g(s,l,t/r)));do{n.fill(0);for(let e=0;e<c.length;e++){const r=c[e],s=ge(u,(e=>-i(e-r)));n[s]++,t[e]=s}const e=new Array(r).fill(0);for(let r=0;r<t.length;r++)e[t[r]]+=c[r];for(let t=0;t<e.length;t++)e[t]/=n[t];o=e.some(((e,t)=>e!=u[t])),u=e}while(a++<200&&o);const h=Array.from({length:r},(()=>[]));for(let e=0;e<t.length;e++)h[t[e]].push(c[e]);const f=[];for(const e of h)f.push(e[0],e[e.length-1]);f.sort(((e,t)=>e-t));const d=[];d.push(f[0]);for(let e=1;e<f.length;e+=2){const t=f[e];isNaN(t)||-1!=d.indexOf(t)||d.push(t)}return d}throw new Error("unknown mode")}!function(e){e.cool=function(){return B([v(180,1,.9),v(250,.7,.4)])},e.hot=function(){return B(["#000","#f00","#ff0","#fff"]).mode("rgb")}}(P||(P={}));const O={},U={};function D(e,t){if(Array.isArray(e[0])&&(e=e[0]),!t)if(1==e.length&&e[0]in b)t="name";else if(1==e.length&&"string"==typeof e[0])t="css";else if(3==e.length)t="rgb";else if(4==e.length&&"number"==typeof e[3]&&e[3]>=0&&e[3]<=1)t="rgb";else{if(!(1==e.length&&"number"==typeof e[0]&&e[0]>=0&&e[0]<=16777215))throw new Error("could not guess mode. args "+JSON.stringify(e));t="num"}const r=U[t](...e);return new I(r[0],r[1],r[2],void 0!==r[3]?r[3]:1)}function G(e){let t;if(t=e.match(/^#?([A-F\d]{2})([A-F\d]{2})([A-F\d]{2})([A-F\d]{2})?$/i))return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),t[4]?parseInt(t[4],16)/255:1];if(t=e.match(/^#?([A-F\d])([A-F\d])([A-F\d])([A-F\d])?$/i))return[17*parseInt(t[1],16),17*parseInt(t[2],16),17*parseInt(t[3],16),t[4]?17*parseInt(t[4],16)/255:1];throw new Error("invalid hex color: "+e)}function k(e){return(e%360+360)%360}function X(e){if(!("number"==typeof e&&e>=0&&e<=16777215))throw new Error("unknown num color: "+e);return[e>>16,e>>8&255,255&e,1]}O.xyz=O.rgb=O.lab=function(e,t,r,i){const n=e[i](),s=t[i]();return D([g(n[0],s[0],r),g(n[1],s[1],r),g(n[2],s[2],r),g(e.alpha(),t.alpha(),r)],i)},O.num=function(e,t,r){return F(g(e.num(),t.num(),r))},O.lrgb=function(e,t,r){const[i,n,s,o]=e.rgba(!1,!1),[a,l,c,u]=t.rgba(!1,!1);return new I(d(i**2*(1-r)+a**2*r),d(n**2*(1-r)+l**2*r),d(s**2*(1-r)+c**2*r),g(o,u,r))},U.lrgb=U.rgb,U.hex=G,U.hsl=se,U.hsv=function(e,t,r,n=1){const s=r*t;return ne(e=k(e),s,s*(1-i(e/60%2-1)),r-s,n)},U.num=X;const j="\\s*",H="([+-]?(?:\\d*\\.?)?\\d+(?:[eE][+-]?\\d+)?)",W=new RegExp(["^rgba?\\(",H,",",H,",",H,"(?:,",H+"(%)?",")?\\)$"].join(j),"i"),Y=new RegExp(["^rgba?\\(",H,H,H,"(?:/",H+"(%)?",")?\\)$"].join(j),"i"),z=new RegExp(["^rgba?\\(",H+"%",",",H+"%",",",H+"%","(?:,",H+"(%)?",")?\\)$"].join(j),"i"),q=new RegExp(["^rgba?\\(",H+"%",H+"%",H+"%","(?:/",H+"(%)?",")?\\)$"].join(j),"i"),Z=new RegExp(["^hsla?\\(",H+"(deg|rad|turn)?",",",H+"%",",",H+"%","(?:,",H+"(%)?",")?\\)$"].join(j),"i"),K=new RegExp(["^hsla?\\(",H+"(deg|rad|turn)?\\s+"+H+"%",H+"%","(?:/",H+"(%)?",")?\\)$"].join(j),"i");function $(e){if(b&&b.hasOwnProperty(e))return X(b[e.toLowerCase()]);let t;if(t=e.match(W)||e.match(Y))return[p(+t[1],0,255),p(+t[2],0,255),p(+t[3],0,255),t[4]?p(t[5]?+t[4]/100:+t[4]):1];if(t=e.match(z)||e.match(q))return[255*p(+t[1]/100),255*p(+t[2]/100),255*p(+t[3]/100),t[4]?p(t[5]?+t[4]/100:+t[4]):1];if(t=e.match(Z)||e.match(K)){const e={deg:1,rad:R,turn:360},r=t[2]?t[2].toLowerCase():"deg";return se((+t[1]*e[r]%360+360)%360,p(+t[3]/100),p(+t[4]/100),t[5]?p(t[6]?+t[5]/100:+t[5]):1)}return G(e)}function Q(e){return u(100*e)/100}function J(e){const t=e/255;return t<=.04045?t/12.92:((t+.055)/1.055)**2.4}function ee(e){return e<=.0031308?12.92*e*255:255*(1.055*e**(1/2.4)-.055)}function te(e){return function(t,r){const[i,n,s]=e(x(r).rgb(),x(t).rgb());return y(i,n,s)}}function re(e){return function(t,r){return t.map(((t,i)=>e(t,r[i])))}}function ie(e,t,r){const i=l(e,t,r),n=c(e,t,r),s=n-i;let o;return o=0==s?0:e==n?(t-r)/s+(t<r?6:0):t==n?2+(r-e)/s:4+(e-t)/s,[60*o,i,n]}function ne(e,t,r,i,n){const s=255*i,o=255*t+s,a=255*r+s;return e<60?[o,a,s,n]:e<120?[a,o,s,n]:e<180?[s,o,a,n]:e<240?[s,a,o,n]:e<300?[a,s,o,n]:[o,s,a,n]}function se(e,t,r,n=1){e=k(e);const s=(1-i(2*r-1))*t;return ne(e,s,s*(1-i(e/60%2-1)),r-s/2,n)}function oe(e,t,r,i=1){const[n,s,o]=function(e,t,r){function i(e){return e>he?e**3:fe*(e-4/29)}return[le*i((e+16)/116+t/500),ce*i((e+16)/116),ue*i((e+16)/116-r/200)]}(e,t,r);return _e(n,s,o,i)}U.css=$,U.name=function(e){return X(b[e])},U.lch=function(e,t,r,i=1){const[,n,o]=function(e,t,r){return[e,s(r*A)*t,f(r*A)*t]}(e,t,r);return oe(e,n,o,i)},U.cmyk=function(e,t,r,i,n=1){return 1==i?[0,0,0,n]:[255*(1-e)*(1-i),255*(1-t)*(1-i),255*(1-r)*(1-i),n]},U.gl=function(e,t,r,i=1){return[255*e,255*t,255*r,i]},U.rgb=(...e)=>e,U.temperature=U.kelvin=U.K=function(e){const t=e/100;let r,i,n;return t<66?(r=255,i=-155.25485562709179-.44596950469579133*(t-2)+104.49216199393888*a(t-2),n=t<20?0:.8274096064007395*(t-10)-254.76935184120902+115.67994401066147*a(t-10)):(r=351.97690566805693+.114206453784165*(t-55)-40.25366309332127*a(t-55),i=325.4494125711974+.07943456536662342*(t-50)-28.0852963507957*a(t-50),n=255),[r,i,n]},U.hcg=function(e,t,r,n=1){const s=r*(1-t);return ne(e=k(e),t,t*(1-i(e/60%2-1)),s,n)};const ae=18,le=.95047,ce=1,ue=1.08883,he=.206896552,fe=.12841855,de=.008856452;function Ee(e,t,r){const[i,n,s]=me(e,t,r);return function(e,t,r){function i(e){return e>de?E(e):e/fe+4/29}return[116*i(t/ce)-16,500*(i(e/le)-i(t/ce)),200*(i(t/ce)-i(r/ue))]}(i,n,s)}function me(e,t,r){const i=J(e),n=J(t),s=J(r);return[.4124564*i+.3575761*n+.1804375*s,.2126729*i+.7151522*n+.072175*s,.0193339*i+.119192*n+.9503041*s]}function _e(e,t,r,i=1){const n=-.969266*e+1.8760108*t+.041556*r,s=.0556434*e-.2040259*t+1.0572252*r;return[ee(3.2404542*e-1.5371385*t-.4985314*r),ee(n),ee(s),i]}function ge(e,t){let r=-1/0,i=-1;for(let n=0;n<e.length;n++){const s=t(e[n]);s>r&&(r=s,i=n)}return i}U.xyz=_e,U.lab=oe,U.hsi=function(e,t,r,i=1){let n,o,a,l=e*A;return l<2*m/3?(a=(1-t)/3,n=(1+t*s(l)/s(m/3-l))/3,o=1-(a+n)):l<4*m/3?(l-=2*m/3,n=(1-t)/3,o=(1+t*s(l)/s(m/3-l))/3,a=1-(n+o)):(l-=4*m/3,o=(1-t)/3,a=(1+t*s(l)/s(m/3-l))/3,n=1-(o+a)),[3*r*n*255,3*r*o*255,3*r*a*255,i]},O.hsv=O.hsl=O.hsi=O.lch=O.hcg=function(e,t,r,i){const[n,s,o]=e[i](),[a,l,c]=t[i]();function u(e,t,r){return e+r*(k(t-e+180)-180)}return x(("h"==i.charAt(0)?u:g)(n,a,r),g(s,l,r),("h"==i.charAt(2)?u:g)(o,c,r),i)}},3086:e=>{e.exports={0:"NONE",1:"ONE",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN",256:"DEPTH_BUFFER_BIT",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",768:"SRC_COLOR",769:"ONE_MINUS_SRC_COLOR",770:"SRC_ALPHA",771:"ONE_MINUS_SRC_ALPHA",772:"DST_ALPHA",773:"ONE_MINUS_DST_ALPHA",774:"DST_COLOR",775:"ONE_MINUS_DST_COLOR",776:"SRC_ALPHA_SATURATE",1024:"STENCIL_BUFFER_BIT",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",2304:"CW",2305:"CCW",2849:"LINE_WIDTH",2884:"CULL_FACE",2885:"CULL_FACE_MODE",2886:"FRONT_FACE",2928:"DEPTH_RANGE",2929:"DEPTH_TEST",2930:"DEPTH_WRITEMASK",2931:"DEPTH_CLEAR_VALUE",2932:"DEPTH_FUNC",2960:"STENCIL_TEST",2961:"STENCIL_CLEAR_VALUE",2962:"STENCIL_FUNC",2963:"STENCIL_VALUE_MASK",2964:"STENCIL_FAIL",2965:"STENCIL_PASS_DEPTH_FAIL",2966:"STENCIL_PASS_DEPTH_PASS",2967:"STENCIL_REF",2968:"STENCIL_WRITEMASK",2978:"VIEWPORT",3024:"DITHER",3042:"BLEND",3088:"SCISSOR_BOX",3089:"SCISSOR_TEST",3106:"COLOR_CLEAR_VALUE",3107:"COLOR_WRITEMASK",3317:"UNPACK_ALIGNMENT",3333:"PACK_ALIGNMENT",3379:"MAX_TEXTURE_SIZE",3386:"MAX_VIEWPORT_DIMS",3408:"SUBPIXEL_BITS",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",3414:"DEPTH_BITS",3415:"STENCIL_BITS",3553:"TEXTURE_2D",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",5386:"INVERT",5890:"TEXTURE",6401:"STENCIL_INDEX",6402:"DEPTH_COMPONENT",6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",7936:"VENDOR",7937:"RENDERER",7938:"VERSION",9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR",10240:"TEXTURE_MAG_FILTER",10241:"TEXTURE_MIN_FILTER",10242:"TEXTURE_WRAP_S",10243:"TEXTURE_WRAP_T",10497:"REPEAT",10752:"POLYGON_OFFSET_UNITS",16384:"COLOR_BUFFER_BIT",32769:"CONSTANT_COLOR",32770:"ONE_MINUS_CONSTANT_COLOR",32771:"CONSTANT_ALPHA",32772:"ONE_MINUS_CONSTANT_ALPHA",32773:"BLEND_COLOR",32774:"FUNC_ADD",32777:"BLEND_EQUATION_RGB",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1",32823:"POLYGON_OFFSET_FILL",32824:"POLYGON_OFFSET_FACTOR",32854:"RGBA4",32855:"RGB5_A1",32873:"TEXTURE_BINDING_2D",32926:"SAMPLE_ALPHA_TO_COVERAGE",32928:"SAMPLE_COVERAGE",32936:"SAMPLE_BUFFERS",32937:"SAMPLES",32938:"SAMPLE_COVERAGE_VALUE",32939:"SAMPLE_COVERAGE_INVERT",32968:"BLEND_DST_RGB",32969:"BLEND_SRC_RGB",32970:"BLEND_DST_ALPHA",32971:"BLEND_SRC_ALPHA",33071:"CLAMP_TO_EDGE",33170:"GENERATE_MIPMAP_HINT",33189:"DEPTH_COMPONENT16",33306:"DEPTH_STENCIL_ATTACHMENT",33635:"UNSIGNED_SHORT_5_6_5",33648:"MIRRORED_REPEAT",33901:"ALIASED_POINT_SIZE_RANGE",33902:"ALIASED_LINE_WIDTH_RANGE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",34016:"ACTIVE_TEXTURE",34024:"MAX_RENDERBUFFER_SIZE",34041:"DEPTH_STENCIL",34055:"INCR_WRAP",34056:"DECR_WRAP",34067:"TEXTURE_CUBE_MAP",34068:"TEXTURE_BINDING_CUBE_MAP",34069:"TEXTURE_CUBE_MAP_POSITIVE_X",34070:"TEXTURE_CUBE_MAP_NEGATIVE_X",34071:"TEXTURE_CUBE_MAP_POSITIVE_Y",34072:"TEXTURE_CUBE_MAP_NEGATIVE_Y",34073:"TEXTURE_CUBE_MAP_POSITIVE_Z",34074:"TEXTURE_CUBE_MAP_NEGATIVE_Z",34076:"MAX_CUBE_MAP_TEXTURE_SIZE",34338:"VERTEX_ATTRIB_ARRAY_ENABLED",34339:"VERTEX_ATTRIB_ARRAY_SIZE",34340:"VERTEX_ATTRIB_ARRAY_STRIDE",34341:"VERTEX_ATTRIB_ARRAY_TYPE",34342:"CURRENT_VERTEX_ATTRIB",34373:"VERTEX_ATTRIB_ARRAY_POINTER",34466:"NUM_COMPRESSED_TEXTURE_FORMATS",34467:"COMPRESSED_TEXTURE_FORMATS",34660:"BUFFER_SIZE",34661:"BUFFER_USAGE",34816:"STENCIL_BACK_FUNC",34817:"STENCIL_BACK_FAIL",34818:"STENCIL_BACK_PASS_DEPTH_FAIL",34819:"STENCIL_BACK_PASS_DEPTH_PASS",34877:"BLEND_EQUATION_ALPHA",34921:"MAX_VERTEX_ATTRIBS",34922:"VERTEX_ATTRIB_ARRAY_NORMALIZED",34930:"MAX_TEXTURE_IMAGE_UNITS",34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER",34964:"ARRAY_BUFFER_BINDING",34965:"ELEMENT_ARRAY_BUFFER_BINDING",34975:"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",35040:"STREAM_DRAW",35044:"STATIC_DRAW",35048:"DYNAMIC_DRAW",35632:"FRAGMENT_SHADER",35633:"VERTEX_SHADER",35660:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",35661:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",35663:"SHADER_TYPE",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",35712:"DELETE_STATUS",35713:"COMPILE_STATUS",35714:"LINK_STATUS",35715:"VALIDATE_STATUS",35716:"INFO_LOG_LENGTH",35717:"ATTACHED_SHADERS",35718:"ACTIVE_UNIFORMS",35719:"ACTIVE_UNIFORM_MAX_LENGTH",35720:"SHADER_SOURCE_LENGTH",35721:"ACTIVE_ATTRIBUTES",35722:"ACTIVE_ATTRIBUTE_MAX_LENGTH",35724:"SHADING_LANGUAGE_VERSION",35725:"CURRENT_PROGRAM",36003:"STENCIL_BACK_REF",36004:"STENCIL_BACK_VALUE_MASK",36005:"STENCIL_BACK_WRITEMASK",36006:"FRAMEBUFFER_BINDING",36007:"RENDERBUFFER_BINDING",36048:"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",36049:"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",36050:"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",36051:"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED",36064:"COLOR_ATTACHMENT0",36096:"DEPTH_ATTACHMENT",36128:"STENCIL_ATTACHMENT",36160:"FRAMEBUFFER",36161:"RENDERBUFFER",36162:"RENDERBUFFER_WIDTH",36163:"RENDERBUFFER_HEIGHT",36164:"RENDERBUFFER_INTERNAL_FORMAT",36168:"STENCIL_INDEX8",36176:"RENDERBUFFER_RED_SIZE",36177:"RENDERBUFFER_GREEN_SIZE",36178:"RENDERBUFFER_BLUE_SIZE",36179:"RENDERBUFFER_ALPHA_SIZE",36180:"RENDERBUFFER_DEPTH_SIZE",36181:"RENDERBUFFER_STENCIL_SIZE",36194:"RGB565",36336:"LOW_FLOAT",36337:"MEDIUM_FLOAT",36338:"HIGH_FLOAT",36339:"LOW_INT",36340:"MEDIUM_INT",36341:"HIGH_INT",36346:"SHADER_COMPILER",36347:"MAX_VERTEX_UNIFORM_VECTORS",36348:"MAX_VARYING_VECTORS",36349:"MAX_FRAGMENT_UNIFORM_VECTORS",37440:"UNPACK_FLIP_Y_WEBGL",37441:"UNPACK_PREMULTIPLY_ALPHA_WEBGL",37442:"CONTEXT_LOST_WEBGL",37443:"UNPACK_COLORSPACE_CONVERSION_WEBGL",37444:"BROWSER_DEFAULT_WEBGL"}},8042:(e,t,r)=>{var i=r(3086);e.exports=function(e){return i[e]}},8852:(e,t,r)=>{var i=r(124).sprintf,n=r(8042),s=r(3999),o=r(7431);e.exports=function(e,t,r){"use strict";var a=s(t)||"of unknown name (see npm glsl-shader-name)",l="unknown type";void 0!==r&&(l=r===n.FRAGMENT_SHADER?"fragment":"vertex");for(var c=i("Error compiling %s shader %s:\n",l,a),u=i("%s%s",c,e),h=e.split("\n"),f={},d=0;d<h.length;d++){var E=h[d];if(""!==E&&"\0"!==E){var m=parseInt(E.split(":")[2]);if(isNaN(m))throw new Error(i("Could not parse error: %s",E));f[m]=E}}var _=o(t).split("\n");for(d=0;d<_.length;d++)if((f[d+3]||f[d+2]||f[d+1])&&(c+=_[d]+"\n",f[d+1])){var g=f[d+1];g=g.substr(g.split(":",3).join(":").length+1).trim(),c+=i("^^^ %s\n\n",g)}return{long:c.trim(),short:u.trim()}}},3999:(e,t,r)=>{var i=r(8267),n=r(9811);e.exports=function(e){for(var t=Array.isArray(e)?e:i(e),r=0;r<t.length;r++){var s=t[r];if("preprocessor"===s.type){var o=s.data.match(/\#define\s+SHADER_NAME(_B64)?\s+(.+)$/);if(o&&o[2]){var a=o[1],l=o[2];return(a?n(l):l).trim()}}}}},7221:(e,t,r)=>{e.exports=function(e){var t,r,I,M=0,S=0,N=l,b=[],w=[],L=1,v=0,F=0,y=!1,B=!1,C="",P=s,V=i;"300 es"===(e=e||{}).version&&(P=a,V=o);var O={},U={};for(M=0;M<P.length;M++)O[P[M]]=!0;for(M=0;M<V.length;M++)U[V[M]]=!0;return function(e){return w=[],null!==e?function(e){var r;for(M=0,e.toString&&(e=e.toString()),C+=e.replace(/\r\n/g,"\n"),I=C.length;t=C[M],M<I;){switch(r=M,N){case u:M=j();break;case h:case f:M=X();break;case d:M=H();break;case E:M=z();break;case R:M=Y();break;case m:M=q();break;case c:M=Z();break;case T:M=k();break;case l:M=G()}r!==M&&("\n"===C[r]?(v=0,++L):++v)}return S+=M,C=C.slice(M),w}(e):(b.length&&D(b.join("")),N=A,D("(eof)"),w)};function D(e){e.length&&w.push({type:x[N],data:e,position:F,line:L,column:v})}function G(){return b=b.length?[]:b,"/"===r&&"*"===t?(F=S+M-1,N=u,r=t,M+1):"/"===r&&"/"===t?(F=S+M-1,N=h,r=t,M+1):"#"===t?(N=f,F=S+M,M):/\s/.test(t)?(N=T,F=S+M,M):(y=/\d/.test(t),B=/[^\w_]/.test(t),F=S+M,N=y?E:B?d:c,M)}function k(){return/[^\s]/g.test(t)?(D(b.join("")),N=l,M):(b.push(t),r=t,M+1)}function X(){return"\r"!==t&&"\n"!==t||"\\"===r?(b.push(t),r=t,M+1):(D(b.join("")),N=l,M)}function j(){return"/"===t&&"*"===r?(b.push(t),D(b.join("")),N=l,M+1):(b.push(t),r=t,M+1)}function H(){if("."===r&&/\d/.test(t))return N=m,M;if("/"===r&&"*"===t)return N=u,M;if("/"===r&&"/"===t)return N=h,M;if("."===t&&b.length){for(;W(b););return N=m,M}if(";"===t||")"===t||"("===t){if(b.length)for(;W(b););return D(t),N=l,M+1}var e=2===b.length&&"="!==t;if(/[\w_\d\s]/.test(t)||e){for(;W(b););return N=l,M}return b.push(t),r=t,M+1}function W(e){for(var t,r,i=0;;){if(t=n.indexOf(e.slice(0,e.length+i).join("")),r=n[t],-1===t){if(i--+e.length>0)continue;r=e.slice(0,1).join("")}return D(r),F+=r.length,(b=b.slice(r.length)).length}}function Y(){return/[^a-fA-F0-9]/.test(t)?(D(b.join("")),N=l,M):(b.push(t),r=t,M+1)}function z(){return"."===t||/[eE]/.test(t)?(b.push(t),N=m,r=t,M+1):"x"===t&&1===b.length&&"0"===b[0]?(N=R,b.push(t),r=t,M+1):/[^\d]/.test(t)?(D(b.join("")),N=l,M):(b.push(t),r=t,M+1)}function q(){return"f"===t&&(b.push(t),r=t,M+=1),/[eE]/.test(t)?(b.push(t),r=t,M+1):("-"!==t&&"+"!==t||!/[eE]/.test(r))&&/[^\d]/.test(t)?(D(b.join("")),N=l,M):(b.push(t),r=t,M+1)}function Z(){if(/[^\d\w_]/.test(t)){var e=b.join("");return N=U[e]?p:O[e]?g:_,D(b.join("")),N=l,M}return b.push(t),r=t,M+1}};var i=r(1995),n=r(9724),s=r(1162),o=r(7196),a=r(7244),l=999,c=9999,u=0,h=1,f=2,d=3,E=4,m=5,_=6,g=7,p=8,T=9,A=10,R=11,x=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]},7244:(e,t,r)=>{var i=r(1162);i=i.slice().filter((function(e){return!/^(gl\_|texture)/.test(e)})),e.exports=i.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"])},1162:e=>{e.exports=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]},7196:(e,t,r)=>{var i=r(1995);e.exports=i.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"])},1995:e=>{e.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},9724:e=>{e.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},8267:(e,t,r)=>{var i=r(7221);e.exports=function(e,t){var r=i(t),n=[];return(n=n.concat(r(e))).concat(r(null))}},6435:(e,t,r)=>{"use strict";var i=r(931);e.exports=function(e,t,r){return i(r=void 0!==r?r+"":" ",t)+e}},931:e=>{"use strict";var t,r="";e.exports=function(e,i){if("string"!=typeof e)throw new TypeError("expected a string");if(1===i)return e;if(2===i)return e+e;var n=e.length*i;if(t!==e||void 0===t)t=e,r="";else if(r.length>=n)return r.substr(0,n);for(;n>r.length&&i>1;)1&i&&(r+=e),i>>=1,e+=e;return r=(r+=e).substr(0,n)}},124:(e,t,r)=>{var i;!function(){"use strict";var n={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function s(e){return function(e,t){var r,i,o,a,l,c,u,h,f,d=1,E=e.length,m="";for(i=0;i<E;i++)if("string"==typeof e[i])m+=e[i];else if("object"==typeof e[i]){if((a=e[i]).keys)for(r=t[d],o=0;o<a.keys.length;o++){if(null==r)throw new Error(s('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));r=r[a.keys[o]]}else r=a.param_no?t[a.param_no]:t[d++];if(n.not_type.test(a.type)&&n.not_primitive.test(a.type)&&r instanceof Function&&(r=r()),n.numeric_arg.test(a.type)&&"number"!=typeof r&&isNaN(r))throw new TypeError(s("[sprintf] expecting number but found %T",r));switch(n.number.test(a.type)&&(h=r>=0),a.type){case"b":r=parseInt(r,10).toString(2);break;case"c":r=String.fromCharCode(parseInt(r,10));break;case"d":case"i":r=parseInt(r,10);break;case"j":r=JSON.stringify(r,null,a.width?parseInt(a.width):0);break;case"e":r=a.precision?parseFloat(r).toExponential(a.precision):parseFloat(r).toExponential();break;case"f":r=a.precision?parseFloat(r).toFixed(a.precision):parseFloat(r);break;case"g":r=a.precision?String(Number(r.toPrecision(a.precision))):parseFloat(r);break;case"o":r=(parseInt(r,10)>>>0).toString(8);break;case"s":r=String(r),r=a.precision?r.substring(0,a.precision):r;break;case"t":r=String(!!r),r=a.precision?r.substring(0,a.precision):r;break;case"T":r=Object.prototype.toString.call(r).slice(8,-1).toLowerCase(),r=a.precision?r.substring(0,a.precision):r;break;case"u":r=parseInt(r,10)>>>0;break;case"v":r=r.valueOf(),r=a.precision?r.substring(0,a.precision):r;break;case"x":r=(parseInt(r,10)>>>0).toString(16);break;case"X":r=(parseInt(r,10)>>>0).toString(16).toUpperCase()}n.json.test(a.type)?m+=r:(!n.number.test(a.type)||h&&!a.sign?f="":(f=h?"+":"-",r=r.toString().replace(n.sign,"")),c=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",u=a.width-(f+r).length,l=a.width&&u>0?c.repeat(u):"",m+=a.align?f+r+l:"0"===c?f+l+r:l+f+r)}return m}(function(e){if(a[e])return a[e];for(var t,r=e,i=[],s=0;r;){if(null!==(t=n.text.exec(r)))i.push(t[0]);else if(null!==(t=n.modulo.exec(r)))i.push("%");else{if(null===(t=n.placeholder.exec(r)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){s|=1;var o=[],l=t[2],c=[];if(null===(c=n.key.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(c[1]);""!==(l=l.substring(c[0].length));)if(null!==(c=n.key_access.exec(l)))o.push(c[1]);else{if(null===(c=n.index_access.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(c[1])}t[2]=o}else s|=2;if(3===s)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");i.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}r=r.substring(t[0].length)}return a[e]=i}(e),arguments)}function o(e,t){return s.apply(null,[e].concat(t||[]))}var a=Object.create(null);t.sprintf=s,t.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=s,window.vsprintf=o,void 0===(i=function(){return{sprintf:s,vsprintf:o}}.call(t,r,t,e))||(e.exports=i))}()},2004:(e,t,r)=>{"use strict";r.d(t,{lW:()=>c,$R:()=>C,Kj:()=>p,ex:()=>M,ZG:()=>O,xE:()=>S});var i=r(2182);function n(e,t,r,i){return new(r||(r=Promise))((function(n,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))}Object.create,Object.create;var s=r(8852),o=r.n(s),a=r(7392);const l=WebGLRenderingContext;class c{constructor(e,t){this.target=e,this.type=t,this.buffer=void 0,this.data=[],this.count=0,this.spacing=1,this.hasBeenCompiled=!1,(0,i.hu)(e==l.ARRAY_BUFFER||e==l.ELEMENT_ARRAY_BUFFER,"target == WGL.ARRAY_BUFFER || target == WGL.ELEMENT_ARRAY_BUFFER"),(0,i.hu)(t==Float32Array||t==Uint16Array||t==Uint32Array,"type == Float32Array || type == Uint16Array || type == Uint32Array"),Uint16Array==t?this.bindSize=l.UNSIGNED_SHORT:Uint32Array==t&&(this.bindSize=l.UNSIGNED_INT)}compile(e=l.STATIC_DRAW,t=P()){let r;if((0,i.hu)(l.STATIC_DRAW==e||l.DYNAMIC_DRAW==e,"WGL.STATIC_DRAW == type || WGL.DYNAMIC_DRAW == type"),this.buffer=this.buffer||t.createBuffer(),0==this.data.length&&console.warn("empty buffer "+this.name),0==this.data.length||this.data[0]instanceof i.V3)(0,i.hu)(!(this.data[0]instanceof i.V3)||this.type==Float32Array),i.V3.pack(this.data,r=new this.type(3*this.data.length)),this.spacing=3,this.count=this.data.length,this.maxValue=0;else{if(Array.isArray(this.data[0])){const e=this.data.length*this.data[0].length;r=new this.type(e);let t=this.data.length,n=e;for(;t--;){const e=this.data[t];let i=e.length;for(;i--;)r[--n]=e[i]}(0,i.hu)(0==n)}else r=new this.type(this.data);const e=this.data.length?r.length/this.data.length:0;(0,i.hu)(e%1==0,`buffer ${this.name} elements not of consistent size, average size is `+e),i.wU&&(1e4<=r.length?this.maxValue=0:this.maxValue=Math.max.apply(void 0,r)),(0,i.hu)([1,2,3,4].includes(e)),this.spacing=e,this.count=this.data.length}t.bindBuffer(this.target,this.buffer),t.bufferData(this.target,r,e),this.hasBeenCompiled=!0}}const{cos:u,sin:h,PI:f,min:d,max:E}=Math,m=WebGLRenderingContext,_=new i.M4,g=new i.M4;class p extends i.yu{constructor(){super(),this.hasBeenCompiled=!1,this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","ts_Vertex")}calcVolume(){let e=0,t=i.V3.O,r=0;const n=this.TRIANGLES,s=this.vertices;for(let o=0;o<n.length;o+=3){const a=n[o+0],l=n[o+1],c=n[o+2],u=s[a],h=s[l],f=s[c],d=h.minus(u),E=f.minus(u),m=d.cross(E);e+=i.V3.add(u,h,f).div(3).z*m.z,r+=m.length();const _=i.V3.add(u.times(2*u.z+h.z+f.z),h.times(u.z+2*h.z+f.z),f.times(u.z+h.z+2*f.z)).times(m.z);t=t.plus(_)}const o=e/2;return{volume:o,centroid:(0,i.p3)(o)?i.V3.O:t.div(24*o).schur(new i.V3(1,1,.5)),area:r/2}}addVertexBuffer(e,t){return(0,i.hu)(!this.vertexBuffers[t],"Buffer "+t+" already exists."),this.hasBeenCompiled=!1,(0,i.hu)("string"==typeof e),(0,i.hu)("string"==typeof t),(this.vertexBuffers[t]=new c(m.ARRAY_BUFFER,Float32Array)).name=e,this[e]=[],this}addIndexBuffer(e,t=m.UNSIGNED_SHORT){this.hasBeenCompiled=!1;const r=m.UNSIGNED_SHORT==t?Uint16Array:Uint32Array;return(this.indexBuffers[e]=new c(m.ELEMENT_ARRAY_BUFFER,r)).name=e,this[e]=[],this}concat(...e){const t=new p,r=[this].concat(e);return Object.getOwnPropertyNames(this.vertexBuffers).forEach((n=>{(0,i.hu)(e.every((e=>!!e.vertexBuffers[n])));const s=this.vertexBuffers[n].name;"ts_Vertex"!==n&&t.addVertexBuffer(s,n),t[s]=[].concat(...r.map((e=>e[s])))})),Object.getOwnPropertyNames(this.indexBuffers).forEach((n=>{(0,i.hu)(e.every((e=>!!e.indexBuffers[n]))),t.addIndexBuffer(n,this.indexBuffers[n].bindSize);const s=Array(r.reduce(((e,t)=>e+t[n].length),0));let o=0,a=0;for(const e of r){for(const t of e[n])s[o++]=a+t;a+=e.vertices.length}t[n]=s})),t.compile(),t}compile(e=P()){let t=1/0;Object.getOwnPropertyNames(this.vertexBuffers).forEach((r=>{const i=this.vertexBuffers[r];i.data=this[i.name],i.compile(void 0,e),this[i.name].length<t&&(t=this[i.name].length)}));for(const t in this.indexBuffers){const r=this.indexBuffers[t];r.data=this[r.name],r.compile(void 0,e)}return this.hasBeenCompiled=!0,this}static fromBinarySTL(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{const n=(new p).addVertexBuffer("normals","ts_Normal"),s=new FileReader;s.onerror=r,s.onload=function(e){const r=new DataView(this.result),s=r.getUint32(80,!0);n.normals.length=3*s,n.vertices.length=3*s;let o=3*s,a=84;function l(){const e=r.getFloat32(a,!0);a+=4;const t=r.getFloat32(a,!0);a+=4;const n=r.getFloat32(a,!0);return a+=4,new i.V3(e,t,n)}for(;o;){o-=3;const e=l();n.normals[o+0]=e,n.normals[o+1]=e,n.normals[o+2]=e,n.vertices[o+0]=l(),n.vertices[o+1]=l(),n.vertices[o+2]=l(),a+=2}t(n)},s.readAsArrayBuffer(e)}))}))}toBinarySTL(){if(!this.TRIANGLES)throw Error("TRIANGLES must be defined.");const e=this.TRIANGLES,t=e.length/3,r=new ArrayBuffer(84+50*t),n=new DataView(r);n.setUint32(80,t,!0);let s=84,o=e.length;for(;o;){o-=3;const t=this.vertices[e[o]],r=this.vertices[e[o+1]],a=this.vertices[e[o+2]];[i.V3.normalOnPoints(t,r,a),t,r,a].forEach((e=>{n.setFloat32(s,e.x,!0),s+=4,n.setFloat32(s,e.y,!0),s+=4,n.setFloat32(s,e.z,!0),s+=4})),s+=2}return(0,i.hu)(s==r.byteLength,s+" "+r.byteLength),new Blob([r],{type:"application/octet-stream"})}transform(e){const t=new p;if(t.vertices=e.transformedPoints(this.vertices),this.normals){t.addVertexBuffer("normals","ts_Normal");const r=e.as3x3(_).inversed(g).transposed(_);t.normals=this.normals.map((e=>r.transformVector(e).unit()))}for(const e in this.indexBuffers)t.addIndexBuffer(e),t[e]=this[e];for(const e in this.vertexBuffers)if("ts_Vertex"!==e&&"ts_Normal"!==e){const r=this.vertexBuffers[e].name;t.addVertexBuffer(r,e),t[r]=this[r]}return t}computeNormalsFromFlatTriangles(){this.normals||this.addVertexBuffer("normals","ts_Normal");const e=this.TRIANGLES,t=this.vertices,r=this.normals;r.length=t.length;for(let n=0;n<e.length;n+=3){const s=e[n],o=e[n+1],a=e[n+2],l=t[s],c=t[o],u=t[a],h=c.minus(l).cross(u.minus(l)),f=h.likeO()?i.V3.O:h.unit();r[s]=r[s]?r[s].plus(f):f,r[o]=r[o]?r[o].plus(f):f,r[a]=r[a]?r[a].plus(f):f}for(let e=0;e<t.length;e++)r[e]=r[e].unit();return this.hasBeenCompiled=!1,this}computeWireframeFromFlatTriangles(e="LINES"){if(!this.TRIANGLES)throw Error("TRIANGLES must be defined.");const t=new Set;function r(e,t){return d(e,t)<<16|E(e,t)}const i=this.TRIANGLES;for(let e=0;e<i.length;e+=3)t.add(r(i[e+0],i[e+1])),t.add(r(i[e+1],i[e+2])),t.add(r(i[e+2],i[e+0]));const n=e;return this[n]||this.addIndexBuffer(e),t.forEach((e=>this[n].push(e>>16,65535&e))),this.hasBeenCompiled=!1,this}computeWireframeFromFlatTrianglesClosedMesh(e="LINES"){if(!this.TRIANGLES)throw Error("TRIANGLES must be defined.");this.LINES||this.addIndexBuffer("LINES");const t=this.TRIANGLES;this[e]||this.addIndexBuffer(e);const r=this[e];for(let e=0;e<t.length;e+=3)t[e+0]<t[e+1]&&r.push(t[e+0],t[e+1]),t[e+1]<t[e+2]&&r.push(t[e+1],t[e+2]),t[e+2]<t[e+0]&&r.push(t[e+2],t[e+0]);return this.hasBeenCompiled=!1,this}computeNormalLines(e=1,t="LINES"){if(!this.normals)throw Error("normals must be defined.");const r=this.vertices,i=this.vertices.length;this[t]||this.addIndexBuffer(t);for(let n=0;n<this.normals.length;n++)r[i+n]=r[n].plus(this.normals[n].toLength(e)),this[t].push(i+n,n);return this.hasBeenCompiled=!1,this}getAABB(){return(new i.mN).addPoints(this.vertices)}getBoundingSphere(){const e={center:this.getAABB().getCenter(),radius:0};for(let t=0;t<this.vertices.length;t++)e.radius=Math.max(e.radius,this.vertices[t].minus(e.center).length());return e}static plane(e={}){const t=e.detailX||e.detail||1,r=e.detailY||e.detail||1,n=e.startX||0,s=e.startY||0,o=e.width||1,a=e.height||1,l=(new p).addIndexBuffer("LINES").addIndexBuffer("TRIANGLES").addVertexBuffer("normals","ts_Normal").addVertexBuffer("coords","ts_TexCoord");for(let e=0;e<=r;e++){const c=e/r;for(let u=0;u<=t;u++){const h=u/t;if(l.vertices.push(new i.V3(n+h*o,s+c*a,0)),l.coords.push([h,c]),l.normals.push(i.V3.Z),u<t&&e<r){const r=u+e*(t+1);l.TRIANGLES.push(r,r+1,r+t+1,r+t+1,r+1,r+t+2)}}}for(let e=0;e<t;e++)l.LINES.push(e,e+1),l.LINES.push((t+1)*r+e,(t+1)*r+e+1);for(let e=0;e<r;e++)l.LINES.push(t*e,t*(e+1)+1),l.LINES.push(t*(e+1),t*(e+2)+1);return l.compile(),l}static box(e=1,t=1,r=1){const n=(new p).addIndexBuffer("LINES").addIndexBuffer("TRIANGLES").addVertexBuffer("normals","ts_Normal");n.vertices.length=n.normals.length=2*((e+1)*(t+1)+(t+1)*(r+1)+(r+1)*(e+1)),n.TRIANGLES.length=4*(e*t+t*r+r*e);let s=0,o=0;function a(e,t,r,a=0,l=1,c=0,u=1){const h=r.transformVector(i.V3.Z);for(let f=0;f<=t;f++){const d=f/t;for(let E=0;E<=e;E++){const m=E/e;if(n.vertices[s]=r.transformPoint(new i.V3(a+m*l,c+d*u,0)),n.normals[s]=h,s++,E<e&&f<t){const t=E+f*(e+1);n.TRIANGLES[o++]=t,n.TRIANGLES[o++]=t+e+1,n.TRIANGLES[o++]=t+1,n.TRIANGLES[o++]=t+e+1,n.TRIANGLES[o++]=t+e+2,n.TRIANGLES[o++]=t+1}}}}return a(t,e,i.M4.forSys(i.V3.Y,i.V3.X,i.V3.Z.negated())),a(e,t,i.M4.translate(i.V3.Z)),a(r,t,i.M4.forSys(i.V3.Z,i.V3.Y,i.V3.X.negated())),a(t,r,i.M4.forSys(i.V3.Y,i.V3.Z,i.V3.X,i.V3.X)),a(e,r,i.M4.forSys(i.V3.X,i.V3.Z,i.V3.Y.negated())),a(r,e,i.M4.forSys(i.V3.Z,i.V3.X,i.V3.Y,i.V3.Y)),n}static cube(){const e=(new p).addVertexBuffer("normals","ts_Normal").addIndexBuffer("TRIANGLES").addIndexBuffer("LINES"),t=[[0,4,6,2],[1,3,7,5],[0,1,5,4],[2,6,7,3],[0,2,3,1],[4,5,7,6]],r=[i.V3.X.negated(),i.V3.X,i.V3.Y.negated(),i.V3.Y,i.V3.Z.negated(),i.V3.Z];for(let i=0;i<6;i++)U(e.TRIANGLES,!0,e.vertices.length,e.vertices.length+1,e.vertices.length+3,e.vertices.length+2),e.vertices.push(...t[i].map((e=>p.UNIT_CUBE_CORNERS[e]))),e.normals.push(r[i],r[i],r[i],r[i]);return e.LINES=[[0,1],[0,2],[1,3],[2,3],[0,4],[1,5],[2,6],[3,7],[4,5],[4,6],[5,7],[6,7]].flatMap((e=>e)).map((e=>{let r=0;return 4*t.findIndex((t=>-1!=(r=t.indexOf(e))))+r})),e.compile(),e}static isocahedron(){return p.sphere(0)}static sphere2(e,t){const r=(0,i.Nv)(e,(t=>{const r=t/(e-1)*f-f/2;return new i.V3(0,u(r),h(r))})),n=(0,i.Nv)(e,(t=>{const r=u(t/(e-1)*f-f/2);return[t/(e-1)*r,r]}));return p.rotation(r,{anchor:i.V3.O,dir1:i.V3.Z},2*f,t,!0,r,n)}static sphere(e=3){const t=new i.V3(1,1.618033988749895,0).unit(),r=t.x,n=t.y,s=[new i.V3(-r,n,0),new i.V3(r,n,0),new i.V3(-r,-n,0),new i.V3(r,-n,0),new i.V3(0,-r,n),new i.V3(0,r,n),new i.V3(0,-r,-n),new i.V3(0,r,-n),new i.V3(n,0,-r),new i.V3(n,0,r),new i.V3(-n,0,-r),new i.V3(-n,0,r)],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];function a(e,t,r,i,n,s,o,l,c,u){if(0==i)s.push(o,l,c),o<l&&u.push(o,l),l<c&&u.push(l,c),c<o&&u.push(c,o);else{const h=e.plus(t).toLength(1),f=t.plus(r).toLength(1),d=r.plus(e).toLength(1),E=n.length,m=E+1,_=E+2;n.push(h,f,d),a(h,f,d,i-1,n,s,E,m,_,u),a(e,h,d,i-1,n,s,o,E,_,u),a(t,f,h,i-1,n,s,l,m,E,u),a(r,d,f,i-1,n,s,c,_,m,u)}}const l=(new p).addVertexBuffer("normals","ts_Normal").addIndexBuffer("TRIANGLES").addIndexBuffer("LINES");l.vertices.push(...s),e=null==e?4:e;for(let t=0;t<20;t++){const[r,i,n]=o.slice(3*t,3*t+3);a(s[r],s[i],s[n],e,l.vertices,l.TRIANGLES,r,i,n,l.LINES)}return l.normals=l.vertices,l.compile(),l}static aabb(e){const t=i.M4.product(i.M4.translate(e.min),i.M4.scale(e.size().max(new i.V3(i.bE,i.bE,i.bE)))),r=p.cube().transform(t);return r.computeNormalLines(20),r.compile(),r}static offsetVertices(e,t,r,n){i.nY.apply(void 0,e),(0,i.nY)(t);const s=(new p).addIndexBuffer("TRIANGLES").addVertexBuffer("coords","ts_TexCoord");n&&s.addVertexBuffer("normals","ts_Normal"),s.vertices=e.concat(e.map((e=>e.plus(t))));const o=e.length;s.coords=(0,i.Nv)(2*o,(e=>[e%o/o,e/o|0]));const a=s.TRIANGLES;for(let t=0;t<e.length-1;t++)U(a,!1,t,t+1,e.length+t,e.length+t+1);return r&&U(a,!1,e.length-1,0,2*e.length-1,e.length),n&&(s.normals=n.concat(n)),s.compile(),s}static rotation(e,t,r,n,s=!0,o,a){const l=(new p).addIndexBuffer("TRIANGLES");o&&l.addVertexBuffer("normals","ts_Normal"),a&&l.addVertexBuffer("coordsUVQ","ts_TexCoordUVQ");const c=e.length,u=c*n,h=new i.M4,f=l.TRIANGLES;for(let d=0;d<n;d++){const E=r*(d/n);if(i.M4.rotateLine(t.anchor,t.dir1,E,h),l.vertices.push(...h.transformedPoints(e)),o&&l.normals.push(...h.transformedVectors(o)),a&&l.coordsUVQ.push(...a.map((([e,t])=>[d/n*t,e,t]))),s||d!==n-1)for(let e=0;e<c-1;e++)U(f,!1,d*c+e+1,d*c+e,((d+1)*c+e+1)%u,((d+1)*c+e)%u)}return l.compile(),l}static spiral(e,t,r,n,s,o,a){const l=(new p).addIndexBuffer("TRIANGLES");o&&l.addVertexBuffer("normals","ts_Normal"),a&&l.addVertexBuffer("coordsUVQ","ts_TexCoordUVQ");const c=e.length,u=c*n,h=new i.M4,f=l.TRIANGLES;for(let d=0;d<n;d++){const E=r*(d/n);if(i.M4.rotateLine(t.anchor,t.dir1,E,h),l.vertices.push(...h.translate(t.dir1.toLength(r/i.gc*(d/n)*s)).transformedPoints(e)),o&&l.normals.push(...h.transformedVectors(o)),a&&l.coordsUVQ.push(...a.map((([e,t])=>[d/n*t,e,t]))),d!==n-1)for(let e=0;e<c-1;e++)U(f,!1,d*c+e+1,d*c+e,((d+1)*c+e+1)%u,((d+1)*c+e)%u)}return l.compile(),l}static parametric(e,t,r,n,s,o,a,l){const c=(new p).addIndexBuffer("TRIANGLES").addVertexBuffer("normals","ts_Normal");for(let u=0;u<=a;u++){const h=(0,i.t7)(r,n,u/a);for(let r=0;r<=l;r++){const n=(0,i.t7)(s,o,r/l);if(c.vertices.push(e(h,n)),t&&c.normals.push(t(h,n)),r<l&&u<a){const e=r+u*(l+1);U(c.TRIANGLES,!1,e,e+l+1,e+1,e+l+2)}}}return c}static load(e){const t=new p;if(!Array.isArray(e.vertices[0]))throw Error();return t.vertices=e.vertices.map((e=>(0,i.V)(e))),e.triangles&&(t.addIndexBuffer("TRIANGLES"),t.TRIANGLES=e.triangles),e.normals&&(t.addVertexBuffer("normals","ts_Normal"),t.normals=e.normals),t.compile(),t}toJSON(){return{vertices:this.vertices.map((e=>e.toArray())),TRIANGLES:this.TRIANGLES}}}p.UNIT_CUBE_CORNERS=[i.V3.O,new i.V3(0,0,1),new i.V3(0,1,0),new i.V3(0,1,1),new i.V3(1,0,0),new i.V3(1,0,1),new i.V3(1,1,0),i.V3.XYZ];const T=WebGLRenderingContext,A={[T.POINTS]:"POINTS",[T.LINES]:"LINES",[T.LINE_STRIP]:"LINE_STRIP",[T.LINE_LOOP]:"LINE_LOOP",[T.TRIANGLES]:"TRIANGLES",[T.TRIANGLE_STRIP]:"TRIANGLE_STRIP",[T.TRIANGLE_FAN]:"TRIANGLE_FAN"},R={[T.POINTS]:e=>!0,[T.LINES]:e=>0==e%2,[T.LINE_STRIP]:e=>e>2,[T.LINE_LOOP]:e=>e>2,[T.TRIANGLES]:e=>0==e%3,[T.TRIANGLE_STRIP]:e=>e>3,[T.TRIANGLE_FAN]:e=>e>3};function x(e){return Float32Array==e.constructor||Float64Array==e.constructor||Array.isArray(e)&&e.every((e=>"number"==typeof e))}function I(e){return!![Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array].some((t=>e instanceof t))||(e instanceof Float32Array||e instanceof Float64Array||Array.isArray(e))&&e.every((e=>Number.isInteger(e)))}class M{constructor(e,t,r=P(),i){this.gl=r,this.name=i,this.projectionMatrixVersion=-1,this.modelViewMatrixVersion=-1,this.outputWarnings={};const n="\n    uniform mat3 ts_NormalMatrix;\n    uniform mat4 ts_ModelViewMatrix;\n    uniform mat4 ts_ProjectionMatrix;\n    uniform mat4 ts_ModelViewProjectionMatrix;\n    uniform mat4 ts_ModelViewMatrixInverse;\n    uniform mat4 ts_ProjectionMatrixInverse;\n    uniform mat4 ts_ModelViewProjectionMatrixInverse;\n  ".match(/\bts_\w+/g);function s(e,t){const i=r.createShader(e);if(r.shaderSource(i,t),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS)){const n=r.getShaderInfoLog(i),s=o()(n,t,e);throw console.warn(s.long),Object.assign(Error(s.short),{shaderSource:t})}return i}if(this.program=r.createProgram(),r.attachShader(this.program,s(r.VERTEX_SHADER,e)),r.attachShader(this.program,s(r.FRAGMENT_SHADER,t)),r.linkProgram(this.program),!r.getProgramParameter(this.program,r.LINK_STATUS))throw Error("link error: "+r.getProgramInfoLog(this.program));this.attributeLocations={},this.uniformLocations={},this.constantAttributes={},this.activeMatrices={},n&&n.forEach((e=>{r.getUniformLocation(this.program,e)&&(this.activeMatrices[e]=!0)})),this.uniformInfos={};for(let e=r.getProgramParameter(this.program,r.ACTIVE_UNIFORMS);e-- >0;){const t=r.getActiveUniform(this.program,e);this.uniformInfos[t.name]=t}}static create(e,t,r,i){return new M(e,t,r,i)}uniforms(e){const t=this.gl;t.useProgram(this.program);for(const r in e){const n=this.uniformLocations[r]||t.getUniformLocation(this.program,r);if(!n)continue;this.uniformLocations[r]=n;let s=e[r];const o=this.uniformInfos[r];if(i.wU){if(!o)throw Error(`uniform ${r} is not defined (available = ${Object.keys(this.uniformInfos).join(",")})`);t.SAMPLER_2D!=o.type&&t.SAMPLER_CUBE!=o.type&&t.INT!=o.type||(1==o.size?(0,i.hu)(Number.isInteger(s)):(0,i.hu)(I(s)&&s.length==o.size,"value must be int array if info.size != 1")),(0,i.hu)(t.FLOAT!=o.type||1==o.size&&"number"==typeof s||x(s)),(0,i.hu)(t.FLOAT_VEC3!=o.type||1==o.size&&s instanceof i.V3||Array.isArray(s)&&o.size==s.length&&(0,i.nY)(...s)),(0,i.hu)(t.FLOAT_VEC4!=o.type||1!=o.size||x(s)&&4==s.length),(0,i.hu)(t.FLOAT_MAT4!=o.type||s instanceof i.M4,(()=>s.toSource())),(0,i.hu)(t.FLOAT_MAT3!=o.type||9==s.length||s instanceof i.M4)}if(s instanceof i.V3&&(s=s.toArray()),t.FLOAT_VEC4==o.type&&1!=o.size)s instanceof Float32Array||s instanceof Float64Array?t.uniform4fv(n,s instanceof Float32Array?s:Float32Array.from(s)):t.uniform4fv(n,s.flatMap((e=>e)));else if(t.FLOAT==o.type&&1!=o.size)t.uniform1fv(n,s);else if(t.FLOAT_VEC3==o.type&&1!=o.size)t.uniform3fv(n,i.V3.pack(s));else if(s.length)switch(s.length){case 1:t.uniform1fv(n,s);break;case 2:t.uniform2fv(n,s);break;case 3:t.uniform3fv(n,s);break;case 4:t.uniform4fv(n,s);break;case 9:t.uniformMatrix3fv(n,!1,new Float32Array([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]]));break;case 16:t.uniformMatrix4fv(n,!1,new Float32Array([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]]));break;default:throw Error("don't know how to load uniform \""+r+'" of length '+s.length)}else if("number"==typeof s)t.FLOAT===o.type?t.uniform1f(n,s):t.uniform1i(n,s);else if("boolean"==typeof s)t.uniform1i(n,+s);else{if(!(s instanceof i.M4))throw Error('attempted to set uniform "'+r+'" to invalid value '+s);{const e=s.m;if(t.FLOAT_MAT4==o.type)t.uniformMatrix4fv(n,!1,[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]);else if(t.FLOAT_MAT3==o.type)t.uniformMatrix3fv(n,!1,[e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]]);else{if(t.FLOAT_MAT2!=o.type)throw Error("Can't assign M4 to "+o.type);t.uniformMatrix2fv(n,!1,new Float32Array([e[0],e[4],e[1],e[5]]))}}}}return this}attributes(e){const t=this.gl;t.useProgram(this.program);for(const r in e){const n=this.attributeLocations[r]||t.getAttribLocation(this.program,r);if(-1==n){r.startsWith("ts_")||console.warn(`[shader ${this.name}] Vertex buffer ${r} was not bound because the attribute is not active.`);continue}this.attributeLocations[r]=n,t.disableVertexAttribArray(n);let s=e[r];s instanceof i.V3&&(s=s.toArray()),"number"==typeof s?t.vertexAttrib1f(n,s):t.vertexAttrib4fv(n,s),this.constantAttributes[r]=!0}return this}draw(e,t=T.TRIANGLES,r,n){(0,i.hu)(e.hasBeenCompiled,"mesh.hasBeenCompiled"),(0,i.hu)(null!=A[t]);const s=A[t];return this.drawBuffers(e.vertexBuffers,e.indexBuffers[s],t,r,n)}drawBuffers(e,t,r=T.TRIANGLES,n=0,s){const o=this.gl;(0,i.hu)(null!=A[r]),(0,i.OD)((()=>1<=Object.keys(e).length)),Object.keys(e).forEach((t=>(0,i.yP)(c,e[t])));const a=this.activeMatrices,l=(a.ts_ModelViewMatrixInverse||a.ts_NormalMatrix)&&o.modelViewMatrix.inversed(),u=a.ts_ProjectionMatrixInverse&&o.projectionMatrix.inversed(),h=(a.ts_ModelViewProjectionMatrix||a.ts_ModelViewProjectionMatrixInverse)&&o.projectionMatrix.times(o.modelViewMatrix),f={};a.ts_ModelViewMatrix&&this.modelViewMatrixVersion!=o.modelViewMatrixVersion&&(f.ts_ModelViewMatrix=o.modelViewMatrix),a.ts_ModelViewMatrixInverse&&(f.ts_ModelViewMatrixInverse=l),a.ts_ProjectionMatrix&&this.projectionMatrixVersion!=o.projectionMatrixVersion&&(f.ts_ProjectionMatrix=o.projectionMatrix),u&&(f.ts_ProjectionMatrixInverse=u),h&&(f.ts_ModelViewProjectionMatrix=h),h&&a.ts_ModelViewProjectionMatrixInverse&&(f.ts_ModelViewProjectionMatrixInverse=h.inversed()),a.ts_NormalMatrix&&this.modelViewMatrixVersion!=o.modelViewMatrixVersion&&(f.ts_NormalMatrix=l.transposed()),this.uniforms(f),this.projectionMatrixVersion=o.projectionMatrixVersion,this.modelViewMatrixVersion=o.modelViewMatrixVersion;let d=1/0;for(const t in e){const r=e[t];(0,i.hu)(r.hasBeenCompiled);const n=this.attributeLocations[t]||o.getAttribLocation(this.program,t);-1!=n&&r.buffer?(this.attributeLocations[t]=n,o.bindBuffer(T.ARRAY_BUFFER,r.buffer),o.enableVertexAttribArray(n),o.vertexAttribPointer(n,r.spacing,T.FLOAT,!1,0,0),d=Math.min(d,r.count)):t.startsWith("ts_")||console.warn(`[shader ${this.name}] Vertex buffer ${t} was not bound because the attribute is not active.`)}for(const t in this.attributeLocations)t in e||o.disableVertexAttribArray(this.attributeLocations[t]);if(i.wU){const e=o.getProgramParameter(this.program,o.ACTIVE_ATTRIBUTES);for(let t=0;t<e;++t)if(!o.getVertexAttrib(t,o.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING)){const e=o.getActiveAttrib(this.program,t);this.constantAttributes[e.name]||this.outputWarnings[e.name]||(this.outputWarnings[e.name]=!0,console.warn("No buffer is bound to attribute "+e.name+" and it was not set with .attributes()"))}}if(d){if(void 0===s&&(s=t?t.count:d),(0,i.hu)(R[r](s),"count "+s+"doesn't fulfill requirement +"+R[r].toString()+" for mode "+A[r]),t){if((0,i.hu)(t.hasBeenCompiled),(0,i.hu)(d>t.maxValue),(0,i.hu)(s%t.spacing==0),(0,i.hu)(n%t.spacing==0),n+s>t.count)throw Error("Buffer not long enough for passed parameters start/length/buffer length "+n+" "+s+" "+t.count);o.bindBuffer(T.ELEMENT_ARRAY_BUFFER,t.buffer),o.drawElements(r,s,t.bindSize,t.type.BYTES_PER_ELEMENT*n)}else{if(n+s>d)throw Error("invalid");o.drawArrays(r,n,s)}o.drawCallCount++}return this}}class S{constructor(e,t,r={},i=P()){this.gl=i,this.width=e,this.height=t,this.format=r.format||i.RGBA,this.internalFormat=r.internalFormat||i.RGBA,this.type=r.type||i.UNSIGNED_BYTE;const n=r.filter||r.magFilter||i.LINEAR,s=r.filter||r.minFilter||i.LINEAR;if(this.type===i.FLOAT){if(2!=i.version&&!i.getExtension("OES_texture_float"))throw Error("OES_texture_float is required but not supported");if((s!==i.NEAREST||n!==i.NEAREST)&&!i.getExtension("OES_texture_float_linear"))throw Error("OES_texture_float_linear is required but not supported")}else if(this.type===i.HALF_FLOAT_OES){if(!i.getExtension("OES_texture_half_float"))throw Error("OES_texture_half_float is required but not supported");if((s!==i.NEAREST||n!==i.NEAREST)&&!i.getExtension("OES_texture_half_float_linear"))throw Error("OES_texture_half_float_linear is required but not supported")}this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,r.wrap||r.wrapS||i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,r.wrap||r.wrapT||i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,this.internalFormat,e,t,0,this.format,this.type,r.data)}setData(e){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.internalFormat,this.width,this.height,0,this.format,this.type,e)}downloadData(e){if(!this.framebuffer)throw Error("No framebuffer. You need to draw to this texture before it makes sense to read from it.");const t=this.gl,r=t.getParameter(t.FRAMEBUFFER_BINDING);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.readPixels(0,0,this.width,this.height,this.format,this.type,e),r!==this.framebuffer&&t.bindFramebuffer(t.FRAMEBUFFER,r)}bind(e){this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(e){this.gl.activeTexture(this.gl.TEXTURE0+e),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}drawTo(e){const t=this.gl,r=t.getParameter(t.FRAMEBUFFER_BINDING);if(this.framebuffer)r!==this.framebuffer&&t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer);else{const e=t.getParameter(t.RENDERBUFFER_BINDING),r=t.createRenderbuffer();if(t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),t.bindRenderbuffer(t.RENDERBUFFER,e),this.framebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,r),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw Error("Rendering to this texture is not supported (incomplete this.framebuffer)")}const i=t.getParameter(t.VIEWPORT);t.viewport(0,0,this.width,this.height),e(t),r!==this.framebuffer&&t.bindFramebuffer(t.FRAMEBUFFER,r),t.viewport(i[0],i[1],i[2],i[3])}swapWith(e){let t;(0,i.hu)(this.gl==e.gl),t=e.texture,e.texture=this.texture,this.texture=t,t=e.width,e.width=this.width,this.width=t,t=e.height,e.height=this.height,this.height=t,t=e.framebuffer,e.framebuffer=this.framebuffer,this.framebuffer=t}static fromImage(e,t={},r=P()){const i=new S(e.width,e.height,t,r);try{r.texImage2D(r.TEXTURE_2D,0,i.format,i.format,i.type,e)}catch(e){throw"file:"==location.protocol?Error('imgElement not loaded for security reasons (serve this page over "http://" instead)'):Error("imgElement not loaded for security reasons (imgElement must originate from the same domain as this page or use Cross-Origin Resource Sharing)")}return t.minFilter&&t.minFilter!=r.NEAREST&&t.minFilter!=r.LINEAR&&r.generateMipmap(r.TEXTURE_2D),i}static fromURLSwitch(e,t,r=P()){S.checkerBoardCanvas=S.checkerBoardCanvas||function(){const e=document.createElement("canvas").getContext("2d");if(!e)throw Error("Could not create 2d canvas.");e.canvas.width=e.canvas.height=128;for(let t=0;t<e.canvas.height;t+=16)for(let r=0;r<e.canvas.width;r+=16)e.fillStyle=16&(r^t)?"#FFF":"#DDD",e.fillRect(r,t,16,16);return e.canvas}();const i=S.fromImage(S.checkerBoardCanvas,t),n=new Image;return n.onload=()=>S.fromImage(n,t,r).swapWith(i),n.onerror=()=>{throw Error("Could not load image "+n.src+". 404?")},n.src=e,i}static fromURL(e,t,r=P()){return new Promise(((i,n)=>{const s=new Image;s.onload=()=>i(S.fromImage(s,t,r)),s.onerror=e=>n("Could not load image "+s.src+". 404?"+e),s.src=e}))}}const N={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}};let b=null,w=null;function L(){if(null===b){b={},w={};const e=window.WebGL2RenderingContext||window.WebGLRenderingContext;if(!e)throw Error("Neither WebGL2RenderingContext nor WebGLRenderingContext exists on window.");for(const t in e){const r=e[t];"number"==typeof r&&(b[r]=t,w[t]=r)}}}function v(e){L();var t=b[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function F(e,t,r,i){const n=N[e];if(void 0!==n){const e=n[t];if(void 0!==e){const t=e[r];if(t){if("object"==typeof t){const e=t.enumBitwiseOr,r=[];let n=0;for(let t=0;t<e.length;++t){const s=w[e[t]];0!=(i&s)&&(n|=s,r.push(v(s)))}return n===i?r.join(" | "):v(i)}return v(i)}}}return null===i?"null":void 0===i?"undefined":i.toString()}function y(e,t,r){e.__defineGetter__(r,(function(){return t[r]})),e.__defineSetter__(r,(function(e){t[r]=e}))}function B(e,t,r,i=e){L(),t=t||function(e,t,r){var i,n="",s=r.length;for(let e=0;e<s;++e)n+=(0==e?"":", ")+F(t,s,e,r[e]);i="WebGL error "+v(e)+" in "+t+"("+n+")",window.console&&window.console.error?window.console.error(i):function(e){window.console&&window.console.log&&window.console.log(e)}(i)};const n={};function s(e,s){return function(...o){r&&r(s,o);const a=e[s].apply(e,o),l=i.getError();return 0!=l&&(n[l]=!0,t(l,s,o)),a}}const o={};for(let n in e)if("function"==typeof e[n])if("getExtension"!=n)o[n]=s(e,n);else{let a=s(e,n);o[n]=function(){const n=a.apply(e,arguments);return n?B(n,t,r,i):null}}else y(o,e,n);return o.getError=function(){for(const e in n)if(n.hasOwnProperty(e)&&n[e])return n[e]=!1,parseInt(e);return e.NO_ERROR},o}const C=[0,0,0,1];function P(){return V.gl}class V{constructor(e,t={mesh:(new p).addVertexBuffer("coords","ts_TexCoord").addVertexBuffer("colors","ts_Color"),mode:-1,coord:[0,0],color:[1,1,1,1],pointSize:1,shader:M.create("\n        attribute vec4 ts_Color;\n        attribute vec4 ts_Vertex;\n        uniform mat4 ts_ModelViewProjectionMatrix;\n        attribute vec2 ts_TexCoord;\n        uniform float pointSize;\n        varying vec4 color;\n        varying vec2 coord;\n        void main() {\n            color = ts_Color;\n            coord = ts_TexCoord;\n            gl_Position = ts_ModelViewProjectionMatrix * ts_Vertex;\n            gl_PointSize = pointSize;\n        }\n        ","\n        precision highp float;\n        uniform sampler2D texture;\n        uniform float pointSize;\n        // uniform bool useTexture;\n        varying vec4 color;\n        varying vec2 coord;\n        void main() {\n            gl_FragColor = color;\n            // if (useTexture) gl_FragColor *= texture2D(texture, coord.xy);\n        }\n        ",e)}){this.immediate=t,this.modelViewMatrix=i.M4.identity(),this.projectionMatrix=i.M4.identity(),this.tempMatrix=new i.M4,this.resultMatrix=new i.M4,this.modelViewStack=[],this.projectionStack=[],this.drawCallCount=0,this.projectionMatrixVersion=0,this.modelViewMatrixVersion=0,this.cachedSDFMeshes={},this.matrixMode(V.MODELVIEW)}matrixMode(e){switch(e){case this.MODELVIEW:this.currentMatrixName="modelViewMatrix",this.stack=this.modelViewStack;break;case this.PROJECTION:this.currentMatrixName="projectionMatrix",this.stack=this.projectionStack;break;default:throw Error("invalid matrix mode "+e)}}loadIdentity(){i.M4.identity(this[this.currentMatrixName]),"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}loadMatrix(e){i.M4.copy(e,this[this.currentMatrixName]),"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}multMatrix(e){i.M4.multiply(this[this.currentMatrixName],e,this.resultMatrix);const t=this.resultMatrix;this.resultMatrix=this[this.currentMatrixName],this[this.currentMatrixName]=t,"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}mirror(e){this.multMatrix(i.M4.mirror(e))}perspective(e,t,r,n){this.multMatrix(i.M4.perspectiveRad(e*i.Co,t,r,n,this.tempMatrix))}frustum(e,t,r,n,s,o){this.multMatrix(i.M4.frustum(e,t,r,n,s,o,this.tempMatrix))}ortho(e,t,r,n,s,o){this.multMatrix(i.M4.ortho(e,t,r,n,s,o,this.tempMatrix))}scale(...e){this.multMatrix(i.M4.scale(...e,this.tempMatrix))}mirroredX(){this.multMatrix(i.M4.mirror(i.Fw))}translate(e,t,r){void 0!==t?this.multMatrix(i.M4.translate(e,t,r,this.tempMatrix)):this.multMatrix(i.M4.translate(e,this.tempMatrix))}rotate(e,t,r,n){this.multMatrix(i.M4.rotate(e*i.Co,{x:t,y:r,z:n},this.tempMatrix))}lookAt(e,t,r){this.multMatrix(i.M4.lookAt(e,t,r,this.tempMatrix))}pushMatrix(){this.stack.push(i.M4.copy(this[this.currentMatrixName]))}popMatrix(){const e=this.stack.pop();(0,i.hu)(void 0!==e),this[this.currentMatrixName]=e,"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}wcToWindowMatrix(){const e=this.getParameter(this.VIEWPORT),[t,r,n,s]=e,o=new i.M4([n/2,0,0,t+n/2,s/2,0,0,r+s/2,0,0,1,0,0,0,0,1]);return i.M4.product(o,this.projectionMatrix,this.modelViewMatrix)}pointSize(e){this.immediate.shader.uniforms({pointSize:e})}begin(e){if(-1!=this.immediate.mode)throw Error("mismatched viewerGL.begin() and viewerGL.end() calls");this.immediate.mode=e,this.immediate.mesh.colors=[],this.immediate.mesh.coords=[],this.immediate.mesh.vertices=[]}color(...e){var t;this.immediate.color=1==e.length&&Array.isArray(e[0])?e[0]:1==e.length&&"number"==typeof e[0]?[((t=e[0])>>16)/255,(t>>8&255)/255,(255&t)/255,1]:1==e.length&&"string"==typeof e[0]?a.$_(e[0]).gl():[e[0],e[1],e[2],e[3]||1]}texCoord(...e){this.immediate.coord=i.V.apply(void 0,e).toArray(2)}vertex(...e){this.immediate.mesh.colors.push(this.immediate.color),this.immediate.mesh.coords.push(this.immediate.coord),this.immediate.mesh.vertices.push(i.V.apply(void 0,e))}end(){if(-1==this.immediate.mode)throw Error("mismatched viewerGL.begin() and viewerGL.end() calls");this.immediate.mesh.compile(),this.immediate.shader.uniforms({useTexture:!!V.gl.getParameter(this.TEXTURE_BINDING_2D)}).drawBuffers(this.immediate.mesh.vertexBuffers,void 0,this.immediate.mode),this.immediate.mode=-1}makeCurrent(){V.gl=this}animate(e){const t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){setTimeout((()=>e(performance.now())),1e3/60)};let r=performance.now(),i=!0;const n=s=>{i&&(e.call(this,s,s-r),r=s,t(n))};return t(n),()=>{i=!1}}fullscreen(e={}){const t=e.paddingTop||0,r=e.paddingLeft||0,i=e.paddingRight||0,n=e.paddingBottom||0;if(!document.body)throw Error("document.body doesn't exist yet (call viewerGL.fullscreen() from window.onload() or from inside the <body> tag)");return Object.assign(this.canvas.style,{position:"absolute",left:r+"px",top:t+"px",width:window.innerWidth-r-i+"px",height:window.innerHeight-t-n+"px"}),this.addResizeListener(),this}addResizeListener(e={}){const t=this;function r(){const r=t.canvas.getBoundingClientRect();t.canvas.width=r.width*window.devicePixelRatio,t.canvas.height=r.height*window.devicePixelRatio,t.viewport(0,0,t.canvas.width,t.canvas.height),e.camera&&(t.matrixMode(V.PROJECTION),t.loadIdentity(),t.perspective(e.fov||45,t.canvas.width/t.canvas.height,e.near||.1,e.far||1e3),t.matrixMode(V.MODELVIEW))}return window.addEventListener("resize",r),r(),this}getMouseLine(e,t){if(e instanceof MouseEvent)return this.getMouseLine(e.offsetX,e.offsetY);const r=(0,i.V)(2*e/this.canvas.offsetWidth-1,2*-t/this.canvas.offsetHeight+1,0),n=(0,i.V)(2*e/this.canvas.offsetWidth-1,2*-t/this.canvas.offsetHeight+1,1),s=this.projectionMatrix.inversed(),o=s.transformPoint(r);return{anchor:o,dir:s.transformPoint(n).minus(o)}}viewportFill(){this.viewport(0,0,this.canvas.width,this.canvas.height)}setupTextRendering(e,t){return n(this,void 0,void 0,(function*(){this.textRenderShader=M.create("attribute vec2 ts_TexCoord;attribute vec4 ts_Vertex;uniform mat4 ts_ModelViewProjectionMatrix;varying vec2 coord;void main(){coord=ts_TexCoord.xy;gl_Position=ts_ModelViewProjectionMatrix*ts_Vertex;}","precision mediump float;uniform sampler2D u_texture;uniform vec4 u_color;uniform float u_buffer;uniform float u_gamma;uniform float u_debug;varying vec2 coord;void main(){float dist=texture2D(u_texture,coord).r;if(u_debug>0.0){gl_FragColor=vec4(dist,dist,dist,1);}else{float alpha=smoothstep(u_buffer-u_gamma,u_buffer+u_gamma,dist);gl_FragColor=vec4(u_color.rgb,alpha*u_color.a);if(gl_FragColor.a==0.0){discard;}}}"),[this.textAtlas,this.textMetrics]=yield Promise.all([S.fromURL(e,{format:this.LUMINANCE,internalFormat:this.LUMINANCE,type:this.UNSIGNED_BYTE}),fetch(t).then((e=>e.json()))])}))}getSDFMeshForString(e){return(0,i.hu)(this.textMetrics),this.cachedSDFMeshes[e]||(this.cachedSDFMeshes[e]=function(e,t,r,n=1){const s=(new p).addIndexBuffer("TRIANGLES").addVertexBuffer("coords","ts_TexCoord");let o=0,a=0;function l(r){const n=e.chars[r];if(!n)return;const[l,c,u,h,f,d,E]=n,{size:m,buffer:_}=e,g=s.vertices.length;if(l>0&&c>0){const e=(o+u-_)/m,r=(o+u+l+_)/m,n=(h-c-_)/m,f=(h+_)/m;s.vertices.push(new i.V3(e,n,a/m),new i.V3(r,n,a/m),new i.V3(e,f,a/m),new i.V3(r,f,a/m));const p=d/t.width,T=(d+l+2*_)/t.width,A=(E+c+2*_)/t.height,R=E/t.height;s.coords.push([p,A],[T,A],[p,R],[T,R]),U(s.TRIANGLES,!1,g,g+1,g+2,g+3)}o+=f}for(let t=0;t<r.length;t++){const i=r[t];"\n"==i?(o=0,a+=n*e.size):l(i)}return Object.assign(s.compile(),{width:o/e.size,lineCount:a+1})}(this.textMetrics,this.textAtlas,e))}renderText(e,t,r=1,n="left",s="bottom",o=.05,a=1.2){const l=this.getSDFMeshForString(e);this.pushMatrix(),this.scale(r);const c={top:-this.textMetrics.ascender/this.textMetrics.size,middle:(-this.textMetrics.ascender-this.textMetrics.descender)/2/this.textMetrics.size,alphabetic:0,bottom:-this.textMetrics.descender/this.textMetrics.size};this.translate({left:0,center:-.5,right:-1}[n]*l.width,c[s],0),this.multMatrix(i.M4.forSys(i.V3.X,i.V3.Y,new i.V3(0,-a,0))),this.textAtlas.bind(0),this.textRenderShader.uniforms({texture:0,u_color:t,u_debug:0,u_gamma:o,u_buffer:.75}).draw(l),this.popMatrix()}static create(e={}){const t=e.canvas||document.createElement("canvas");let r;e.canvas||(t.width=800,t.height=600),"alpha"in e||(e.alpha=!1);try{r=t.getContext("webgl2",e),r&&(r.version=2),r||(r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),r&&(r.version=1))}catch(e){console.log(e,"Failed to get context")}if(!r)throw Error("WebGL not supported");return e.throwOnError&&(r=B(r,((e,t)=>{throw Error(v(e)+" was caused by "+t)}))),V.gl=r,(0,i.zy)(r,V.prototype),(0,i.zy)(r,new V(r)),r}fixCanvasRes(e=1/0){this.canvas.width=this.canvas.clientWidth*Math.min(window.devicePixelRatio,e),this.canvas.height=this.canvas.clientHeight*Math.min(window.devicePixelRatio,e),this.viewport(0,0,this.canvas.width,this.canvas.height)}drawVector(e,t,r=C,n=1){if(e.likeO())return;this.pushMatrix();const s=4*n;if(s>e.length())return;const o=e.getPerpendicular().unit();this.multMatrix(i.M4.forSys(e.unit(),o,e.cross(o).unit(),t)),this.scale(e.length()-s,n/2,n/2),this.shaders.singleColor.uniforms({color:r}).draw(this.meshes.vectorShaft),this.scale(1/(e.length()-s),1,1),this.translate(e.length()-s,0,0),this.scale(s/2,1,1),this.shaders.singleColor.draw(this.meshes.vectorHead),this.popMatrix()}}var O;function U(e,t,r,i,n,s){t?e.push(r,n,i,i,n,s):e.push(r,i,n,i,s,n)}V.MODELVIEW=0,V.PROJECTION=1,V.HALF_FLOAT_OES=36193,(O||(O={})).create=V.create,V.prototype.MODELVIEW=V.MODELVIEW,V.prototype.PROJECTION=V.PROJECTION,V.prototype.HALF_FLOAT_OES=V.HALF_FLOAT_OES}}]);
//# sourceMappingURL=4.js.map