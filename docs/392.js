(self.webpackChunkworkshop=self.webpackChunkworkshop||[]).push([[392],{9392:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "lW": () => (/* binding */ E),\n/* harmony export */   "Kj": () => (/* binding */ P),\n/* harmony export */   "ex": () => (/* binding */ D),\n/* harmony export */   "ZG": () => (/* binding */ ot),\n/* harmony export */   "xE": () => (/* binding */ U),\n/* harmony export */   "Qu": () => (/* binding */ rt)\n/* harmony export */ });\n/* unused harmony exports GL_COLOR_BLACK, SHADER_VAR_TYPES, TSGLContextBase, glEnumToString, glFunctionArgToString, glFunctionArgsToString, init, isArray, isNumber, isWebGL2RenderingContext, makeDebugContext, makeLostContextSimulatingCanvas, mightBeEnum, pushQuad, resetToInitialState */\n/* harmony import */ var ts3dutils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(2182);\n/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(8149);\n/* harmony import */ var gl_format_compiler_error__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(5416);\n/* harmony import */ var gl_format_compiler_error__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(gl_format_compiler_error__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var chroma_ts__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(7769);\nconst y=WebGLRenderingContext;class E{constructor(e,r){this.target=e,this.type=r,this.buffer=void 0,this.data=[],this.count=0,this.spacing=1,this.hasBeenCompiled=!1,(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(e==y.ARRAY_BUFFER||e==y.ELEMENT_ARRAY_BUFFER,"target == WGL.ARRAY_BUFFER || target == WGL.ELEMENT_ARRAY_BUFFER"),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(r==Float32Array||r==Uint16Array||r==Uint32Array,"type == Float32Array || type == Uint16Array || type == Uint32Array"),Uint16Array==r?this.bindSize=y.UNSIGNED_SHORT:Uint32Array==r&&(this.bindSize=y.UNSIGNED_INT)}compile(i=y.STATIC_DRAW,n=rt()){let o;if((0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(y.STATIC_DRAW==i||y.DYNAMIC_DRAW==i,"WGL.STATIC_DRAW == type || WGL.DYNAMIC_DRAW == type"),this.buffer=this.buffer||n.createBuffer(),0==this.data.length&&console.warn("empty buffer "+this.name),0==this.data.length||this.data[0]instanceof ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3)(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(!(this.data[0]instanceof ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3)||this.type==Float32Array),ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.pack(this.data,o=new this.type(3*this.data.length)),this.spacing=3,this.count=this.data.length,this.maxValue=0;else{if(Array.isArray(this.data[0])){const e=this.data.length*this.data[0].length;o=new this.type(e);let r=this.data.length,i=e;for(;r--;){const t=this.data[r];let e=t.length;for(;e--;)o[--i]=t[e]}(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(0==i)}else o=new this.type(this.data);const e=this.data.length?o.length/this.data.length:0;(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(e%1==0,`buffer ${this.name} elements not of consistent size, average size is `+e),ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .NLA_DEBUG */ .wU&&(1e4<=o.length?this.maxValue=0:this.maxValue=Math.max.apply(void 0,o)),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)([1,2,3,4].includes(e)),this.spacing=e,this.count=this.data.length}n.bindBuffer(this.target,this.buffer),n.bufferData(this.target,o,i),this.hasBeenCompiled=!0}}const{cos:A,sin:S,PI:T,min:v,max:F}=Math,L=WebGLRenderingContext,I=new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4,N=new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4;class P extends ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .Transformable */ .yu{constructor(){super(),this.hasBeenCompiled=!1,this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","ts_Vertex")}calcVolume(){let t=0,r=ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.O,i=0;const n=this.TRIANGLES,s=this.vertices;for(let o=0;o<n.length;o+=3){const a=n[o+0],c=n[o+1],h=n[o+2],f=s[a],u=s[c],l=s[h],m=u.minus(f),d=l.minus(f),w=m.cross(d);t+=ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.add(f,u,l).div(3).z*w.z,i+=w.length();const b=ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.add(f.times(2*f.z+u.z+l.z),u.times(f.z+2*u.z+l.z),l.times(f.z+u.z+2*l.z)).times(w.z);r=r.plus(b)}const a=t/2;return{volume:a,centroid:(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .eq0 */ .p3)(a)?ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.O:r.div(24*a).schur(new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(1,1,.5)),area:i/2}}addVertexBuffer(e,r){return (0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(!this.vertexBuffers[r],"Buffer "+r+" already exists."),this.hasBeenCompiled=!1,(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)("string"==typeof e),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)("string"==typeof r),(this.vertexBuffers[r]=new E(L.ARRAY_BUFFER,Float32Array)).name=e,this[e]=[],this}addIndexBuffer(t,e=L.UNSIGNED_SHORT){this.hasBeenCompiled=!1;const r=L.UNSIGNED_SHORT==e?Uint16Array:Uint32Array;return(this.indexBuffers[t]=new E(L.ELEMENT_ARRAY_BUFFER,r)).name=t,this[t]=[],this}concat(...e){const r=new P,i=[this].concat(e);return Object.getOwnPropertyNames(this.vertexBuffers).forEach((n=>{(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(e.every((t=>!!t.vertexBuffers[n])));const o=this.vertexBuffers[n].name;"ts_Vertex"!==n&&r.addVertexBuffer(o,n),r[o]=[].concat(...i.map((t=>t[o])))})),Object.getOwnPropertyNames(this.indexBuffers).forEach((n=>{(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(e.every((t=>!!t.indexBuffers[n]))),r.addIndexBuffer(n,this.indexBuffers[n].bindSize);const o=Array(i.reduce(((t,e)=>t+e[n].length),0));let s=0,a=0;for(const t of i){for(const e of t[n])o[s++]=a+e;a+=t.vertices.length}r[n]=o})),r.compile(),r}compile(t=rt()){let e=1/0;Object.getOwnPropertyNames(this.vertexBuffers).forEach((r=>{const i=this.vertexBuffers[r];i.data=this[i.name],i.compile(void 0,t),this[i.name].length<e&&(e=this[i.name].length)}));for(const e in this.indexBuffers){const r=this.indexBuffers[e];r.data=this[r.name],r.compile(void 0,t)}return this.hasBeenCompiled=!0,this}static fromBinarySTL(t){return (0,tslib__WEBPACK_IMPORTED_MODULE_3__/* .__awaiter */ .mG)(this,void 0,void 0,(function*(){return new Promise(((r,i)=>{const n=(new P).addVertexBuffer("normals","ts_Normal"),o=new FileReader;o.onerror=i,o.onload=function(t){const i=new DataView(this.result),o=i.getUint32(80,!0);n.normals.length=3*o,n.vertices.length=3*o;let s=3*o,a=84;function c(){const t=i.getFloat32(a,!0);a+=4;const r=i.getFloat32(a,!0);a+=4;const n=i.getFloat32(a,!0);return a+=4,new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(t,r,n)}for(;s;){s-=3;const t=c();n.normals[s+0]=t,n.normals[s+1]=t,n.normals[s+2]=t,n.vertices[s+0]=c(),n.vertices[s+1]=c(),n.vertices[s+2]=c(),a+=2}r(n)},o.readAsArrayBuffer(t)}))}))}toBinarySTL(){if(!this.TRIANGLES)throw Error("TRIANGLES must be defined.");const r=this.TRIANGLES,i=r.length/3,n=new ArrayBuffer(84+50*i),o=new DataView(n);o.setUint32(80,i,!0);let s=84,a=r.length;for(;a;){a-=3;const t=this.vertices[r[a]],i=this.vertices[r[a+1]],n=this.vertices[r[a+2]];[ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.normalOnPoints(t,i,n),t,i,n].forEach((t=>{o.setFloat32(s,t.x,!0),s+=4,o.setFloat32(s,t.y,!0),s+=4,o.setFloat32(s,t.z,!0),s+=4})),s+=2}return (0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(s==n.byteLength,s+" "+n.byteLength),new Blob([n],{type:"application/octet-stream"})}transform(t){const e=new P;if(e.vertices=t.transformedPoints(this.vertices),this.normals){e.addVertexBuffer("normals","ts_Normal");const r=t.as3x3(I).inversed(N).transposed(I);e.normals=this.normals.map((t=>r.transformVector(t).unit()))}for(const t in this.indexBuffers)e.addIndexBuffer(t),e[t]=this[t];for(const t in this.vertexBuffers)if("ts_Vertex"!==t&&"ts_Normal"!==t){const r=this.vertexBuffers[t].name;e.addVertexBuffer(r,t),e[r]=this[r]}return e}computeNormalsFromFlatTriangles(){this.normals||this.addVertexBuffer("normals","ts_Normal");const t=this.TRIANGLES,e=this.vertices,r=this.normals;r.length=e.length;for(let i=0;i<t.length;i+=3){const n=t[i],o=t[i+1],s=t[i+2],a=e[n],c=e[o],h=e[s],f=c.minus(a).cross(h.minus(a)).unit();r[n]=r[n]?r[n].plus(f):f,r[o]=r[o]?r[o].plus(f):f,r[s]=r[s]?r[s].plus(f):f}for(let t=0;t<e.length;t++)r[t]=r[t].unit();return this.hasBeenCompiled=!1,this}computeWireframeFromFlatTriangles(t="LINES"){if(!this.TRIANGLES)throw Error("TRIANGLES must be defined.");const e=new Set;function r(t,e){return v(t,e)<<16|F(t,e)}const i=this.TRIANGLES;for(let t=0;t<i.length;t+=3)e.add(r(i[t+0],i[t+1])),e.add(r(i[t+1],i[t+2])),e.add(r(i[t+2],i[t+0]));const n=t;return this[n]||this.addIndexBuffer(t),e.forEach((t=>this[n].push(t>>16,65535&t))),this.hasBeenCompiled=!1,this}computeWireframeFromFlatTrianglesClosedMesh(t="LINES"){if(!this.TRIANGLES)throw Error("TRIANGLES must be defined.");this.LINES||this.addIndexBuffer("LINES");const e=this.TRIANGLES;this[t]||this.addIndexBuffer(t);const r=this[t];for(let t=0;t<e.length;t+=3)e[t+0]<e[t+1]&&r.push(e[t+0],e[t+1]),e[t+1]<e[t+2]&&r.push(e[t+1],e[t+2]),e[t+2]<e[t+0]&&r.push(e[t+2],e[t+0]);return this.hasBeenCompiled=!1,this}computeNormalLines(t=1,e="LINES"){if(!this.normals)throw Error("normals must be defined.");const r=this.vertices,i=this.vertices.length;this[e]||this.addIndexBuffer(e);for(let n=0;n<this.normals.length;n++)r[i+n]=r[n].plus(this.normals[n].toLength(t)),this[e].push(i+n,n);return this.hasBeenCompiled=!1,this}getAABB(){return(new ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .AABB */ .mN).addPoints(this.vertices)}getBoundingSphere(){const t={center:this.getAABB().getCenter(),radius:0};for(let e=0;e<this.vertices.length;e++)t.radius=Math.max(t.radius,this.vertices[e].minus(t.center).length());return t}static plane(t={}){const r=t.detailX||t.detail||1,i=t.detailY||t.detail||1,n=t.startX||0,o=t.startY||0,s=t.width||1,a=t.height||1,c=(new P).addIndexBuffer("LINES").addIndexBuffer("TRIANGLES").addVertexBuffer("normals","ts_Normal").addVertexBuffer("coords","ts_TexCoord");for(let t=0;t<=i;t++){const h=t/i;for(let f=0;f<=r;f++){const u=f/r;if(c.vertices.push(new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(n+u*s,o+h*a,0)),c.coords.push([u,h]),c.normals.push(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Z),f<r&&t<i){const e=f+t*(r+1);c.TRIANGLES.push(e,e+1,e+r+1,e+r+1,e+1,e+r+2)}}}for(let t=0;t<r;t++)c.LINES.push(t,t+1),c.LINES.push((r+1)*i+t,(r+1)*i+t+1);for(let t=0;t<i;t++)c.LINES.push(r*t,r*(t+1)+1),c.LINES.push(r*(t+1),r*(t+2)+1);return c.compile(),c}static box(t=1,r=1,n=1){const o=(new P).addIndexBuffer("LINES").addIndexBuffer("TRIANGLES").addVertexBuffer("normals","ts_Normal");o.vertices.length=o.normals.length=2*((t+1)*(r+1)+(r+1)*(n+1)+(n+1)*(t+1)),o.TRIANGLES.length=4*(t*r+r*n+n*t);let s=0,a=0;function c(t,r,i,n=0,c=1,h=0,f=1){const u=i.transformVector(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Z);for(let l=0;l<=r;l++){const m=l/r;for(let d=0;d<=t;d++){const w=d/t;if(o.vertices[s]=i.transformPoint(new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(n+w*c,h+m*f,0)),o.normals[s]=u,s++,d<t&&l<r){const e=d+l*(t+1);o.TRIANGLES[a++]=e,o.TRIANGLES[a++]=e+t+1,o.TRIANGLES[a++]=e+1,o.TRIANGLES[a++]=e+t+1,o.TRIANGLES[a++]=e+t+2,o.TRIANGLES[a++]=e+1}}}}return c(r,t,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.forSys(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Y,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.X,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Z.negated())),c(t,r,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.translate(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Z)),c(n,r,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.forSys(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Z,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Y,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.X.negated())),c(r,n,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.forSys(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Y,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Z,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.X,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.X)),c(t,n,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.forSys(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.X,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Z,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Y.negated())),c(n,t,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.forSys(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Z,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.X,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Y,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Y)),o}static cube(){const t=(new P).addVertexBuffer("normals","ts_Normal").addIndexBuffer("TRIANGLES").addIndexBuffer("LINES"),r=[[0,4,6,2],[1,3,7,5],[0,1,5,4],[2,6,7,3],[0,2,3,1],[4,5,7,6]],i=[ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.X.negated(),ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.X,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Y.negated(),ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Y,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Z.negated(),ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Z];for(let e=0;e<6;e++)st(t.TRIANGLES,!0,t.vertices.length,t.vertices.length+1,t.vertices.length+3,t.vertices.length+2),t.vertices.push(...r[e].map((t=>P.UNIT_CUBE_CORNERS[t]))),t.normals.push(i[e],i[e],i[e],i[e]);return t.LINES=[[0,1],[0,2],[1,3],[2,3],[0,4],[1,5],[2,6],[3,7],[4,5],[4,6],[5,7],[6,7]].flatMap((t=>t)).map((t=>{let e=0;return 4*r.findIndex((r=>-1!=(e=r.indexOf(t))))+e})),t.compile(),t}static isocahedron(){return P.sphere(0)}static sphere2(t,r){const i=(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .arrayFromFunction */ .Nv)(t,(r=>{const i=r/(t-1)*T-T/2;return new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(0,A(i),S(i))})),n=(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .arrayFromFunction */ .Nv)(t,(e=>{const r=A(e/(t-1)*T-T/2);return[e/(t-1)*r,r]}));return P.rotation(i,{anchor:ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.O,dir1:ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Z},2*T,r,!0,i,n)}static sphere(t=3){const r=new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(1,1.618033988749895,0).unit(),i=r.x,n=r.y,o=[new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(-i,n,0),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(i,n,0),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(-i,-n,0),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(i,-n,0),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(0,-i,n),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(0,i,n),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(0,-i,-n),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(0,i,-n),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(n,0,-i),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(n,0,i),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(-n,0,-i),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(-n,0,i)],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];function a(t,e,r,i,n,o,s,c,h,f){if(0==i)o.push(s,c,h),s<c&&f.push(s,c),c<h&&f.push(c,h),h<s&&f.push(h,s);else{const u=t.plus(e).toLength(1),l=e.plus(r).toLength(1),m=r.plus(t).toLength(1),d=n.length,w=d+1,b=d+2;n.push(u,l,m),a(u,l,m,i-1,n,o,d,w,b,f),a(t,u,m,i-1,n,o,s,d,b,f),a(e,l,u,i-1,n,o,c,w,d,f),a(r,m,l,i-1,n,o,h,b,w,f)}}const c=(new P).addVertexBuffer("normals","ts_Normal").addIndexBuffer("TRIANGLES").addIndexBuffer("LINES");c.vertices.push(...o),t=null==t?4:t;for(let e=0;e<20;e++){const[r,i,n]=s.slice(3*e,3*e+3);a(o[r],o[i],o[n],t,c.vertices,c.TRIANGLES,r,i,n,c.LINES)}return c.normals=c.vertices,c.compile(),c}static aabb(t){const r=ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.product(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.translate(t.min),ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.scale(t.size().max(new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .NLA_PRECISION */ .bE,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .NLA_PRECISION */ .bE,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .NLA_PRECISION */ .bE)))),n=P.cube().transform(r);return n.computeNormalLines(20),n.compile(),n}static offsetVertices(t,e,r,i){ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assertVectors.apply */ .nY.apply(void 0,t),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assertVectors */ .nY)(e);const n=(new P).addIndexBuffer("TRIANGLES").addVertexBuffer("coords","ts_TexCoord");i&&n.addVertexBuffer("normals","ts_Normal"),n.vertices=t.concat(t.map((t=>t.plus(e))));const o=t.length;n.coords=(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .arrayFromFunction */ .Nv)(2*o,(t=>[t%o/o,t/o|0]));const s=n.TRIANGLES;for(let e=0;e<t.length-1;e++)st(s,!1,e,e+1,t.length+e,t.length+e+1);return r&&st(s,!1,t.length-1,0,2*t.length-1,t.length),i&&(n.normals=i.concat(i)),n.compile(),n}static rotation(t,e,r,n,o=!0,s,a){const c=(new P).addIndexBuffer("TRIANGLES");s&&c.addVertexBuffer("normals","ts_Normal"),a&&c.addVertexBuffer("coordsUVQ","ts_TexCoordUVQ");const h=t.length,f=h*n,u=new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4,l=c.TRIANGLES;for(let m=0;m<n;m++){const d=r*(m/n);if(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.rotateLine(e.anchor,e.dir1,d,u),c.vertices.push(...u.transformedPoints(t)),s&&c.normals.push(...u.transformedVectors(s)),a&&c.coordsUVQ.push(...a.map((([t,e])=>[m/n*e,t,e]))),o||m!==n-1)for(let t=0;t<h-1;t++)st(l,!1,m*h+t+1,m*h+t,((m+1)*h+t+1)%f,((m+1)*h+t)%f)}return c.compile(),c}static spiral(t,e,r,n,o,s,a){const c=(new P).addIndexBuffer("TRIANGLES");s&&c.addVertexBuffer("normals","ts_Normal"),a&&c.addVertexBuffer("coordsUVQ","ts_TexCoordUVQ");const h=t.length,u=h*n,l=new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4,m=c.TRIANGLES;for(let d=0;d<n;d++){const w=r*(d/n);if(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.rotateLine(e.anchor,e.dir1,w,l),c.vertices.push(...l.translate(e.dir1.toLength(r/ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .TAU */ .gc*(d/n)*o)).transformedPoints(t)),s&&c.normals.push(...l.transformedVectors(s)),a&&c.coordsUVQ.push(...a.map((([t,e])=>[d/n*e,t,e]))),d!==n-1)for(let t=0;t<h-1;t++)st(m,!1,d*h+t+1,d*h+t,((d+1)*h+t+1)%u,((d+1)*h+t)%u)}return c.compile(),c}static parametric(t,e,r,i,n,o,s,a){const c=(new P).addIndexBuffer("TRIANGLES").addVertexBuffer("normals","ts_Normal");for(let h=0;h<=s;h++){const f=(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .lerp */ .t7)(r,i,h/s);for(let r=0;r<=a;r++){const i=(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .lerp */ .t7)(n,o,r/a);if(c.vertices.push(t(f,i)),e&&c.normals.push(e(f,i)),r<a&&h<s){const t=r+h*(a+1);st(c.TRIANGLES,!1,t,t+a+1,t+1,t+a+2)}}}return c}static load(t){const e=new P;if(!Array.isArray(t.vertices[0]))throw Error();return e.vertices=t.vertices.map((t=>(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V)(t))),t.triangles&&(e.addIndexBuffer("TRIANGLES"),e.TRIANGLES=t.triangles),t.normals&&(e.addVertexBuffer("normals","ts_Normal"),e.normals=t.normals),e.compile(),e}toJSON(){return{vertices:this.vertices.map((t=>t.toArray())),TRIANGLES:this.TRIANGLES}}}P.UNIT_CUBE_CORNERS=[ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.O,new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(0,0,1),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(0,1,0),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(0,1,1),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(1,0,0),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(1,0,1),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(1,1,0),ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.XYZ];const R=WebGLRenderingContext,M={[R.POINTS]:"POINTS",[R.LINES]:"LINES",[R.LINE_STRIP]:"LINE_STRIP",[R.LINE_LOOP]:"LINE_LOOP",[R.TRIANGLES]:"TRIANGLES",[R.TRIANGLE_STRIP]:"TRIANGLE_STRIP",[R.TRIANGLE_FAN]:"TRIANGLE_FAN"},B={[R.POINTS]:t=>!0,[R.LINES]:t=>0==t%2,[R.LINE_STRIP]:t=>t>2,[R.LINE_LOOP]:t=>t>2,[R.TRIANGLES]:t=>0==t%3,[R.TRIANGLE_STRIP]:t=>t>3,[R.TRIANGLE_FAN]:t=>t>3},C=(/* unused pure expression or super */ null && (["FLOAT","FLOAT_MAT2","FLOAT_MAT3","FLOAT_MAT4","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","INT","INT_VEC2","INT_VEC3","INT_VEC4","UNSIGNED_INT"]));function G(t){return Array==t.constructor||Float32Array==t.constructor||Float64Array==t.constructor}function O(t){return Float32Array==t.constructor||Float64Array==t.constructor||Array.isArray(t)&&t.every((t=>"number"==typeof t))}function V(t){return!![Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array].some((e=>t instanceof e))||(t instanceof Float32Array||t instanceof Float64Array||Array.isArray(t))&&t.every((t=>Number.isInteger(t)))}class D{constructor(t,e,r=rt(),i){this.gl=r,this.name=i,this.projectionMatrixVersion=-1,this.modelViewMatrixVersion=-1,this.outputWarnings={};const n="\\n    uniform mat3 ts_NormalMatrix;\\n    uniform mat4 ts_ModelViewMatrix;\\n    uniform mat4 ts_ProjectionMatrix;\\n    uniform mat4 ts_ModelViewProjectionMatrix;\\n    uniform mat4 ts_ModelViewMatrixInverse;\\n    uniform mat4 ts_ProjectionMatrixInverse;\\n    uniform mat4 ts_ModelViewProjectionMatrixInverse;\\n  ".match(/\\bts_\\w+/g);function o(t,e){const i=r.createShader(t);if(r.shaderSource(i,e),r.compileShader(i),!r.getShaderParameter(i,r.COMPILE_STATUS)){const n=r.getShaderInfoLog(i),o=gl_format_compiler_error__WEBPACK_IMPORTED_MODULE_1___default()(n,e,t);throw console.warn(o.long),Object.assign(Error(o.short),{shaderSource:e})}return i}if(this.program=r.createProgram(),r.attachShader(this.program,o(r.VERTEX_SHADER,t)),r.attachShader(this.program,o(r.FRAGMENT_SHADER,e)),r.linkProgram(this.program),!r.getProgramParameter(this.program,r.LINK_STATUS))throw Error("link error: "+r.getProgramInfoLog(this.program));this.attributeLocations={},this.uniformLocations={},this.constantAttributes={},this.activeMatrices={},n&&n.forEach((t=>{r.getUniformLocation(this.program,t)&&(this.activeMatrices[t]=!0)})),this.uniformInfos={};for(let t=r.getProgramParameter(this.program,r.ACTIVE_UNIFORMS);t-- >0;){const e=r.getActiveUniform(this.program,t);this.uniformInfos[e.name]=e}}static create(t,e,r,i){return new D(t,e,r,i)}uniforms(n){const o=this.gl;o.useProgram(this.program);for(const s in n){const a=this.uniformLocations[s]||o.getUniformLocation(this.program,s);if(!a)continue;this.uniformLocations[s]=a;let c=n[s];const f=this.uniformInfos[s];if(ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .NLA_DEBUG */ .wU){if(!f)throw Error(`uniform ${s} is not defined (available = ${Object.keys(this.uniformInfos).join(",")})`);o.SAMPLER_2D!=f.type&&o.SAMPLER_CUBE!=f.type&&o.INT!=f.type||(1==f.size?(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(Number.isInteger(c)):(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(V(c)&&c.length==f.size,"value must be int array if info.size != 1")),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(o.FLOAT!=f.type||1==f.size&&"number"==typeof c||O(c)),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(o.FLOAT_VEC3!=f.type||1==f.size&&c instanceof ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3||Array.isArray(c)&&f.size==c.length&&(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assertVectors */ .nY)(...c)),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(o.FLOAT_VEC4!=f.type||1!=f.size||O(c)&&4==c.length),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(o.FLOAT_MAT4!=f.type||c instanceof ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4,(()=>c.toSource())),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(o.FLOAT_MAT3!=f.type||9==c.length||c instanceof ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4)}if(c instanceof ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3&&(c=c.toArray()),o.FLOAT_VEC4==f.type&&1!=f.size)c instanceof Float32Array||c instanceof Float64Array?o.uniform4fv(a,c instanceof Float32Array?c:Float32Array.from(c)):o.uniform4fv(a,c.flatMap((t=>t)));else if(o.FLOAT==f.type&&1!=f.size)o.uniform1fv(a,c);else if(o.FLOAT_VEC3==f.type&&1!=f.size)o.uniform3fv(a,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.pack(c));else if(c.length)switch(c.length){case 1:o.uniform1fv(a,c);break;case 2:o.uniform2fv(a,c);break;case 3:o.uniform3fv(a,c);break;case 4:o.uniform4fv(a,c);break;case 9:o.uniformMatrix3fv(a,!1,new Float32Array([c[0],c[3],c[6],c[1],c[4],c[7],c[2],c[5],c[8]]));break;case 16:o.uniformMatrix4fv(a,!1,new Float32Array([c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14],c[3],c[7],c[11],c[15]]));break;default:throw Error("don\'t know how to load uniform \\""+s+\'" of length \'+c.length)}else if("number"==typeof c)o.FLOAT===f.type?o.uniform1f(a,c):o.uniform1i(a,c);else if("boolean"==typeof c)o.uniform1i(a,+c);else{if(!(c instanceof ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4))throw Error(\'attempted to set uniform "\'+s+\'" to invalid value \'+c);{const t=c.m;if(o.FLOAT_MAT4==f.type)o.uniformMatrix4fv(a,!1,[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]);else if(o.FLOAT_MAT3==f.type)o.uniformMatrix3fv(a,!1,[t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]]);else{if(o.FLOAT_MAT2!=f.type)throw Error("Can\'t assign M4 to "+f.type);o.uniformMatrix2fv(a,!1,new Float32Array([t[0],t[4],t[1],t[5]]))}}}}return this}attributes(t){const r=this.gl;r.useProgram(this.program);for(const i in t){const n=this.attributeLocations[i]||r.getAttribLocation(this.program,i);if(-1==n){i.startsWith("ts_")||console.warn(`[shader ${this.name}] Vertex buffer ${i} was not bound because the attribute is not active.`);continue}this.attributeLocations[i]=n,r.disableVertexAttribArray(n);let o=t[i];o instanceof ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3&&(o=o.toArray()),"number"==typeof o?r.vertexAttrib1f(n,o):r.vertexAttrib4fv(n,o),this.constantAttributes[i]=!0}return this}draw(e,r=R.TRIANGLES,i,n){(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(e.hasBeenCompiled,"mesh.hasBeenCompiled"),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(null!=M[r]);const o=M[r];return this.drawBuffers(e.vertexBuffers,e.indexBuffers[o],r,i,n)}drawBuffers(e,i,n=R.TRIANGLES,o=0,s){const a=this.gl;(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(null!=M[n]),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assertf */ .OD)((()=>1<=Object.keys(e).length)),Object.keys(e).forEach((t=>(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assertInst */ .yP)(E,e[t])));const c=this.activeMatrices,h=(c.ts_ModelViewMatrixInverse||c.ts_NormalMatrix)&&a.modelViewMatrix.inversed(),f=c.ts_ProjectionMatrixInverse&&a.projectionMatrix.inversed(),u=(c.ts_ModelViewProjectionMatrix||c.ts_ModelViewProjectionMatrixInverse)&&a.projectionMatrix.times(a.modelViewMatrix),l={};c.ts_ModelViewMatrix&&this.modelViewMatrixVersion!=a.modelViewMatrixVersion&&(l.ts_ModelViewMatrix=a.modelViewMatrix),c.ts_ModelViewMatrixInverse&&(l.ts_ModelViewMatrixInverse=h),c.ts_ProjectionMatrix&&this.projectionMatrixVersion!=a.projectionMatrixVersion&&(l.ts_ProjectionMatrix=a.projectionMatrix),f&&(l.ts_ProjectionMatrixInverse=f),u&&(l.ts_ModelViewProjectionMatrix=u),u&&c.ts_ModelViewProjectionMatrixInverse&&(l.ts_ModelViewProjectionMatrixInverse=u.inversed()),c.ts_NormalMatrix&&this.modelViewMatrixVersion!=a.modelViewMatrixVersion&&(l.ts_NormalMatrix=h.transposed()),this.uniforms(l),this.projectionMatrixVersion=a.projectionMatrixVersion,this.modelViewMatrixVersion=a.modelViewMatrixVersion;let w=1/0;for(const r in e){const i=e[r];(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(i.hasBeenCompiled);const n=this.attributeLocations[r]||a.getAttribLocation(this.program,r);-1!=n&&i.buffer?(this.attributeLocations[r]=n,a.bindBuffer(R.ARRAY_BUFFER,i.buffer),a.enableVertexAttribArray(n),a.vertexAttribPointer(n,i.spacing,R.FLOAT,!1,0,0),w=Math.min(w,i.count)):r.startsWith("ts_")||console.warn(`[shader ${this.name}] Vertex buffer ${r} was not bound because the attribute is not active.`)}for(const t in this.attributeLocations)t in e||a.disableVertexAttribArray(this.attributeLocations[t]);if(ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .NLA_DEBUG */ .wU){const t=a.getProgramParameter(this.program,a.ACTIVE_ATTRIBUTES);for(let e=0;e<t;++e)if(!a.getVertexAttrib(e,a.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING)){const t=a.getActiveAttrib(this.program,e);this.constantAttributes[t.name]||this.outputWarnings[t.name]||(this.outputWarnings[t.name]=!0,console.warn("No buffer is bound to attribute "+t.name+" and it was not set with .attributes()"))}}if(w){if(void 0===s&&(s=i?i.count:w),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(B[n](s),"count "+s+"doesn\'t fulfill requirement +"+B[n].toString()+" for mode "+M[n]),i){if((0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(i.hasBeenCompiled),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(w>i.maxValue),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(s%i.spacing==0),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(o%i.spacing==0),o+s>i.count)throw Error("Buffer not long enough for passed parameters start/length/buffer length "+o+" "+s+" "+i.count);a.bindBuffer(R.ELEMENT_ARRAY_BUFFER,i.buffer),a.drawElements(n,s,i.bindSize,i.type.BYTES_PER_ELEMENT*o)}else{if(o+s>w)throw Error("invalid");a.drawArrays(n,o,s)}a.drawCallCount++}return this}}class U{constructor(t,e,r={},i=rt()){this.gl=i,this.width=t,this.height=e,this.format=r.format||i.RGBA,this.internalFormat=r.internalFormat||i.RGBA,this.type=r.type||i.UNSIGNED_BYTE;const n=r.filter||r.magFilter||i.LINEAR,o=r.filter||r.minFilter||i.LINEAR;if(this.type===i.FLOAT){if(2!=i.version&&!i.getExtension("OES_texture_float"))throw Error("OES_texture_float is required but not supported");if((o!==i.NEAREST||n!==i.NEAREST)&&!i.getExtension("OES_texture_float_linear"))throw Error("OES_texture_float_linear is required but not supported")}else if(this.type===i.HALF_FLOAT_OES){if(!i.getExtension("OES_texture_half_float"))throw Error("OES_texture_half_float is required but not supported");if((o!==i.NEAREST||n!==i.NEAREST)&&!i.getExtension("OES_texture_half_float_linear"))throw Error("OES_texture_half_float_linear is required but not supported")}this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,r.wrap||r.wrapS||i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,r.wrap||r.wrapT||i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,this.internalFormat,t,e,0,this.format,this.type,r.data)}setData(t){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.internalFormat,this.width,this.height,0,this.format,this.type,t)}downloadData(t){if(!this.framebuffer)throw Error("No framebuffer. You need to draw to this texture before it makes sense to read from it.");const e=this.gl,r=e.getParameter(e.FRAMEBUFFER_BINDING);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.readPixels(0,0,this.width,this.height,this.format,this.type,t),r!==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,r)}bind(t){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(t){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}drawTo(t){const e=this.gl,r=e.getParameter(e.FRAMEBUFFER_BINDING);if(this.framebuffer)r!==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer);else{const t=e.getParameter(e.RENDERBUFFER_BINDING),r=e.createRenderbuffer();if(e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height),e.bindRenderbuffer(e.RENDERBUFFER,t),this.framebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,r),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)throw Error("Rendering to this texture is not supported (incomplete this.framebuffer)")}const i=e.getParameter(e.VIEWPORT);e.viewport(0,0,this.width,this.height),t(e),r!==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,r),e.viewport(i[0],i[1],i[2],i[3])}swapWith(e){let r;(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(this.gl==e.gl),r=e.texture,e.texture=this.texture,this.texture=r,r=e.width,e.width=this.width,this.width=r,r=e.height,e.height=this.height,this.height=r,r=e.framebuffer,e.framebuffer=this.framebuffer,this.framebuffer=r}static fromImage(t,e={},r=rt()){const i=new U(t.width,t.height,e,r);try{r.texImage2D(r.TEXTURE_2D,0,i.format,i.format,i.type,t)}catch(t){throw"file:"==location.protocol?Error(\'imgElement not loaded for security reasons (serve this page over "http://" instead)\'):Error("imgElement not loaded for security reasons (imgElement must originate from the same domain as this page or use Cross-Origin Resource Sharing)")}return e.minFilter&&e.minFilter!=r.NEAREST&&e.minFilter!=r.LINEAR&&r.generateMipmap(r.TEXTURE_2D),i}static fromURLSwitch(t,e,r=rt()){U.checkerBoardCanvas=U.checkerBoardCanvas||function(){const t=document.createElement("canvas").getContext("2d");if(!t)throw Error("Could not create 2d canvas.");t.canvas.width=t.canvas.height=128;for(let e=0;e<t.canvas.height;e+=16)for(let r=0;r<t.canvas.width;r+=16)t.fillStyle=16&(r^e)?"#FFF":"#DDD",t.fillRect(r,e,16,16);return t.canvas}();const i=U.fromImage(U.checkerBoardCanvas,e),n=new Image;return n.onload=()=>U.fromImage(n,e,r).swapWith(i),n.onerror=()=>{throw Error("Could not load image "+n.src+". 404?")},n.src=t,i}static fromURL(t,e,r=rt()){return new Promise(((i,n)=>{const o=new Image;o.onload=()=>i(U.fromImage(o,e,r)),o.onerror=t=>n("Could not load image "+o.src+". 404?"+t),o.src=t}))}}const W=WebGLRenderingContext,j={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}};let k=null,z=null;function Q(){if(null===k){k={},z={};const t=window.WebGL2RenderingContext||window.WebGLRenderingContext;if(!t)throw Error("Neither WebGL2RenderingContext nor WebGLRenderingContext exists on window.");for(const e in t){const r=t[e];"number"==typeof r&&(k[r]=e,z[e]=r)}}}function q(t){return Q(),void 0!==k[t]}function $(t){Q();var e=k[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function Y(t,e,r,i){const n=j[t];if(void 0!==n){const t=n[e];if(void 0!==t){const e=t[r];if(e){if("object"==typeof e){const t=e.enumBitwiseOr,r=[];let n=0;for(let e=0;e<t.length;++e){const o=z[t[e]];0!=(i&o)&&(n|=o,r.push($(o)))}return n===i?r.join(" | "):$(i)}return $(i)}}}return null===i?"null":void 0===i?"undefined":i.toString()}function H(t,e){for(var r="",i=e.length,n=0;n<i;++n)r+=(0==n?"":", ")+Y(t,i,n,e[n]);return r}function X(t,e,r){t.__defineGetter__(r,(function(){return e[r]})),t.__defineSetter__(r,(function(t){e[r]=t}))}function J(t,e,r,i=t){Q(),e=e||function(t,e,r){var i,n="",o=r.length;for(let t=0;t<o;++t)n+=(0==t?"":", ")+Y(e,o,t,r[t]);i="WebGL error "+$(t)+" in "+e+"("+n+")",window.console&&window.console.error?window.console.error(i):function(t){window.console&&window.console.log&&window.console.log(t)}(i)};const n={};function o(t,o){return function(...s){r&&r(o,s);const a=t[o].apply(t,s),c=i.getError();return 0!=c&&(n[c]=!0,e(c,o,s)),a}}const s={};for(let n in t)if("function"==typeof t[n])if("getExtension"!=n)s[n]=o(t,n);else{let a=o(t,n);s[n]=function(){const n=a.apply(t,arguments);return n?J(n,e,r,i):null}}else X(s,t,n);return s.getError=function(){for(const t in n)if(n.hasOwnProperty(t)&&n[t])return n[t]=!1,parseInt(t);return t.NO_ERROR},s}function K(t){return!!t.createTransformFeedback}function Z(t){K(t)&&t.bindVertexArray(null);const e=t.getParameter(t.MAX_VERTEX_ATTRIBS),r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r);for(let r=0;r<e;++r)t.disableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(r,0),K(t)&&t.vertexAttribDivisor(r,0);t.deleteBuffer(r);const i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(let e=0;e<i;++e)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null),K(t)&&(t.bindTexture(t.TEXTURE_2D_ARRAY,null),t.bindTexture(t.TEXTURE_3D,null),t.bindSampler(e,null));if(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),K(t)){t.drawBuffers([t.BACK]),t.readBuffer(t.BACK),t.bindBuffer(t.COPY_READ_BUFFER,null),t.bindBuffer(t.COPY_WRITE_BUFFER,null),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),t.bindBuffer(t.PIXEL_UNPACK_BUFFER,null);const e=t.getParameter(t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(let r=0;r<e;++r)t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,r,null);const r=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);for(let e=0;e<r;++e)t.bindBufferBase(t.UNIFORM_BUFFER,e,null);t.disable(t.RASTERIZER_DISCARD),t.pixelStorei(t.UNPACK_IMAGE_HEIGHT,0),t.pixelStorei(t.UNPACK_SKIP_IMAGES,0),t.pixelStorei(t.UNPACK_ROW_LENGTH,0),t.pixelStorei(t.UNPACK_SKIP_ROWS,0),t.pixelStorei(t.UNPACK_SKIP_PIXELS,0),t.pixelStorei(t.PACK_ROW_LENGTH,0),t.pixelStorei(t.PACK_SKIP_ROWS,0),t.pixelStorei(t.PACK_SKIP_PIXELS,0),t.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT,t.DONT_CARE)}for(;t.getError(););}function tt(t){const e=t;let r;const i=[],n=[];let o={},s=1,a=!1;const c=[];let h=0,f=0,u=!1,l=0;const m={};var d;function w(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function b(t){i.push(w(t))}function g(t){n.push(w(t))}function x(){const t=Object.keys(m);for(let e=0;e<t.length;++e)delete m[t[e]]}function p(){++f,a||h==f&&e.loseContext()}function _(t,e){const r=t[e];return function(){if(p(),!a)return r.apply(t,arguments)}}function y(t){return{statusMessage:t,preventDefault:function(){u=!0}}}return e.getContext=(d=e.getContext,function(){const t=d.apply(e,arguments);if(t instanceof W||window.WebGL2RenderingContext&&t instanceof WebGL2RenderingContext){if(t!=r){if(r)throw Error("got different context");r=t,o=E(r)}return o}return t}),function(t){const e=t.addEventListener;t.addEventListener=function(r,i){switch(r){case"webglcontextlost":b(i);break;case"webglcontextrestored":g(i);break;default:e.apply(t,arguments)}}}(e),e.loseContext=function(){if(!a){for(a=!0,h=0,++s;r.getError();)x();m[r.CONTEXT_LOST_WEBGL]=!0;const t=y("context lost"),n=i.slice();setTimeout((function(){for(let e=0;e<n.length;++e)n[e](t);l>=0&&setTimeout((function(){e.restoreContext()}),l)}),0)}},e.restoreContext=function(){a&&n.length&&setTimeout((function(){if(!u)throw Error("can not restore. webglcontestlost listener did not call event.preventDefault");!function(){for(let t=0;t<c.length;++t){const e=c[t];e instanceof WebGLBuffer?r.deleteBuffer(e):e instanceof WebGLFramebuffer?r.deleteFramebuffer(e):e instanceof WebGLProgram?r.deleteProgram(e):e instanceof WebGLRenderbuffer?r.deleteRenderbuffer(e):e instanceof WebGLShader?r.deleteShader(e):e instanceof WebGLTexture?r.deleteTexture(e):K(r)&&(e instanceof WebGLQuery?r.deleteQuery(e):e instanceof WebGLSampler?r.deleteSampler(e):e instanceof WebGLSync?r.deleteSync(e):e instanceof WebGLTransformFeedback?r.deleteTransformFeedback(e):e instanceof WebGLVertexArrayObject&&r.deleteVertexArray(e))}}(),Z(r),a=!1,f=0,u=!1;const t=n.slice(),e=y("context restored");for(let r=0;r<t.length;++r)t[r](e)}),0)},e.loseContextInNCalls=function(t){if(a)throw Error("You can not ask a lost context to be lost");h=f+t},e.getNumCalls=function(){return f},e.setRestoreTimeout=function(t){l=t},e;function E(t){for(const e in t)"function"==typeof t[e]?o[e]=_(t,e):X(o,t,e);o.getError=function(){if(p(),!a){let t;for(;t=r.getError();)m[t]=!0}for(const t in m)if(m[t])return delete m[t],t;return o.NO_ERROR};const e=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];K(t)&&e.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(let r=0;r<e.length;++r){const i=e[r];o[i]=function(e){return function(){if(p(),a)return null;const r=e.apply(t,arguments);return r.t=s,c.push(r),r}}(t[i])}const i=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];K(t)&&i.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(let e=0;e<i.length;++e){const r=i[e];o[r]=function(e){return function(){return p(),a?null:e.apply(t,arguments)}}(o[r])}const n=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];K(t)&&n.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(let e=0;e<n.length;++e){const r=n[e];o[r]=function(e){return function(){return p(),!a&&e.apply(t,arguments)}}(o[r])}return o.checkFramebufferStatus=function(e){return function(){return p(),a?o.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(o.checkFramebufferStatus),o.getAttribLocation=function(e){return function(){return p(),a?-1:e.apply(t,arguments)}}(o.getAttribLocation),o.getVertexAttribOffset=function(e){return function(){return p(),a?0:e.apply(t,arguments)}}(o.getVertexAttribOffset),o.isContextLost=function(){return a},K(t)&&(o.getFragDataLocation=function(e){return function(){return p(),a?-1:e.apply(t,arguments)}}(o.getFragDataLocation),o.clientWaitSync=function(e){return function(){return p(),a?o.WAIT_FAILED:e.apply(t,arguments)}}(o.clientWaitSync),o.getUniformBlockIndex=function(e){return function(){return p(),a?o.INVALID_INDEX:e.apply(t,arguments)}}(o.getUniformBlockIndex)),o}}const et=[0,0,0,1];function rt(){return nt.gl}function it(t){const e=Object.prototype.toString.call(t);return"[object Number]"==e||"[object Boolean]"==e}class nt{constructor(t,e={mesh:(new P).addVertexBuffer("coords","ts_TexCoord").addVertexBuffer("colors","ts_Color"),mode:-1,coord:[0,0],color:[1,1,1,1],pointSize:1,shader:D.create("\\n        attribute vec4 ts_Color;\\n        attribute vec4 ts_Vertex;\\n        uniform mat4 ts_ModelViewProjectionMatrix;\\n        attribute vec2 ts_TexCoord;\\n        uniform float pointSize;\\n        varying vec4 color;\\n        varying vec2 coord;\\n        void main() {\\n            color = ts_Color;\\n            coord = ts_TexCoord;\\n            gl_Position = ts_ModelViewProjectionMatrix * ts_Vertex;\\n            gl_PointSize = pointSize;\\n        }\\n        ","\\n        precision highp float;\\n        uniform sampler2D texture;\\n        uniform float pointSize;\\n        // uniform bool useTexture;\\n        varying vec4 color;\\n        varying vec2 coord;\\n        void main() {\\n            gl_FragColor = color;\\n            // if (useTexture) gl_FragColor *= texture2D(texture, coord.xy);\\n        }\\n        ",t)}){this.immediate=e,this.modelViewMatrix=ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.identity(),this.projectionMatrix=ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.identity(),this.tempMatrix=new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4,this.resultMatrix=new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4,this.modelViewStack=[],this.projectionStack=[],this.drawCallCount=0,this.projectionMatrixVersion=0,this.modelViewMatrixVersion=0,this.cachedSDFMeshes={},this.matrixMode(nt.MODELVIEW)}matrixMode(t){switch(t){case this.MODELVIEW:this.currentMatrixName="modelViewMatrix",this.stack=this.modelViewStack;break;case this.PROJECTION:this.currentMatrixName="projectionMatrix",this.stack=this.projectionStack;break;default:throw Error("invalid matrix mode "+t)}}loadIdentity(){ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.identity(this[this.currentMatrixName]),"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}loadMatrix(t){ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.copy(t,this[this.currentMatrixName]),"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}multMatrix(t){ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.multiply(this[this.currentMatrixName],t,this.resultMatrix);const e=this.resultMatrix;this.resultMatrix=this[this.currentMatrixName],this[this.currentMatrixName]=e,"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}mirror(t){this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.mirror(t))}perspective(t,e,r,n){this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.perspectiveRad(t*ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .DEG */ .Co,e,r,n,this.tempMatrix))}frustum(t,e,r,n,o,s){this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.frustum(t,e,r,n,o,s,this.tempMatrix))}ortho(t,e,r,n,o,s){this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.ortho(t,e,r,n,o,s,this.tempMatrix))}scale(...t){this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.scale(...t,this.tempMatrix))}mirroredX(){this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.mirror(ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .P3ZX */ .Fw))}translate(t,e,r){void 0!==e?this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.translate(t,e,r,this.tempMatrix)):this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.translate(t,this.tempMatrix))}rotate(t,e,r,n){this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.rotate(t*ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .DEG */ .Co,{x:e,y:r,z:n},this.tempMatrix))}lookAt(t,e,r){this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.lookAt(t,e,r,this.tempMatrix))}pushMatrix(){this.stack.push(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.copy(this[this.currentMatrixName]))}popMatrix(){const e=this.stack.pop();(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(void 0!==e),this[this.currentMatrixName]=e,"projectionMatrix"==this.currentMatrixName?this.projectionMatrixVersion++:this.modelViewMatrixVersion++}wcToWindowMatrix(){const t=this.getParameter(this.VIEWPORT),[e,r,n,o]=t,s=new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4([n/2,0,0,e+n/2,o/2,0,0,r+o/2,0,0,1,0,0,0,0,1]);return ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.product(s,this.projectionMatrix,this.modelViewMatrix)}pointSize(t){this.immediate.shader.uniforms({pointSize:t})}begin(t){if(-1!=this.immediate.mode)throw Error("mismatched viewerGL.begin() and viewerGL.end() calls");this.immediate.mode=t,this.immediate.mesh.colors=[],this.immediate.mesh.coords=[],this.immediate.mesh.vertices=[]}color(...t){this.immediate.color=1==t.length&&Array.isArray(t[0])?t[0]:1==t.length&&"number"==typeof t[0]?function(t){return[(t>>16)/255,(t>>8&255)/255,(255&t)/255,1]}(t[0]):1==t.length&&"string"==typeof t[0]?(0,chroma_ts__WEBPACK_IMPORTED_MODULE_2__/* .color */ .$_)(t[0]).gl():[t[0],t[1],t[2],t[3]||1]}texCoord(...t){this.immediate.coord=ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V.apply(void 0,t).toArray(2)}vertex(...t){this.immediate.mesh.colors.push(this.immediate.color),this.immediate.mesh.coords.push(this.immediate.coord),this.immediate.mesh.vertices.push(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V.apply(void 0,t))}end(){if(-1==this.immediate.mode)throw Error("mismatched viewerGL.begin() and viewerGL.end() calls");this.immediate.mesh.compile(),this.immediate.shader.uniforms({useTexture:!!nt.gl.getParameter(this.TEXTURE_BINDING_2D)}).drawBuffers(this.immediate.mesh.vertexBuffers,void 0,this.immediate.mode),this.immediate.mode=-1}makeCurrent(){nt.gl=this}animate(t){const e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){setTimeout((()=>t(performance.now())),1e3/60)};let r=performance.now(),i=!0;const n=o=>{i&&(t.call(this,o,o-r),r=o,e(n))};return e(n),()=>{i=!1}}fullscreen(t={}){const e=t.paddingTop||0,r=t.paddingLeft||0,i=t.paddingRight||0,n=t.paddingBottom||0;if(!document.body)throw Error("document.body doesn\'t exist yet (call viewerGL.fullscreen() from window.onload() or from inside the <body> tag)");return Object.assign(this.canvas.style,{position:"absolute",left:r+"px",top:e+"px",width:window.innerWidth-r-i+"px",height:window.innerHeight-e-n+"px"}),this.addResizeListener(),this}addResizeListener(t={}){const e=this;function r(){const r=e.canvas.getBoundingClientRect();e.canvas.width=r.width*window.devicePixelRatio,e.canvas.height=r.height*window.devicePixelRatio,e.viewport(0,0,e.canvas.width,e.canvas.height),t.camera&&(e.matrixMode(nt.PROJECTION),e.loadIdentity(),e.perspective(t.fov||45,e.canvas.width/e.canvas.height,t.near||.1,t.far||1e3),e.matrixMode(nt.MODELVIEW))}return window.addEventListener("resize",r),r(),this}getMouseLine(t,e){if(t instanceof MouseEvent)return this.getMouseLine(t.offsetX,t.offsetY);const r=(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V)(2*t/this.canvas.offsetWidth-1,2*-e/this.canvas.offsetHeight+1,0),i=(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V)(2*t/this.canvas.offsetWidth-1,2*-e/this.canvas.offsetHeight+1,1),n=this.projectionMatrix.inversed(),o=n.transformPoint(r);return{anchor:o,dir:n.transformPoint(i).minus(o)}}viewportFill(){this.viewport(0,0,this.canvas.width,this.canvas.height)}setupTextRendering(t,e){return (0,tslib__WEBPACK_IMPORTED_MODULE_3__/* .__awaiter */ .mG)(this,void 0,void 0,(function*(){this.textRenderShader=D.create("attribute vec2 ts_TexCoord;attribute vec4 ts_Vertex;uniform mat4 ts_ModelViewProjectionMatrix;varying vec2 coord;void main(){coord=ts_TexCoord.xy;gl_Position=ts_ModelViewProjectionMatrix*ts_Vertex;}","precision mediump float;uniform sampler2D u_texture;uniform vec4 u_color;uniform float u_buffer;uniform float u_gamma;uniform float u_debug;varying vec2 coord;void main(){float dist=texture2D(u_texture,coord).r;if(u_debug>0.0){gl_FragColor=vec4(dist,dist,dist,1);}else{float alpha=smoothstep(u_buffer-u_gamma,u_buffer+u_gamma,dist);gl_FragColor=vec4(u_color.rgb,alpha*u_color.a);if(gl_FragColor.a==0.0){discard;}}}"),[this.textAtlas,this.textMetrics]=yield Promise.all([U.fromURL(t,{format:this.LUMINANCE,internalFormat:this.LUMINANCE,type:this.UNSIGNED_BYTE}),fetch(e).then((t=>t.json()))])}))}getSDFMeshForString(r){return (0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .assert */ .hu)(this.textMetrics),this.cachedSDFMeshes[r]||(this.cachedSDFMeshes[r]=function(t,r,i,n=1){const o=(new P).addIndexBuffer("TRIANGLES").addVertexBuffer("coords","ts_TexCoord");let s=0,a=0;function c(i){const n=t.chars[i];if(!n)return;const[c,h,f,u,l,m,d]=n,{size:w,buffer:b}=t,g=o.vertices.length;if(c>0&&h>0){const t=(s+f-b)/w,i=(s+f+c+b)/w,n=(u-h-b)/w,l=(u+b)/w;o.vertices.push(new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(t,n,a/w),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(i,n,a/w),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(t,l,a/w),new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(i,l,a/w));const x=m/r.width,p=(m+c+2*b)/r.width,_=(d+h+2*b)/r.height,y=d/r.height;o.coords.push([x,_],[p,_],[x,y],[p,y]),st(o.TRIANGLES,!1,g,g+1,g+2,g+3)}s+=l}for(let e=0;e<i.length;e++){const r=i[e];"\\n"==r?(s=0,a+=n*t.size):c(r)}return Object.assign(o.compile(),{width:s/t.size,lineCount:a+1})}(this.textMetrics,this.textAtlas,r))}renderText(t,r,n=1,o="left",s="bottom",a=.05,c=1.2){const h=this.getSDFMeshForString(t);this.pushMatrix(),this.scale(n);const f={top:-this.textMetrics.ascender/this.textMetrics.size,middle:(-this.textMetrics.ascender-this.textMetrics.descender)/2/this.textMetrics.size,alphabetic:0,bottom:-this.textMetrics.descender/this.textMetrics.size};this.translate({left:0,center:-.5,right:-1}[o]*h.width,f[s],0),this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.forSys(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.X,ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3.Y,new ts3dutils__WEBPACK_IMPORTED_MODULE_0__.V3(0,-c,0))),this.textAtlas.bind(0),this.textRenderShader.uniforms({texture:0,u_color:r,u_debug:0,u_gamma:a,u_buffer:.75}).draw(h),this.popMatrix()}static create(t={}){const e=t.canvas||document.createElement("canvas");let r;t.canvas||(e.width=800,e.height=600),"alpha"in t||(t.alpha=!1);try{r=e.getContext("webgl2",t),r&&(r.version=2),r||(r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r&&(r.version=1))}catch(t){console.log(t,"Failed to get context")}if(!r)throw Error("WebGL not supported");return t.throwOnError&&(r=J(r,((t,e)=>{throw Error($(t)+" was caused by "+e)}))),nt.gl=r,(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .addOwnProperties */ .zy)(r,nt.prototype),(0,ts3dutils__WEBPACK_IMPORTED_MODULE_0__/* .addOwnProperties */ .zy)(r,new nt(r)),r}fixCanvasRes(t=1/0){this.canvas.width=this.canvas.clientWidth*Math.min(window.devicePixelRatio,t),this.canvas.height=this.canvas.clientHeight*Math.min(window.devicePixelRatio,t),this.viewport(0,0,this.canvas.width,this.canvas.height)}drawVector(t,e,r=et,n=1){if(t.likeO())return;this.pushMatrix();const o=4*n;if(o>t.length())return;const s=t.getPerpendicular().unit();this.multMatrix(ts3dutils__WEBPACK_IMPORTED_MODULE_0__.M4.forSys(t.unit(),s,t.cross(s).unit(),e)),this.scale(t.length()-o,n/2,n/2),this.shaders.singleColor.uniforms({color:r}).draw(this.meshes.vectorShaft),this.scale(1/(t.length()-o),1,1),this.translate(t.length()-o,0,0),this.scale(o/2,1,1),this.shaders.singleColor.draw(this.meshes.vectorHead),this.popMatrix()}}var ot;function st(t,e,r,i,n,o){e?t.push(r,n,i,i,n,o):t.push(r,i,n,i,o,n)}nt.MODELVIEW=0,nt.PROJECTION=1,nt.HALF_FLOAT_OES=36193,function(t){t.create=nt.create}(ot||(ot={})),nt.prototype.MODELVIEW=nt.MODELVIEW,nt.prototype.PROJECTION=nt.PROJECTION,nt.prototype.HALF_FLOAT_OES=nt.HALF_FLOAT_OES;\n\n\n//# sourceURL=webpack://workshop/../nla/tsgl/lib/index.es.min.js?')}}]);