(self.webpackChunkworkshop=self.webpackChunkworkshop||[]).push([[634],{7205:(t,o,e)=>{"use strict";e.r(o),e.d(o,{quickhull:()=>d,default:()=>f});var n=e(2182),a=e(9392),r=e(7392),s=e(9526);const i="C:\\Users\\aval\\tsdev\\workshop\\src\\delta3d\\index.tsx";r.$_("blue").gl();class l{__init3(){this.children=[]}constructor(t=n.M4.IDENTITY,o,e,...a){this.transform=t,this.mesh=o,this.color=e,l.prototype.__init3.call(this),a.forEach((t=>this.add(t)))}add(...t){for(const o of t)this.children.push(o),o.parent=this}getTransform(t){let o=t.transform;for(;t.parent!=this;)o=(t=t.parent).transform.times(o);return o}withGimbal(){return this.gimbal=!0,this}}const c=new l;function m(t,o){return t.map((t=>{const e=o.xy().distanceTo(t);return o.z+Math.sqrt(144-e*e)+1}))}function d(t){const o={pos:(0,n.V)(.75,0,1),lookDir:(0,n.V)(0,0,-1),axisPoss:[0,0,0]},e=()=>{localStorage.setItem("viewState",JSON.stringify({pos:o.pos.toArray(),lookDir:o.lookDir.toArray(),axisPoss:o.axisPoss}))};(()=>{if(null!=localStorage.getItem("viewState")){const t=JSON.parse(localStorage.getItem("viewState"));o.pos=n.V3.fromArray(t.pos),o.lookDir=n.V3.fromArray(t.lookDir),o.axisPoss=t.axisPoss||o.axisPoss}})();const s=a.Kj.cube();console.log("cubeMesh",s);const i=a.Kj.rotation([n.V3.O,(0,n.V)(1,0,1)],{anchor:n.V3.O,dir1:n.V3.Z},n.gc,16),d=(a.Kj.plane(),a.Kj.sphere(1).computeWireframeFromFlatTrianglesClosedMesh().compile()),f=a.Kj.spiral([(0,n.V)(-.1,1),(0,n.V)(0,1.1),(0,n.V)(.1,1,0)],{anchor:n.V3.O,dir1:n.V3.X},320*n.gc,5120,.2).computeNormalsFromFlatTriangles().compile();console.log("spiralMesh",f);const v=a.Kj.rotation([n.V3.Y,n.V3.XY],{anchor:n.V3.O,dir1:n.V3.X},2*Math.PI,16,!0),u=a.Kj.rotation([n.V3.O,n.V3.X,(0,n.V)(1,0,1),n.V3.Z],{anchor:n.V3.O,dir1:n.V3.Z},2*n.PI,3),p=new a.lW(t.ARRAY_BUFFER,Float32Array);let g=0;const h=r.bA("yellow","black").colors(6,"gl");console.log(d);const V=[],M=[],x=[],w=[];let y,_=[];c.add(new l(n.M4.translate((0,n.V)(-.5,-.5,-1)).scale(30,30,1),s,r.iv("lightgreen").gl()).withGimbal(),y=new l(n.M4.translate(0,0,5),void 0,void 0,new l(n.M4.scale(3,3,1).rotateZ(Math.PI/3),u,r.iv("orange").gl()),new l(n.M4.translate(0,0,-1),i,r.iv("silver").gl()),...[0,1,2].flatMap((t=>[0,1].map((o=>w[2*t+o]=new l(n.M4.scale(.2).translate(1.5,o?1.5:-1.5,.5).rotateZ(n.gc*(1/3*t)),d,h[2*t+o])))))),...[0,1,2,3,4,5].map((t=>_[t]=new l(void 0,v,h[t]))),...[0,1,2].map((t=>new l(n.M4.translate(10,0,0).rotateZ(2*n.PI/3*t),void 0,void 0,M[t]=new l(n.M4.rotateY(-n.PI/2),f,r.iv("green").gl()),new l(n.M4.scale(.4).translate(-2.5,0,0),s,r.iv("cyan").gl()),V[t]=new l(n.M4.translate(0,0,o.axisPoss[t]),void 0,void 0,new l(n.M4.translate(-.5,-.5).scale(2,3,1),s,r.iv("blue").gl()),...[0,1].map((o=>x[2*t+o]=new l(n.M4.scale(.2).translate(-1,o?1.5:-1.5,.5),d,h[2*t+o]))))))));const P=[0,1,2].map((t=>c.getTransform(V[t]).transformPoint((0,n.V)(-2.5,0,0)).xy()));function I(){[0,1,2].forEach((t=>{V[t].transform=n.M4.translate(0,0,o.axisPoss[t]),M[t].transform=n.M4.scale(1,.5,.5).rotateX(n.gc*-o.axisPoss[t]/.2).rotateY(-n.PI/2)}));const[t,e,a]=[0,1,2].map((t=>c.getTransform(V[t]).transformPoint((0,n.V)(-2.5,0,0)))),r=function(t,o,e,a,r,s){const i=t.to(e).unit(),l=t.to(r).rejectedFrom1(i).unit(),c=n.M4.forSys(i,l,void 0,t),m=t.to(e).length(),d=t.to(r).dot(i),f=t.to(r).dot(l),v=(0+m*m)/(2*m),u=(0-2*d*v+d*d+f*f)/(2*f),p=(0,n.V)(v,u,Math.sqrt(144-v*v-u*u));return c.transformPoint(p)}(e,0,t,0,a);y.transform=n.M4.translate(r);for(let t=0;t<6;t++){const o=c.getTransform(x[t]).O,e=c.getTransform(w[t]).O;_[t].transform=n.M4.scale(12,.1,.1).rotateAB(n.V3.X,o.to(e)).translate(o)}}o.axisPoss=m(P,n.V3.O),I();const k=a.ex.create("\n\tuniform mat4 ts_ModelViewMatrix;\n\tuniform mat3 ts_NormalMatrix;\n\tuniform mat4 ts_ModelViewProjectionMatrix;\n\tuniform float pointSize;\n\n\tattribute vec4 ts_Vertex;\n\tattribute vec3 ts_Normal;\n\n\tvarying vec3 coordUVQ;\n\tvarying vec2 coord;\n\tvarying vec3 normal;\n\tvarying vec3 position;\n\n\tvoid main() {\n\n\t  gl_Position = ts_ModelViewProjectionMatrix * ts_Vertex;\n\t  gl_PointSize = pointSize;\n\n\t  normal =ts_Normal;\n\t  vec4 position4 = ts_ModelViewMatrix * ts_Vertex;\n\t  position = position4.xyz;\n\t}\n  ","\n\tprecision highp float;\n\n\tuniform sampler2D texture;\n\tuniform vec3 lightPos;\n\tuniform vec4 color;\n\n\tvarying vec3 coordUVQ;\n\tvarying vec2 coord;\n\tvarying vec3 normal;\n\tvarying vec3 position;\n\n\tvoid main() {\n\t\tvec3 normal1 = normalize(normal);\n\t\tvec3 lightPos = vec3(1000, 2000, 4000);\n\t\tvec3 lightDir = normalize(position.xyz - lightPos);\n        float uMaterialShininess = 256.0;\n\t\tfloat lightIntensity = 0.2 + 0.8 * max(0.0, -dot(lightDir, normal1));\n\t\tgl_FragColor = vec4(normal,1.0);\n\t\tgl_FragColor = vec4(vec3(color) * lightIntensity, 1);\n\t}\n\t  ");t.clearColor(1,1,1,0),t.cullFace(t.BACK);const E=()=>{t.matrixMode(t.PROJECTION),t.loadIdentity(),t.perspective(70,t.canvas.width/t.canvas.height,.1,1e3),t.lookAt((0,n.V)(.75,0,1),(0,n.V)(.75,0,0),n.V3.Y),t.matrixMode(t.MODELVIEW)};E(),t.pointSize(10),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);let O={};console.log(t.canvas),t.canvas.contentEditable="true",t.canvas.focus(),t.canvas.onkeydown=function(o){O[o.key]=!0,"2"===o.key&&E(),"1"===o.key&&(t.matrixMode(t.PROJECTION),t.loadIdentity(),t.perspective(70,t.canvas.width/t.canvas.height,.1,1e3),t.lookAt((0,n.V)(0,.5,2.2),n.V3.O,n.V3.Y),t.matrixMode(t.MODELVIEW))},t.canvas.onkeypress=function(t){new n.V3(0,0,0)},t.canvas.onkeyup=function(t){O[t.key]=!1};let b=n.V3.O,C=n.M4.IDENTITY;function T(o){t.pushMatrix(),t.multMatrix(o.transform),o.gimbal&&t.drawGimbal(.1),o.mesh&&k.uniforms({color:o.color,pointSize:12,lightPos:(0,n.V)(100,0,100).toLength(-1)}).draw(o.mesh),o.children.forEach(T),t.popMatrix()}function D(t,o){return+!!O[t]-+!!O[o]}t.canvas.onmousemove2=function(t){const o=(0,n.V)(t.pageX,t.pageY),e=b.to(o);1&t.buttons&&(C=C.rotateZ(.25*e.x*n.Co),C=C.rotateX(.25*e.y*n.Co)),b=o},t.canvas.onmousemove=function(t){const e=(0,n.V)(t.pageX,t.pageY),a=b.to(e);if(1&t.buttons){const t=n.M4.rotateY(.25*-a.x*n.Co).rotateX(.25*-a.y*n.Co);o.lookDir=t.transformVector(o.lookDir).unit()}b=e};const S=[["u","j"],["i","k"],["o","l"]];return p.data[g++]=n.V3.O,p.data[g++]=n.V3.O,t.animate((function(a,s){const i=n.M4.rotateX(70*n.Co).translate(0,0,3).transformPoint(n.V3.polar(2,a/500,1+a/1e5));o.axisPoss=m(P,i),p.data[g++]=i,p.compile(),I();for(let t=0;t<3;t++){const n=.1*D(...S[t]);0!==n&&(o.axisPoss[t]+=n,I(),e())}const l=new n.V3(+!!O.w-+!!O.s,+!!O.a-+!!O.d,+!!O.e-+!!O.q+ +!!O[" "]).times(.05);if(!l.likeO()){const t=o.lookDir;o.pos=o.pos.plus(n.M4.forSys(t,n.V3.Y.cross(t).unit()).transformVector(l)),e()}t.matrixMode(t.PROJECTION),t.loadIdentity(),t.perspective(70,t.canvas.width/t.canvas.height,.1,1e3),t.lookAt(o.pos,o.pos.plus(o.lookDir),n.V3.Y),t.matrixMode(t.MODELVIEW),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.loadIdentity(),t.rotate(-90,1,0,0),t.drawGimbal(.1),T(c),k.uniforms({color:r.iv("red").gl()}).drawBuffers({ts_Vertex:p},void 0,t.LINE_STRIP)}))}const f=()=>{const t=(0,s.useRef)(null);return(0,s.useEffect)((()=>{const o=a.ZG.create({canvas:t.current});o.fixCanvasRes(),o.addResizeListener(),d(o)}),[]),s.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100%"},__self:void 0,__source:{fileName:i,lineNumber:539}},s.createElement("canvas",{ref:t,style:{flexGrow:1},tabIndex:0,__self:void 0,__source:{fileName:i,lineNumber:540}}))}}}]);